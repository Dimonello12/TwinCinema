var Sx=Object.defineProperty;var xx=(n,e,t)=>e in n?Sx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var wc=(n,e,t)=>xx(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function _x(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var k0={exports:{}},Yu={},D0={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bo=Symbol.for("react.element"),Ax=Symbol.for("react.portal"),Ix=Symbol.for("react.fragment"),Lx=Symbol.for("react.strict_mode"),Rx=Symbol.for("react.profiler"),wx=Symbol.for("react.provider"),bx=Symbol.for("react.context"),kx=Symbol.for("react.forward_ref"),Dx=Symbol.for("react.suspense"),Px=Symbol.for("react.memo"),Cx=Symbol.for("react.lazy"),Gp=Symbol.iterator;function Nx(n){return n===null||typeof n!="object"?null:(n=Gp&&n[Gp]||n["@@iterator"],typeof n=="function"?n:null)}var P0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C0=Object.assign,N0={};function ca(n,e,t){this.props=n,this.context=e,this.refs=N0,this.updater=t||P0}ca.prototype.isReactComponent={};ca.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ca.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function O0(){}O0.prototype=ca.prototype;function Jf(n,e,t){this.props=n,this.context=e,this.refs=N0,this.updater=t||P0}var eh=Jf.prototype=new O0;eh.constructor=Jf;C0(eh,ca.prototype);eh.isPureReactComponent=!0;var Vp=Array.isArray,M0=Object.prototype.hasOwnProperty,th={current:null},F0={key:!0,ref:!0,__self:!0,__source:!0};function U0(n,e,t){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)M0.call(e,r)&&!F0.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var u=Array(o),l=0;l<o;l++)u[l]=arguments[l+2];i.children=u}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:Bo,type:n,key:s,ref:a,props:i,_owner:th.current}}function Ox(n,e){return{$$typeof:Bo,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function nh(n){return typeof n=="object"&&n!==null&&n.$$typeof===Bo}function Mx(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var jp=/\/+/g;function bc(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Mx(""+n.key):e.toString(36)}function Bl(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Bo:case Ax:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+bc(a,0):r,Vp(i)?(t="",n!=null&&(t=n.replace(jp,"$&/")+"/"),Bl(i,e,t,"",function(l){return l})):i!=null&&(nh(i)&&(i=Ox(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(jp,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",Vp(n))for(var o=0;o<n.length;o++){s=n[o];var u=r+bc(s,o);a+=Bl(s,e,t,u,i)}else if(u=Nx(n),typeof u=="function")for(n=u.call(n),o=0;!(s=n.next()).done;)s=s.value,u=r+bc(s,o++),a+=Bl(s,e,t,u,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function nl(n,e,t){if(n==null)return n;var r=[],i=0;return Bl(n,r,"","",function(s){return e.call(t,s,i++)}),r}function Fx(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var dn={current:null},$l={transition:null},Ux={ReactCurrentDispatcher:dn,ReactCurrentBatchConfig:$l,ReactCurrentOwner:th};function B0(){throw Error("act(...) is not supported in production builds of React.")}Ke.Children={map:nl,forEach:function(n,e,t){nl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return nl(n,function(){e++}),e},toArray:function(n){return nl(n,function(e){return e})||[]},only:function(n){if(!nh(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ke.Component=ca;Ke.Fragment=Ix;Ke.Profiler=Rx;Ke.PureComponent=Jf;Ke.StrictMode=Lx;Ke.Suspense=Dx;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ux;Ke.act=B0;Ke.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=C0({},n.props),i=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=th.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(u in e)M0.call(e,u)&&!F0.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&o!==void 0?o[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){o=Array(u);for(var l=0;l<u;l++)o[l]=arguments[l+2];r.children=o}return{$$typeof:Bo,type:n.type,key:i,ref:s,props:r,_owner:a}};Ke.createContext=function(n){return n={$$typeof:bx,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:wx,_context:n},n.Consumer=n};Ke.createElement=U0;Ke.createFactory=function(n){var e=U0.bind(null,n);return e.type=n,e};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(n){return{$$typeof:kx,render:n}};Ke.isValidElement=nh;Ke.lazy=function(n){return{$$typeof:Cx,_payload:{_status:-1,_result:n},_init:Fx}};Ke.memo=function(n,e){return{$$typeof:Px,type:n,compare:e===void 0?null:e}};Ke.startTransition=function(n){var e=$l.transition;$l.transition={};try{n()}finally{$l.transition=e}};Ke.unstable_act=B0;Ke.useCallback=function(n,e){return dn.current.useCallback(n,e)};Ke.useContext=function(n){return dn.current.useContext(n)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(n){return dn.current.useDeferredValue(n)};Ke.useEffect=function(n,e){return dn.current.useEffect(n,e)};Ke.useId=function(){return dn.current.useId()};Ke.useImperativeHandle=function(n,e,t){return dn.current.useImperativeHandle(n,e,t)};Ke.useInsertionEffect=function(n,e){return dn.current.useInsertionEffect(n,e)};Ke.useLayoutEffect=function(n,e){return dn.current.useLayoutEffect(n,e)};Ke.useMemo=function(n,e){return dn.current.useMemo(n,e)};Ke.useReducer=function(n,e,t){return dn.current.useReducer(n,e,t)};Ke.useRef=function(n){return dn.current.useRef(n)};Ke.useState=function(n){return dn.current.useState(n)};Ke.useSyncExternalStore=function(n,e,t){return dn.current.useSyncExternalStore(n,e,t)};Ke.useTransition=function(){return dn.current.useTransition()};Ke.version="18.3.1";D0.exports=Ke;var Ee=D0.exports;const Bx=_x(Ee);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $x=Ee,Gx=Symbol.for("react.element"),Vx=Symbol.for("react.fragment"),jx=Object.prototype.hasOwnProperty,Hx=$x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kx={key:!0,ref:!0,__self:!0,__source:!0};function $0(n,e,t){var r,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)jx.call(e,r)&&!Kx.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Gx,type:n,key:s,ref:a,props:i,_owner:Hx.current}}Yu.Fragment=Vx;Yu.jsx=$0;Yu.jsxs=$0;k0.exports=Yu;var P=k0.exports,kd={},G0={exports:{}},Un={},V0={exports:{}},j0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(V,W){var Z=V.length;V.push(W);e:for(;0<Z;){var q=Z-1>>>1,X=V[q];if(0<i(X,W))V[q]=W,V[Z]=X,Z=q;else break e}}function t(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var W=V[0],Z=V.pop();if(Z!==W){V[0]=Z;e:for(var q=0,X=V.length,ye=X>>>1;q<ye;){var ke=2*(q+1)-1,Te=V[ke],Le=ke+1,Re=V[Le];if(0>i(Te,Z))Le<X&&0>i(Re,Te)?(V[q]=Re,V[Le]=Z,q=Le):(V[q]=Te,V[ke]=Z,q=ke);else if(Le<X&&0>i(Re,Z))V[q]=Re,V[Le]=Z,q=Le;else break e}}return W}function i(V,W){var Z=V.sortIndex-W.sortIndex;return Z!==0?Z:V.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var u=[],l=[],c=1,d=null,f=3,h=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(V){for(var W=t(l);W!==null;){if(W.callback===null)r(l);else if(W.startTime<=V)r(l),W.sortIndex=W.expirationTime,e(u,W);else break;W=t(l)}}function _(V){if(g=!1,E(V),!p)if(t(u)!==null)p=!0,J(I);else{var W=t(l);W!==null&&le(_,W.startTime-V)}}function I(V,W){p=!1,g&&(g=!1,v(w),w=-1),h=!0;var Z=f;try{for(E(W),d=t(u);d!==null&&(!(d.expirationTime>W)||V&&!N());){var q=d.callback;if(typeof q=="function"){d.callback=null,f=d.priorityLevel;var X=q(d.expirationTime<=W);W=n.unstable_now(),typeof X=="function"?d.callback=X:d===t(u)&&r(u),E(W)}else r(u);d=t(u)}if(d!==null)var ye=!0;else{var ke=t(l);ke!==null&&le(_,ke.startTime-W),ye=!1}return ye}finally{d=null,f=Z,h=!1}}var b=!1,L=null,w=-1,D=5,R=-1;function N(){return!(n.unstable_now()-R<D)}function G(){if(L!==null){var V=n.unstable_now();R=V;var W=!0;try{W=L(!0,V)}finally{W?ee():(b=!1,L=null)}}else b=!1}var ee;if(typeof y=="function")ee=function(){y(G)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,re=oe.port2;oe.port1.onmessage=G,ee=function(){re.postMessage(null)}}else ee=function(){m(G,0)};function J(V){L=V,b||(b=!0,ee())}function le(V,W){w=m(function(){V(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,J(I))},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(V){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var Z=f;f=W;try{return V()}finally{f=Z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(V,W){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Z=f;f=V;try{return W()}finally{f=Z}},n.unstable_scheduleCallback=function(V,W,Z){var q=n.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?q+Z:q):Z=q,V){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=Z+X,V={id:c++,callback:W,priorityLevel:V,startTime:Z,expirationTime:X,sortIndex:-1},Z>q?(V.sortIndex=Z,e(l,V),t(u)===null&&V===t(l)&&(g?(v(w),w=-1):g=!0,le(_,Z-q))):(V.sortIndex=X,e(u,V),p||h||(p=!0,J(I))),V},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(V){var W=f;return function(){var Z=f;f=W;try{return V.apply(this,arguments)}finally{f=Z}}}})(j0);V0.exports=j0;var zx=V0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wx=Ee,Fn=zx;function te(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var H0=new Set,Qa={};function ps(n,e){Zs(n,e),Zs(n+"Capture",e)}function Zs(n,e){for(Qa[n]=e,n=0;n<e.length;n++)H0.add(e[n])}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dd=Object.prototype.hasOwnProperty,Yx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Hp={},Kp={};function qx(n){return Dd.call(Kp,n)?!0:Dd.call(Hp,n)?!1:Yx.test(n)?Kp[n]=!0:(Hp[n]=!0,!1)}function Xx(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Zx(n,e,t,r){if(e===null||typeof e>"u"||Xx(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function fn(n,e,t,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){qt[n]=new fn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];qt[e]=new fn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){qt[n]=new fn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){qt[n]=new fn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){qt[n]=new fn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){qt[n]=new fn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){qt[n]=new fn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){qt[n]=new fn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){qt[n]=new fn(n,5,!1,n.toLowerCase(),null,!1,!1)});var rh=/[\-:]([a-z])/g;function ih(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(rh,ih);qt[e]=new fn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(rh,ih);qt[e]=new fn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(rh,ih);qt[e]=new fn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){qt[n]=new fn(n,1,!1,n.toLowerCase(),null,!1,!1)});qt.xlinkHref=new fn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){qt[n]=new fn(n,1,!1,n.toLowerCase(),null,!0,!0)});function sh(n,e,t,r){var i=qt.hasOwnProperty(e)?qt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Zx(e,t,i,r)&&(t=null),r||i===null?qx(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ni=Wx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rl=Symbol.for("react.element"),Ls=Symbol.for("react.portal"),Rs=Symbol.for("react.fragment"),ah=Symbol.for("react.strict_mode"),Pd=Symbol.for("react.profiler"),K0=Symbol.for("react.provider"),z0=Symbol.for("react.context"),oh=Symbol.for("react.forward_ref"),Cd=Symbol.for("react.suspense"),Nd=Symbol.for("react.suspense_list"),lh=Symbol.for("react.memo"),li=Symbol.for("react.lazy"),W0=Symbol.for("react.offscreen"),zp=Symbol.iterator;function Sa(n){return n===null||typeof n!="object"?null:(n=zp&&n[zp]||n["@@iterator"],typeof n=="function"?n:null)}var Et=Object.assign,kc;function Da(n){if(kc===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);kc=e&&e[1]||""}return`
`+kc+n}var Dc=!1;function Pc(n,e){if(!n||Dc)return"";Dc=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var u=`
`+i[a].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=a&&0<=o);break}}}finally{Dc=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Da(n):""}function Qx(n){switch(n.tag){case 5:return Da(n.type);case 16:return Da("Lazy");case 13:return Da("Suspense");case 19:return Da("SuspenseList");case 0:case 2:case 15:return n=Pc(n.type,!1),n;case 11:return n=Pc(n.type.render,!1),n;case 1:return n=Pc(n.type,!0),n;default:return""}}function Od(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Rs:return"Fragment";case Ls:return"Portal";case Pd:return"Profiler";case ah:return"StrictMode";case Cd:return"Suspense";case Nd:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case z0:return(n.displayName||"Context")+".Consumer";case K0:return(n._context.displayName||"Context")+".Provider";case oh:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case lh:return e=n.displayName||null,e!==null?e:Od(n.type)||"Memo";case li:e=n._payload,n=n._init;try{return Od(n(e))}catch{}}return null}function Jx(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Od(e);case 8:return e===ah?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function wi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Y0(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function e_(n){var e=Y0(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function il(n){n._valueTracker||(n._valueTracker=e_(n))}function q0(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Y0(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function su(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Md(n,e){var t=e.checked;return Et({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Wp(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=wi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function X0(n,e){e=e.checked,e!=null&&sh(n,"checked",e,!1)}function Fd(n,e){X0(n,e);var t=wi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Ud(n,e.type,t):e.hasOwnProperty("defaultValue")&&Ud(n,e.type,wi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Yp(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Ud(n,e,t){(e!=="number"||su(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Pa=Array.isArray;function $s(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+wi(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Bd(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(te(91));return Et({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function qp(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(te(92));if(Pa(t)){if(1<t.length)throw Error(te(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:wi(t)}}function Z0(n,e){var t=wi(e.value),r=wi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Xp(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Q0(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $d(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Q0(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var sl,J0=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(sl=sl||document.createElement("div"),sl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=sl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ja(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Ba={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},t_=["Webkit","ms","Moz","O"];Object.keys(Ba).forEach(function(n){t_.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Ba[e]=Ba[n]})});function ey(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ba.hasOwnProperty(n)&&Ba[n]?(""+e).trim():e+"px"}function ty(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=ey(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var n_=Et({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gd(n,e){if(e){if(n_[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(te(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(te(62))}}function Vd(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jd=null;function uh(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Hd=null,Gs=null,Vs=null;function Zp(n){if(n=Vo(n)){if(typeof Hd!="function")throw Error(te(280));var e=n.stateNode;e&&(e=Ju(e),Hd(n.stateNode,n.type,e))}}function ny(n){Gs?Vs?Vs.push(n):Vs=[n]:Gs=n}function ry(){if(Gs){var n=Gs,e=Vs;if(Vs=Gs=null,Zp(n),e)for(n=0;n<e.length;n++)Zp(e[n])}}function iy(n,e){return n(e)}function sy(){}var Cc=!1;function ay(n,e,t){if(Cc)return n(e,t);Cc=!0;try{return iy(n,e,t)}finally{Cc=!1,(Gs!==null||Vs!==null)&&(sy(),ry())}}function eo(n,e){var t=n.stateNode;if(t===null)return null;var r=Ju(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(te(231,e,typeof t));return t}var Kd=!1;if(Zr)try{var xa={};Object.defineProperty(xa,"passive",{get:function(){Kd=!0}}),window.addEventListener("test",xa,xa),window.removeEventListener("test",xa,xa)}catch{Kd=!1}function r_(n,e,t,r,i,s,a,o,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var $a=!1,au=null,ou=!1,zd=null,i_={onError:function(n){$a=!0,au=n}};function s_(n,e,t,r,i,s,a,o,u){$a=!1,au=null,r_.apply(i_,arguments)}function a_(n,e,t,r,i,s,a,o,u){if(s_.apply(this,arguments),$a){if($a){var l=au;$a=!1,au=null}else throw Error(te(198));ou||(ou=!0,zd=l)}}function gs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function oy(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Qp(n){if(gs(n)!==n)throw Error(te(188))}function o_(n){var e=n.alternate;if(!e){if(e=gs(n),e===null)throw Error(te(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return Qp(i),n;if(s===r)return Qp(i),e;s=s.sibling}throw Error(te(188))}if(t.return!==r.return)t=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a)throw Error(te(189))}}if(t.alternate!==r)throw Error(te(190))}if(t.tag!==3)throw Error(te(188));return t.stateNode.current===t?n:e}function ly(n){return n=o_(n),n!==null?uy(n):null}function uy(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=uy(n);if(e!==null)return e;n=n.sibling}return null}var cy=Fn.unstable_scheduleCallback,Jp=Fn.unstable_cancelCallback,l_=Fn.unstable_shouldYield,u_=Fn.unstable_requestPaint,Lt=Fn.unstable_now,c_=Fn.unstable_getCurrentPriorityLevel,ch=Fn.unstable_ImmediatePriority,dy=Fn.unstable_UserBlockingPriority,lu=Fn.unstable_NormalPriority,d_=Fn.unstable_LowPriority,fy=Fn.unstable_IdlePriority,qu=null,Ar=null;function f_(n){if(Ar&&typeof Ar.onCommitFiberRoot=="function")try{Ar.onCommitFiberRoot(qu,n,void 0,(n.current.flags&128)===128)}catch{}}var ar=Math.clz32?Math.clz32:g_,h_=Math.log,p_=Math.LN2;function g_(n){return n>>>=0,n===0?32:31-(h_(n)/p_|0)|0}var al=64,ol=4194304;function Ca(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function uu(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~i;o!==0?r=Ca(o):(s&=a,s!==0&&(r=Ca(s)))}else a=t&~i,a!==0?r=Ca(a):s!==0&&(r=Ca(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ar(e),i=1<<t,r|=n[t],e&=~i;return r}function m_(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function y_(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-ar(s),o=1<<a,u=i[a];u===-1?(!(o&t)||o&r)&&(i[a]=m_(o,e)):u<=e&&(n.expiredLanes|=o),s&=~o}}function Wd(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function hy(){var n=al;return al<<=1,!(al&4194240)&&(al=64),n}function Nc(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function $o(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ar(e),n[e]=t}function v_(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-ar(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function dh(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ar(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var tt=0;function py(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var gy,fh,my,yy,vy,Yd=!1,ll=[],Ei=null,Ti=null,Si=null,to=new Map,no=new Map,hi=[],E_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eg(n,e){switch(n){case"focusin":case"focusout":Ei=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Si=null;break;case"pointerover":case"pointerout":to.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(e.pointerId)}}function _a(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Vo(e),e!==null&&fh(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function T_(n,e,t,r,i){switch(e){case"focusin":return Ei=_a(Ei,n,e,t,r,i),!0;case"dragenter":return Ti=_a(Ti,n,e,t,r,i),!0;case"mouseover":return Si=_a(Si,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return to.set(s,_a(to.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,no.set(s,_a(no.get(s)||null,n,e,t,r,i)),!0}return!1}function Ey(n){var e=Zi(n.target);if(e!==null){var t=gs(e);if(t!==null){if(e=t.tag,e===13){if(e=oy(t),e!==null){n.blockedOn=e,vy(n.priority,function(){my(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Gl(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=qd(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);jd=r,t.target.dispatchEvent(r),jd=null}else return e=Vo(t),e!==null&&fh(e),n.blockedOn=t,!1;e.shift()}return!0}function tg(n,e,t){Gl(n)&&t.delete(e)}function S_(){Yd=!1,Ei!==null&&Gl(Ei)&&(Ei=null),Ti!==null&&Gl(Ti)&&(Ti=null),Si!==null&&Gl(Si)&&(Si=null),to.forEach(tg),no.forEach(tg)}function Aa(n,e){n.blockedOn===e&&(n.blockedOn=null,Yd||(Yd=!0,Fn.unstable_scheduleCallback(Fn.unstable_NormalPriority,S_)))}function ro(n){function e(i){return Aa(i,n)}if(0<ll.length){Aa(ll[0],n);for(var t=1;t<ll.length;t++){var r=ll[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Ei!==null&&Aa(Ei,n),Ti!==null&&Aa(Ti,n),Si!==null&&Aa(Si,n),to.forEach(e),no.forEach(e),t=0;t<hi.length;t++)r=hi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<hi.length&&(t=hi[0],t.blockedOn===null);)Ey(t),t.blockedOn===null&&hi.shift()}var js=ni.ReactCurrentBatchConfig,cu=!0;function x_(n,e,t,r){var i=tt,s=js.transition;js.transition=null;try{tt=1,hh(n,e,t,r)}finally{tt=i,js.transition=s}}function __(n,e,t,r){var i=tt,s=js.transition;js.transition=null;try{tt=4,hh(n,e,t,r)}finally{tt=i,js.transition=s}}function hh(n,e,t,r){if(cu){var i=qd(n,e,t,r);if(i===null)Hc(n,e,r,du,t),eg(n,r);else if(T_(i,n,e,t,r))r.stopPropagation();else if(eg(n,r),e&4&&-1<E_.indexOf(n)){for(;i!==null;){var s=Vo(i);if(s!==null&&gy(s),s=qd(n,e,t,r),s===null&&Hc(n,e,r,du,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Hc(n,e,r,null,t)}}var du=null;function qd(n,e,t,r){if(du=null,n=uh(r),n=Zi(n),n!==null)if(e=gs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=oy(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return du=n,null}function Ty(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(c_()){case ch:return 1;case dy:return 4;case lu:case d_:return 16;case fy:return 536870912;default:return 16}default:return 16}}var yi=null,ph=null,Vl=null;function Sy(){if(Vl)return Vl;var n,e=ph,t=e.length,r,i="value"in yi?yi.value:yi.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[s-r];r++);return Vl=i.slice(n,1<r?1-r:void 0)}function jl(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ul(){return!0}function ng(){return!1}function Bn(n){function e(t,r,i,s,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ul:ng,this.isPropagationStopped=ng,this}return Et(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ul)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ul)},persist:function(){},isPersistent:ul}),e}var da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gh=Bn(da),Go=Et({},da,{view:0,detail:0}),A_=Bn(Go),Oc,Mc,Ia,Xu=Et({},Go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mh,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ia&&(Ia&&n.type==="mousemove"?(Oc=n.screenX-Ia.screenX,Mc=n.screenY-Ia.screenY):Mc=Oc=0,Ia=n),Oc)},movementY:function(n){return"movementY"in n?n.movementY:Mc}}),rg=Bn(Xu),I_=Et({},Xu,{dataTransfer:0}),L_=Bn(I_),R_=Et({},Go,{relatedTarget:0}),Fc=Bn(R_),w_=Et({},da,{animationName:0,elapsedTime:0,pseudoElement:0}),b_=Bn(w_),k_=Et({},da,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),D_=Bn(k_),P_=Et({},da,{data:0}),ig=Bn(P_),C_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},N_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function M_(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=O_[n])?!!e[n]:!1}function mh(){return M_}var F_=Et({},Go,{key:function(n){if(n.key){var e=C_[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=jl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?N_[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mh,charCode:function(n){return n.type==="keypress"?jl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?jl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),U_=Bn(F_),B_=Et({},Xu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sg=Bn(B_),$_=Et({},Go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mh}),G_=Bn($_),V_=Et({},da,{propertyName:0,elapsedTime:0,pseudoElement:0}),j_=Bn(V_),H_=Et({},Xu,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),K_=Bn(H_),z_=[9,13,27,32],yh=Zr&&"CompositionEvent"in window,Ga=null;Zr&&"documentMode"in document&&(Ga=document.documentMode);var W_=Zr&&"TextEvent"in window&&!Ga,xy=Zr&&(!yh||Ga&&8<Ga&&11>=Ga),ag=" ",og=!1;function _y(n,e){switch(n){case"keyup":return z_.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ay(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ws=!1;function Y_(n,e){switch(n){case"compositionend":return Ay(e);case"keypress":return e.which!==32?null:(og=!0,ag);case"textInput":return n=e.data,n===ag&&og?null:n;default:return null}}function q_(n,e){if(ws)return n==="compositionend"||!yh&&_y(n,e)?(n=Sy(),Vl=ph=yi=null,ws=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xy&&e.locale!=="ko"?null:e.data;default:return null}}var X_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lg(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!X_[n.type]:e==="textarea"}function Iy(n,e,t,r){ny(r),e=fu(e,"onChange"),0<e.length&&(t=new gh("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Va=null,io=null;function Z_(n){My(n,0)}function Zu(n){var e=Ds(n);if(q0(e))return n}function Q_(n,e){if(n==="change")return e}var Ly=!1;if(Zr){var Uc;if(Zr){var Bc="oninput"in document;if(!Bc){var ug=document.createElement("div");ug.setAttribute("oninput","return;"),Bc=typeof ug.oninput=="function"}Uc=Bc}else Uc=!1;Ly=Uc&&(!document.documentMode||9<document.documentMode)}function cg(){Va&&(Va.detachEvent("onpropertychange",Ry),io=Va=null)}function Ry(n){if(n.propertyName==="value"&&Zu(io)){var e=[];Iy(e,io,n,uh(n)),ay(Z_,e)}}function J_(n,e,t){n==="focusin"?(cg(),Va=e,io=t,Va.attachEvent("onpropertychange",Ry)):n==="focusout"&&cg()}function eA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Zu(io)}function tA(n,e){if(n==="click")return Zu(e)}function nA(n,e){if(n==="input"||n==="change")return Zu(e)}function rA(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ur=typeof Object.is=="function"?Object.is:rA;function so(n,e){if(ur(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Dd.call(e,i)||!ur(n[i],e[i]))return!1}return!0}function dg(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function fg(n,e){var t=dg(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=dg(t)}}function wy(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?wy(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function by(){for(var n=window,e=su();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=su(n.document)}return e}function vh(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function iA(n){var e=by(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&wy(t.ownerDocument.documentElement,t)){if(r!==null&&vh(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=fg(t,s);var a=fg(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var sA=Zr&&"documentMode"in document&&11>=document.documentMode,bs=null,Xd=null,ja=null,Zd=!1;function hg(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Zd||bs==null||bs!==su(r)||(r=bs,"selectionStart"in r&&vh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ja&&so(ja,r)||(ja=r,r=fu(Xd,"onSelect"),0<r.length&&(e=new gh("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=bs)))}function cl(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ks={animationend:cl("Animation","AnimationEnd"),animationiteration:cl("Animation","AnimationIteration"),animationstart:cl("Animation","AnimationStart"),transitionend:cl("Transition","TransitionEnd")},$c={},ky={};Zr&&(ky=document.createElement("div").style,"AnimationEvent"in window||(delete ks.animationend.animation,delete ks.animationiteration.animation,delete ks.animationstart.animation),"TransitionEvent"in window||delete ks.transitionend.transition);function Qu(n){if($c[n])return $c[n];if(!ks[n])return n;var e=ks[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in ky)return $c[n]=e[t];return n}var Dy=Qu("animationend"),Py=Qu("animationiteration"),Cy=Qu("animationstart"),Ny=Qu("transitionend"),Oy=new Map,pg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fi(n,e){Oy.set(n,e),ps(e,[n])}for(var Gc=0;Gc<pg.length;Gc++){var Vc=pg[Gc],aA=Vc.toLowerCase(),oA=Vc[0].toUpperCase()+Vc.slice(1);Fi(aA,"on"+oA)}Fi(Dy,"onAnimationEnd");Fi(Py,"onAnimationIteration");Fi(Cy,"onAnimationStart");Fi("dblclick","onDoubleClick");Fi("focusin","onFocus");Fi("focusout","onBlur");Fi(Ny,"onTransitionEnd");Zs("onMouseEnter",["mouseout","mouseover"]);Zs("onMouseLeave",["mouseout","mouseover"]);Zs("onPointerEnter",["pointerout","pointerover"]);Zs("onPointerLeave",["pointerout","pointerover"]);ps("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ps("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ps("onBeforeInput",["compositionend","keypress","textInput","paste"]);ps("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ps("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ps("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Na="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Na));function gg(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,a_(r,e,void 0,n),n.currentTarget=null}function My(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],u=o.instance,l=o.currentTarget;if(o=o.listener,u!==s&&i.isPropagationStopped())break e;gg(i,o,l),s=u}else for(a=0;a<r.length;a++){if(o=r[a],u=o.instance,l=o.currentTarget,o=o.listener,u!==s&&i.isPropagationStopped())break e;gg(i,o,l),s=u}}}if(ou)throw n=zd,ou=!1,zd=null,n}function lt(n,e){var t=e[nf];t===void 0&&(t=e[nf]=new Set);var r=n+"__bubble";t.has(r)||(Fy(e,n,2,!1),t.add(r))}function jc(n,e,t){var r=0;e&&(r|=4),Fy(t,n,r,e)}var dl="_reactListening"+Math.random().toString(36).slice(2);function ao(n){if(!n[dl]){n[dl]=!0,H0.forEach(function(t){t!=="selectionchange"&&(lA.has(t)||jc(t,!1,n),jc(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[dl]||(e[dl]=!0,jc("selectionchange",!1,e))}}function Fy(n,e,t,r){switch(Ty(e)){case 1:var i=x_;break;case 4:i=__;break;default:i=hh}t=i.bind(null,e,t,n),i=void 0,!Kd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Hc(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Zi(o),a===null)return;if(u=a.tag,u===5||u===6){r=s=a;continue e}o=o.parentNode}}r=r.return}ay(function(){var l=s,c=uh(t),d=[];e:{var f=Oy.get(n);if(f!==void 0){var h=gh,p=n;switch(n){case"keypress":if(jl(t)===0)break e;case"keydown":case"keyup":h=U_;break;case"focusin":p="focus",h=Fc;break;case"focusout":p="blur",h=Fc;break;case"beforeblur":case"afterblur":h=Fc;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=rg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=L_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=G_;break;case Dy:case Py:case Cy:h=b_;break;case Ny:h=j_;break;case"scroll":h=A_;break;case"wheel":h=K_;break;case"copy":case"cut":case"paste":h=D_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=sg}var g=(e&4)!==0,m=!g&&n==="scroll",v=g?f!==null?f+"Capture":null:f;g=[];for(var y=l,E;y!==null;){E=y;var _=E.stateNode;if(E.tag===5&&_!==null&&(E=_,v!==null&&(_=eo(y,v),_!=null&&g.push(oo(y,_,E)))),m)break;y=y.return}0<g.length&&(f=new h(f,p,null,t,c),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==jd&&(p=t.relatedTarget||t.fromElement)&&(Zi(p)||p[Qr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=l,p=p?Zi(p):null,p!==null&&(m=gs(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=l),h!==p)){if(g=rg,_="onMouseLeave",v="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(g=sg,_="onPointerLeave",v="onPointerEnter",y="pointer"),m=h==null?f:Ds(h),E=p==null?f:Ds(p),f=new g(_,y+"leave",h,t,c),f.target=m,f.relatedTarget=E,_=null,Zi(c)===l&&(g=new g(v,y+"enter",p,t,c),g.target=E,g.relatedTarget=m,_=g),m=_,h&&p)t:{for(g=h,v=p,y=0,E=g;E;E=vs(E))y++;for(E=0,_=v;_;_=vs(_))E++;for(;0<y-E;)g=vs(g),y--;for(;0<E-y;)v=vs(v),E--;for(;y--;){if(g===v||v!==null&&g===v.alternate)break t;g=vs(g),v=vs(v)}g=null}else g=null;h!==null&&mg(d,f,h,g,!1),p!==null&&m!==null&&mg(d,m,p,g,!0)}}e:{if(f=l?Ds(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var I=Q_;else if(lg(f))if(Ly)I=nA;else{I=eA;var b=J_}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(I=tA);if(I&&(I=I(n,l))){Iy(d,I,t,c);break e}b&&b(n,f,l),n==="focusout"&&(b=f._wrapperState)&&b.controlled&&f.type==="number"&&Ud(f,"number",f.value)}switch(b=l?Ds(l):window,n){case"focusin":(lg(b)||b.contentEditable==="true")&&(bs=b,Xd=l,ja=null);break;case"focusout":ja=Xd=bs=null;break;case"mousedown":Zd=!0;break;case"contextmenu":case"mouseup":case"dragend":Zd=!1,hg(d,t,c);break;case"selectionchange":if(sA)break;case"keydown":case"keyup":hg(d,t,c)}var L;if(yh)e:{switch(n){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else ws?_y(n,t)&&(w="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(w="onCompositionStart");w&&(xy&&t.locale!=="ko"&&(ws||w!=="onCompositionStart"?w==="onCompositionEnd"&&ws&&(L=Sy()):(yi=c,ph="value"in yi?yi.value:yi.textContent,ws=!0)),b=fu(l,w),0<b.length&&(w=new ig(w,n,null,t,c),d.push({event:w,listeners:b}),L?w.data=L:(L=Ay(t),L!==null&&(w.data=L)))),(L=W_?Y_(n,t):q_(n,t))&&(l=fu(l,"onBeforeInput"),0<l.length&&(c=new ig("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:l}),c.data=L))}My(d,e)})}function oo(n,e,t){return{instance:n,listener:e,currentTarget:t}}function fu(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=eo(n,t),s!=null&&r.unshift(oo(n,s,i)),s=eo(n,e),s!=null&&r.push(oo(n,s,i))),n=n.return}return r}function vs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function mg(n,e,t,r,i){for(var s=e._reactName,a=[];t!==null&&t!==r;){var o=t,u=o.alternate,l=o.stateNode;if(u!==null&&u===r)break;o.tag===5&&l!==null&&(o=l,i?(u=eo(t,s),u!=null&&a.unshift(oo(t,u,o))):i||(u=eo(t,s),u!=null&&a.push(oo(t,u,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var uA=/\r\n?/g,cA=/\u0000|\uFFFD/g;function yg(n){return(typeof n=="string"?n:""+n).replace(uA,`
`).replace(cA,"")}function fl(n,e,t){if(e=yg(e),yg(n)!==e&&t)throw Error(te(425))}function hu(){}var Qd=null,Jd=null;function ef(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var tf=typeof setTimeout=="function"?setTimeout:void 0,dA=typeof clearTimeout=="function"?clearTimeout:void 0,vg=typeof Promise=="function"?Promise:void 0,fA=typeof queueMicrotask=="function"?queueMicrotask:typeof vg<"u"?function(n){return vg.resolve(null).then(n).catch(hA)}:tf;function hA(n){setTimeout(function(){throw n})}function Kc(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),ro(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);ro(e)}function xi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Eg(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var fa=Math.random().toString(36).slice(2),Tr="__reactFiber$"+fa,lo="__reactProps$"+fa,Qr="__reactContainer$"+fa,nf="__reactEvents$"+fa,pA="__reactListeners$"+fa,gA="__reactHandles$"+fa;function Zi(n){var e=n[Tr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Qr]||t[Tr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Eg(n);n!==null;){if(t=n[Tr])return t;n=Eg(n)}return e}n=t,t=n.parentNode}return null}function Vo(n){return n=n[Tr]||n[Qr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ds(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(te(33))}function Ju(n){return n[lo]||null}var rf=[],Ps=-1;function Ui(n){return{current:n}}function ct(n){0>Ps||(n.current=rf[Ps],rf[Ps]=null,Ps--)}function ot(n,e){Ps++,rf[Ps]=n.current,n.current=e}var bi={},tn=Ui(bi),En=Ui(!1),ss=bi;function Qs(n,e){var t=n.type.contextTypes;if(!t)return bi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Tn(n){return n=n.childContextTypes,n!=null}function pu(){ct(En),ct(tn)}function Tg(n,e,t){if(tn.current!==bi)throw Error(te(168));ot(tn,e),ot(En,t)}function Uy(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(te(108,Jx(n)||"Unknown",i));return Et({},t,r)}function gu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||bi,ss=tn.current,ot(tn,n),ot(En,En.current),!0}function Sg(n,e,t){var r=n.stateNode;if(!r)throw Error(te(169));t?(n=Uy(n,e,ss),r.__reactInternalMemoizedMergedChildContext=n,ct(En),ct(tn),ot(tn,n)):ct(En),ot(En,t)}var Kr=null,ec=!1,zc=!1;function By(n){Kr===null?Kr=[n]:Kr.push(n)}function mA(n){ec=!0,By(n)}function Bi(){if(!zc&&Kr!==null){zc=!0;var n=0,e=tt;try{var t=Kr;for(tt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Kr=null,ec=!1}catch(i){throw Kr!==null&&(Kr=Kr.slice(n+1)),cy(ch,Bi),i}finally{tt=e,zc=!1}}return null}var Cs=[],Ns=0,mu=null,yu=0,Hn=[],Kn=0,as=null,Wr=1,Yr="";function Wi(n,e){Cs[Ns++]=yu,Cs[Ns++]=mu,mu=n,yu=e}function $y(n,e,t){Hn[Kn++]=Wr,Hn[Kn++]=Yr,Hn[Kn++]=as,as=n;var r=Wr;n=Yr;var i=32-ar(r)-1;r&=~(1<<i),t+=1;var s=32-ar(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Wr=1<<32-ar(e)+i|t<<i|r,Yr=s+n}else Wr=1<<s|t<<i|r,Yr=n}function Eh(n){n.return!==null&&(Wi(n,1),$y(n,1,0))}function Th(n){for(;n===mu;)mu=Cs[--Ns],Cs[Ns]=null,yu=Cs[--Ns],Cs[Ns]=null;for(;n===as;)as=Hn[--Kn],Hn[Kn]=null,Yr=Hn[--Kn],Hn[Kn]=null,Wr=Hn[--Kn],Hn[Kn]=null}var Nn=null,Cn=null,dt=!1,ir=null;function Gy(n,e){var t=zn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function xg(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Nn=n,Cn=xi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Nn=n,Cn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=as!==null?{id:Wr,overflow:Yr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=zn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Nn=n,Cn=null,!0):!1;default:return!1}}function sf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function af(n){if(dt){var e=Cn;if(e){var t=e;if(!xg(n,e)){if(sf(n))throw Error(te(418));e=xi(t.nextSibling);var r=Nn;e&&xg(n,e)?Gy(r,t):(n.flags=n.flags&-4097|2,dt=!1,Nn=n)}}else{if(sf(n))throw Error(te(418));n.flags=n.flags&-4097|2,dt=!1,Nn=n}}}function _g(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Nn=n}function hl(n){if(n!==Nn)return!1;if(!dt)return _g(n),dt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!ef(n.type,n.memoizedProps)),e&&(e=Cn)){if(sf(n))throw Vy(),Error(te(418));for(;e;)Gy(n,e),e=xi(e.nextSibling)}if(_g(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(te(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Cn=xi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Cn=null}}else Cn=Nn?xi(n.stateNode.nextSibling):null;return!0}function Vy(){for(var n=Cn;n;)n=xi(n.nextSibling)}function Js(){Cn=Nn=null,dt=!1}function Sh(n){ir===null?ir=[n]:ir.push(n)}var yA=ni.ReactCurrentBatchConfig;function La(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(te(309));var r=t.stateNode}if(!r)throw Error(te(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(te(284));if(!t._owner)throw Error(te(290,n))}return n}function pl(n,e){throw n=Object.prototype.toString.call(e),Error(te(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Ag(n){var e=n._init;return e(n._payload)}function jy(n){function e(v,y){if(n){var E=v.deletions;E===null?(v.deletions=[y],v.flags|=16):E.push(y)}}function t(v,y){if(!n)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function i(v,y){return v=Li(v,y),v.index=0,v.sibling=null,v}function s(v,y,E){return v.index=E,n?(E=v.alternate,E!==null?(E=E.index,E<y?(v.flags|=2,y):E):(v.flags|=2,y)):(v.flags|=1048576,y)}function a(v){return n&&v.alternate===null&&(v.flags|=2),v}function o(v,y,E,_){return y===null||y.tag!==6?(y=Jc(E,v.mode,_),y.return=v,y):(y=i(y,E),y.return=v,y)}function u(v,y,E,_){var I=E.type;return I===Rs?c(v,y,E.props.children,_,E.key):y!==null&&(y.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===li&&Ag(I)===y.type)?(_=i(y,E.props),_.ref=La(v,y,E),_.return=v,_):(_=Xl(E.type,E.key,E.props,null,v.mode,_),_.ref=La(v,y,E),_.return=v,_)}function l(v,y,E,_){return y===null||y.tag!==4||y.stateNode.containerInfo!==E.containerInfo||y.stateNode.implementation!==E.implementation?(y=ed(E,v.mode,_),y.return=v,y):(y=i(y,E.children||[]),y.return=v,y)}function c(v,y,E,_,I){return y===null||y.tag!==7?(y=ts(E,v.mode,_,I),y.return=v,y):(y=i(y,E),y.return=v,y)}function d(v,y,E){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Jc(""+y,v.mode,E),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case rl:return E=Xl(y.type,y.key,y.props,null,v.mode,E),E.ref=La(v,null,y),E.return=v,E;case Ls:return y=ed(y,v.mode,E),y.return=v,y;case li:var _=y._init;return d(v,_(y._payload),E)}if(Pa(y)||Sa(y))return y=ts(y,v.mode,E,null),y.return=v,y;pl(v,y)}return null}function f(v,y,E,_){var I=y!==null?y.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return I!==null?null:o(v,y,""+E,_);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case rl:return E.key===I?u(v,y,E,_):null;case Ls:return E.key===I?l(v,y,E,_):null;case li:return I=E._init,f(v,y,I(E._payload),_)}if(Pa(E)||Sa(E))return I!==null?null:c(v,y,E,_,null);pl(v,E)}return null}function h(v,y,E,_,I){if(typeof _=="string"&&_!==""||typeof _=="number")return v=v.get(E)||null,o(y,v,""+_,I);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case rl:return v=v.get(_.key===null?E:_.key)||null,u(y,v,_,I);case Ls:return v=v.get(_.key===null?E:_.key)||null,l(y,v,_,I);case li:var b=_._init;return h(v,y,E,b(_._payload),I)}if(Pa(_)||Sa(_))return v=v.get(E)||null,c(y,v,_,I,null);pl(y,_)}return null}function p(v,y,E,_){for(var I=null,b=null,L=y,w=y=0,D=null;L!==null&&w<E.length;w++){L.index>w?(D=L,L=null):D=L.sibling;var R=f(v,L,E[w],_);if(R===null){L===null&&(L=D);break}n&&L&&R.alternate===null&&e(v,L),y=s(R,y,w),b===null?I=R:b.sibling=R,b=R,L=D}if(w===E.length)return t(v,L),dt&&Wi(v,w),I;if(L===null){for(;w<E.length;w++)L=d(v,E[w],_),L!==null&&(y=s(L,y,w),b===null?I=L:b.sibling=L,b=L);return dt&&Wi(v,w),I}for(L=r(v,L);w<E.length;w++)D=h(L,v,w,E[w],_),D!==null&&(n&&D.alternate!==null&&L.delete(D.key===null?w:D.key),y=s(D,y,w),b===null?I=D:b.sibling=D,b=D);return n&&L.forEach(function(N){return e(v,N)}),dt&&Wi(v,w),I}function g(v,y,E,_){var I=Sa(E);if(typeof I!="function")throw Error(te(150));if(E=I.call(E),E==null)throw Error(te(151));for(var b=I=null,L=y,w=y=0,D=null,R=E.next();L!==null&&!R.done;w++,R=E.next()){L.index>w?(D=L,L=null):D=L.sibling;var N=f(v,L,R.value,_);if(N===null){L===null&&(L=D);break}n&&L&&N.alternate===null&&e(v,L),y=s(N,y,w),b===null?I=N:b.sibling=N,b=N,L=D}if(R.done)return t(v,L),dt&&Wi(v,w),I;if(L===null){for(;!R.done;w++,R=E.next())R=d(v,R.value,_),R!==null&&(y=s(R,y,w),b===null?I=R:b.sibling=R,b=R);return dt&&Wi(v,w),I}for(L=r(v,L);!R.done;w++,R=E.next())R=h(L,v,w,R.value,_),R!==null&&(n&&R.alternate!==null&&L.delete(R.key===null?w:R.key),y=s(R,y,w),b===null?I=R:b.sibling=R,b=R);return n&&L.forEach(function(G){return e(v,G)}),dt&&Wi(v,w),I}function m(v,y,E,_){if(typeof E=="object"&&E!==null&&E.type===Rs&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case rl:e:{for(var I=E.key,b=y;b!==null;){if(b.key===I){if(I=E.type,I===Rs){if(b.tag===7){t(v,b.sibling),y=i(b,E.props.children),y.return=v,v=y;break e}}else if(b.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===li&&Ag(I)===b.type){t(v,b.sibling),y=i(b,E.props),y.ref=La(v,b,E),y.return=v,v=y;break e}t(v,b);break}else e(v,b);b=b.sibling}E.type===Rs?(y=ts(E.props.children,v.mode,_,E.key),y.return=v,v=y):(_=Xl(E.type,E.key,E.props,null,v.mode,_),_.ref=La(v,y,E),_.return=v,v=_)}return a(v);case Ls:e:{for(b=E.key;y!==null;){if(y.key===b)if(y.tag===4&&y.stateNode.containerInfo===E.containerInfo&&y.stateNode.implementation===E.implementation){t(v,y.sibling),y=i(y,E.children||[]),y.return=v,v=y;break e}else{t(v,y);break}else e(v,y);y=y.sibling}y=ed(E,v.mode,_),y.return=v,v=y}return a(v);case li:return b=E._init,m(v,y,b(E._payload),_)}if(Pa(E))return p(v,y,E,_);if(Sa(E))return g(v,y,E,_);pl(v,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,y!==null&&y.tag===6?(t(v,y.sibling),y=i(y,E),y.return=v,v=y):(t(v,y),y=Jc(E,v.mode,_),y.return=v,v=y),a(v)):t(v,y)}return m}var ea=jy(!0),Hy=jy(!1),vu=Ui(null),Eu=null,Os=null,xh=null;function _h(){xh=Os=Eu=null}function Ah(n){var e=vu.current;ct(vu),n._currentValue=e}function of(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Hs(n,e){Eu=n,xh=Os=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(yn=!0),n.firstContext=null)}function Yn(n){var e=n._currentValue;if(xh!==n)if(n={context:n,memoizedValue:e,next:null},Os===null){if(Eu===null)throw Error(te(308));Os=n,Eu.dependencies={lanes:0,firstContext:n}}else Os=Os.next=n;return e}var Qi=null;function Ih(n){Qi===null?Qi=[n]:Qi.push(n)}function Ky(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Ih(e)):(t.next=i.next,i.next=t),e.interleaved=t,Jr(n,r)}function Jr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ui=!1;function Lh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zy(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function qr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function _i(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,qe&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Jr(n,t)}return i=r.interleaved,i===null?(e.next=e,Ih(r)):(e.next=i.next,i.next=e),r.interleaved=e,Jr(n,t)}function Hl(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,dh(n,t)}}function Ig(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Tu(n,e,t,r){var i=n.updateQueue;ui=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var u=o,l=u.next;u.next=null,a===null?s=l:a.next=l,a=u;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=l:o.next=l,c.lastBaseUpdate=u))}if(s!==null){var d=i.baseState;a=0,c=l=u=null,o=s;do{var f=o.lane,h=o.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=n,g=o;switch(f=e,h=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=Et({},d,f);break e;case 2:ui=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,a|=f;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;f=o,o=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ls|=a,n.lanes=a,n.memoizedState=d}}function Lg(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(te(191,i));i.call(r)}}}var jo={},Ir=Ui(jo),uo=Ui(jo),co=Ui(jo);function Ji(n){if(n===jo)throw Error(te(174));return n}function Rh(n,e){switch(ot(co,e),ot(uo,n),ot(Ir,jo),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$d(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=$d(e,n)}ct(Ir),ot(Ir,e)}function ta(){ct(Ir),ct(uo),ct(co)}function Wy(n){Ji(co.current);var e=Ji(Ir.current),t=$d(e,n.type);e!==t&&(ot(uo,n),ot(Ir,t))}function wh(n){uo.current===n&&(ct(Ir),ct(uo))}var mt=Ui(0);function Su(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wc=[];function bh(){for(var n=0;n<Wc.length;n++)Wc[n]._workInProgressVersionPrimary=null;Wc.length=0}var Kl=ni.ReactCurrentDispatcher,Yc=ni.ReactCurrentBatchConfig,os=0,vt=null,Ot=null,$t=null,xu=!1,Ha=!1,fo=0,vA=0;function Qt(){throw Error(te(321))}function kh(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ur(n[t],e[t]))return!1;return!0}function Dh(n,e,t,r,i,s){if(os=s,vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Kl.current=n===null||n.memoizedState===null?xA:_A,n=t(r,i),Ha){s=0;do{if(Ha=!1,fo=0,25<=s)throw Error(te(301));s+=1,$t=Ot=null,e.updateQueue=null,Kl.current=AA,n=t(r,i)}while(Ha)}if(Kl.current=_u,e=Ot!==null&&Ot.next!==null,os=0,$t=Ot=vt=null,xu=!1,e)throw Error(te(300));return n}function Ph(){var n=fo!==0;return fo=0,n}function mr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?vt.memoizedState=$t=n:$t=$t.next=n,$t}function qn(){if(Ot===null){var n=vt.alternate;n=n!==null?n.memoizedState:null}else n=Ot.next;var e=$t===null?vt.memoizedState:$t.next;if(e!==null)$t=e,Ot=n;else{if(n===null)throw Error(te(310));Ot=n,n={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},$t===null?vt.memoizedState=$t=n:$t=$t.next=n}return $t}function ho(n,e){return typeof e=="function"?e(n):e}function qc(n){var e=qn(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=Ot,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var o=a=null,u=null,l=s;do{var c=l.lane;if((os&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:n(r,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(o=u=d,a=r):u=u.next=d,vt.lanes|=c,ls|=c}l=l.next}while(l!==null&&l!==s);u===null?a=r:u.next=o,ur(r,e.memoizedState)||(yn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,vt.lanes|=s,ls|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Xc(n){var e=qn(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=n(s,a.action),a=a.next;while(a!==i);ur(s,e.memoizedState)||(yn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function Yy(){}function qy(n,e){var t=vt,r=qn(),i=e(),s=!ur(r.memoizedState,i);if(s&&(r.memoizedState=i,yn=!0),r=r.queue,Ch(Qy.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||$t!==null&&$t.memoizedState.tag&1){if(t.flags|=2048,po(9,Zy.bind(null,t,r,i,e),void 0,null),Gt===null)throw Error(te(349));os&30||Xy(t,e,i)}return i}function Xy(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Zy(n,e,t,r){e.value=t,e.getSnapshot=r,Jy(e)&&ev(n)}function Qy(n,e,t){return t(function(){Jy(e)&&ev(n)})}function Jy(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ur(n,t)}catch{return!0}}function ev(n){var e=Jr(n,1);e!==null&&or(e,n,1,-1)}function Rg(n){var e=mr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ho,lastRenderedState:n},e.queue=n,n=n.dispatch=SA.bind(null,vt,n),[e.memoizedState,n]}function po(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function tv(){return qn().memoizedState}function zl(n,e,t,r){var i=mr();vt.flags|=n,i.memoizedState=po(1|e,t,void 0,r===void 0?null:r)}function tc(n,e,t,r){var i=qn();r=r===void 0?null:r;var s=void 0;if(Ot!==null){var a=Ot.memoizedState;if(s=a.destroy,r!==null&&kh(r,a.deps)){i.memoizedState=po(e,t,s,r);return}}vt.flags|=n,i.memoizedState=po(1|e,t,s,r)}function wg(n,e){return zl(8390656,8,n,e)}function Ch(n,e){return tc(2048,8,n,e)}function nv(n,e){return tc(4,2,n,e)}function rv(n,e){return tc(4,4,n,e)}function iv(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function sv(n,e,t){return t=t!=null?t.concat([n]):null,tc(4,4,iv.bind(null,e,n),t)}function Nh(){}function av(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kh(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function ov(n,e){var t=qn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kh(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function lv(n,e,t){return os&21?(ur(t,e)||(t=hy(),vt.lanes|=t,ls|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,yn=!0),n.memoizedState=t)}function EA(n,e){var t=tt;tt=t!==0&&4>t?t:4,n(!0);var r=Yc.transition;Yc.transition={};try{n(!1),e()}finally{tt=t,Yc.transition=r}}function uv(){return qn().memoizedState}function TA(n,e,t){var r=Ii(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},cv(n))dv(e,t);else if(t=Ky(n,e,t,r),t!==null){var i=un();or(t,n,r,i),fv(t,e,r)}}function SA(n,e,t){var r=Ii(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(cv(n))dv(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(i.hasEagerState=!0,i.eagerState=o,ur(o,a)){var u=e.interleaved;u===null?(i.next=i,Ih(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=Ky(n,e,i,r),t!==null&&(i=un(),or(t,n,r,i),fv(t,e,r))}}function cv(n){var e=n.alternate;return n===vt||e!==null&&e===vt}function dv(n,e){Ha=xu=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function fv(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,dh(n,t)}}var _u={readContext:Yn,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useInsertionEffect:Qt,useLayoutEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useMutableSource:Qt,useSyncExternalStore:Qt,useId:Qt,unstable_isNewReconciler:!1},xA={readContext:Yn,useCallback:function(n,e){return mr().memoizedState=[n,e===void 0?null:e],n},useContext:Yn,useEffect:wg,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,zl(4194308,4,iv.bind(null,e,n),t)},useLayoutEffect:function(n,e){return zl(4194308,4,n,e)},useInsertionEffect:function(n,e){return zl(4,2,n,e)},useMemo:function(n,e){var t=mr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=mr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=TA.bind(null,vt,n),[r.memoizedState,n]},useRef:function(n){var e=mr();return n={current:n},e.memoizedState=n},useState:Rg,useDebugValue:Nh,useDeferredValue:function(n){return mr().memoizedState=n},useTransition:function(){var n=Rg(!1),e=n[0];return n=EA.bind(null,n[1]),mr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=vt,i=mr();if(dt){if(t===void 0)throw Error(te(407));t=t()}else{if(t=e(),Gt===null)throw Error(te(349));os&30||Xy(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,wg(Qy.bind(null,r,s,n),[n]),r.flags|=2048,po(9,Zy.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=mr(),e=Gt.identifierPrefix;if(dt){var t=Yr,r=Wr;t=(r&~(1<<32-ar(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=fo++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vA++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},_A={readContext:Yn,useCallback:av,useContext:Yn,useEffect:Ch,useImperativeHandle:sv,useInsertionEffect:nv,useLayoutEffect:rv,useMemo:ov,useReducer:qc,useRef:tv,useState:function(){return qc(ho)},useDebugValue:Nh,useDeferredValue:function(n){var e=qn();return lv(e,Ot.memoizedState,n)},useTransition:function(){var n=qc(ho)[0],e=qn().memoizedState;return[n,e]},useMutableSource:Yy,useSyncExternalStore:qy,useId:uv,unstable_isNewReconciler:!1},AA={readContext:Yn,useCallback:av,useContext:Yn,useEffect:Ch,useImperativeHandle:sv,useInsertionEffect:nv,useLayoutEffect:rv,useMemo:ov,useReducer:Xc,useRef:tv,useState:function(){return Xc(ho)},useDebugValue:Nh,useDeferredValue:function(n){var e=qn();return Ot===null?e.memoizedState=n:lv(e,Ot.memoizedState,n)},useTransition:function(){var n=Xc(ho)[0],e=qn().memoizedState;return[n,e]},useMutableSource:Yy,useSyncExternalStore:qy,useId:uv,unstable_isNewReconciler:!1};function nr(n,e){if(n&&n.defaultProps){e=Et({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function lf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Et({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var nc={isMounted:function(n){return(n=n._reactInternals)?gs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=un(),i=Ii(n),s=qr(r,i);s.payload=e,t!=null&&(s.callback=t),e=_i(n,s,i),e!==null&&(or(e,n,i,r),Hl(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=un(),i=Ii(n),s=qr(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=_i(n,s,i),e!==null&&(or(e,n,i,r),Hl(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=un(),r=Ii(n),i=qr(t,r);i.tag=2,e!=null&&(i.callback=e),e=_i(n,i,r),e!==null&&(or(e,n,r,t),Hl(e,n,r))}};function bg(n,e,t,r,i,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!so(t,r)||!so(i,s):!0}function hv(n,e,t){var r=!1,i=bi,s=e.contextType;return typeof s=="object"&&s!==null?s=Yn(s):(i=Tn(e)?ss:tn.current,r=e.contextTypes,s=(r=r!=null)?Qs(n,i):bi),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nc,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function kg(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&nc.enqueueReplaceState(e,e.state,null)}function uf(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Lh(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Yn(s):(s=Tn(e)?ss:tn.current,i.context=Qs(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(lf(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&nc.enqueueReplaceState(i,i.state,null),Tu(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function na(n,e){try{var t="",r=e;do t+=Qx(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function Zc(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function cf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var IA=typeof WeakMap=="function"?WeakMap:Map;function pv(n,e,t){t=qr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Iu||(Iu=!0,Tf=r),cf(n,e)},t}function gv(n,e,t){t=qr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){cf(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){cf(n,e),typeof r!="function"&&(Ai===null?Ai=new Set([this]):Ai.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Dg(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new IA;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=BA.bind(null,n,e,t),e.then(n,n))}function Pg(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Cg(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=qr(-1,1),e.tag=2,_i(t,e,1))),t.lanes|=1),n)}var LA=ni.ReactCurrentOwner,yn=!1;function on(n,e,t,r){e.child=n===null?Hy(e,null,t,r):ea(e,n.child,t,r)}function Ng(n,e,t,r,i){t=t.render;var s=e.ref;return Hs(e,i),r=Dh(n,e,t,r,s,i),t=Ph(),n!==null&&!yn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ei(n,e,i)):(dt&&t&&Eh(e),e.flags|=1,on(n,e,r,i),e.child)}function Og(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Vh(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,mv(n,e,s,r,i)):(n=Xl(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:so,t(a,r)&&n.ref===e.ref)return ei(n,e,i)}return e.flags|=1,n=Li(s,r),n.ref=e.ref,n.return=e,e.child=n}function mv(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(so(s,r)&&n.ref===e.ref)if(yn=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(yn=!0);else return e.lanes=n.lanes,ei(n,e,i)}return df(n,e,t,r,i)}function yv(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot(Fs,wn),wn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ot(Fs,wn),wn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,ot(Fs,wn),wn|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,ot(Fs,wn),wn|=r;return on(n,e,i,t),e.child}function vv(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function df(n,e,t,r,i){var s=Tn(t)?ss:tn.current;return s=Qs(e,s),Hs(e,i),t=Dh(n,e,t,r,s,i),r=Ph(),n!==null&&!yn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ei(n,e,i)):(dt&&r&&Eh(e),e.flags|=1,on(n,e,t,i),e.child)}function Mg(n,e,t,r,i){if(Tn(t)){var s=!0;gu(e)}else s=!1;if(Hs(e,i),e.stateNode===null)Wl(n,e),hv(e,t,r),uf(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var u=a.context,l=t.contextType;typeof l=="object"&&l!==null?l=Yn(l):(l=Tn(t)?ss:tn.current,l=Qs(e,l));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||u!==l)&&kg(e,a,r,l),ui=!1;var f=e.memoizedState;a.state=f,Tu(e,r,a,i),u=e.memoizedState,o!==r||f!==u||En.current||ui?(typeof c=="function"&&(lf(e,t,c,r),u=e.memoizedState),(o=ui||bg(e,t,o,r,f,u,l))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=l,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,zy(n,e),o=e.memoizedProps,l=e.type===e.elementType?o:nr(e.type,o),a.props=l,d=e.pendingProps,f=a.context,u=t.contextType,typeof u=="object"&&u!==null?u=Yn(u):(u=Tn(t)?ss:tn.current,u=Qs(e,u));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==u)&&kg(e,a,r,u),ui=!1,f=e.memoizedState,a.state=f,Tu(e,r,a,i);var p=e.memoizedState;o!==d||f!==p||En.current||ui?(typeof h=="function"&&(lf(e,t,h,r),p=e.memoizedState),(l=ui||bg(e,t,l,r,f,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return ff(n,e,t,r,s,i)}function ff(n,e,t,r,i,s){vv(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&Sg(e,t,!1),ei(n,e,s);r=e.stateNode,LA.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=ea(e,n.child,null,s),e.child=ea(e,null,o,s)):on(n,e,o,s),e.memoizedState=r.state,i&&Sg(e,t,!0),e.child}function Ev(n){var e=n.stateNode;e.pendingContext?Tg(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Tg(n,e.context,!1),Rh(n,e.containerInfo)}function Fg(n,e,t,r,i){return Js(),Sh(i),e.flags|=256,on(n,e,t,r),e.child}var hf={dehydrated:null,treeContext:null,retryLane:0};function pf(n){return{baseLanes:n,cachePool:null,transitions:null}}function Tv(n,e,t){var r=e.pendingProps,i=mt.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),ot(mt,i&1),n===null)return af(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=sc(a,r,0,null),n=ts(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=pf(t),e.memoizedState=hf,n):Oh(e,a));if(i=n.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return RA(n,e,a,r,o,i,t);if(s){s=r.fallback,a=e.mode,i=n.child,o=i.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Li(i,u),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=Li(o,s):(s=ts(s,a,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=n.child.memoizedState,a=a===null?pf(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=hf,r}return s=n.child,n=s.sibling,r=Li(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Oh(n,e){return e=sc({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function gl(n,e,t,r){return r!==null&&Sh(r),ea(e,n.child,null,t),n=Oh(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function RA(n,e,t,r,i,s,a){if(t)return e.flags&256?(e.flags&=-257,r=Zc(Error(te(422))),gl(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=sc({mode:"visible",children:r.children},i,0,null),s=ts(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&ea(e,n.child,null,a),e.child.memoizedState=pf(a),e.memoizedState=hf,s);if(!(e.mode&1))return gl(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(te(419)),r=Zc(s,r,void 0),gl(n,e,a,r)}if(o=(a&n.childLanes)!==0,yn||o){if(r=Gt,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Jr(n,i),or(r,n,i,-1))}return Gh(),r=Zc(Error(te(421))),gl(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=$A.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,Cn=xi(i.nextSibling),Nn=e,dt=!0,ir=null,n!==null&&(Hn[Kn++]=Wr,Hn[Kn++]=Yr,Hn[Kn++]=as,Wr=n.id,Yr=n.overflow,as=e),e=Oh(e,r.children),e.flags|=4096,e)}function Ug(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),of(n.return,e,t)}function Qc(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function Sv(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(on(n,e,r.children,t),r=mt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Ug(n,t,e);else if(n.tag===19)Ug(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(ot(mt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Su(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Qc(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Su(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Qc(e,!0,t,null,s);break;case"together":Qc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wl(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ei(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ls|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(te(153));if(e.child!==null){for(n=e.child,t=Li(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Li(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function wA(n,e,t){switch(e.tag){case 3:Ev(e),Js();break;case 5:Wy(e);break;case 1:Tn(e.type)&&gu(e);break;case 4:Rh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ot(vu,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ot(mt,mt.current&1),e.flags|=128,null):t&e.child.childLanes?Tv(n,e,t):(ot(mt,mt.current&1),n=ei(n,e,t),n!==null?n.sibling:null);ot(mt,mt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Sv(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ot(mt,mt.current),r)break;return null;case 22:case 23:return e.lanes=0,yv(n,e,t)}return ei(n,e,t)}var xv,gf,_v,Av;xv=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};gf=function(){};_v=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Ji(Ir.current);var s=null;switch(t){case"input":i=Md(n,i),r=Md(n,r),s=[];break;case"select":i=Et({},i,{value:void 0}),r=Et({},r,{value:void 0}),s=[];break;case"textarea":i=Bd(n,i),r=Bd(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=hu)}Gd(t,r);var a;t=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var o=i[l];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Qa.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var u=r[l];if(o=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==o&&(u!=null||o!=null))if(l==="style")if(o){for(a in o)!o.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in u)u.hasOwnProperty(a)&&o[a]!==u[a]&&(t||(t={}),t[a]=u[a])}else t||(s||(s=[]),s.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,o=o?o.__html:void 0,u!=null&&o!==u&&(s=s||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Qa.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&lt("scroll",n),s||o===u||(s=[])):(s=s||[]).push(l,u))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Av=function(n,e,t,r){t!==r&&(e.flags|=4)};function Ra(n,e){if(!dt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Jt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function bA(n,e,t){var r=e.pendingProps;switch(Th(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(e),null;case 1:return Tn(e.type)&&pu(),Jt(e),null;case 3:return r=e.stateNode,ta(),ct(En),ct(tn),bh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(hl(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ir!==null&&(_f(ir),ir=null))),gf(n,e),Jt(e),null;case 5:wh(e);var i=Ji(co.current);if(t=e.type,n!==null&&e.stateNode!=null)_v(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(te(166));return Jt(e),null}if(n=Ji(Ir.current),hl(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[Tr]=e,r[lo]=s,n=(e.mode&1)!==0,t){case"dialog":lt("cancel",r),lt("close",r);break;case"iframe":case"object":case"embed":lt("load",r);break;case"video":case"audio":for(i=0;i<Na.length;i++)lt(Na[i],r);break;case"source":lt("error",r);break;case"img":case"image":case"link":lt("error",r),lt("load",r);break;case"details":lt("toggle",r);break;case"input":Wp(r,s),lt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},lt("invalid",r);break;case"textarea":qp(r,s),lt("invalid",r)}Gd(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&fl(r.textContent,o,n),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&fl(r.textContent,o,n),i=["children",""+o]):Qa.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&lt("scroll",r)}switch(t){case"input":il(r),Yp(r,s,!0);break;case"textarea":il(r),Xp(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=hu)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Q0(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Tr]=e,n[lo]=r,xv(n,e,!1,!1),e.stateNode=n;e:{switch(a=Vd(t,r),t){case"dialog":lt("cancel",n),lt("close",n),i=r;break;case"iframe":case"object":case"embed":lt("load",n),i=r;break;case"video":case"audio":for(i=0;i<Na.length;i++)lt(Na[i],n);i=r;break;case"source":lt("error",n),i=r;break;case"img":case"image":case"link":lt("error",n),lt("load",n),i=r;break;case"details":lt("toggle",n),i=r;break;case"input":Wp(n,r),i=Md(n,r),lt("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Et({},r,{value:void 0}),lt("invalid",n);break;case"textarea":qp(n,r),i=Bd(n,r),lt("invalid",n);break;default:i=r}Gd(t,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var u=o[s];s==="style"?ty(n,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&J0(n,u)):s==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&Ja(n,u):typeof u=="number"&&Ja(n,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Qa.hasOwnProperty(s)?u!=null&&s==="onScroll"&&lt("scroll",n):u!=null&&sh(n,s,u,a))}switch(t){case"input":il(n),Yp(n,r,!1);break;case"textarea":il(n),Xp(n);break;case"option":r.value!=null&&n.setAttribute("value",""+wi(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?$s(n,!!r.multiple,s,!1):r.defaultValue!=null&&$s(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=hu)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Jt(e),null;case 6:if(n&&e.stateNode!=null)Av(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(te(166));if(t=Ji(co.current),Ji(Ir.current),hl(e)){if(r=e.stateNode,t=e.memoizedProps,r[Tr]=e,(s=r.nodeValue!==t)&&(n=Nn,n!==null))switch(n.tag){case 3:fl(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&fl(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Tr]=e,e.stateNode=r}return Jt(e),null;case 13:if(ct(mt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(dt&&Cn!==null&&e.mode&1&&!(e.flags&128))Vy(),Js(),e.flags|=98560,s=!1;else if(s=hl(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(te(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(te(317));s[Tr]=e}else Js(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Jt(e),s=!1}else ir!==null&&(_f(ir),ir=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||mt.current&1?Ft===0&&(Ft=3):Gh())),e.updateQueue!==null&&(e.flags|=4),Jt(e),null);case 4:return ta(),gf(n,e),n===null&&ao(e.stateNode.containerInfo),Jt(e),null;case 10:return Ah(e.type._context),Jt(e),null;case 17:return Tn(e.type)&&pu(),Jt(e),null;case 19:if(ct(mt),s=e.memoizedState,s===null)return Jt(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)Ra(s,!1);else{if(Ft!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Su(n),a!==null){for(e.flags|=128,Ra(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ot(mt,mt.current&1|2),e.child}n=n.sibling}s.tail!==null&&Lt()>ra&&(e.flags|=128,r=!0,Ra(s,!1),e.lanes=4194304)}else{if(!r)if(n=Su(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ra(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!dt)return Jt(e),null}else 2*Lt()-s.renderingStartTime>ra&&t!==1073741824&&(e.flags|=128,r=!0,Ra(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Lt(),e.sibling=null,t=mt.current,ot(mt,r?t&1|2:t&1),e):(Jt(e),null);case 22:case 23:return $h(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?wn&1073741824&&(Jt(e),e.subtreeFlags&6&&(e.flags|=8192)):Jt(e),null;case 24:return null;case 25:return null}throw Error(te(156,e.tag))}function kA(n,e){switch(Th(e),e.tag){case 1:return Tn(e.type)&&pu(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ta(),ct(En),ct(tn),bh(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return wh(e),null;case 13:if(ct(mt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(te(340));Js()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ct(mt),null;case 4:return ta(),null;case 10:return Ah(e.type._context),null;case 22:case 23:return $h(),null;case 24:return null;default:return null}}var ml=!1,en=!1,DA=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Ms(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){_t(n,e,r)}else t.current=null}function mf(n,e,t){try{t()}catch(r){_t(n,e,r)}}var Bg=!1;function PA(n,e){if(Qd=cu,n=by(),vh(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,u=-1,l=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||i!==0&&d.nodeType!==3||(o=a+i),d!==s||r!==0&&d.nodeType!==3||(u=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++l===i&&(o=a),f===s&&++c===r&&(u=a),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=o===-1||u===-1?null:{start:o,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(Jd={focusedElem:n,selectionRange:t},cu=!1,ge=e;ge!==null;)if(e=ge,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ge=n;else for(;ge!==null;){e=ge;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,m=p.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:nr(e.type,g),m);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(_){_t(e,e.return,_)}if(n=e.sibling,n!==null){n.return=e.return,ge=n;break}ge=e.return}return p=Bg,Bg=!1,p}function Ka(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&mf(e,t,s)}i=i.next}while(i!==r)}}function rc(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function yf(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Iv(n){var e=n.alternate;e!==null&&(n.alternate=null,Iv(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Tr],delete e[lo],delete e[nf],delete e[pA],delete e[gA])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Lv(n){return n.tag===5||n.tag===3||n.tag===4}function $g(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Lv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function vf(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=hu));else if(r!==4&&(n=n.child,n!==null))for(vf(n,e,t),n=n.sibling;n!==null;)vf(n,e,t),n=n.sibling}function Ef(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Ef(n,e,t),n=n.sibling;n!==null;)Ef(n,e,t),n=n.sibling}var jt=null,rr=!1;function si(n,e,t){for(t=t.child;t!==null;)Rv(n,e,t),t=t.sibling}function Rv(n,e,t){if(Ar&&typeof Ar.onCommitFiberUnmount=="function")try{Ar.onCommitFiberUnmount(qu,t)}catch{}switch(t.tag){case 5:en||Ms(t,e);case 6:var r=jt,i=rr;jt=null,si(n,e,t),jt=r,rr=i,jt!==null&&(rr?(n=jt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):jt.removeChild(t.stateNode));break;case 18:jt!==null&&(rr?(n=jt,t=t.stateNode,n.nodeType===8?Kc(n.parentNode,t):n.nodeType===1&&Kc(n,t),ro(n)):Kc(jt,t.stateNode));break;case 4:r=jt,i=rr,jt=t.stateNode.containerInfo,rr=!0,si(n,e,t),jt=r,rr=i;break;case 0:case 11:case 14:case 15:if(!en&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&mf(t,e,a),i=i.next}while(i!==r)}si(n,e,t);break;case 1:if(!en&&(Ms(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){_t(t,e,o)}si(n,e,t);break;case 21:si(n,e,t);break;case 22:t.mode&1?(en=(r=en)||t.memoizedState!==null,si(n,e,t),en=r):si(n,e,t);break;default:si(n,e,t)}}function Gg(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new DA),e.forEach(function(r){var i=GA.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Jn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:jt=o.stateNode,rr=!1;break e;case 3:jt=o.stateNode.containerInfo,rr=!0;break e;case 4:jt=o.stateNode.containerInfo,rr=!0;break e}o=o.return}if(jt===null)throw Error(te(160));Rv(s,a,i),jt=null,rr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){_t(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wv(e,n),e=e.sibling}function wv(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Jn(e,n),hr(n),r&4){try{Ka(3,n,n.return),rc(3,n)}catch(g){_t(n,n.return,g)}try{Ka(5,n,n.return)}catch(g){_t(n,n.return,g)}}break;case 1:Jn(e,n),hr(n),r&512&&t!==null&&Ms(t,t.return);break;case 5:if(Jn(e,n),hr(n),r&512&&t!==null&&Ms(t,t.return),n.flags&32){var i=n.stateNode;try{Ja(i,"")}catch(g){_t(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&X0(i,s),Vd(o,a);var l=Vd(o,s);for(a=0;a<u.length;a+=2){var c=u[a],d=u[a+1];c==="style"?ty(i,d):c==="dangerouslySetInnerHTML"?J0(i,d):c==="children"?Ja(i,d):sh(i,c,d,l)}switch(o){case"input":Fd(i,s);break;case"textarea":Z0(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?$s(i,!!s.multiple,h,!1):f!==!!s.multiple&&(s.defaultValue!=null?$s(i,!!s.multiple,s.defaultValue,!0):$s(i,!!s.multiple,s.multiple?[]:"",!1))}i[lo]=s}catch(g){_t(n,n.return,g)}}break;case 6:if(Jn(e,n),hr(n),r&4){if(n.stateNode===null)throw Error(te(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){_t(n,n.return,g)}}break;case 3:if(Jn(e,n),hr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{ro(e.containerInfo)}catch(g){_t(n,n.return,g)}break;case 4:Jn(e,n),hr(n);break;case 13:Jn(e,n),hr(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Uh=Lt())),r&4&&Gg(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(en=(l=en)||c,Jn(e,n),en=l):Jn(e,n),hr(n),r&8192){if(l=n.memoizedState!==null,(n.stateNode.isHidden=l)&&!c&&n.mode&1)for(ge=n,c=n.child;c!==null;){for(d=ge=c;ge!==null;){switch(f=ge,h=f.child,f.tag){case 0:case 11:case 14:case 15:Ka(4,f,f.return);break;case 1:Ms(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){_t(r,t,g)}}break;case 5:Ms(f,f.return);break;case 22:if(f.memoizedState!==null){jg(d);continue}}h!==null?(h.return=f,ge=h):jg(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,u=d.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,o.style.display=ey("display",a))}catch(g){_t(n,n.return,g)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(g){_t(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Jn(e,n),hr(n),r&4&&Gg(n);break;case 21:break;default:Jn(e,n),hr(n)}}function hr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Lv(t)){var r=t;break e}t=t.return}throw Error(te(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Ja(i,""),r.flags&=-33);var s=$g(n);Ef(n,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,o=$g(n);vf(n,o,a);break;default:throw Error(te(161))}}catch(u){_t(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function CA(n,e,t){ge=n,bv(n)}function bv(n,e,t){for(var r=(n.mode&1)!==0;ge!==null;){var i=ge,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||ml;if(!a){var o=i.alternate,u=o!==null&&o.memoizedState!==null||en;o=ml;var l=en;if(ml=a,(en=u)&&!l)for(ge=i;ge!==null;)a=ge,u=a.child,a.tag===22&&a.memoizedState!==null?Hg(i):u!==null?(u.return=a,ge=u):Hg(i);for(;s!==null;)ge=s,bv(s),s=s.sibling;ge=i,ml=o,en=l}Vg(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,ge=s):Vg(n)}}function Vg(n){for(;ge!==null;){var e=ge;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:en||rc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!en)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:nr(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Lg(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Lg(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&ro(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}en||e.flags&512&&yf(e)}catch(f){_t(e,e.return,f)}}if(e===n){ge=null;break}if(t=e.sibling,t!==null){t.return=e.return,ge=t;break}ge=e.return}}function jg(n){for(;ge!==null;){var e=ge;if(e===n){ge=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ge=t;break}ge=e.return}}function Hg(n){for(;ge!==null;){var e=ge;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{rc(4,e)}catch(u){_t(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){_t(e,i,u)}}var s=e.return;try{yf(e)}catch(u){_t(e,s,u)}break;case 5:var a=e.return;try{yf(e)}catch(u){_t(e,a,u)}}}catch(u){_t(e,e.return,u)}if(e===n){ge=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ge=o;break}ge=e.return}}var NA=Math.ceil,Au=ni.ReactCurrentDispatcher,Mh=ni.ReactCurrentOwner,Wn=ni.ReactCurrentBatchConfig,qe=0,Gt=null,wt=null,Yt=0,wn=0,Fs=Ui(0),Ft=0,go=null,ls=0,ic=0,Fh=0,za=null,mn=null,Uh=0,ra=1/0,Gr=null,Iu=!1,Tf=null,Ai=null,yl=!1,vi=null,Lu=0,Wa=0,Sf=null,Yl=-1,ql=0;function un(){return qe&6?Lt():Yl!==-1?Yl:Yl=Lt()}function Ii(n){return n.mode&1?qe&2&&Yt!==0?Yt&-Yt:yA.transition!==null?(ql===0&&(ql=hy()),ql):(n=tt,n!==0||(n=window.event,n=n===void 0?16:Ty(n.type)),n):1}function or(n,e,t,r){if(50<Wa)throw Wa=0,Sf=null,Error(te(185));$o(n,t,r),(!(qe&2)||n!==Gt)&&(n===Gt&&(!(qe&2)&&(ic|=t),Ft===4&&pi(n,Yt)),Sn(n,r),t===1&&qe===0&&!(e.mode&1)&&(ra=Lt()+500,ec&&Bi()))}function Sn(n,e){var t=n.callbackNode;y_(n,e);var r=uu(n,n===Gt?Yt:0);if(r===0)t!==null&&Jp(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Jp(t),e===1)n.tag===0?mA(Kg.bind(null,n)):By(Kg.bind(null,n)),fA(function(){!(qe&6)&&Bi()}),t=null;else{switch(py(r)){case 1:t=ch;break;case 4:t=dy;break;case 16:t=lu;break;case 536870912:t=fy;break;default:t=lu}t=Fv(t,kv.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function kv(n,e){if(Yl=-1,ql=0,qe&6)throw Error(te(327));var t=n.callbackNode;if(Ks()&&n.callbackNode!==t)return null;var r=uu(n,n===Gt?Yt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ru(n,r);else{e=r;var i=qe;qe|=2;var s=Pv();(Gt!==n||Yt!==e)&&(Gr=null,ra=Lt()+500,es(n,e));do try{FA();break}catch(o){Dv(n,o)}while(!0);_h(),Au.current=s,qe=i,wt!==null?e=0:(Gt=null,Yt=0,e=Ft)}if(e!==0){if(e===2&&(i=Wd(n),i!==0&&(r=i,e=xf(n,i))),e===1)throw t=go,es(n,0),pi(n,r),Sn(n,Lt()),t;if(e===6)pi(n,r);else{if(i=n.current.alternate,!(r&30)&&!OA(i)&&(e=Ru(n,r),e===2&&(s=Wd(n),s!==0&&(r=s,e=xf(n,s))),e===1))throw t=go,es(n,0),pi(n,r),Sn(n,Lt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(te(345));case 2:Yi(n,mn,Gr);break;case 3:if(pi(n,r),(r&130023424)===r&&(e=Uh+500-Lt(),10<e)){if(uu(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){un(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=tf(Yi.bind(null,n,mn,Gr),e);break}Yi(n,mn,Gr);break;case 4:if(pi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-ar(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=Lt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*NA(r/1960))-r,10<r){n.timeoutHandle=tf(Yi.bind(null,n,mn,Gr),r);break}Yi(n,mn,Gr);break;case 5:Yi(n,mn,Gr);break;default:throw Error(te(329))}}}return Sn(n,Lt()),n.callbackNode===t?kv.bind(null,n):null}function xf(n,e){var t=za;return n.current.memoizedState.isDehydrated&&(es(n,e).flags|=256),n=Ru(n,e),n!==2&&(e=mn,mn=t,e!==null&&_f(e)),n}function _f(n){mn===null?mn=n:mn.push.apply(mn,n)}function OA(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!ur(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function pi(n,e){for(e&=~Fh,e&=~ic,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ar(e),r=1<<t;n[t]=-1,e&=~r}}function Kg(n){if(qe&6)throw Error(te(327));Ks();var e=uu(n,0);if(!(e&1))return Sn(n,Lt()),null;var t=Ru(n,e);if(n.tag!==0&&t===2){var r=Wd(n);r!==0&&(e=r,t=xf(n,r))}if(t===1)throw t=go,es(n,0),pi(n,e),Sn(n,Lt()),t;if(t===6)throw Error(te(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Yi(n,mn,Gr),Sn(n,Lt()),null}function Bh(n,e){var t=qe;qe|=1;try{return n(e)}finally{qe=t,qe===0&&(ra=Lt()+500,ec&&Bi())}}function us(n){vi!==null&&vi.tag===0&&!(qe&6)&&Ks();var e=qe;qe|=1;var t=Wn.transition,r=tt;try{if(Wn.transition=null,tt=1,n)return n()}finally{tt=r,Wn.transition=t,qe=e,!(qe&6)&&Bi()}}function $h(){wn=Fs.current,ct(Fs)}function es(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,dA(t)),wt!==null)for(t=wt.return;t!==null;){var r=t;switch(Th(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&pu();break;case 3:ta(),ct(En),ct(tn),bh();break;case 5:wh(r);break;case 4:ta();break;case 13:ct(mt);break;case 19:ct(mt);break;case 10:Ah(r.type._context);break;case 22:case 23:$h()}t=t.return}if(Gt=n,wt=n=Li(n.current,null),Yt=wn=e,Ft=0,go=null,Fh=ic=ls=0,mn=za=null,Qi!==null){for(e=0;e<Qi.length;e++)if(t=Qi[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}t.pending=r}Qi=null}return n}function Dv(n,e){do{var t=wt;try{if(_h(),Kl.current=_u,xu){for(var r=vt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}xu=!1}if(os=0,$t=Ot=vt=null,Ha=!1,fo=0,Mh.current=null,t===null||t.return===null){Ft=1,go=e,wt=null;break}e:{var s=n,a=t.return,o=t,u=e;if(e=Yt,o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=Pg(a);if(h!==null){h.flags&=-257,Cg(h,a,o,s,e),h.mode&1&&Dg(s,l,e),e=h,u=l;var p=e.updateQueue;if(p===null){var g=new Set;g.add(u),e.updateQueue=g}else p.add(u);break e}else{if(!(e&1)){Dg(s,l,e),Gh();break e}u=Error(te(426))}}else if(dt&&o.mode&1){var m=Pg(a);if(m!==null){!(m.flags&65536)&&(m.flags|=256),Cg(m,a,o,s,e),Sh(na(u,o));break e}}s=u=na(u,o),Ft!==4&&(Ft=2),za===null?za=[s]:za.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=pv(s,u,e);Ig(s,v);break e;case 1:o=u;var y=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Ai===null||!Ai.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var _=gv(s,o,e);Ig(s,_);break e}}s=s.return}while(s!==null)}Nv(t)}catch(I){e=I,wt===t&&t!==null&&(wt=t=t.return);continue}break}while(!0)}function Pv(){var n=Au.current;return Au.current=_u,n===null?_u:n}function Gh(){(Ft===0||Ft===3||Ft===2)&&(Ft=4),Gt===null||!(ls&268435455)&&!(ic&268435455)||pi(Gt,Yt)}function Ru(n,e){var t=qe;qe|=2;var r=Pv();(Gt!==n||Yt!==e)&&(Gr=null,es(n,e));do try{MA();break}catch(i){Dv(n,i)}while(!0);if(_h(),qe=t,Au.current=r,wt!==null)throw Error(te(261));return Gt=null,Yt=0,Ft}function MA(){for(;wt!==null;)Cv(wt)}function FA(){for(;wt!==null&&!l_();)Cv(wt)}function Cv(n){var e=Mv(n.alternate,n,wn);n.memoizedProps=n.pendingProps,e===null?Nv(n):wt=e,Mh.current=null}function Nv(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=kA(t,e),t!==null){t.flags&=32767,wt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ft=6,wt=null;return}}else if(t=bA(t,e,wn),t!==null){wt=t;return}if(e=e.sibling,e!==null){wt=e;return}wt=e=n}while(e!==null);Ft===0&&(Ft=5)}function Yi(n,e,t){var r=tt,i=Wn.transition;try{Wn.transition=null,tt=1,UA(n,e,t,r)}finally{Wn.transition=i,tt=r}return null}function UA(n,e,t,r){do Ks();while(vi!==null);if(qe&6)throw Error(te(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(te(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(v_(n,s),n===Gt&&(wt=Gt=null,Yt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||yl||(yl=!0,Fv(lu,function(){return Ks(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Wn.transition,Wn.transition=null;var a=tt;tt=1;var o=qe;qe|=4,Mh.current=null,PA(n,t),wv(t,n),iA(Jd),cu=!!Qd,Jd=Qd=null,n.current=t,CA(t),u_(),qe=o,tt=a,Wn.transition=s}else n.current=t;if(yl&&(yl=!1,vi=n,Lu=i),s=n.pendingLanes,s===0&&(Ai=null),f_(t.stateNode),Sn(n,Lt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Iu)throw Iu=!1,n=Tf,Tf=null,n;return Lu&1&&n.tag!==0&&Ks(),s=n.pendingLanes,s&1?n===Sf?Wa++:(Wa=0,Sf=n):Wa=0,Bi(),null}function Ks(){if(vi!==null){var n=py(Lu),e=Wn.transition,t=tt;try{if(Wn.transition=null,tt=16>n?16:n,vi===null)var r=!1;else{if(n=vi,vi=null,Lu=0,qe&6)throw Error(te(331));var i=qe;for(qe|=4,ge=n.current;ge!==null;){var s=ge,a=s.child;if(ge.flags&16){var o=s.deletions;if(o!==null){for(var u=0;u<o.length;u++){var l=o[u];for(ge=l;ge!==null;){var c=ge;switch(c.tag){case 0:case 11:case 15:Ka(8,c,s)}var d=c.child;if(d!==null)d.return=c,ge=d;else for(;ge!==null;){c=ge;var f=c.sibling,h=c.return;if(Iv(c),c===l){ge=null;break}if(f!==null){f.return=h,ge=f;break}ge=h}}}var p=s.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(g!==null)}}ge=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,ge=a;else e:for(;ge!==null;){if(s=ge,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ka(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ge=v;break e}ge=s.return}}var y=n.current;for(ge=y;ge!==null;){a=ge;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,ge=E;else e:for(a=y;ge!==null;){if(o=ge,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:rc(9,o)}}catch(I){_t(o,o.return,I)}if(o===a){ge=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,ge=_;break e}ge=o.return}}if(qe=i,Bi(),Ar&&typeof Ar.onPostCommitFiberRoot=="function")try{Ar.onPostCommitFiberRoot(qu,n)}catch{}r=!0}return r}finally{tt=t,Wn.transition=e}}return!1}function zg(n,e,t){e=na(t,e),e=pv(n,e,1),n=_i(n,e,1),e=un(),n!==null&&($o(n,1,e),Sn(n,e))}function _t(n,e,t){if(n.tag===3)zg(n,n,t);else for(;e!==null;){if(e.tag===3){zg(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ai===null||!Ai.has(r))){n=na(t,n),n=gv(e,n,1),e=_i(e,n,1),n=un(),e!==null&&($o(e,1,n),Sn(e,n));break}}e=e.return}}function BA(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=un(),n.pingedLanes|=n.suspendedLanes&t,Gt===n&&(Yt&t)===t&&(Ft===4||Ft===3&&(Yt&130023424)===Yt&&500>Lt()-Uh?es(n,0):Fh|=t),Sn(n,e)}function Ov(n,e){e===0&&(n.mode&1?(e=ol,ol<<=1,!(ol&130023424)&&(ol=4194304)):e=1);var t=un();n=Jr(n,e),n!==null&&($o(n,e,t),Sn(n,t))}function $A(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Ov(n,t)}function GA(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(te(314))}r!==null&&r.delete(e),Ov(n,t)}var Mv;Mv=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||En.current)yn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return yn=!1,wA(n,e,t);yn=!!(n.flags&131072)}else yn=!1,dt&&e.flags&1048576&&$y(e,yu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Wl(n,e),n=e.pendingProps;var i=Qs(e,tn.current);Hs(e,t),i=Dh(null,e,r,n,i,t);var s=Ph();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Tn(r)?(s=!0,gu(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Lh(e),i.updater=nc,e.stateNode=i,i._reactInternals=e,uf(e,r,n,t),e=ff(null,e,r,!0,s,t)):(e.tag=0,dt&&s&&Eh(e),on(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Wl(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=jA(r),n=nr(r,n),i){case 0:e=df(null,e,r,n,t);break e;case 1:e=Mg(null,e,r,n,t);break e;case 11:e=Ng(null,e,r,n,t);break e;case 14:e=Og(null,e,r,nr(r.type,n),t);break e}throw Error(te(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:nr(r,i),df(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:nr(r,i),Mg(n,e,r,i,t);case 3:e:{if(Ev(e),n===null)throw Error(te(387));r=e.pendingProps,s=e.memoizedState,i=s.element,zy(n,e),Tu(e,r,null,t);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=na(Error(te(423)),e),e=Fg(n,e,r,t,i);break e}else if(r!==i){i=na(Error(te(424)),e),e=Fg(n,e,r,t,i);break e}else for(Cn=xi(e.stateNode.containerInfo.firstChild),Nn=e,dt=!0,ir=null,t=Hy(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Js(),r===i){e=ei(n,e,t);break e}on(n,e,r,t)}e=e.child}return e;case 5:return Wy(e),n===null&&af(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,a=i.children,ef(r,i)?a=null:s!==null&&ef(r,s)&&(e.flags|=32),vv(n,e),on(n,e,a,t),e.child;case 6:return n===null&&af(e),null;case 13:return Tv(n,e,t);case 4:return Rh(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ea(e,null,r,t):on(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:nr(r,i),Ng(n,e,r,i,t);case 7:return on(n,e,e.pendingProps,t),e.child;case 8:return on(n,e,e.pendingProps.children,t),e.child;case 12:return on(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,ot(vu,r._currentValue),r._currentValue=a,s!==null)if(ur(s.value,a)){if(s.children===i.children&&!En.current){e=ei(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var u=o.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=qr(-1,t&-t),u.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}s.lanes|=t,u=s.alternate,u!==null&&(u.lanes|=t),of(s.return,t,e),o.lanes|=t;break}u=u.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(te(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),of(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}on(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Hs(e,t),i=Yn(i),r=r(i),e.flags|=1,on(n,e,r,t),e.child;case 14:return r=e.type,i=nr(r,e.pendingProps),i=nr(r.type,i),Og(n,e,r,i,t);case 15:return mv(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:nr(r,i),Wl(n,e),e.tag=1,Tn(r)?(n=!0,gu(e)):n=!1,Hs(e,t),hv(e,r,i),uf(e,r,i,t),ff(null,e,r,!0,n,t);case 19:return Sv(n,e,t);case 22:return yv(n,e,t)}throw Error(te(156,e.tag))};function Fv(n,e){return cy(n,e)}function VA(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(n,e,t,r){return new VA(n,e,t,r)}function Vh(n){return n=n.prototype,!(!n||!n.isReactComponent)}function jA(n){if(typeof n=="function")return Vh(n)?1:0;if(n!=null){if(n=n.$$typeof,n===oh)return 11;if(n===lh)return 14}return 2}function Li(n,e){var t=n.alternate;return t===null?(t=zn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Xl(n,e,t,r,i,s){var a=2;if(r=n,typeof n=="function")Vh(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Rs:return ts(t.children,i,s,e);case ah:a=8,i|=8;break;case Pd:return n=zn(12,t,e,i|2),n.elementType=Pd,n.lanes=s,n;case Cd:return n=zn(13,t,e,i),n.elementType=Cd,n.lanes=s,n;case Nd:return n=zn(19,t,e,i),n.elementType=Nd,n.lanes=s,n;case W0:return sc(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case K0:a=10;break e;case z0:a=9;break e;case oh:a=11;break e;case lh:a=14;break e;case li:a=16,r=null;break e}throw Error(te(130,n==null?n:typeof n,""))}return e=zn(a,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function ts(n,e,t,r){return n=zn(7,n,r,e),n.lanes=t,n}function sc(n,e,t,r){return n=zn(22,n,r,e),n.elementType=W0,n.lanes=t,n.stateNode={isHidden:!1},n}function Jc(n,e,t){return n=zn(6,n,null,e),n.lanes=t,n}function ed(n,e,t){return e=zn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function HA(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Nc(0),this.expirationTimes=Nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jh(n,e,t,r,i,s,a,o,u){return n=new HA(n,e,t,o,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=zn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lh(s),n}function KA(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ls,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Uv(n){if(!n)return bi;n=n._reactInternals;e:{if(gs(n)!==n||n.tag!==1)throw Error(te(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Tn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(te(171))}if(n.tag===1){var t=n.type;if(Tn(t))return Uy(n,t,e)}return e}function Bv(n,e,t,r,i,s,a,o,u){return n=jh(t,r,!0,n,i,s,a,o,u),n.context=Uv(null),t=n.current,r=un(),i=Ii(t),s=qr(r,i),s.callback=e??null,_i(t,s,i),n.current.lanes=i,$o(n,i,r),Sn(n,r),n}function ac(n,e,t,r){var i=e.current,s=un(),a=Ii(i);return t=Uv(t),e.context===null?e.context=t:e.pendingContext=t,e=qr(s,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=_i(i,e,a),n!==null&&(or(n,i,a,s),Hl(n,i,a)),a}function wu(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Wg(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Hh(n,e){Wg(n,e),(n=n.alternate)&&Wg(n,e)}function zA(){return null}var $v=typeof reportError=="function"?reportError:function(n){console.error(n)};function Kh(n){this._internalRoot=n}oc.prototype.render=Kh.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(te(409));ac(n,e,null,null)};oc.prototype.unmount=Kh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;us(function(){ac(null,n,null,null)}),e[Qr]=null}};function oc(n){this._internalRoot=n}oc.prototype.unstable_scheduleHydration=function(n){if(n){var e=yy();n={blockedOn:null,target:n,priority:e};for(var t=0;t<hi.length&&e!==0&&e<hi[t].priority;t++);hi.splice(t,0,n),t===0&&Ey(n)}};function zh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function lc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Yg(){}function WA(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var l=wu(a);s.call(l)}}var a=Bv(e,r,n,0,null,!1,!1,"",Yg);return n._reactRootContainer=a,n[Qr]=a.current,ao(n.nodeType===8?n.parentNode:n),us(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var l=wu(u);o.call(l)}}var u=jh(n,0,!1,null,null,!1,!1,"",Yg);return n._reactRootContainer=u,n[Qr]=u.current,ao(n.nodeType===8?n.parentNode:n),us(function(){ac(e,u,t,r)}),u}function uc(n,e,t,r,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var u=wu(a);o.call(u)}}ac(e,a,n,i)}else a=WA(t,e,n,i,r);return wu(a)}gy=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ca(e.pendingLanes);t!==0&&(dh(e,t|1),Sn(e,Lt()),!(qe&6)&&(ra=Lt()+500,Bi()))}break;case 13:us(function(){var r=Jr(n,1);if(r!==null){var i=un();or(r,n,1,i)}}),Hh(n,1)}};fh=function(n){if(n.tag===13){var e=Jr(n,134217728);if(e!==null){var t=un();or(e,n,134217728,t)}Hh(n,134217728)}};my=function(n){if(n.tag===13){var e=Ii(n),t=Jr(n,e);if(t!==null){var r=un();or(t,n,e,r)}Hh(n,e)}};yy=function(){return tt};vy=function(n,e){var t=tt;try{return tt=n,e()}finally{tt=t}};Hd=function(n,e,t){switch(e){case"input":if(Fd(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Ju(r);if(!i)throw Error(te(90));q0(r),Fd(r,i)}}}break;case"textarea":Z0(n,t);break;case"select":e=t.value,e!=null&&$s(n,!!t.multiple,e,!1)}};iy=Bh;sy=us;var YA={usingClientEntryPoint:!1,Events:[Vo,Ds,Ju,ny,ry,Bh]},wa={findFiberByHostInstance:Zi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qA={bundleType:wa.bundleType,version:wa.version,rendererPackageName:wa.rendererPackageName,rendererConfig:wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ni.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=ly(n),n===null?null:n.stateNode},findFiberByHostInstance:wa.findFiberByHostInstance||zA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{qu=vl.inject(qA),Ar=vl}catch{}}Un.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=YA;Un.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zh(e))throw Error(te(200));return KA(n,e,null,t)};Un.createRoot=function(n,e){if(!zh(n))throw Error(te(299));var t=!1,r="",i=$v;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=jh(n,1,!1,null,null,t,!1,r,i),n[Qr]=e.current,ao(n.nodeType===8?n.parentNode:n),new Kh(e)};Un.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(te(188)):(n=Object.keys(n).join(","),Error(te(268,n)));return n=ly(e),n=n===null?null:n.stateNode,n};Un.flushSync=function(n){return us(n)};Un.hydrate=function(n,e,t){if(!lc(e))throw Error(te(200));return uc(null,n,e,!0,t)};Un.hydrateRoot=function(n,e,t){if(!zh(n))throw Error(te(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",a=$v;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Bv(e,null,n,1,t??null,i,!1,s,a),n[Qr]=e.current,ao(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new oc(e)};Un.render=function(n,e,t){if(!lc(e))throw Error(te(200));return uc(null,n,e,!1,t)};Un.unmountComponentAtNode=function(n){if(!lc(n))throw Error(te(40));return n._reactRootContainer?(us(function(){uc(null,null,n,!1,function(){n._reactRootContainer=null,n[Qr]=null})}),!0):!1};Un.unstable_batchedUpdates=Bh;Un.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!lc(t))throw Error(te(200));if(n==null||n._reactInternals===void 0)throw Error(te(38));return uc(n,e,t,!1,r)};Un.version="18.3.1-next-f1338f8080-20240426";function Gv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Gv)}catch(n){console.error(n)}}Gv(),G0.exports=Un;var XA=G0.exports,qg=XA;kd.createRoot=qg.createRoot,kd.hydrateRoot=qg.hydrateRoot;const ue=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},ZA=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=QA},QA=Number.MAX_SAFE_INTEGER||9007199254740991;let ve=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),B=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),T=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var He={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},pe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Es{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class JA{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Es(e),this.fast_=new Es(t),this.defaultTTFB_=i,this.ttfb_=new Es(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Es(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Es(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Es(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function eI(n,e,t){return(e=nI(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function nt(){return nt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},nt.apply(null,arguments)}function Xg(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Je(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xg(Object(t),!0).forEach(function(r){eI(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Xg(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function tI(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function nI(n){var e=tI(n,"string");return typeof e=="symbol"?e:e+""}class Qn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=ci,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const ci=function(){},rI={trace:ci,debug:ci,log:ci,warn:ci,info:ci,error:ci};function Af(){return nt({},rI)}function iI(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):ci}function Zg(n,e,t){return e[n]?e[n].bind(e):iI(n,t)}const If=Af();function sI(n,e,t){const r=Af();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{r[s]=Zg(s,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Af()}i.forEach(s=>{If[s]=Zg(s,n)})}else nt(If,r);return r}const et=If;function ki(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function aI(n){return typeof self<"u"&&n===self.ManagedMediaSource}function Vv(n,e){const t=Object.keys(n),r=Object.keys(e),i=t.length,s=r.length;return!i||!s||i===s&&!t.some(a=>r.indexOf(a)===-1)}function On(n,e=!1){if(typeof TextDecoder<"u"){const l=new TextDecoder("utf-8").decode(n);if(e){const c=l.indexOf("\0");return c!==-1?l.substring(0,c):l}return l.replace(/\0/g,"")}const t=n.length;let r,i,s,a="",o=0;for(;o<t;){if(r=n[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=n[o++],a+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=n[o++],s=n[o++],a+=String.fromCharCode((r&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}function Kt(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function jv(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function oI(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var td={exports:{}},Qg;function lI(){return Qg||(Qg=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(u,l,c){if(c=c||{},u=u.trim(),l=l.trim(),!l){if(!c.alwaysNormalize)return u;var d=o.parseURL(u);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):l;var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var p=i.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));else{var m=h.path,v=m.substring(0,m.lastIndexOf("/")+1)+f.path;g.path=o.normalizePath(v)}return g.path===null&&(g.path=c.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(g)},parseURL:function(u){var l=r.exec(u);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};n.exports=o})()}(td)),td.exports}var Wh=lI();class Yh{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var rt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Hv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,cI(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[rt.AUDIO]:null,[rt.VIDEO]:null,[rt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Yh),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Wh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[rt.AUDIO]=null,e[rt.VIDEO]=null,e[rt.AUDIOVIDEO]=null}}function Rt(n){return n.sn!=="initSegment"}class nd extends Hv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ue(e)&&ue(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const i=this._decryptdata=t[r[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ue(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ue(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Rt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const i=t[e];i&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,a=!1){const{elementaryStreams:o}=this,u=o[e];if(!u){o[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:a};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,r),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,s)}}class uI extends Hv{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Kv(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||Kv(t,e)}}function cI(n,e){const t=Kv(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Jg=Math.pow(2,32)-1,dI=[].push,zv={video:1,audio:2,id3:3,text:4};function Ct(n){return String.fromCharCode.apply(null,n)}function Wv(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Ce(n,e){const t=Yv(n,e);return t<0?4294967296+t:t}function em(n,e){let t=Ce(n,e);return t*=Math.pow(2,32),t+=Ce(n,e+4),t}function Yv(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function fI(n){const e=n.byteLength;for(let t=0;t<e;){const r=Ce(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Ge(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=Ce(n,i),a=Ct(n.subarray(i+4,i+8)),o=s>1?i+s:r;if(a===e[0])if(e.length===1)t.push(n.subarray(i+8,o));else{const u=Ge(n.subarray(i+8,o),e.slice(1));u.length&&dI.apply(t,u)}i=o}return t}function hI(n){const e=[],t=n[0];let r=8;const i=Ce(n,r);r+=4;let s=0,a=0;t===0?(s=Ce(n,r),a=Ce(n,r+4),r+=8):(s=em(n,r),a=em(n,r+8),r+=16),r+=2;let o=n.length+a;const u=Wv(n,r);r+=2;for(let l=0;l<u;l++){let c=r;const d=Ce(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return et.warn("SIDX has hierarchical references (not supported)"),null;const p=Ce(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/i,start:o,end:o+f-1}}),o+=f,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:u,references:e}}function qv(n){const e=[],t=Ge(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=Ge(s,["tkhd"])[0];if(a){let o=a[0];const u=Ce(a,o===0?12:20),l=Ge(s,["mdia","mdhd"])[0];if(l){o=l[0];const c=Ce(l,o===0?12:20),d=Ge(s,["mdia","hdlr"])[0];if(d){const f=Ct(d.subarray(8,12)),h={soun:rt.AUDIO,vide:rt.VIDEO}[f],p=Ge(s,["mdia","minf","stbl","stsd"])[0],g=pI(p);h?(e[u]={timescale:c,type:h,stsd:g},e[h]=Je({timescale:c,id:u},g)):e[u]={timescale:c,type:f,stsd:g}}}}}return Ge(n,["moov","mvex","trex"]).forEach(i=>{const s=Ce(i,4),a=e[s];a&&(a.default={duration:Ce(i,12),flags:Ce(i,20)})}),e}function pI(n){const e=n.subarray(8),t=e.subarray(86),r=Ct(e.subarray(4,8));let i=r,s;const a=r==="enca"||r==="encv";if(a){const l=Ge(e,[r])[0].subarray(r==="enca"?28:78);Ge(l,["sinf"]).forEach(d=>{const f=Ge(d,["schm"])[0];if(f){const h=Ct(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const p=Ge(d,["frma"])[0];p&&(i=Ct(p))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=Ge(t,["avcC"])[0];u&&u.length>3&&(i+="."+Tl(u[1])+Tl(u[2])+Tl(u[3]),s=El(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=Ge(e,[r])[0],l=Ge(u.subarray(28),["esds"])[0];if(l&&l.length>7){let c=4;if(l[c++]!==3)break;c=rd(l,c),c+=2;const d=l[c++];if(d&128&&(c+=2),d&64&&(c+=l[c++]),l[c++]!==4)break;c=rd(l,c);const f=l[c++];if(f===64)i+="."+Tl(f);else break;if(c+=12,l[c++]!==5)break;c=rd(l,c);const h=l[c++];let p=(h&248)>>3;p===31&&(p+=1+((h&7)<<3)+((l[c]&224)>>5)),i+="."+p}break}case"hvc1":case"hev1":{const u=Ge(t,["hvcC"])[0];if(u&&u.length>12){const l=u[1],c=["","A","B","C"][l>>6],d=l&31,f=Ce(u,2),h=(l&32)>>5?"H":"L",p=u[12],g=u.subarray(6,12);i+="."+c+d,i+="."+gI(f).toString(16).toUpperCase(),i+="."+h+p;let m="";for(let v=g.length;v--;){const y=g[v];(y||m)&&(m="."+y.toString(16).toUpperCase()+m)}i+=m}s=El(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=El(i,t)||i;break}case"vp09":{const u=Ge(t,["vpcC"])[0];if(u&&u.length>6){const l=u[4],c=u[5],d=u[6]>>4&15;i+="."+yr(l)+"."+yr(c)+"."+yr(d)}break}case"av01":{const u=Ge(t,["av1C"])[0];if(u&&u.length>2){const l=u[1]>>>5,c=u[1]&31,d=u[2]>>>7?"H":"M",f=(u[2]&64)>>6,h=(u[2]&32)>>5,p=l===2&&f?h?12:10:f?10:8,g=(u[2]&16)>>4,m=(u[2]&8)>>3,v=(u[2]&4)>>2,y=u[2]&3;i+="."+l+"."+yr(c)+d+"."+yr(p)+"."+g+"."+m+v+y+"."+yr(1)+"."+yr(1)+"."+yr(1)+"."+0,s=El("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function El(n,e){const t=Ge(e,["dvvC"]),r=t.length?t[0]:Ge(e,["dvcC"])[0];if(r){const i=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return n+"."+yr(i)+"."+yr(s)}}function gI(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function rd(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Tl(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function yr(n){return(n<10?"0":"")+n}function mI(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Xv(n,(r,i)=>{const s=r.subarray(8,24);s.some(a=>a!==0)||(et.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Kt(s)} -> ${Kt(t)}`),r.set(t,8))})}function yI(n){const e=[];return Xv(n,t=>e.push(t.subarray(8,24))),e}function Xv(n,e){Ge(n,["moov","trak"]).forEach(r=>{const i=Ge(r,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let a=Ge(s,["enca"]);const o=a.length>0;o||(a=Ge(s,["encv"])),a.forEach(u=>{const l=o?u.subarray(28):u.subarray(78);Ge(l,["sinf"]).forEach(d=>{const f=Zv(d);f&&e(f,o)})})})}function Zv(n){const e=Ge(n,["schm"])[0];if(e){const t=Ct(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=Ge(n,["schi","tenc"])[0];if(r)return r}}}function vI(n,e,t){const r={},i=Ge(n,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=Ge(a,["tfhd"])[0],u=Ce(o,4),l=e[u];if(!l)continue;r[u]||(r[u]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=r[u],d=Ge(a,["tfdt"])[0];if(d){const E=d[0];let _=Ce(d,4);E===1&&(_===Jg?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(_*=Jg+1,_+=Ce(d,8))),ue(_)&&(!ue(c.start)||_<c.start)&&(c.start=_)}const f=l.default,h=Ce(o,0)|(f==null?void 0:f.flags);let p=(f==null?void 0:f.duration)||0;h&8&&(h&2?p=Ce(o,12):p=Ce(o,8));const g=Ge(a,["trun"]);let m=c.start||0,v=0,y=p;for(let E=0;E<g.length;E++){const _=g[E],I=Ce(_,4),b=c.sampleCount;c.sampleCount+=I;const L=_[3]&1,w=_[3]&4,D=_[2]&1,R=_[2]&2,N=_[2]&4,G=_[2]&8;let ee=8,oe=I;for(L&&(ee+=4),w&&I&&(!(_[ee+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=b),ee+=4,D?(y=Ce(_,ee),ee+=4):y=p,R&&(ee+=4),G&&(ee+=4),m+=y,v+=y,oe--);oe--;)D?(y=Ce(_,ee),ee+=4):y=p,R&&(ee+=4),N&&(_[ee+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(oe+1),c.keyFrameStart=m),ee+=4),G&&(ee+=4),m+=y,v+=y;!v&&p&&(v+=p*I)}c.duration+=v}if(!Object.keys(r).some(s=>r[s].duration)){let s=1/0,a=0;const o=Ge(n,["sidx"]);for(let u=0;u<o.length;u++){const l=hI(o[u]);if(l!=null&&l.references){s=Math.min(s,l.earliestPresentationTime/l.timescale);const c=l.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,c+l.earliestPresentationTime/l.timescale)}}a&&ue(a)&&Object.keys(r).forEach(u=>{r[u].duration||(r[u].duration=a*r[u].timescale-r[u].start)})}return r}function EI(n){const e={valid:null,remainder:null},t=Ge(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Xn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function tm(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let a=!1;return Ge(r,["moof"]).map(u=>{const l=u.byteOffset-8;Ge(u,["traf"]).map(d=>{const f=Ge(d,["tfdt"]).map(h=>{const p=h[0];let g=Ce(h,4);return p===1&&(g*=Math.pow(2,32),g+=Ce(h,8)),g/i})[0];return f!==void 0&&(n=f),Ge(d,["tfhd"]).map(h=>{const p=Ce(h,4),g=Ce(h,0)&16777215,m=(g&1)!==0,v=(g&2)!==0,y=(g&8)!==0;let E=0;const _=(g&16)!==0;let I=0;const b=(g&32)!==0;let L=8;p===s&&(m&&(L+=8),v&&(L+=4),y&&(E=Ce(h,L),L+=4),_&&(I=Ce(h,L),L+=4),b&&(L+=4),e.type==="video"&&(a=cc(e.codec)),Ge(d,["trun"]).map(w=>{const D=w[0],R=Ce(w,0)&16777215,N=(R&1)!==0;let G=0;const ee=(R&4)!==0,oe=(R&256)!==0;let re=0;const J=(R&512)!==0;let le=0;const V=(R&1024)!==0,W=(R&2048)!==0;let Z=0;const q=Ce(w,4);let X=8;N&&(G=Ce(w,X),X+=4),ee&&(X+=4);let ye=G+l;for(let ke=0;ke<q;ke++){if(oe?(re=Ce(w,X),X+=4):re=E,J?(le=Ce(w,X),X+=4):le=I,V&&(X+=4),W&&(D===0?Z=Ce(w,X):Z=Yv(w,X),X+=4),e.type===rt.VIDEO){let Te=0;for(;Te<le;){const Le=Ce(r,ye);if(ye+=4,TI(a,r[ye])){const Re=r.subarray(ye,ye+Le);qh(Re,a?2:1,n+Z/i,t)}ye+=Le,Te+=Le+4}}n+=re/i}}))})})}),t}function cc(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function TI(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function qh(n,e,t,r){const i=Qv(n);let s=0;s+=e;let a=0,o=0,u=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;u=i[s++],a+=u}while(u===255);o=0;do{if(s>=i.length)break;u=i[s++],o+=u}while(u===255);const l=i.length-s;let c=s;if(o<l)s+=o;else if(o>l){et.error(`Malformed SEI payload. ${o} is too small, only ${l} bytes left to parse.`);break}if(a===4){if(i[c++]===181){const f=Wv(i,c);if(c+=2,f===49){const h=Ce(i,c);if(c+=4,h===1195456820){const p=i[c++];if(p===3){const g=i[c++],m=31&g,v=64&g,y=v?2+m*3:0,E=new Uint8Array(y);if(v){E[0]=g;for(let _=1;_<y;_++)E[_]=i[c++]}r.push({type:p,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let p=0;p<16;p++){const g=i[c++].toString(16);d.push(g.length==1?"0"+g:g),(p===3||p===5||p===7||p===9)&&d.push("-")}const f=o-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=i[c++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:On(h),userDataBytes:h})}}}function Qv(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===t[0]&&(a++,t.shift()),s[r]=n[a];return s}function SI(n){const e=n[0];let t="",r="",i=0,s=0,a=0,o=0,u=0,l=0;if(e===0){for(;Ct(n.subarray(l,l+1))!=="\0";)t+=Ct(n.subarray(l,l+1)),l+=1;for(t+=Ct(n.subarray(l,l+1)),l+=1;Ct(n.subarray(l,l+1))!=="\0";)r+=Ct(n.subarray(l,l+1)),l+=1;r+=Ct(n.subarray(l,l+1)),l+=1,i=Ce(n,12),s=Ce(n,16),o=Ce(n,20),u=Ce(n,24),l=28}else if(e===1){l+=4,i=Ce(n,l),l+=4;const d=Ce(n,l);l+=4;const f=Ce(n,l);for(l+=4,a=2**32*d+f,ZA(a)||(a=Number.MAX_SAFE_INTEGER,et.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Ce(n,l),l+=4,u=Ce(n,l),l+=4;Ct(n.subarray(l,l+1))!=="\0";)t+=Ct(n.subarray(l,l+1)),l+=1;for(t+=Ct(n.subarray(l,l+1)),l+=1;Ct(n.subarray(l,l+1))!=="\0";)r+=Ct(n.subarray(l,l+1)),l+=1;r+=Ct(n.subarray(l,l+1)),l+=1}const c=n.subarray(l,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:u,payload:c}}function xI(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function _I(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),xI([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,a,t)}function AI(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=II(i);e.push(s),r+=s.size}}return e}function II(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=n.buffer,o=Kt(new Uint8Array(a,t+12,16));let u=null,l=null,c=0;if(s===0)c=28;else{const f=n.getUint32(28);if(!f||r<32+f*16)return{offset:t,size:e};u=[];for(let h=0;h<f;h++)u.push(new Uint8Array(a,t+32+h*16,16));c=32+f*16}if(!c)return{offset:t,size:e};const d=n.getUint32(c);return e-32<d?{offset:t,size:e}:(l=new Uint8Array(a,t+c+4,d),{version:s,systemId:o,kids:u,data:l,offset:t,size:e})}const Jv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ia={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Xh(n,e){const t=ia[e];return!!t&&!!t[n.slice(0,4)]}function mo(n,e,t=!0){return!n.split(",").some(r=>!Zh(r,e,t))}function Zh(n,e,t=!0){var r;const i=ki(t);return(r=i==null?void 0:i.isTypeSupported(yo(n,e)))!=null?r:!1}function yo(n,e){return`${e}/mp4;codecs=${n}`}function nm(n){if(n){const e=n.substring(0,4);return ia.video[e]}return 2}function bu(n){const e=Jv();return n.split(",").reduce((t,r)=>{const s=e&&cc(r)?9:ia.video[r];return s?(s*2+t)/(t?3:2):(ia.audio[r]+t)/(t?2:1)},0)}const id={};function LI(n,e=!0){if(id[n])return id[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var r;if(Zh(t[i],"audio",e))return id[n]=t[i],t[i];if(t[i]==="mp3"&&(r=ki(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const RI=/flac|opus|mp4a\.40\.34/i;function ku(n,e=!0){return n.replace(RI,t=>LI(t.toLowerCase(),e))}function wI(n,e){const t=[];if(n){const r=n.split(",");for(let i=0;i<r.length;i++)Xh(r[i],"video")||t.push(r[i])}return e&&t.push(e),t.join(",")}function Zl(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(rm(n,"audio")||rm(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function rm(n,e){return Xh(n,e)&&Zh(n,e)}function bI(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function kI(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function im(n){const e=ki(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Lf(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const DI={supported:!0,powerEfficient:!0,smooth:!0},PI={supported:!1,smooth:!1,powerEfficient:!1},eE={supported:!0,configurations:[],decodingInfoResults:[DI]};function tE(n,e){return{supported:!1,configurations:e,decodingInfoResults:[PI],error:n}}function CI(n,e,t,r,i,s){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,u=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,c=l?parseInt(l):u?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((f,h)=>{if(h){const p=e.groups[h];if(!p)throw new Error(`Audio track group ${h} not found`);Object.keys(p.channels).forEach(g=>{f[g]=(f[g]||0)+p.channels[g]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>cc(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!d&&ue(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function nE(n,e,t,r={}){const i=n.videoCodec;if(!i&&!n.audioCodec||!t)return Promise.resolve(eE);const s=[],a=NI(n),o=a.length,u=OI(n,e,o>0),l=u.length;for(let c=o||1*l||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),l){d.audio=u[c%l];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}s.push(d)}if(i){const c=navigator.userAgent;if(i.split(",").some(d=>cc(d))&&Jv())return Promise.resolve(tE(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),s))}return Promise.all(s.map(c=>{const d=FI(c);return r[d]||(r[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:s,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:s,decodingInfoResults:[],error:c}))}function NI(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=rE(n),i=n.width||640,s=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(u=>{const l={contentType:yo(kI(u),"video"),width:i,height:s,bitrate:r,framerate:a};return o!=="sdr"&&(l.transferFunction=o),l}):[]}function OI(n,e,t){var r;const i=(r=n.audioCodec)==null?void 0:r.split(","),s=rE(n);return i&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var u;const l=o?(u=e.groups[o])==null?void 0:u.tracks:null;return l?l.reduce((c,d)=>{if(d.groupId===o){const f=parseFloat(d.channels||"");i.forEach(h=>{const p={contentType:yo(h,"audio"),bitrate:t?MI(h,s):s};f&&(p.channels=""+f),c.push(p)})}return c},a):a},[]):[]}function MI(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function rE(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function FI(n){let e="";const{audio:t,video:r}=n;if(r){const i=Lf(r.contentType);e+=`${i}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const i=Lf(t.contentType);e+=`${r?"_":""}${i}_c${t.channels}`}return e}const Rf=["NONE","TYPE-0","TYPE-1",null];function UI(n){return Rf.indexOf(n)>-1}const Du=["SDR","PQ","HLG"];function BI(n){return!!n&&Du.indexOf(n)>-1}var Ql={No:"",Yes:"YES",v2:"v2"};function sm(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?Ql.v2:Ql.Yes:Ql.No}class am{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class vo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return om(this._audioGroups,e)}hasSubtitleGroup(e){return om(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function om(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function $I(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function GI(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||Du.slice(0);const i=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&$I(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const VI=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},it=(n,e)=>JSON.stringify(n,VI(e));function jI(n,e,t,r,i){const s=Object.keys(n),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,u=i==null?void 0:i.videoCodec,l=a&&parseInt(a)===2;let c=!1,d=!1,f=1/0,h=1/0,p=1/0,g=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:E}=GI(e,i);for(let w=s.length;w--;){const D=n[s[w]];c||(c=D.channels[2]>0),f=Math.min(f,D.minHeight),h=Math.min(h,D.minFramerate),p=Math.min(p,D.minBitrate),E.filter(N=>D.videoRanges[N]>0).length>0&&(d=!0)}f=ue(f)?f:0,h=ue(h)?h:0;const _=Math.max(1080,f),I=Math.max(30,h);p=ue(p)?p:t,t=Math.max(p,t),d||(e=void 0);const b=s.length>1;return{codecSet:s.reduce((w,D)=>{const R=n[D];if(D===w)return w;if(v=d?E.filter(N=>R.videoRanges[N]>0):[],b){if(R.minBitrate>t)return pr(D,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),w;if(!R.hasDefaultAudio)return pr(D,"no renditions with default or auto-select sound found"),w;if(o&&D.indexOf(o.substring(0,4))%5!==0)return pr(D,`audio codec preference "${o}" not found`),w;if(a&&!l){if(!R.channels[a])return pr(D,`no renditions with ${a} channel sound found (channels options: ${Object.keys(R.channels)})`),w}else if((!o||l)&&c&&R.channels[2]===0)return pr(D,"no renditions with stereo sound found"),w;if(R.minHeight>_)return pr(D,`min resolution of ${R.minHeight} > maximum of ${_}`),w;if(R.minFramerate>I)return pr(D,`min framerate of ${R.minFramerate} > maximum of ${I}`),w;if(!v.some(N=>R.videoRanges[N]>0))return pr(D,`no variants with VIDEO-RANGE of ${it(v)} found`),w;if(u&&D.indexOf(u.substring(0,4))%5!==0)return pr(D,`video codec preference "${u}" not found`),w;if(R.maxScore<m)return pr(D,`max score of ${R.maxScore} < selected max of ${m}`),w}return w&&(bu(D)>=bu(w)||R.fragmentError>n[w].fragmentError)?w:(g=R.minIndex,m=R.maxScore,D)},void 0),videoRanges:v,preferHDR:y,minFramerate:h,minBitrate:p,minIndex:g}}function pr(n,e){et.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function iE(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function HI(n,e,t,r){return n.slice(t,r+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let u=i[s.codecSet];u||(i[s.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return u.minHeight=Math.min(u.minHeight,l),u.minFramerate=Math.min(u.minFramerate,s.frameRate),u.minIndex=Math.min(u.minIndex,a),u.maxScore=Math.max(u.maxScore,s.score),u.fragmentError+=s.fragmentError,u.videoRanges[s.videoRange]=(u.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{u.channels[f]=(u.channels[f]||0)+d.channels[f]}))}),i},{})}function lm(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}}function Sr(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(ns(n,i,t))return r}return-1}function ns(n,e,t){const{groupId:r,name:i,lang:s,assocLang:a,default:o}=n,u=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||KI(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(u===void 0||e.forced===u)&&(!("characteristics"in n)||zI(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function KI(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function zI(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function qi(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function WI(n,e,t,r,i){const s=e[r],o=e.reduce((f,h,p)=>{const g=h.uri;return(f[g]||(f[g]=[])).push(p),f},{})[s.uri];o.length>1&&(r=Math.max.apply(Math,o));const u=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),d=um(e,r,f=>{if(f.videoRange!==u||f.frameRate!==l||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,p=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return Sr(n,p,i)>-1});return d>-1?d:um(e,r,f=>{const h=f.audioGroups,p=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return Sr(n,p,i)>-1})}function um(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function Pu(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class YI extends Qn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:u}=a;if(!i||!u)return;const l=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,f=l-c.loading.start,h=a.minAutoLevel,p=i.level,g=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||p<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const m=g>-1&&g!==p,v=!!t||m;if(!v&&(u.paused||!u.playbackRate||!u.readyState))return;const y=a.mainForwardBufferInfo;if(!v&&y===null)return;const E=this.bwEstimator.getEstimateTTFB(),_=Math.abs(u.playbackRate);if(f<=Math.max(E,1e3*(d/(_*2))))return;const I=y?y.len/_:0,b=c.loading.first?c.loading.first-c.loading.start:-1,L=c.loaded&&b>-1,w=this.getBwEstimate(),D=a.levels,R=D[p],N=Math.max(c.loaded,Math.round(d*(i.bitrate||R.averageBitrate)/8));let G=L?f-b:f;G<1&&L&&(G=Math.min(f,c.loaded*8/w));const ee=L?c.loaded*1e3/G:0,oe=E/1e3,re=ee?(N-c.loaded)/ee:N*8/w+oe;if(re<=I)return;const J=ee?ee*8:w,le=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,V=this.hls.config.abrBandWidthUpFactor;let W=Number.POSITIVE_INFINITY,Z;for(Z=p-1;Z>h;Z--){const ke=D[Z].maxBitrate,Te=!D[Z].details||le;if(W=this.getTimeToLoadFrag(oe,J,d*ke,Te),W<Math.min(I,d+oe))break}if(W>=re||W>d*10)return;L?this.bwEstimator.sample(f-Math.min(E,b),c.loaded):this.bwEstimator.sampleTTFB(f);const q=D[Z].maxBitrate;this.getBwEstimate()*V>q&&this.resetEstimator(q);const X=this.findBestLevel(q,h,Z,0,I,1,1);X>-1&&(Z=X),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${I.toFixed(3)} s
      Estimated load time for current fragment: ${re.toFixed(3)} s
      Estimated load time for down switch fragment: ${W.toFixed(3)} s
      TTFB estimate: ${b|0} ms
      Current BW estimate: ${ue(w)?w|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Z} @ ${q|0} bps`),a.nextLoadLevel=a.nextAutoLevel=Z,this.clearTimer();const ye=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===Z&&Z>0){const ke=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Z>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${ke.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,Z>h){let Te=this.findBestLevel(this.hls.levels[h].bitrate,h,Z,0,ke,1,1);Te===-1&&(Te=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Te,this.resetEstimator(this.hls.levels[Te].bitrate)}}};m||re>W*2?ye():this.timer=self.setInterval(ye,W*1e3),a.trigger(T.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new JA(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(T.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case B.BUFFER_ADD_CODEC_ERROR:case B.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case B.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const a=performance.now(),o=s?s.stats:r.stats,u=a-o.loading.start,l=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&l>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(d,l),o.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;ue(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===pe.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,u=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:u},a.realBitrate=Math.round(8*o/u)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(T.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==pe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),l=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(l){const m=this.findBestLevel(u,a,i,l,0,c,d);if(m>=0)return this.rebufferNotice=-1,m}let f=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const m=this.bitrateTestDelay;m&&(f=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(u,a,i,l,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const p=r.levels[a],g=r.loadLevelObj;return g&&(p==null?void 0:p.bitrate)<g.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,a,o){var u;const l=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:v}=this.hls;if(p.length===1)return 0;const y=p[d],E=!!((u=this.hls.latestLevelDetails)!=null&&u.live),_=m===-1||c===-1;let I,b="SDR",L=(y==null?void 0:y.frameRate)||0;const{audioPreference:w,videoPreference:D}=v,R=this.audioTracksByGroup||(this.audioTracksByGroup=iE(g));let N=-1;if(_){if(this.firstSelection!==-1)return this.firstSelection;const J=this.codecTiers||(this.codecTiers=HI(p,R,t,r)),le=jI(J,b,e,w,D),{codecSet:V,videoRanges:W,minFramerate:Z,minBitrate:q,minIndex:X,preferHDR:ye}=le;N=X,I=V,b=ye?W[W.length-1]:W[0],L=Z,e=Math.max(e,q),this.log(`picked start tier ${it(le)}`)}else I=y==null?void 0:y.codecSet,b=y==null?void 0:y.videoRange;const G=h?h.duration:f?f.duration:0,ee=this.bwEstimator.getEstimateTTFB()/1e3,oe=[];for(let J=r;J>=t;J--){var re;const le=p[J],V=J>d;if(!le)continue;if(v.useMediaCapabilities&&!le.supportedResult&&!le.supportedPromise){const Te=navigator.mediaCapabilities;typeof(Te==null?void 0:Te.decodingInfo)=="function"&&CI(le,R,b,L,e,w)?(le.supportedPromise=nE(le,R,Te,this.supportedCache),le.supportedPromise.then(Le=>{if(!this.hls)return;le.supportedResult=Le;const Re=this.hls.levels,at=Re.indexOf(le);Le.error?this.warn(`MediaCapabilities decodingInfo error: "${Le.error}" for level ${at} ${it(Le)}`):Le.supported?Le.decodingInfoResults.some(kt=>kt.smooth===!1||kt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${at} not smooth or powerEfficient: ${it(Le)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${at} ${it(Le)}`),at>-1&&Re.length>1&&(this.log(`Removing unsupported level ${at}`),this.hls.removeLevel(at),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Le=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Le}`)})):le.supportedResult=eE}if((I&&le.codecSet!==I||b&&le.videoRange!==b||V&&L>le.frameRate||!V&&L>0&&L<le.frameRate||(re=le.supportedResult)!=null&&(re=re.decodingInfoResults)!=null&&re.some(Te=>Te.smooth===!1))&&(!_||J!==N)){oe.push(J);continue}const W=le.details,Z=(h?W==null?void 0:W.partTarget:W==null?void 0:W.averagetargetduration)||G;let q;V?q=o*e:q=a*e;const X=G&&i>=G*2&&s===0?le.averageBitrate:le.maxBitrate,ye=this.getTimeToLoadFrag(ee,q,X*Z,W===void 0);if(q>=X&&(J===c||le.loadError===0&&le.fragmentError===0)&&(ye<=ee||!ue(ye)||E&&!this.bitrateTestDelay||ye<l)){const Te=this.forcedAutoLevel;return J!==m&&(Te===-1||Te!==m)&&(oe.length&&this.trace(`Skipped level(s) ${oe.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${p[oe[0]].codecs}" ${p[oe[0]].videoRange}; not compatible with "${I}" ${b}`),this.info(`switch candidate:${d}->${J} adjustedbw(${Math.round(q)})-bitrate=${Math.round(q-X)} ttfb:${ee.toFixed(1)} avgDuration:${Z.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${ye.toFixed(1)} firstSelection:${_} codecSet:${le.codecSet} videoRange:${le.videoRange} hls.loadLevel:${m}`)),_&&(this.firstSelection=J),J}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const sE={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const a=e(s);if(a>0)t=i+1;else if(a<0)r=i-1;else return s}return null}};function qI(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!ue(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<n.length;++s){const a=n[s];if(ZI(e,t,a))return a}return null}function cs(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&cm(t,r,s)===0||XI(s,n,Math.min(i,r))))return s;const a=sE.search(e,cm.bind(null,t,r));return a&&(a!==n||!s)?a:s}function XI(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function cm(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function ZI(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function aE(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:i}=n;i&&(r=r.concat(i));let s;return sE.search(r,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function Cu(n){switch(n.details){case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_TIMEOUT:case B.LEVEL_LOAD_TIMEOUT:case B.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function oE(n){return n.details.startsWith("key")}function lE(n){return oE(n)&&!!n.frag&&!n.frag.decryptdata}function dm(n,e){const t=Cu(e);return n.default[`${t?"timeout":"error"}Retry`]}function Qh(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function fm(n){return Je(Je({},n),{errorRetry:null,timeoutRetry:null})}function Nu(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(QI(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function QI(n){return wf(n)||!!n&&(n<400||n>499)}function wf(n){return n===0&&navigator.onLine===!1}var Ht={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ln={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class JI extends Qn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.ERROR,this.onError,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.ERROR,this.onError,this),e.off(T.ERROR,this.onErrorOut,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===pe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case B.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=zs();return}case B.FRAG_GAP:case B.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ht.SendAlternateToPenaltyBox;return}case B.LEVEL_EMPTY_ERROR:case B.LEVEL_PARSING_ERROR:{var a;const u=t.parent===pe.MAIN?t.level:i.loadLevel;t.details===B.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case B.LEVEL_LOAD_ERROR:case B.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case B.AUDIO_TRACK_LOAD_ERROR:case B.AUDIO_TRACK_LOAD_TIMEOUT:case B.SUBTITLE_LOAD_ERROR:case B.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=i.loadLevelObj;if(u&&(s.type===He.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===He.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Ht.SendAlternateToPenaltyBox,t.errorAction.flags=Ln.MoveAllAlternatesMatchingHost;return}}return;case B.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ht.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingHDCP};return;case B.KEY_SYSTEM_SESSION_UPDATE_FAILED:case B.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case B.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ht.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingKey};return;case B.BUFFER_ADD_CODEC_ERROR:case B.REMUX_ALLOC_ERROR:case B.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case B.INTERNAL_EXCEPTION:case B.BUFFER_APPENDING_ERROR:case B.BUFFER_FULL_ERROR:case B.LEVEL_SWITCH_ERROR:case B.BUFFER_STALLED_ERROR:case B.BUFFER_SEEK_OVER_HOLE:case B.BUFFER_NUDGE_ON_STALL:t.errorAction=zs();return}t.type===ve.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=zs())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=dm(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(Nu(i,s,Cu(e),e.response))return{action:Ht.RetryRequest,flags:Ln.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=dm(oE(e)?a:s,e),u=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==B.FRAG_GAP&&i.fragmentError++,!lE(e)&&Nu(o,u,Cu(e),e.response)))return{action:Ht.RetryRequest,flags:Ln.None,retryConfig:o,retryCount:u};const l=this.getLevelSwitchAction(e,r);return o&&(l.retryConfig=o,l.retryCount=u),l}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const l=e.details;i.loadError++,l===B.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:p}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const g=(s=e.frag)==null?void 0:s.type,v=(g===pe.AUDIO&&l===B.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(l===B.BUFFER_ADD_CODEC_ERROR||l===B.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:b})=>i.audioCodec!==b),E=e.sourceBufferName==="video"&&(l===B.BUFFER_ADD_CODEC_ERROR||l===B.BUFFER_APPEND_ERROR)&&d.some(({codecSet:b,audioCodec:L})=>i.codecSet!==b&&i.audioCodec===L),{type:_,groupId:I}=(a=e.context)!=null?a:{};for(let b=d.length;b--;){const L=(b+f)%d.length;if(L!==f&&L>=h&&L<=p&&d[L].loadError===0){var o,u;const w=d[L];if(l===B.FRAG_GAP&&g===pe.MAIN&&e.frag){const D=d[L].details;if(D){const R=cs(e.frag,D.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(_===He.AUDIO_TRACK&&w.hasAudioGroup(I)||_===He.SUBTITLE_TRACK&&w.hasSubtitleGroup(I))continue;if(g===pe.AUDIO&&(o=i.audioGroups)!=null&&o.some(D=>w.hasAudioGroup(D))||g===pe.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(D=>w.hasSubtitleGroup(D))||v&&i.audioCodec===w.audioCodec||E&&i.codecSet===w.codecSet||!v&&i.codecSet!==w.codecSet)continue}c=L;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Ht.SendAlternateToPenaltyBox,flags:Ln.None,nextAutoLevel:c}}return{action:Ht.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Ht.DoNothing:break;case Ht.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==B.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i}=r,s=r.nextAutoLevel;switch(i){case Ln.None:this.switchLevel(e,s);break;case Ln.MoveAllAlternatesMatchingHDCP:{const u=this.getVariantLevelIndex(e.frag),l=t.levels[u],c=l==null?void 0:l.attrs["HDCP-LEVEL"];if(r.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=Rf[Rf.indexOf(c)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ln.MoveAllAlternatesMatchingKey:{const u=e.decryptdata;if(u){const l=this.hls.levels,c=l.length;for(let f=c;f--;)if(this.variantHasKey(l[f],u)){var a,o;this.log(`Banned key found in level ${f} (${l[f].bitrate}bps) or audio group "${(a=l[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Kt(u.keyId||[])}`),l[f].fragmentError++,l[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)r.resolved=!0;else if(d&&d.type!==pe.MAIN){const f=d.decryptdata;f&&!u.matches(f)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===B.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=Lf(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${s} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(s))}}}function zs(n){const e={action:Ht.DoNothing,flags:Ln.None};return n&&(e.resolved=!0),e}var Mt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class eL{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const u=o.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,r,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u||a>=u.body.sn)return;if(!u.buffered&&(!u.loaded||s)){u.body.type===r&&this.removeFragment(u.body);return}const l=u.range[e];if(l){if(l.time.length===0){this.removeFragment(u.body);return}l.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(u.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,i=Ts(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const u=r.elementaryStreams[o];if(!u)return;const l=t[o],c=a||u.partial===!0;s.range[o]=this.getBufferedTimes(r,e.part,c,l)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,r),Sl(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=hm(r,i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=Ts(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},a=e.start,o=e.end,u=e.minEndPTS||o,l=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(l>=d&&u<=f){s.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(o,i.end(c))});break}else if(a<f&&o>d){const h=Math.max(a,i.start(c)),p=Math.min(o,i.end(c));p>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:p}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,a=0;const{bufferPadding:o,fragments:u}=this;return Object.keys(u).forEach(l=>{const c=u[l];c&&Sl(c)&&(i=c.body.start-o,s=c.body.end+o,e>=i&&e<=s&&(r=Math.min(e-i,s-e),a<=r&&(t=c.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Sl(t))}getState(e){const t=Ts(e),r=this.fragments[t];return r?r.buffered?Sl(r)?Mt.PARTIAL:Mt.OK:Mt.APPENDING:Mt.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,s=r.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,i=t.part?null:t,s=Ts(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(i){let l=this.activePartLists[o];l||(this.activePartLists[o]=l=[]),l.push(i)}this.timeRanges=s;const u=s[a];this.detectEvictedFragments(a,u,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ts(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){const s=t[r[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const u=o.body;u.type!==r||i&&!u.gap||u.start<t&&u.end>e&&(o.buffered||s)&&this.removeFragment(u)})}removeFragment(e){const t=Ts(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=hm(r,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function Sl(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Ts(n){return`${n.type}_${n.level}_${n.sn}`}function hm(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Di={cbc:0,ctr:1};class tL{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Di.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Di.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function nL(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class rL{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],a=r[2],o=r[3],u=this.invSubMix,l=u[0],c=u[1],d=u[2],f=u[3],h=new Uint32Array(256);let p=0,g=0,m=0;for(m=0;m<256;m++)m<128?h[m]=m<<1:h[m]=m<<1^283;for(m=0;m<256;m++){let v=g^g<<1^g<<2^g<<3^g<<4;v=v>>>8^v&255^99,e[p]=v,t[v]=p;const y=h[p],E=h[y],_=h[E];let I=h[v]*257^v*16843008;i[p]=I<<24|I>>>8,s[p]=I<<16|I>>>16,a[p]=I<<8|I>>>24,o[p]=I,I=_*16843009^E*65537^y*257^p*16843008,l[v]=I<<24|I>>>8,c[v]=I<<16|I>>>16,d[v]=I<<8|I>>>24,f[v]=I,p?(p=y^h[h[h[_^y]]],g^=h[h[g]]):p=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,u;const l=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],g=h[1],m=h[2],v=h[3];let y,E;for(o=0;o<a;o++){if(o<s){y=l[o]=t[o];continue}E=y,o%s===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[o/s|0]<<24):s>6&&o%s===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),l[o]=y=(l[o-s]^E)>>>0}for(u=0;u<a;u++)o=a-u,u&3?E=l[o]:E=l[o-4],u<4||o<=4?c[u]=E:c[u]=p[d[E>>>24]]^g[d[E>>>16&255]]^m[d[E>>>8&255]]^v[d[E&255]],c[u]=c[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,u=o[0],l=o[1],c=o[2],d=o[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],p=f[1],g=f[2],m=f[3];const v=new Int32Array(e),y=new Int32Array(v.length);let E,_,I,b,L,w,D,R,N,G,ee,oe,re,J;const le=this.networkToHostOrderSwap;for(;t<v.length;){for(N=le(v[t]),G=le(v[t+1]),ee=le(v[t+2]),oe=le(v[t+3]),L=N^s[0],w=oe^s[1],D=ee^s[2],R=G^s[3],re=4,J=1;J<i;J++)E=u[L>>>24]^l[w>>16&255]^c[D>>8&255]^d[R&255]^s[re],_=u[w>>>24]^l[D>>16&255]^c[R>>8&255]^d[L&255]^s[re+1],I=u[D>>>24]^l[R>>16&255]^c[L>>8&255]^d[w&255]^s[re+2],b=u[R>>>24]^l[L>>16&255]^c[w>>8&255]^d[D&255]^s[re+3],L=E,w=_,D=I,R=b,re=re+4;E=a[L>>>24]<<24^a[w>>16&255]<<16^a[D>>8&255]<<8^a[R&255]^s[re],_=a[w>>>24]<<24^a[D>>16&255]<<16^a[R>>8&255]<<8^a[L&255]^s[re+1],I=a[D>>>24]<<24^a[R>>16&255]<<16^a[L>>8&255]<<8^a[w&255]^s[re+2],b=a[R>>>24]<<24^a[L>>16&255]<<16^a[w>>8&255]<<8^a[D&255]^s[re+3],y[t]=le(E^h),y[t+1]=le(b^p),y[t+2]=le(I^g),y[t+3]=le(_^m),h=N,p=G,g=ee,m=oe,t=t+4}return y.buffer}}class iL{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=sL(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function sL(n){switch(n){case Di.cbc:return"AES-CBC";case Di.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const aL=16;class Jh{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?nL(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,i);const u=this.flush();u?s(u.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Di.cbc||t.byteLength!==16)return et.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Xn(o,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;s&&(r=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new rL),l.expandKey(t);const c=a;return this.currentResult=l.decrypt(u.buffer,0,r),this.currentIV=u.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new iL(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new tL(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(et.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%aL;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(et.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const pm=Math.pow(2,17);class oL{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Vr({type:ve.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){u(mm(e));return}else e.gap=!1;const l=this.loader=s?new s(i):new a(i),c=gm(e);e.loader=l;const d=fm(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:pm};e.stats=l.stats;const h={onSuccess:(p,g,m,v)=>{this.resetLoader(e,l);let y=p.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:e,part:null,payload:y,networkDetails:v})},onError:(p,g,m,v)=>{this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Je({url:r,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:m,stats:v}))},onAbort:(p,g,m)=>{this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:p}))},onTimeout:(p,g,m)=>{this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:p}))}};t&&(h.onProgress=(p,g,m,v)=>t({frag:e,part:null,payload:m,networkDetails:v})),l.load(c,f,h)})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(mm(e,t));return}const l=this.loader=s?new s(i):new a(i),c=gm(e,t);e.loader=l;const d=fm(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:pm};t.stats=l.stats,l.load(c,f,{onSuccess:(h,p,g,m)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:h.data,networkDetails:m};r(v),o(v)},onError:(h,p,g,m)=>{this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Je({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:m}))},onAbort:(h,p,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(e,l),u(new Vr({type:ve.NETWORK_ERROR,details:B.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const u=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/s),u),d=(u-l)*Math.round(r.loaded/l);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function gm(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(ue(i)&&ue(s)){var a;let o=i,u=s;if(n.sn==="initSegment"&&lL((a=n.decryptdata)==null?void 0:a.method)){const l=s-i;l%16&&(u=s+(16-l%16)),i!==0&&(r.resetIV=!0,o=i-16)}r.rangeStart=o,r.rangeEnd=u}return r}function mm(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:ve.MEDIA_ERROR,details:B.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Vr(r)}function lL(n){return n==="AES-128"||n==="AES-256"}class Vr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class uE extends Qn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ep{constructor(e,t,r,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=xl(),this.buffering={audio:xl(),video:xl(),audiovideo:xl()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=a}}function xl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const ym={length:0,start:()=>0,end:()=>0};class Me{static isBuffered(e,t){if(e){const r=Me.getBuffered(e);for(let i=r.length;i--;)if(t>=r.start(i)&&t<=r.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=Me.getBuffered(e);return Me.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const i=Me.bufferedRanges(e);if(i.length)return Me.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const f=s[d-1].end;e[c].start-f<r?e[c].end>f&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let a=0,o,u=t,l=t;for(let c=0;c<s.length;c++){const d=s[c].start,f=s[c].end;if(i===-1&&t>=d&&t<=f&&(i=c),t+r>=d&&t<f)u=d,l=f,a=l-t;else if(t+r<d){o=d;break}}return{len:a,start:u||0,end:l||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||ym}catch(t){return et.log("failed to get media.buffered",t),ym}}}const cE=/\{\$([a-zA-Z0-9-_]+)\}/g;function vm(n){return cE.test(n)}function bf(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(cE,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function Em(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function uL(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const cL=/^(\d+)x(\d+)$/,Tm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class pt{constructor(e,t){typeof e=="string"&&(e=pt.parseAttrList(e,t)),nt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=cL.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const i={},s='"';for(Tm.lastIndex=0;(r=Tm.exec(e))!==null;){const a=r[1].trim();let o=r[2];const u=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let l=!1;if(u)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":l=!0}if(t&&(u||l))o=bf(t,o);else if(!l&&!u)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":et.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const dL="com.apple.hls.interstitial";function fL(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function hL(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class dE{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:r,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){et.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=nt(new pt({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ue(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(et.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ue(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===dL}get isValid(){return!!this.id&&!this._badValueForSameId&&ue(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const pL=10;class gL{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?ue(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||pL}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ou(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function Sm(n,e){return!n&&!e?!0:!n||!e?!1:Ou(n,e)}function Ws(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function tp(n){switch(n){case"AES-128":case"AES-256":return Di.cbc;case"AES-256-CTR":return Di.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function np(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function kf(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function mL(n){const e=kf(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function fE(n){const e=function(r,i,s){const a=r[i];r[i]=r[s],r[s]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function hE(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(r.splice(-1,1),t=np(a)):t=mL(a)}}return t}const Mu=typeof self<"u"?self:void 0;var yt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},zt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Jl(n){switch(n){case zt.FAIRPLAY:return yt.FAIRPLAY;case zt.PLAYREADY:return yt.PLAYREADY;case zt.WIDEVINE:return yt.WIDEVINE;case zt.CLEARKEY:return yt.CLEARKEY}}function sd(n){switch(n){case yt.FAIRPLAY:return zt.FAIRPLAY;case yt.PLAYREADY:return zt.PLAYREADY;case yt.WIDEVINE:return zt.WIDEVINE;case yt.CLEARKEY:return zt.CLEARKEY}}function Oa(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[yt.FAIRPLAY,yt.WIDEVINE,yt.PLAYREADY,yt.CLEARKEY].filter(i=>!!e[i]):[];return!r[yt.WIDEVINE]&&t&&r.push(yt.WIDEVINE),r}const pE=function(n){return Mu!=null&&(n=Mu.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function yL(n,e,t,r){let i;switch(n){case yt.FAIRPLAY:i=["cenc","sinf"];break;case yt.WIDEVINE:case yt.PLAYREADY:i=["cenc"];break;case yt.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return vL(i,e,t,r)}function vL(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function EL(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function gE(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const u=np(o).subarray(0,16);return fE(u),u}}return null}let Ss={};class Ri{static clearKeyUriToKeyIdMap(){Ss={}}static setKeyIdForUri(e,t){Ss[e]=t}static addKeyIdForUri(e){const t=Object.keys(Ss).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),Ss[e]=r,r}constructor(e,t,r,i=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ws(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(jv(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Ou(e.keyFormatVersions,this.keyFormatVersions)&&Sm(e.iv,this.iv)&&Sm(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ws(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case zt.FAIRPLAY:case zt.WIDEVINE:case zt.PLAYREADY:case zt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ws(this.method)){let s=this.iv;return s||(typeof e!="number"&&(et.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=SL(e)),new Ri(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Ss[this.uri];if(s&&!Ou(this.keyId,s)&&Ri.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=hE(this.uri);if(r)switch(this.keyFormat){case zt.WIDEVINE:if(this.pssh=r,!this.keyId){const s=AI(r.buffer);if(s.length){var i;const a=s[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=xm(t));break;case zt.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=_I(s,null,r),this.keyId=gE(r);break}default:{let s=r.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=TL(t),s||(s=xm(t),s||(s=Ss[this.uri])),s&&(this.keyId=s,Ri.setKeyIdForUri(this.uri,s))}return this}}function TL(n){const e=n==null?void 0:n[zt.WIDEVINE];return e?e.keyId:null}function xm(n){const e=n==null?void 0:n[zt.PLAYREADY];if(e){const t=hE(e.uri);if(t)return gE(t)}return null}function SL(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const _m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Am=/#EXT-X-MEDIA:(.*)/g,xL=/^#EXT(?:INF|-X-TARGETDURATION):/m,ad=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),_L=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class xr{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return Wh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xL.test(e)}static parseMasterPlaylist(e,t){const r=vm(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];if(_m.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=_m.exec(e))!=null;)if(a[1]){var o;const l=new pt(a[1],i),c=bf(i,a[2]),d={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:xr.resolve(c,t)},f=l.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),Rm(l.CODECS,d);const h=l["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},Rm(h,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),i.levels.push(d)}else if(a[3]){const l=a[3],c=a[4];switch(l){case"SESSION-DATA":{const d=new pt(c,i),f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=Im(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):et.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new pt(c,i);Em(i,d,t)}break}case"CONTENT-STEERING":{const d=new pt(c,i);i.contentSteering={uri:xr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Lm(c);break}}}const u=s.length>0&&s.length<i.levels.length;return i.levels=u?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},a=r.levels,o={AUDIO:a.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:a.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(Am.lastIndex=0;(i=Am.exec(e))!==null;){const l=new pt(i[1],r),c=l.TYPE;if(c){const d=o[c],f=s[c]||[];s[c]=f;const h=l.LANGUAGE,p=l["ASSOC-LANGUAGE"],g=l.CHANNELS,m=l.CHARACTERISTICS,v=l["INSTREAM-ID"],y={attrs:l,bitrate:0,id:u++,groupId:l["GROUP-ID"]||"",name:l.NAME||h||"",type:c,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:h,url:l.URI?xr.resolve(l.URI,t):""};if(p&&(y.assocLang=p),g&&(y.channels=g),m&&(y.characteristics=m),v&&(y.instreamId=v),d!=null&&d.length){const E=xr.findGroup(d,y.groupId)||d[0];wm(y,E,"audioCodec"),wm(y,E,"textCodec")}f.push(y)}}return s}static parseLevelPlaylist(e,t,r,i,s,a){var o;const u={url:t},l=new gL(t),c=l.fragments,d=[];let f=null,h=0,p=0,g=0,m=0,v=0,y=null,E=new nd(i,u),_,I,b,L=-1,w=!1,D=null,R;if(ad.lastIndex=0,l.m3u8=e,l.hasVariableRefs=vm(e),((o=ad.exec(e))==null?void 0:o[0])!=="#EXTM3U")return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;(_=ad.exec(e))!==null;){w&&(w=!1,E=new nd(i,u),E.playlistOffset=g,E.setStart(g),E.sn=h,E.cc=m,v&&(E.bitrate=v),E.level=r,f&&(E.initSegment=f,f.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),D&&(E.setByteRange(D),D=null)));const oe=_[1];if(oe){E.duration=parseFloat(oe);const re=(" "+_[2]).slice(1);E.title=re||null,E.tagList.push(re?["INF",oe,re]:["INF",oe])}else if(_[3]){if(ue(E.duration)){E.playlistOffset=g,E.setStart(g),b&&km(E,b,l),E.sn=h,E.level=r,E.cc=m,c.push(E);const re=(" "+_[3]).slice(1);E.relurl=bf(l,re),Df(E,y,d),y=E,g+=E.duration,h++,p=0,w=!0}}else{if(_=_[0].match(_L),!_){et.warn("No matches on slow regex match for level playlist!");continue}for(I=1;I<_.length&&_[I]===void 0;I++);const re=(" "+_[I]).slice(1),J=(" "+_[I+1]).slice(1),le=_[I+2]?(" "+_[I+2]).slice(1):null;switch(re){case"BYTERANGE":y?E.setByteRange(J,y):E.setByteRange(J);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=J,E.tagList.push(["PROGRAM-DATE-TIME",J]),L===-1&&(L=c.length);break;case"PLAYLIST-TYPE":l.type&&Ur(l,re,_),l.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":l.startSN!==0?Ur(l,re,_):c.length>0&&Dm(l,re,_),h=l.startSN=parseInt(J);break;case"SKIP":{l.skippedSegments&&Ur(l,re,_);const V=new pt(J,l),W=V.decimalInteger("SKIPPED-SEGMENTS");if(ue(W)){l.skippedSegments+=W;for(let q=W;q--;)c.push(null);h+=W}const Z=V.enumeratedString("RECENTLY-REMOVED-DATERANGES");Z&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(Z.split("	")));break}case"TARGETDURATION":l.targetduration!==0&&Ur(l,re,_),l.targetduration=Math.max(parseInt(J),1);break;case"VERSION":l.version!==null&&Ur(l,re,_),l.version=parseInt(J);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Ur(l,re,_),l.live=!1;break;case"#":(J||le)&&E.tagList.push(le?[J,le]:[J]);break;case"DISCONTINUITY":m++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([re]);break;case"BITRATE":E.tagList.push([re,J]),v=parseInt(J)*1e3,ue(v)?E.bitrate=v:v=0;break;case"DATERANGE":{const V=new pt(J,l),W=new dE(V,l.dateRanges[V.ID],l.dateRangeTagCount);l.dateRangeTagCount++,W.isValid||l.skippedSegments?l.dateRanges[W.id]=W:et.warn(`Ignoring invalid DATERANGE tag: "${J}"`),E.tagList.push(["EXT-X-DATERANGE",J]);break}case"DEFINE":{{const V=new pt(J,l);"IMPORT"in V?uL(l,V,a):Em(l,V,t)}break}case"DISCONTINUITY-SEQUENCE":l.startCC!==0?Ur(l,re,_):c.length>0&&Dm(l,re,_),l.startCC=m=parseInt(J);break;case"KEY":{const V=Im(J,t,l);if(V.isSupported()){if(V.method==="NONE"){b=void 0;break}b||(b={});const W=b[V.keyFormat];W!=null&&W.matches(V)||(W&&(b=nt({},b)),b[V.keyFormat]=V)}else et.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${J}"`);break}case"START":l.startTimeOffset=Lm(J);break;case"MAP":{const V=new pt(J,l);if(E.duration){const W=new nd(i,u);bm(W,V,r,b),f=W,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{const W=E.byteRangeEndOffset;if(W){const Z=E.byteRangeStartOffset;D=`${W-Z}@${Z}`}else D=null;bm(E,V,r,b),f=E,w=!0}f.cc=m;break}case"SERVER-CONTROL":{R&&Ur(l,re,_),R=new pt(J),l.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),l.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{l.partTarget&&Ur(l,re,_);const V=new pt(J);l.partTarget=V.decimalFloatingPoint("PART-TARGET");break}case"PART":{let V=l.partList;V||(V=l.partList=[]);const W=p>0?V[V.length-1]:void 0,Z=p++,q=new pt(J,l),X=new uI(q,E,u,Z,W);V.push(X),E.duration+=X.duration;break}case"PRELOAD-HINT":{const V=new pt(J,l);l.preloadHint=V;break}case"RENDITION-REPORT":{const V=new pt(J,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(V);break}default:et.warn(`line parsed but not handled: ${_}`);break}}}y&&!y.relurl?(c.pop(),g-=y.duration,l.partList&&(l.fragmentHint=y)):l.partList&&(Df(E,y,d),E.cc=m,l.fragmentHint=E,b&&km(E,b,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const N=c.length,G=c[0],ee=c[N-1];if(g+=l.skippedSegments*l.targetduration,g>0&&N&&ee){l.averagetargetduration=g/N;const oe=ee.sn;l.endSN=oe!=="initSegment"?oe:0,l.live||(ee.endList=!0),L>0&&(IL(c,L),G&&d.unshift(G))}return l.fragmentHint&&(g+=l.fragmentHint.duration),l.totalduration=g,d.length&&l.dateRangeTagCount&&G&&mE(d,l),l.endCC=m,l}}function mE(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];n.push(o),t++}else return;const r=n[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const u=e.dateRanges[s[o]],l=u.startDate.getTime();u.tagAnchor=r.ref;for(let c=t;c--;){var a;if(((a=n[c])==null?void 0:a.sn)<e.startSN)break;const d=AL(e,l,n,c,i);if(d!==-1){u.tagAnchor=e.fragments[d].ref;break}}}}function AL(n,e,t,r,i){const s=t[r];if(s){const o=s.programDateTime;if(e>=o||r===0){var a;const u=(((a=t[r+1])==null?void 0:a.start)||i)-s.start;if(e<=o+u*1e3){const l=t[r].sn-n.startSN;if(l<0)return-1;const c=n.fragments;if(c.length>t.length){const f=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let h=f;h>l;h--){const p=c[h].programDateTime;if(e>=p&&e<p+c[h].duration*1e3)return h}}return l}}}return-1}function Im(n,e,t){var r,i;const s=new pt(n,t),a=(r=s.METHOD)!=null?r:"",o=s.URI,u=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!u&&et.error(`Invalid IV: ${s.IV}`);const d=o?xr.resolve(o,e):"",f=(l||"1").split("/").map(Number).filter(Number.isFinite);return new Ri(a,d,c,f,u,s.KEYID)}function Lm(n){const t=new pt(n).decimalFloatingPoint("TIME-OFFSET");return ue(t)?t:null}function Rm(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>Xh(s,r));i.length&&(e[`${r}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function wm(n,e,t){const r=e[t];r&&(n[t]=r)}function IL(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Df(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function bm(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function km(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}function Ur(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Dm(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function od(n,e){const t=e.startPTS;if(ue(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function yE(n,e,t,r,i,s,a){r-t<=0&&(a.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let u=t,l=r;const c=e.startPTS,d=e.endPTS;if(ue(c)){const v=Math.abs(c-t);n&&v>n.totalduration?a.warn(`media timestamps and playlist times differ by ${v}s for level ${e.level} ${n.url}`):ue(e.deltaPTS)?e.deltaPTS=Math.max(v,e.deltaPTS):e.deltaPTS=v,u=Math.max(t,c),t=Math.min(t,c),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,l=Math.min(r,d),r=Math.max(r,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const h=e.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let p;const g=h-n.startSN,m=n.fragments;for(m[g]=e,p=g;p>0;p--)od(m[p],m[p-1]);for(p=g;p<m.length-1;p++)od(m[p],m[p+1]);return n.fragmentHint&&od(m[m.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function LL(n,e,t){if(n===e)return;let r=null;const i=n.fragments;for(let c=i.length-1;c>=0;c--){const d=i[c].initSegment;if(d){r=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;bL(n,e,(c,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const p=c.cc-d.cc;for(let g=f;g<h.length;g++)h[g].cc+=p;e.endCC=h[h.length-1].cc}ue(c.startPTS)&&ue(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,r=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(r&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(c.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=RL(n.dateRanges,e,t));const c=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&Df(o[d],o[d-1],c);mE(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var u;const c=TE(n,e.startSN-1);e.startCC=(u=c==null?void 0:c.cc)!=null?u:a[0].cc}wL(n.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),s?yE(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):vE(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const c=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=c),e.driftEndTime=l,e.driftEnd=c}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function RL(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:i}=e,s=nt({},n);i&&i.forEach(u=>{delete s[u]});const o=Object.keys(s).length;return o?(Object.keys(r).forEach(u=>{const l=s[u],c=new dE(r[u].attr,l);c.isValid?(s[u]=c,l||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${it(r[u].attr)}"`)}),s):r}function wL(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const a=n[i],o=e[i+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function bL(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let l=i;l<=s;l++){const c=u[a+l];let d=o[l];if(r&&!d&&c&&(d=e.fragments[l]=c),c&&d){t(c,d,l,o);const f=c.relurl,h=d.relurl;if(f&&kL(f,h)){e.playlistParsingError=Pm(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Pm(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function Pm(n,e,t,r,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function vE(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,s=r>=0;let a=0;if(s&&r<i.length)a=i[r].start;else if(s&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(s&&t)a=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Pf(e,a)}function Pf(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function EE(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function TE(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function Cm(n,e,t){return n?SE(n.partList,e,t):null}function SE(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function xE(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function kL(n,e){return n!==e&&e?Nm(n)!==Nm(e):!1}function Nm(n){return n.replace(/\?[^?]*$/,"")}function Ya(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function DL(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function Om(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function _E(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)Om(t[r],n);e.fragmentHint&&Om(e.fragmentHint,n),e.alignedSliding=!0}function PL(n,e){n&&(AE(e,n),e.alignedSliding||Fu(e,n),!e.alignedSliding&&!e.skippedSegments&&vE(n,e,!1))}function AE(n,e){if(!DL(e,n))return;const t=Math.min(e.endCC,n.endCC),r=Ya(e.fragments,t),i=Ya(n.fragments,t);if(!r||!i)return;et.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-i.start;_E(s,n)}function Fu(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(i=Ya(r,a),s=Ya(t,a)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=Ya(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,u=s.programDateTime;if(!o||!u)return;const l=(u-o)/1e3-(s.start-i.start);_E(l,n)}function ln(n,e,t){vn(n,e,t),n.addEventListener(e,t)}function vn(n,e,t){n.removeEventListener(e,t)}const CL={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class rp extends uE{constructor(e,t,r,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:u,mediaBuffer:l,state:c}=this,d=u?u.currentTime:0,f=Me.bufferInfo(l||u,d,a.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${ue(d)?d.toFixed(3):d}, state: ${c}, ${h?"out of":"in"} buffer`),this.state===z.ENDED)this.resetLoadingState();else if(o){const p=a.maxFragLookUpTolerance,g=o.start-p,m=o.start+o.duration+p;if(h||m<f.start||g>f.end){const v=d>m;(d<g||v)&&(v&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(d>p&&(this.lastCurrentTime=d),!this.loadingParts){const g=Math.max(f.end,d),m=this.shouldLoadParts(this.getLevelDetails(),g);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=m)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===z.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new oL(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Jh(e.config)}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===z.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=z.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Me.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const c=u[u.length-1];return Me.isBuffered(this.media,c.start+c.duration/2)}const l=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(l)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;ln(r,"seeking",this.onMediaSeeking),ln(r,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===z.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),vn(i,"seeking",this.onMediaSeeking),vn(i,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===z.FRAG_LOADING||!this.fragCurrent&&a===z.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=z.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(T.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Mt.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Mt.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(T.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{frag:s,payload:a}=r,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Ws(o.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,tp(o.method)).catch(l=>{throw i.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:s}),l}).then(l=>{const c=self.performance.now();return i.trigger(T.FRAG_DECRYPTED,{frag:s,payload:l,stats:{tstart:u,tdecrypt:c}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==z.STOPPED&&(this.state=z.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,i;const s=e.tracks;if(s&&!t.encrypted&&((r=s.audio)!=null&&r.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(T.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?CL.toString(Me.getBuffered(r)):"(detached)"})`),Rt(e)){var i;if(e.type!==pe.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=z.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=z.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(u=>!u),o=new ep(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=z.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(T.KEY_LOADED,f),this.state===z.KEY_LOADING&&(this.state=z.IDLE),f}),this.hls.trigger(T.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(Rt(e)&&(!u||e.sn!==u.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${u==null?void 0:u.sn}->${e.sn}`),this.loadingParts=f)}if(r=Math.max(e.start,r||0),this.loadingParts&&Rt(e)){const f=a.partList;if(f&&i){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(f,e,r);if(h>-1){const p=f[h];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=z.FRAG_LOADING;let g;return o?g=o.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,p,t,i)).catch(m=>this.handleFragLoadError(m)):g=this.doFragPartsLoad(e,p,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(T.FRAG_LOADING,{frag:e,part:p,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}if(Rt(e)&&this.loadingParts){var l;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(l=a.partList)==null?void 0:l.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),ue(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=z.FRAG_LOADING;const c=this.config.progressive&&e.type!==pe.SUBTITLE;let d;return c&&o?d=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,i)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?i:void 0),o]).then(([f])=>(!c&&i&&i(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(T.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,i){return new Promise((s,a)=>{var o;const u=[],l=(o=r.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{u[d.index]=f;const h=f.part;this.hls.trigger(T.FRAG_LOADED,f);const p=Cm(r.details,e.sn,d.index+1)||SE(l,e.sn,d.index+1);if(p)c(p);else return s({frag:e,part:h,partsLoaded:u})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===B.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ve.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(T.ERROR,t)}else this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==z.PARSING){!this.fragCurrent&&this.state!==z.STOPPED&&this.state!==z.ERROR&&(this.state=z.IDLE);return}const{frag:r,part:i,level:s}=t,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),l=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);l!==this.loadingParts&&(this.log(`LL-Part loading ${l?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=l),this.updateLevelTiming(r,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const s=e.partList[0];if(s.fragment.type===pe.SUBTITLE)return!1;const a=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],u=o.details,l=a>-1?Cm(u,s,a):null,c=l?l.fragment:TE(u,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,r,i,s){if(this.state!==z.PARSING)return;const{data1:a,data2:o}=e;let u=a;if(o&&(u=Xn(a,o)),!u.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:i,offset:c,parent:t.type,data:u};if(this.hls.trigger(T.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Me.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=Me.bufferInfo(t,r,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const i=this.getLoadPosition();if(!ue(i))return null;const a=this.lastCurrentTime>i||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,r,i){const s=Me.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return Me.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=pe.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,a=r[0].start,o=s.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var l;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,p=u?(f!==-1&&f>=a?f:h)||u.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(l=u)==null?void 0:l.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=a&&(u=r[0]);if(!u){const d=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(u,t);if(!c&&u){const d=u.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Mt.OK||r===Mt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(o!==null&&r.len+o.len>=s){const u=a.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Mm(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Mm(this.config)&&e.type!==pe.SUBTITLE){const r=this.hls.interstitialsManager,i=r==null?void 0:r.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=r==null?void 0:r.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,a=!0;for(let o=0,u=e.length;o<u;o++){const l=e[o];if(a=a&&!l.independent,i>-1&&r<l.start)break;const c=l.loaded;c?i=-1:(s||(l.independent||a)&&l.fragment===t)&&(l.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${l.start}`),i=o),s=c}return i}loadedEndOfParts(e,t){let r;for(let i=e.length;i--;){if(r=e[i],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=qI(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];r.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=aE(e,r.cc,r.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=r;const{fragmentHint:u}=r,{maxFragLookUpTolerance:l}=i,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&u);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===u.sn&&(a=a.concat(u),o=u.sn);let f;if(e<t){var h;const g=e<this.lastCurrentTime||e>t-l||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:l;f=cs(s,a,e,g)}else f=a[a.length-1];if(f){const p=f.sn-r.startSN,g=this.fragmentTracker.getState(f);if((g===Mt.OK||g===Mt.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn||!r.live)&&f.level===s.level){const v=a[p+1];f.sn<o&&this.fragmentTracker.getState(v)!==Mt.OK?f=v:f=null}}return f}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&ue(s);if(a||!o&&!s){PL(r,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const i=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&ue(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Rt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==z.FRAG_LOADING_WAITING_RETRY)&&(this.state=z.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const v=this.getCurrentContext(t.chunkMeta);v&&(t.frag=v.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===B.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=z.ERROR;return}const{action:u,flags:l,retryCount:c=0,retryConfig:d}=o,f=!!d,h=f&&u===Ht.RetryRequest,p=f&&!o.resolved&&l===Ln.MoveAllAlternatesMatchingHost,g=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!h&&p&&Rt(i)&&!i.endList&&g&&!lE(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((h||p)&&c<d.maxNumRetry){var m;const v=wf((m=t.response)==null?void 0:m.code),y=Qh(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+y,this.state=z.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,v){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${y}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&u!==Ht.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else u===Ht.SendAlternateToPenaltyBox?this.state=z.WAITING_LEVEL:this.state=z.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!wf(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=z.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===z.PARSING||this.state===z.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===pe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==z.STOPPED&&(this.state=z.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=Me.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==z.STOPPED&&(this.state=z.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,l)=>{const c=e.elementaryStreams[l];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${l} duration reliably (${d})`),u||!1;const f=i?0:yE(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(T.LEVEL_PTS_UPDATED,{details:s,level:r,drift:f,type:l,frag:e,start:c.startPTS,end:c.endPTS}),!0}return u},!1)){var o;const u=((o=this.transmuxer)==null?void 0:o.error)===null;if((r.fragmentError===0||u&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),u){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=z.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(T.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===pe.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((i=t&&!r?e.startPTS:(r||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Mm(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class IE{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=NL(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function NL(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}var ld={exports:{}},Fm;function OL(){return Fm||(Fm=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||u,f),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],h]:u._events[p].push(h):(u._events[p]=h,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new r:delete u._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,c,d,f,h,p){var g=t?t+l:l;if(!this._events[g])return!1;var m=this._events[g],v=arguments.length,y,E;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,d),!0;case 4:return m.fn.call(m.context,c,d,f),!0;case 5:return m.fn.call(m.context,c,d,f,h),!0;case 6:return m.fn.call(m.context,c,d,f,h,p),!0}for(E=1,y=new Array(v-1);E<v;E++)y[E-1]=arguments[E];m.fn.apply(m.context,y)}else{var _=m.length,I;for(E=0;E<_;E++)switch(m[E].once&&this.removeListener(l,m[E].fn,void 0,!0),v){case 1:m[E].fn.call(m[E].context);break;case 2:m[E].fn.call(m[E].context,c);break;case 3:m[E].fn.call(m[E].context,c,d);break;case 4:m[E].fn.call(m[E].context,c,d,f);break;default:if(!y)for(I=1,y=new Array(v-1);I<v;I++)y[I-1]=arguments[I];m[E].fn.apply(m[E].context,y)}}return!0},o.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},o.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},o.prototype.removeListener=function(l,c,d,f){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return a(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&a(this,h);else{for(var g=0,m=[],v=p.length;g<v;g++)(p[g].fn!==c||f&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[h]=m.length===1?m[0]:m:a(this,h)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(ld)),ld.exports}var ML=OL(),ip=oI(ML);const Eo="1.6.15",sa={};function FL(){return typeof __HLS_WORKER_BUNDLE__=="function"}function UL(){const n=sa[Eo];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return sa[Eo]=i,i}function BL(n){const e=sa[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return sa[n]=i,i}function $L(n){const e=sa[n||Eo];if(e&&e.clientCount--===1){const{worker:r,objectURL:i}=e;delete sa[n||Eo],i&&self.URL.revokeObjectURL(i),r.terminate()}}function LE(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function sp(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function dc(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function To(n,e){const t=e;let r=0;for(;sp(n,e);){r+=10;const i=dc(n,e+6);r+=i,LE(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function GL(n,e,t,r){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const h=new Error(`invalid ADTS sampling index:${a}`);n.emit(T.ERROR,T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const o=(s>>6&3)+1,u=e[t+3]>>6&3|(s&1)<<2,l="mp4a.40."+o,c=i[a];let d=a;(o===5||o===29)&&(d-=3);const f=[o<<3|(d&14)>>1,(d&1)<<7|u<<3];return et.log(`manifest codec:${r}, parsed codec:${l}, channels:${u}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:c,channelCount:u,codec:l,parsedCodec:l,manifestCodec:r}}function RE(n,e){return n[e]===255&&(n[e+1]&246)===240}function wE(n,e){return n[e+1]&1?7:9}function ap(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function VL(n,e){return e+5<n.length}function Uu(n,e){return e+1<n.length&&RE(n,e)}function jL(n,e){return VL(n,e)&&RE(n,e)&&ap(n,e)<=n.length-e}function HL(n,e){if(Uu(n,e)){const t=wE(n,e);if(e+t>=n.length)return!1;const r=ap(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||Uu(n,i)}return!1}function bE(n,e,t,r,i){if(!n.samplerate){const s=GL(e,t,r,i);if(!s)return;nt(n,s)}}function kE(n){return 1024*9e4/n}function KL(n,e){const t=wE(n,e);if(e+t<=n.length){const r=ap(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function DE(n,e,t,r,i){const s=kE(n.samplerate),a=r+i*s,o=KL(e,t);let u;if(o){const{frameLength:d,headerLength:f}=o,h=f+d,p=Math.max(0,t+h-e.length);p?(u=new Uint8Array(h-f),u.set(e.subarray(t+f,e.length),0)):u=e.subarray(t+f,t+h);const g={unit:u,pts:a};return p||n.samples.push(g),{sample:g,length:h,missing:p}}const l=e.length-t;return u=new Uint8Array(l),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:a},length:l,missing:-1}}function zL(n,e){return sp(n,e)&&dc(n,e+6)+10<=n.length-e}function WL(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function ud(n,e=0,t=1/0){return YL(n,e,t,Uint8Array)}function YL(n,e,t,r){const i=qL(n);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=XL(n)?n.byteOffset:0,o=(a+n.byteLength)/s,u=(a+e)/s,l=Math.floor(Math.max(0,Math.min(u,o))),c=Math.floor(Math.min(l+Math.max(t,0),o));return new r(i,l,c-l)}function qL(n){return n instanceof ArrayBuffer?n:n.buffer}function XL(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function ZL(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const i=On(ud(n.data,1,r)),s=n.data[2+r],a=n.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=On(ud(n.data,3+r,a));let u;return i==="-->"?u=On(ud(n.data,4+r+a)):u=WL(n.data.subarray(4+r+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=u,e}function QL(n){if(n.size<2)return;const e=On(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function JL(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=On(n.data.subarray(t),!0);t+=r.length+1;const i=On(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=On(n.data.subarray(1));return{key:n.type,info:"",data:e}}function e1(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=On(n.data.subarray(t),!0);t+=r.length+1;const i=On(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=On(n.data);return{key:n.type,info:"",data:e}}function t1(n){return n.type==="PRIV"?QL(n):n.type[0]==="W"?e1(n):n.type==="APIC"?ZL(n):JL(n)}function n1(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=dc(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const _l=10,r1=10;function PE(n){let e=0;const t=[];for(;sp(n,e);){const r=dc(n,e+6);n[e+5]>>6&1&&(e+=_l),e+=_l;const i=e+r;for(;e+r1<i;){const s=n1(n.subarray(e)),a=t1(s);a&&t.push(a),e+=s.size+_l}LE(n,e)&&(e+=_l)}return t}function CE(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function i1(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function op(n){const e=PE(n);for(let t=0;t<e.length;t++){const r=e[t];if(CE(r))return i1(r)}}let bn=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function vr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class lp{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Xn(this.cachedData,e),this.cachedData=null);let r=To(e,0),i=r?r.length:0,s;const a=this._audioTrack,o=this._id3Track,u=r?op(r):void 0,l=e.length;for((this.basePTS===null||this.frameIndex===0&&ue(u))&&(this.basePTS=s1(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:bn.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=l}else zL(e,i)?(r=To(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:bn.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===l&&s!==l){const c=e.slice(s);this.cachedData?this.cachedData=Xn(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:vr(),id3Track:o,textTrack:vr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:vr(),id3Track:this._id3Track,textTrack:vr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const s1=(n,e,t)=>{if(ue(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Al=null;const a1=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o1=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],l1=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],u1=[0,1,1,4];function NE(n,e,t,r,i){if(t+24>e.length)return;const s=OE(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=r+i*a,u={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function OE(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,u=t===3?3-r:r===3?3:4,l=a1[u*14+i-1]*1e3,d=o1[(t===3?0:t===2?1:2)*3+s],f=o===3?1:2,h=l1[t][r],p=u1[r],g=h*8*p,m=Math.floor(h*l/d+a)*p;if(Al===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Al=E?parseInt(E[1]):0}return!!Al&&Al<=87&&r===2&&l>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:m,samplesPerFrame:g}}}function up(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function ME(n,e){return e+1<n.length&&up(n,e)}function c1(n,e){return up(n,e)&&4<=n.length-e}function FE(n,e){if(e+1<n.length&&up(n,e)){const r=OE(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||ME(n,s)}return!1}class d1 extends lp{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=To(e,0);let i=(r==null?void 0:r.length)||0;if(FE(e,i))return!1;for(let s=e.length;i<s;i++)if(HL(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return jL(e,t)}appendFrame(e,t,r){bE(e,this.observer,t,r,e.manifestCodec);const i=DE(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const UE=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=n[e];const o=Math.min(r,8),u=8-o;s[0]=4278190080>>>24+u<<u,i[0]=(a[0]&s[0])>>u,t=t?t<<o|i[0]:i[0],e+=1,r-=o}return t};class f1 extends lp{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=BE(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=To(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&op(t)!==void 0&&UE(e,r)<16}}function BE(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],u=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+h,m=e[t+5]>>3,v=e[t+5]&7,y=new Uint8Array([s<<6|m<<1|v>>2,(v&3)<<6|d<<3|h<<2|u>>4,u<<4&224]),E=1536/o*9e4,_=r+i*E,I=e.subarray(t,t+c);return n.config=y,n.channelCount=g,n.samplerate=o,n.samples.push({unit:I,pts:_}),c}class h1 extends lp{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=To(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&op(t)!==void 0&&UE(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(FE(e,r))return et.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return c1(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return NE(e,t,r,this.basePTS,this.frameIndex)}}const p1=/\/emsg[-/]ID3/i;class g1{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=vr("video",1),a=this.audioTrack=vr("audio",1),o=this.txtTrack=vr("text",1);if(this.id3Track=vr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=qv(e);if(u.video){const{id:l,timescale:c,codec:d,supplemental:f}=u.video;s.id=l,s.timescale=o.timescale=c,s.codec=d,s.supplemental=f}if(u.audio){const{id:l,timescale:c,codec:d}=u.audio;a.id=l,a.timescale=c,a.codec=d}o.id=zv.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return fI(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Xn(this.remainderData,e));const o=EI(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;const a=this.extractID3Track(i,t);return s.samples=tm(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=tm(e,t),{videoTrack:t,audioTrack:vr(),id3Track:i,textTrack:vr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=Ge(e.samples,["emsg"]);i&&i.forEach(s=>{const a=SI(s);if(p1.test(a.schemeIdUri)){const o=Um(a,t);let u=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const l=a.payload;r.samples.push({data:l,len:l.byteLength,dts:o,pts:o,type:bn.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=Um(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:bn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Um(n,e){return ue(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class m1{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Jh(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Di.cbc)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const u=new Uint8Array(o);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const a=Qv(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(a,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)}).catch(i)}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const a=s[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,i,a),!this.decrypter.isSync()))return}}}}class $E{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let u=0,l,c,d,f=-1,h=0;for(s===-1&&(f=0,h=this.getNALuType(t,0),s=0,u=1);u<i;){if(l=t[u++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(c=u-s-1,f>=0){const p={data:t.subarray(f,c),type:h};o.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(a&&u<=4-a&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-a)),c>0&&(p.data=Xn(p.data,t.subarray(0,c)),p.state=0))}u<i?(d=this.getNALuType(t,u),f=u,h=d,s=0):s=-1}else s=0}if(f>=0&&s>=0){const p={data:t.subarray(f,i),type:h,state:s};o.push(p)}if(o.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=Xn(p.data,t))}return e.naluState=s,o}}class qa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&et.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class y1 extends $E{parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,u=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(l=>{var c,d;switch(l.type){case 1:{let g=!1;o=!0;const m=l.data;if(u&&m.length>4){const v=this.readSliceType(m);(v===2||v===4||v===7||v===9)&&(g=!0)}if(g){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=g;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,qh(l.data,1,r.pts,t.samples);break}case 7:{var h,p;o=!0,u=!0;const g=l.data,m=this.readSPS(g);if(!e.sps||e.width!==m.width||e.height!==m.height||((h=e.pixelRatio)==null?void 0:h[0])!==m.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[g];const v=g.subarray(1,4);let y="avc1.";for(let E=0;E<3;E++){let _=v[E].toString(16);_.length<2&&(_="0"+_),y+=_}e.codec=y}break}case 8:o=!0,e.pps=[l.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(l)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new qa(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(r+s+256)%256),r=i===0?r:i}readSPS(e){const t=new qa(e);let r=0,i=0,s=0,a=0,o,u,l;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),p=t.skipBits.bind(t),g=t.skipEG.bind(t),m=t.skipUEG.bind(t),v=this.skipScalingList.bind(this);c();const y=c();if(d(5),p(3),c(),m(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const w=f();if(w===3&&p(1),m(),m(),p(1),h())for(u=w!==3?8:12,l=0;l<u;l++)h()&&(l<6?v(16,t):v(64,t))}m();const E=f();if(E===0)f();else if(E===1)for(p(1),g(),g(),o=f(),l=0;l<o;l++)g();m(),p(1);const _=f(),I=f(),b=d(1);b===0&&p(1),p(1),h()&&(r=f(),i=f(),s=f(),a=f());let L=[1,1];if(h()&&h())switch(c()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((_+1)*16-r*2-i*2),height:(2-b)*(I+1)*16-(b?2:4)*(s+a),pixelRatio:L}}}class v1 extends $E{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,u=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(l=>{var c,d;switch(l.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,u){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,qh(l.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=nt(e.params,this.readVPS(l.data)),this.initVPS=l.data),e.vps=[l.data];break;case 33:if(o=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],l.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(l.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in h.params)e.params[p]=h.params[p]}this.pushParameterSet(e.sps,l.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(l.data);for(const p in h)e.params[p]=h[p]}this.pushParameterSet(e.pps,l.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(l)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new qa(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:i}}readSPS(e){const t=new qa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),u=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),p=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=t.readUByte(),y=[],E=[];for(let $e=0;$e<r;$e++)y.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let $e=r;$e<8;$e++)t.readBits(2);for(let $e=0;$e<r;$e++)y[$e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[$e]&&t.readUByte();t.readUEG();const _=t.readUEG();_==3&&t.skipBits(1);const I=t.readUEG(),b=t.readUEG(),L=t.readBoolean();let w=0,D=0,R=0,N=0;L&&(w+=t.readUEG(),D+=t.readUEG(),R+=t.readUEG(),N+=t.readUEG());const G=t.readUEG(),ee=t.readUEG(),oe=t.readUEG(),re=t.readBoolean();for(let $e=re?0:r;$e<=r;$e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Tt=0;Tt<4;Tt++)for(let Dt=0;Dt<(Tt===3?2:6);Dt++)if(!t.readBoolean())t.readUEG();else{const fe=Math.min(64,1<<4+(Tt<<1));Tt>1&&t.readEG();for(let Ye=0;Ye<fe;Ye++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const V=t.readUEG();let W=0;for(let $e=0;$e<V;$e++){let Tt=!1;if($e!==0&&(Tt=t.readBoolean()),Tt){$e===V&&t.readUEG(),t.readBoolean(),t.readUEG();let Dt=0;for(let de=0;de<=W;de++){const fe=t.readBoolean();let Ye=!1;fe||(Ye=t.readBoolean()),(fe||Ye)&&Dt++}W=Dt}else{const Dt=t.readUEG(),de=t.readUEG();W=Dt+de;for(let fe=0;fe<Dt;fe++)t.readUEG(),t.readBoolean();for(let fe=0;fe<de;fe++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const $e=t.readUEG();for(let Tt=0;Tt<$e;Tt++){for(let Dt=0;Dt<oe+4;Dt++)t.readBits(1);t.readBits(1)}}let q=0,X=1,ye=1,ke=!0,Te=1,Le=0;t.readBoolean(),t.readBoolean();let Re=!1;if(t.readBoolean()){if(t.readBoolean()){const Pt=t.readUByte(),Pr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ae=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Pt>0&&Pt<16?(X=Pr[Pt-1],ye=Ae[Pt-1]):Pt===255&&(X=t.readBits(16),ye=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Re=t.readBoolean(),Re&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Te=t.readBits(32),Le=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ae=t.readBoolean(),_n=t.readBoolean();let S=!1;(Ae||_n)&&(S=t.readBoolean(),S&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),S&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let A=0;A<=r;A++){ke=t.readBoolean();const C=ke||t.readBoolean();let O=!1;C?t.readEG():O=t.readBoolean();const j=O?1:t.readUEG()+1;if(Ae)for(let $=0;$<j;$++)t.readUEG(),t.readUEG(),S&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(_n)for(let $=0;$<j;$++)t.readUEG(),t.readUEG(),S&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),q=t.readUEG())}let kt=I,Qe=b;if(L){let $e=1,Tt=1;_===1?$e=Tt=2:_==2&&($e=2),kt=I-$e*D-$e*w,Qe=b-Tt*N-Tt*R}const At=i?["A","B","C"][i]:"",dr=o<<24|u<<16|l<<8|c;let $n=0;for(let $e=0;$e<32;$e++)$n=($n|(dr>>$e&1)<<31-$e)>>>0;let Gn=$n.toString(16);return a===1&&Gn==="2"&&(Gn="6"),{codecString:`hvc1.${At}${a}.${Gn}.${s?"H":"L"}${v}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,u,l,c],general_constraint_indicator_flags:[d,f,h,p,g,m],general_level_idc:v,bit_depth:G+8,bit_depth_luma_minus8:G,bit_depth_chroma_minus8:ee,min_spatial_segmentation_idc:q,chroma_format_idc:_,frame_rate:{fixed:ke,fps:Le/Te}},width:kt,height:Qe,pixelRatio:[X,ye]}}readPPS(e){const t=new qa(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ut=188;class di{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){const r=di.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ut*5,t-Ut)+1,i=0;for(;i<r;){let s=!1,a=-1,o=0;for(let u=i;u<t;u+=Ut)if(e[u]===71&&(t-u===Ut||e[u+Ut]===71)){if(o++,a===-1&&(a=u,a!==0&&(r=Math.min(a+Ut*99,e.length-Ut)+1)),s||(s=Cf(e,u)===0),s&&o>1&&(a===0&&o>2||u+Ut>r))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:zv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=di.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=di.createTrack("audio",i),this._id3Track=di.createTrack("id3"),this._txtTrack=di.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,u=this._id3Track,l=this._txtTrack;let c=a.pid,d=a.pesData,f=o.pid,h=u.pid,p=o.pesData,g=u.pesData,m=null,v=this.pmtParsed,y=this._pmtId,E=e.length;if(this.remainderData&&(e=Xn(this.remainderData,e),E=e.length,this.remainderData=null),E<Ut&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:u,textTrack:l};const _=Math.max(0,di.syncOffset(e));E-=(E-_)%Ut,E<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let I=0;for(let L=_;L<E;L+=Ut)if(e[L]===71){const w=!!(e[L+1]&64),D=Cf(e,L),R=(e[L+3]&48)>>4;let N;if(R>1){if(N=L+5+e[L+4],N===L+Ut)continue}else N=L+4;switch(D){case c:w&&(d&&(s=xs(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,l,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(N,L+Ut)),d.size+=L+Ut-N);break;case f:if(w){if(p&&(s=xs(p,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(N,L+Ut)),p.size+=L+Ut-N);break;case h:w&&(g&&(s=xs(g,this.logger))&&this.parseID3PES(u,s),g={data:[],size:0}),g&&(g.data.push(e.subarray(N,L+Ut)),g.size+=L+Ut-N);break;case 0:w&&(N+=e[N]+1),y=this._pmtId=E1(e,N);break;case y:{w&&(N+=e[N]+1);const G=T1(e,N,this.typeSupported,r,this.observer,this.logger);c=G.videoPid,c>0&&(a.pid=c,a.segmentCodec=G.segmentVideoCodec),f=G.audioPid,f>0&&(o.pid=f,o.segmentCodec=G.segmentAudioCodec),h=G.id3Pid,h>0&&(u.pid=h),m!==null&&!v&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${m}'. Backtracking to sync byte @${_} to parse all TS packets.`),m=null,L=_-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=D;break}}else I++;I>0&&Nf(this.observer,new Error(`Found ${I} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=p,u.pesData=g;const b={audioTrack:o,videoTrack:a,id3Track:u,textTrack:l};return i&&this.extractRemainingSamples(b),b}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,a=r.pesData,o=t.pesData,u=i.pesData;let l;if(a&&(l=xs(a,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,s,l,!0),r.pesData=null)):r.pesData=a,o&&(l=xs(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;u&&(l=xs(u,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new m1(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new y1:e==="hevc"&&(this.videoParser=new v1))}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=Xn(i.sample.unit,s);else{const h=f-d;i.sample.unit.set(s.subarray(0,d),h),e.samples.push(i.sample),r=i.missing}}let a,o;for(a=r,o=s.length;a<o-1&&!Uu(s,a);a++);if(a!==r){let d;const f=a<o-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",Nf(this.observer,new Error(d),f,this.logger),!f)return}bE(e,this.observer,s,a,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const d=kE(e.samplerate);u=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,c;for(;a<o;)if(c=DE(e,s,a,u,l),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(l++;a<o-1&&!Uu(s,a);a++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(ME(r,a)){const u=NE(e,r,a,o,s);if(u)a+=u.length,s++;else break}else a++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let a=0,o=0,u;for(;o<s&&(u=BE(e,r,o,i,a++))>0;)o+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=nt({},t,{type:this._videoTrack?bn.emsg:bn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Cf(n,e){return((n[e+1]&31)<<8)+n[e+2]}function E1(n,e){return(n[e+10]&31)<<8|n[e+11]}function T1(n,e,t,r,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],u=e+3+o-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<u;){const c=Cf(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){cd("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!r){cd("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!r){cd("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(n[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const g=n[f+1]+2;f+=g,h-=g}}break;case 194:case 135:return Nf(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function Nf(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(T.ERROR,T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function cd(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function xs(n,e){let t=0,r,i,s,a,o;const u=n.data;if(!n||n.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=Xn(u[0],u[1]),u.splice(1,1);if(r=u[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(i=(r[4]<<8)+r[5],i&&i>n.size-6)return null;const c=r[7];c&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=r[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let h=0,p=u.length;h<p;h++){r=u[h];let g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;f.set(r,t),t+=g}return i&&(i-=s+3),{data:f,pts:a,dts:o,len:i}}return null}class S1{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ai=Math.pow(2,32)-1;class U{static init(){U.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in U.types)U.types.hasOwnProperty(e)&&(U.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);U.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);U.STTS=U.STSC=U.STCO=s,U.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),U.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),U.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),U.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);U.FTYP=U.box(U.types.ftyp,a,u,a,o),U.DINF=U.box(U.types.dinf,U.box(U.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),i=0,r=8;i<s;i++)a.set(t[i],r),r+=t[i].byteLength;return a}static hdlr(e){return U.box(U.types.hdlr,U.HDLR_TYPES[e])}static mdat(e){return U.box(U.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(ai+1)),i=Math.floor(t%(ai+1));return U.box(U.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return U.box(U.types.mdia,U.mdhd(e.timescale||0,e.duration||0),U.hdlr(e.type),U.minf(e))}static mfhd(e){return U.box(U.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?U.box(U.types.minf,U.box(U.types.smhd,U.SMHD),U.DINF,U.stbl(e)):U.box(U.types.minf,U.box(U.types.vmhd,U.VMHD),U.DINF,U.stbl(e))}static moof(e,t,r){return U.box(U.types.moof,U.mfhd(e),U.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=U.trak(e[t]);return U.box.apply(null,[U.types.moov,U.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(U.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=U.trex(e[t]);return U.box.apply(null,[U.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(ai+1)),i=Math.floor(t%(ai+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return U.box(U.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return U.box(U.types.sdtp,r)}static stbl(e){return U.box(U.types.stbl,U.stsd(e),U.box(U.types.stts,U.STTS),U.box(U.types.stsc,U.STSC),U.box(U.types.stsz,U.STSZ),U.box(U.types.stco,U.STCO))}static avc1(e){let t=[],r=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(s));const o=U.box(U.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),u=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return U.box(U.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return U.box(U.types.mp4a,U.audioStsd(e),U.box(U.types.esds,U.esds(e)))}static mp3(e){return U.box(U.types[".mp3"],U.audioStsd(e))}static ac3(e){return U.box(U.types["ac-3"],U.audioStsd(e),U.box(U.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return U.box(U.types.stsd,U.STSD,U.mp4a(e));if(t==="ac3"&&e.config)return U.box(U.types.stsd,U.STSD,U.ac3(e));if(t==="mp3"&&e.codec==="mp3")return U.box(U.types.stsd,U.STSD,U.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return U.box(U.types.stsd,U.STSD,U.avc1(e));if(t==="hevc"&&e.vps)return U.box(U.types.stsd,U.STSD,U.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(r/(ai+1)),o=Math.floor(r%(ai+1));return U.box(U.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=U.sdtp(e),i=e.id,s=Math.floor(t/(ai+1)),a=Math.floor(t%(ai+1));return U.box(U.types.traf,U.box(U.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),U.box(U.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),U.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,U.box(U.types.trak,U.tkhd(e),U.mdia(e))}static trex(e){const t=e.id;return U.box(U.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,a=new Uint8Array(s);let o,u,l,c,d,f;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)u=r[o],l=u.duration,c=u.size,d=u.flags,f=u.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return U.box(U.types.trun,a)}static initSegment(e){U.types||U.init();const t=U.moov(e);return Xn(U.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=s.length;for(let p=0;p<r.length;p+=1){a+=3;for(let g=0;g<r[p].length;g+=1)a+=2+r[p][g].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const u=r.length-1;for(let p=0;p<r.length;p+=1){o.set(new Uint8Array([32+p|(p===u?128:0),0,r[p].length]),a),a+=3;for(let g=0;g<r[p].length;g+=1)o.set(new Uint8Array([r[p][g].length>>8,r[p][g].length&255]),a),a+=2,o.set(r[p][g],a),a+=r[p][g].length}const l=U.box(U.types.hvcC,o),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return U.box(U.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}U.types=void 0;U.HDLR_TYPES=void 0;U.STTS=void 0;U.STSC=void 0;U.STCO=void 0;U.STSZ=void 0;U.VMHD=void 0;U.SMHD=void 0;U.STSD=void 0;U.FTYP=void 0;U.DINF=void 0;const GE=9e4;function cp(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function x1(n,e,t=1,r=!1){return cp(n,e,1/t,r)}function ba(n,e=!1){return cp(n,1e3,1/GE,e)}function _1(n,e=1){return cp(n,GE,1/e)}function Bm(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const A1=10*1e3,I1=1024,L1=1152,R1=1536;let _s=null,dd=null;function $m(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class eu extends Qn{constructor(e,t,r,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,_s===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_s=a?parseInt(a[1]):0}if(dd===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);dd=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Bm(t)} > ${e&&Bm(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,u=o-s;return u<-4294967296&&(t=!0,o=Rn(o,r),u=o-s),u>0?s:o},r);return t&&this.debug("PTS rollover detected"),i}remux(e,t,r,i,s,a,o,u){let l,c,d,f,h,p,g=s,m=s;const v=e.pid>-1,y=t.pid>-1,E=t.samples.length,_=e.samples.length>0,I=o&&E>0||E>1;if((!v||_)&&(!y||I)||this.ISGenerated||o){if(this.ISGenerated){var L,w,D,R;const oe=this.videoTrackConfig;(oe&&(t.width!==oe.width||t.height!==oe.height||((L=t.pixelRatio)==null?void 0:L[0])!==((w=oe.pixelRatio)==null?void 0:w[0])||((D=t.pixelRatio)==null?void 0:D[1])!==((R=oe.pixelRatio)==null?void 0:R[1]))||!oe&&I||this.nextAudioTs===null&&_)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const N=this.isVideoContiguous;let G=-1,ee;if(I&&(G=w1(t.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,G>0){this.warn(`Dropped ${G} out of ${E} video samples due to a missing keyframe`);const oe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(G),t.dropped+=G,m+=(t.samples[0].pts-oe)/t.inputTimeScale,ee=m}else G===-1&&(this.warn(`No keyframe found out of ${E} video samples`),p=!1);if(this.ISGenerated){if(_&&I){const oe=this.getVideoStartPts(t.samples),J=(Rn(e.samples[0].pts,oe)-oe)/t.inputTimeScale;g+=Math.max(0,J),m+=Math.max(0,-J)}if(_){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),c=this.remuxAudio(e,g,this.isAudioContiguous,a,y||I||u===pe.AUDIO?m:void 0),I){const oe=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),l=this.remuxVideo(t,m,N,oe)}}else I&&(l=this.remuxVideo(t,m,N,0));l&&(l.firstKeyFrame=G,l.independent=G!==-1,l.firstKeyFramePTS=ee)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=VE(r,s,this._initPTS,this._initDTS)),i.samples.length&&(f=jE(i,s,this._initPTS))),{audio:c,video:l,initSegment:d,independent:p,text:f,id3:h}}computeInitPts(e,t,r,i){const s=Math.round(r*t);let a=Rn(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${i}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,r,i){const s=e.samples,a=t.samples,o=this.typeSupported,u={},l=this._initPTS;let c=!l||i,d="audio/mp4",f,h,p,g=-1;if(c&&(f=h=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):U.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(g=e.id,p=e.inputTimeScale,!l||p!==l.timescale?f=h=this.computeInitPts(s[0].pts,p,r,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:U.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(g=t.id,p=t.inputTimeScale,!l||p!==l.timescale){const m=this.getVideoStartPts(a),v=Rn(a[0].dts,m),y=this.computeInitPts(v,p,r,"video"),E=this.computeInitPts(m,p,r,"video");h=Math.min(h,y),f=Math.min(f,E)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(l&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${r} ${f/p} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${f/p} (${f}/${p}) trackId: ${g}`),this._initPTS={baseTime:f,timescale:p,trackId:g},this._initDTS={baseTime:h,timescale:p,trackId:g}):f=p=void 0,{tracks:u,initPTS:f,timescale:p,trackId:g}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,a=e.samples,o=[],u=a.length,l=this._initPTS,c=l.baseTime*s/l.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,p,g,m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,y=!1;if(!r||d===null){const q=c+t*s,X=a[0].pts-Rn(a[0].dts,a[0].pts);_s&&d!==null&&Math.abs(q-X-(d+c))<15e3?r=!0:d=q-X-c}const E=d+c;for(let q=0;q<u;q++){const X=a[q];X.pts=Rn(X.pts,E),X.dts=Rn(X.dts,E),X.dts<a[q>0?q-1:q].dts&&(y=!0)}y&&a.sort(function(q,X){const ye=q.dts-X.dts,ke=q.pts-X.pts;return ye||ke}),p=a[0].dts,g=a[a.length-1].dts;const _=g-p,I=_?Math.round(_/(u-1)):h||e.inputTimeScale/30;if(r){const q=p-E,X=q>I,ye=q<-1;if((X||ye)&&(X?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ba(q,!0)} ms (${q}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ba(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ye||E>=a[0].pts||_s)){p=E;const ke=a[0].pts-q;if(X)a[0].dts=p,a[0].pts=ke;else{let Te=!0;for(let Le=0;Le<a.length&&!(a[Le].dts>ke&&Te);Le++){const Re=a[Le].pts;if(a[Le].dts-=q,a[Le].pts-=q,Le<a.length-1){const at=a[Le+1].pts,kt=a[Le].pts,Qe=at<=kt,At=at<=Re;Te=Qe==At}}}this.log(`Video: Initial PTS/DTS adjusted: ${ba(ke,!0)}/${ba(p,!0)}, delta: ${ba(q,!0)} ms`)}}p=Math.max(0,p);let b=0,L=0,w=p;for(let q=0;q<u;q++){const X=a[q],ye=X.units,ke=ye.length;let Te=0;for(let Le=0;Le<ke;Le++)Te+=ye[Le].data.length;L+=Te,b+=ke,X.length=Te,X.dts<w?(X.dts=w,w+=I/4|0||1):w=X.dts,m=Math.min(X.pts,m),v=Math.max(X.pts,v)}g=a[u-1].dts;const D=L+4*b+8;let R;try{R=new Uint8Array(D)}catch(q){this.observer.emit(T.ERROR,T.ERROR,{type:ve.MUX_ERROR,details:B.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:D,reason:`fail allocating video mdat ${D}`});return}const N=new DataView(R.buffer);N.setUint32(0,D),R.set(U.types.mdat,4);let G=!1,ee=Number.POSITIVE_INFINITY,oe=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let q=0;q<u;q++){const X=a[q],ye=X.units;let ke=0;for(let Re=0,at=ye.length;Re<at;Re++){const kt=ye[Re],Qe=kt.data,At=kt.data.byteLength;N.setUint32(f,At),f+=4,R.set(Qe,f),f+=At,ke+=4+At}let Te;if(q<u-1)h=a[q+1].dts-X.dts,Te=a[q+1].pts-X.pts;else{const Re=this.config,at=q>0?X.dts-a[q-1].dts:I;if(Te=q>0?X.pts-a[q-1].pts:I,Re.stretchShortVideoTrack&&this.nextAudioTs!==null){const kt=Math.floor(Re.maxBufferHole*s),Qe=(i?m+i*s:this.nextAudioTs+c)-X.pts;Qe>kt?(h=Qe-at,h<0?h=at:G=!0,this.log(`It is approximately ${Qe/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=at}else h=at}const Le=Math.round(X.pts-X.dts);ee=Math.min(ee,h),re=Math.max(re,h),oe=Math.min(oe,Te),J=Math.max(J,Te),o.push($m(X.key,h,ke,Le))}if(o.length){if(_s){if(_s<70){const q=o[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(dd&&J-oe<re-ee&&I/re<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=p;for(let X=0,ye=o.length;X<ye;X++){const ke=q+o[X].duration,Te=q+o[X].cts;if(X<ye-1){const Le=ke+o[X+1].cts;o[X].duration=Le-Te}else o[X].duration=X?o[X-1].duration:I;o[X].cts=0,q=ke}}}h=G||!h?I:h;const le=g+h;this.nextVideoTs=d=le-c,this.videoSampleDuration=h,this.isVideoContiguous=!0;const Z={data1:U.moof(e.sequenceNumber++,p,nt(e,{samples:o})),data2:R,startPTS:(m-c)/s,endPTS:(v+h-c)/s,startDTS:(p-c)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Z}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return L1;case"ac3":return R1;default:return I1}}remuxAudio(e,t,r,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,u=a/o,l=this.getSamplesPerFrame(e),c=l*u,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],p=s!==void 0;let g=e.samples,m=f?0:8,v=this.nextAudioTs||-1;const y=d.baseTime*a/d.timescale,E=y+t*a;if(this.isAudioContiguous=r=r||g.length&&v>0&&(i&&Math.abs(E-(v+y))<9e3||Math.abs(Rn(g[0].pts,E)-(v+y))<20*c),g.forEach(function(J){J.pts=Rn(J.pts,E)}),!r||v<0){const J=g.length;if(g=g.filter(le=>le.pts>=0),J!==g.length&&this.warn(`Removed ${g.length-J} of ${J} samples (initPTS ${y} / ${a})`),!g.length)return;s===0?v=0:i&&!p?v=Math.max(0,E-y):v=g[0].pts-y}if(e.segmentCodec==="aac"){const J=this.config.maxAudioFramesDrift;for(let le=0,V=v+y;le<g.length;le++){const W=g[le],Z=W.pts,q=Z-V,X=Math.abs(1e3*q/a);if(q<=-J*c&&p)le===0&&(this.warn(`Audio frame @ ${(Z/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*q/a)} ms.`),this.nextAudioTs=v=Z-y,V=Z);else if(q>=J*c&&X<A1&&p){let ye=Math.round(q/c);for(V=Z-ye*c;V<0&&ye&&c;)ye--,V+=c;le===0&&(this.nextAudioTs=v=V-y),this.warn(`Injecting ${ye} audio frames @ ${((V-y)/a).toFixed(3)}s due to ${Math.round(1e3*q/a)} ms gap.`);for(let ke=0;ke<ye;ke++){let Te=S1.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=W.unit.subarray()),g.splice(le,0,{unit:Te,pts:V}),V+=c,le++}}W.pts=V,V+=c}}let _=null,I=null,b,L=0,w=g.length;for(;w--;)L+=g[w].unit.byteLength;for(let J=0,le=g.length;J<le;J++){const V=g[J],W=V.unit;let Z=V.pts;if(I!==null){const X=h[J-1];X.duration=Math.round((Z-I)/u)}else if(r&&e.segmentCodec==="aac"&&(Z=v+y),_=Z,L>0){L+=m;try{b=new Uint8Array(L)}catch(X){this.observer.emit(T.ERROR,T.ERROR,{type:ve.MUX_ERROR,details:B.REMUX_ALLOC_ERROR,fatal:!1,error:X,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(b.buffer).setUint32(0,L),b.set(U.types.mdat,4))}else return;b.set(W,m);const q=W.byteLength;m+=q,h.push($m(!0,l,q,0)),I=Z}const D=h.length;if(!D)return;const R=h[h.length-1];v=I-y,this.nextAudioTs=v+u*R.duration;const N=f?new Uint8Array(0):U.moof(e.sequenceNumber++,_/u,nt({},e,{samples:h}));e.samples=[];const G=(_-y)/a,ee=this.nextAudioTs/a,re={data1:N,data2:b,startPTS:G,endPTS:ee,startDTS:G,endDTS:ee,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.isAudioContiguous=!0,re}}function Rn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function w1(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function VE(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let o=0;o<i;o++){const u=n.samples[o];u.pts=Rn(u.pts-t.baseTime*s/t.timescale,e*s)/s,u.dts=Rn(u.dts-r.baseTime*s/r.timescale,e*s)/s}const a=n.samples;return n.samples=[],{samples:a}}function jE(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let a=0;a<r;a++){const o=n.samples[a];o.pts=Rn(o.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((a,o)=>a.pts-o.pts);const s=n.samples;return n.samples=[],{samples:s}}class b1 extends Qn{constructor(e,t,r,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=qv(e);if(t)mI(e,t);else{const u=s||a;u!=null&&u.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${u.codec}")!`)}s&&(r=Gm(s,rt.AUDIO,this)),a&&(i=Gm(a,rt.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:r+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:r,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,i,s,a){var o,u;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};ue(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(f),p=this.initData),!((u=p)!=null&&u.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=vI(f,p,this),m=p.audio?g[p.audio.id]:null,v=p.video?g[p.video.id]:null,y=Il(v,1/0),E=Il(m,1/0),_=Il(v,0,!0),I=Il(m,0,!0);let b=s,L=0;const w=m&&(!v||!l&&E<y||l&&l.trackId===p.audio.id),D=w?m:v;if(D){const V=D.timescale,W=D.start-s*V,Z=w?p.audio.id:p.video.id;b=D.start/V,L=w?I-E:_-y,(a||!l)&&(k1(l,b,s,L)||V!==l.timescale)&&(l&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${W/V} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${b-s} (${W}/${V}) trackId: ${Z}`),l=null,h.initPTS=W,h.timescale=V,h.trackId=Z)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=b,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const R=b-l.baseTime/l.timescale,N=R+L;L>0?this.lastEndTime=N:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const G=!!p.audio,ee=!!p.video;let oe="";G&&(oe+="audio"),ee&&(oe+="video");const re=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),J={data1:f,startPTS:R,startDTS:R,endPTS:N,endDTS:N,type:oe,hasAudio:G,hasVideo:ee,nb:1,dropped:0,encrypted:re};d.audio=G&&!ee?J:void 0,d.video=ee?J:void 0;const le=v==null?void 0:v.sampleCount;if(le){const V=v.keyFrameIndex,W=V!==-1;J.nb=le,J.dropped=V===0||this.isVideoContiguous?0:W?V:le,J.independent=W,J.firstKeyFrame=V,W&&v.keyFrameStart&&(J.firstKeyFramePTS=(v.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(d.independent=W),this.isVideoContiguous||(this.isVideoContiguous=W),J.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${V}/${le} dropped: ${J.dropped} start: ${J.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=VE(r,s,l,l),i.samples.length&&(d.text=jE(i,s,l)),d}}function Il(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function k1(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function Gm(n,e,t){const r=n.codec;return r&&r.length>4?r:e===rt.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?ku(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let jr;try{jr=self.performance.now.bind(self.performance)}catch{jr=Date.now}const tu=[{demux:g1,remux:b1},{demux:di,remux:eu},{demux:d1,remux:eu},{demux:h1,remux:eu}];tu.splice(2,0,{demux:f1,remux:eu});class Vm{constructor(e,t,r,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=jr();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=i||o,{audioCodec:g,videoCodec:m,defaultInitPts:v,duration:y,initSegmentData:E}=u,_=D1(a,t);if(_&&Ws(_.method)){const w=this.getDecrypter(),D=tp(_.method);if(w.isSync()){let R=w.softwareDecrypt(a,_.key.buffer,_.iv.buffer,D);if(r.part>-1){const G=w.flush();R=G&&G.buffer}if(!R)return s.executeEnd=jr(),fd(r);a=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=w.webCryptoDecrypt(a,_.key.buffer,_.iv.buffer,D).then(R=>{const N=this.push(R,null,r);return this.decryptionPromise=null,N}),this.decryptionPromise}const I=this.needsProbing(c,d);if(I){const w=this.configureTransmuxer(a);if(w)return this.logger.warn(`[transmuxer] ${w.message}`),this.observer.emit(T.ERROR,T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message}),s.executeEnd=jr(),fd(r)}(c||d||p||I)&&this.resetInitSegment(E,g,m,y,t),(c||p||I)&&this.resetInitialTimestamp(v),l||this.resetContiguity();const b=this.transmux(a,_,h,f,r);this.asyncResult=So(b);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,s.executeEnd=jr(),b}flush(e){const t=e.transmuxing;t.executeStart=jr();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:u,remuxer:l}=this;if(!u||!l){t.executeEnd=jr();const d=[fd(e)];return this.asyncResult?Promise.resolve(d):d}const c=u.flush(o);return So(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:u,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===pe.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(i,s,a,o,l,u,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=jr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,i),o.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,i,s):a=this.transmuxUnencrypted(e,r,i,s),a}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,u,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i}=this;let s;for(let d=0,f=tu.length;d<f;d++){var a;if((a=tu[d].demux)!=null&&a.probe(e,this.logger)){s=tu[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,u=this.remuxer,l=s.remux,c=s.demux;(!u||!(u instanceof l))&&(this.remuxer=new l(r,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(r,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Jh(this.config)),e}}function D1(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const fd=n=>({remuxResult:{},chunkMeta:n});function So(n){return"then"in n&&n.then instanceof Function}class P1{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class C1{constructor(e,t,r,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let jm=0;class HE{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=jm++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const l=u.data,c=this.hls;if(!(!c||!(l!=null&&l.event)||l.instanceNo!==this.instanceNo))switch(l.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":{c.logger[l.data.logType]&&c.logger[l.data.logType](l.data.message);break}default:{l.data=l.data||{},l.data.frag=this.frag,l.data.part=this.part,l.data.id=this.id,c.trigger(l.event,l.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const l=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:l})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const a=(u,l)=>{l=l||{},l.frag=this.frag||void 0,u===T.ERROR&&(l=l,l.parent=this.id,l.part=this.part,this.error=l.error),this.hls.trigger(u,l)};this.observer=new ip,this.observer.on(T.FRAG_DECRYPTED,a),this.observer.on(T.ERROR,a);const o=im(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(s.workerPath||FL()){try{s.workerPath?(u.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=BL(s.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=UL());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:it(s)})}catch(c){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Vm(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new Vm(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=jm++;const t=this.hls.config,r=im(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:it(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),$L(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,s,a,o,u,l,c){var d,f;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:p}=this,g=a?a.start:s.start,m=s.decryptdata,v=this.frag,y=!(v&&s.cc===v.cc),E=!(v&&l.level===v.level),_=v?l.sn-v.sn:-1,I=this.part?l.part-this.part.index:-1,b=_===0&&l.id>1&&l.id===(v==null?void 0:v.stats.chunkCount),L=!E&&(_===1||_===0&&(I===1||b&&I<=0)),w=self.performance.now();(E||_||s.stats.parsing.start===0)&&(s.stats.parsing.start=w),a&&(I||!L)&&(a.stats.parsing.start=w);const D=!(v&&((d=s.initSegment)==null?void 0:d.url)===((f=v.initSegment)==null?void 0:f.url)),R=new C1(y,L,u,E,g,D);if(!L||y||D){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===pe.MAIN?"level":"track"}: ${l.level} id: ${l.id}
        discontinuity: ${y}
        trackSwitch: ${E}
        contiguous: ${L}
        accurateTimeOffset: ${u}
        timeOffset: ${g}
        initSegmentChange: ${D}`);const N=new P1(r,i,t,o,c);this.configureTransmuxer(N)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:R},e instanceof ArrayBuffer?[e]:[]);else if(p){const N=p.push(e,m,l,R);So(N)?N.then(G=>{this.handleTransmuxComplete(G)}).catch(G=>{this.transmuxerError(G,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(N)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const i=r.flush(e);So(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Hm=100;class N1 extends rp{constructor(e,t,r){super(e,t,r,"audio-stream-controller",pe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s,trackId:a}){if(r===pe.MAIN){const o=t.cc,u=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/s} (${i}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===z.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==o)&&this.syncWithAnchor(t,l==null?void 0:l.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==o?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===z.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const i=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),u=aE(a,s,o);u&&(this.log(`Syncing with main frag at ${u.start} cc ${u.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===z.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=z.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(Hm),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=z.IDLE):this.state=z.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case z.IDLE:this.doTickIdle();break;case z.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],i=r==null?void 0:r.details;if(i&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(i))break;this.state=z.WAITING_INIT_PTS}break}case z.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case z.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:i,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=z.FRAG_LOADING;const o=i.flush().buffer,u={frag:t,part:r,payload:o,networkDetails:null};this._handleFragmentLoadProgress(u),s&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=z.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[s]))return;const o=r[s],u=o.details;if(!u||this.waitForLive(o)||this.waitForCdnTuneIn(u)){this.state=z.WAITING_TRACK,this.startFragRequested=!1;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,rt.AUDIO,pe.AUDIO));const c=this.getFwdBufferInfo(l,pe.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,u)){t.trigger(T.BUFFER_EOS,{type:"audio"}),this.state=z.ENDED;return}const d=c.len,f=t.maxBufferLength,h=u.fragments,p=h[0].start,g=this.getLoadPosition(),m=this.flushing?g:c.end;if(this.switchingTrack&&i){const E=g;u.PTSKnown&&E<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}if(d>=f&&!this.switchingTrack&&m<h[h.length-1].start)return;let v=this.getNextFragment(m,u);if(v&&this.isLoopLoading(v,m)&&(v=this.getNextFragmentLoopLoading(v,u,c,pe.MAIN,f)),!v){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Rt(v)&&!v.endList&&(!u.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===Mt.OK&&(this.mainFragLoading=y=null),y&&Rt(y))){if(v.start>y.end){const _=this.fragmentTracker.getFragAtPos(m,pe.MAIN);_&&_.end>y.end&&(y=_,this.mainFragLoading={frag:_,targetBufferTime:null})}if(v.start>y.end)return}this.loadFragment(v,o,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new vo(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==z.STOPPED&&(this.setInterval(Hm),this.state=z.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(T.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:i}=this,{details:s,id:a,groupId:o,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${u.name}" of "${o}"`);return}const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired){this.cachedTrackLoadedData=t,this.state!==z.STOPPED&&(this.state=z.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${u.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[a];let d=0;if(s.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(AE(s,l),s.alignedSliding||Fu(s,l),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(T.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===z.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const l=u[o];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const c=l.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new HE(this.hls,pe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],p=(t=r.initSegment)==null?void 0:t.data;if(h!==void 0){const m=i?i.index:-1,v=m!==-1,y=new ep(r.level,r.sn,r.stats.chunkCount,s.byteLength,m,v);f.push(s,p,d,"",r,i,c.totalduration,!1,y,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new IE,complete:!1};g.push(new Uint8Array(s)),this.state!==z.STOPPED&&(this.state=z.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===pe.MAIN&&Rt(t.frag)&&(this.mainFragLoading=t,this.state===z.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==pe.AUDIO){!this.audioOnly&&r.type===pe.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Rt(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(T.AUDIO_TRACK_SWITCHED,Je({},s)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case B.FRAG_GAP:case B.FRAG_PARSING_ERROR:case B.FRAG_DECRYPT_ERROR:case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.AUDIO,t);break;case B.AUDIO_TRACK_LOAD_ERROR:case B.AUDIO_TRACK_LOAD_TIMEOUT:case B.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===He.AUDIO_TRACK&&(this.state=z.IDLE);break;case B.BUFFER_ADD_CODEC_ERROR:case B.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case B.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case B.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==rt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==rt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===z.ENDED&&(this.state=z.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,pe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:u,part:l,level:c}=o,{details:d}=c,{audio:f,text:h,id3:p,initSegment:g}=s;if(this.fragContextChanged(u)||!d){this.fragmentTracker.removeFragment(u);return}if(this.state=z.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const m=u.initSegment||u;if(this.unhandledEncryptionError(g,u))return;this._bufferInitSegment(c,g.tracks,m,a),i.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:r,tracks:g.tracks})}if(f){const{startPTS:m,endPTS:v,startDTS:y,endDTS:E}=f;l&&(l.elementaryStreams[rt.AUDIO]={startPTS:m,endPTS:v,startDTS:y,endDTS:E}),u.setElementaryStreamInfo(rt.AUDIO,m,v,y,E),this.bufferFragmentData(f,u,l,a)}if(p!=null&&(t=p.samples)!=null&&t.length){const m=nt({id:r,frag:u,details:d},p);i.trigger(T.FRAG_PARSING_METADATA,m)}if(h){const m=nt({id:r,frag:u,details:d},h);i.trigger(T.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,r,i){if(this.state!==z.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=pe.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(T.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const u={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:o};this.hls.trigger(T.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===Mt.NOT_LOADED||i===Mt.PARTIAL){var s;if(!Rt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=z.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Fu(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;ns({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,qi)||(Pu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(T.AUDIO_TRACK_SWITCHED,Je({},e))}}class dp extends Qn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let u;try{u=new self.URL(o.URI,t.url).href}catch(l){this.warn(`Could not construct new URL for Rendition Report: ${l}`),u=o.URI||""}if(u===e){s=a;break}else u===e.substring(0,u.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let u=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}const l=r&&sm(r);return new am(o,u>=0?u:void 0,l)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const c=Math.max(u||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(i.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){LL(r,i,this);const y=i.playlistParsingError;if(y){this.warn(y);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var l;const{networkDetails:_}=t;E.trigger(T.ERROR,{type:ve.NETWORK_ERROR,details:B.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:y,reason:y.message,level:t.level||void 0,parent:(l=i.fragments[0])==null?void 0:l.type,networkDetails:_,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(i.edge-f)*1e3,p=EE(i,h);if(i.requestScheduled+p<a?i.requestScheduled=a:i.requestScheduled+=p,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let g,m,v;if(i.canBlockReload&&i.endSN&&i.advanced){const y=this.hls.config.lowLatencyMode,E=i.lastPartSn,_=i.endSN,I=i.lastPartIndex,b=I!==-1,L=E===_;b?L?(m=_+1,v=y?0:I):(m=E,v=y?I+1:i.maxPartIndex):m=_+1;const w=i.age,D=w+i.ageHeader;let R=Math.min(D-i.partTarget,i.targetduration*1.5);if(R>0){if(D>i.targetduration*3)this.log(`Playlist last advanced ${w.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,v=void 0;else if(r!=null&&r.tuneInGoal&&D-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${R} with playlist age: ${i.age}`),R=0;else{const N=Math.floor(R/i.targetduration);if(m+=N,v!==void 0){const G=Math.round(R%i.targetduration/i.partTarget);v+=G}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${w.toFixed(2)}s goal: ${R} skip sn ${N} to part ${v}`)}i.tuneInGoal=R}if(g=this.getDeliveryDirectives(i,t.deliveryDirectives,m,v),y||!L){i.requestScheduled=a,this.loadingPlaylist(c,g);return}}else(i.canBlockReload||i.canSkipUntil)&&(g=this.getDeliveryDirectives(i,t.deliveryDirectives,m,v));g&&m!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(p-o*2,p/2)),this.scheduleLoading(c,g,i)}else this.clearTimer()}scheduleLoading(e,t,r){const i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,i){let s=sm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=Ql.No),new am(r,i,s)}checkRetry(e){const t=e.details,r=Cu(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},u=!!i&&!!o&&(s===Ht.RetryRequest||!i.resolved&&s===Ht.SendAlternateToPenaltyBox);if(u){var l;if(a>=o.maxNumRetry)return!1;if(r&&(l=e.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Qh(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function KE(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!xo(n[t].attrs,e[t].attrs))return!1;return!0}function xo(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function Of(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class O1 extends dp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.audioPreference;if(!s&&u){const f=Sr(u,o,qi);if(f>-1)s=o[f];else{const h=Sr(u,this.tracks);s=this.tracks[h]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(T.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(l!==-1&&d===-1)this.setAudioTrack(l);else if(o.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===He.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&ns(e,i,qi))return i;const s=Sr(e,this.tracksInGroup,qi);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=WI(e,t.levels,r,a,qi);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Sr(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(T.AUDIO_TRACK_SWITCHING,Je({},i)),s))return;const a=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||ns(e,i,qi)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u}=e;for(let l=0;l<t.length;l++){const c=t[l];if(ns({name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u},c,qi))return l}for(let l=0;l<t.length;l++){const c=t[l];if(xo(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const c=t[l];if(xo(e.attrs,c.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Pu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(T.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class M1{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var r;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const Km=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,zE="HlsJsTrackRemovedError";class F1 extends Error{constructor(e){super(e),this.name=zE}}class U1 extends Qn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:i,mediaSource:s}=this;r&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(T.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=aI(ki(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.BUFFER_EOS,this.onBufferEos,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.FRAG_PARSED,this.onFragParsed,this),e.on(T.FRAG_CHANGED,this.onFragChanged,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_EOS,this.onBufferEos,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.FRAG_PARSED,this.onFragParsed,this),e.off(T.FRAG_CHANGED,this.onFragChanged,this),e.off(T.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?nt(r,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(r[a]=nt({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const i=ki(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const u=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||u&&a instanceof u,zm(r),B1(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${it(r,(u,l)=>u==="initSegment"?void 0:l)};
transfer tracks: ${it(i,(u,l)=>u==="initSegment"?void 0:l)}}`),!Vv(i,r)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,l=this.details,c=Math.max(u,(l==null?void 0:l.fragments[0].start)||0);if(c-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${u}`),this.onMediaDetaching(T.MEDIA_DETACHING,{}),this.onMediaAttaching(T.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(u=>{const l=u,c=i[l];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const m=Me.getBuffered(d);f.detectEvictedFragments(l,m,h,null,!0)}const p=hd(l),g=[l,d];this.sourceBuffers[p]=g,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(l),this.trackSourceBuffer(l,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const u=s.sourceBuffers;for(let l=u.length;l--;)o&&u[l].abort(),s.removeSourceBuffer(u[l]);o&&s.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&zm(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(T.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[hd(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new M1(this.tracks)}onBufferCodecs(e,t){var r;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&s.some(u=>!i[u]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(u=>{var l,c;const d=t[u],{id:f,codec:h,levelCodec:p,container:g,metadata:m,supplemental:v}=d;let y=i[u];const E=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[u],_=E!=null&&E.buffer?E:y,I=(_==null?void 0:_.pendingCodec)||(_==null?void 0:_.codec),b=_==null?void 0:_.levelCodec;y||(y=i[u]={buffer:void 0,listeners:[],codec:h,supplemental:v,container:g,levelCodec:p,metadata:m,id:f});const L=Zl(I,b),w=L==null?void 0:L.replace(Km,"$1");let D=Zl(h,p);const R=(c=D)==null?void 0:c.replace(Km,"$1");D&&L&&w!==R&&(u.slice(0,5)==="audio"&&(D=ku(D,this.appendSource)),this.log(`switching codec ${I} to ${D}`),D!==(y.pendingCodec||y.codec)&&(y.pendingCodec=D),y.container=g,this.appendChangeType(u,g,D))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const i=`${t};codecs=${r}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,i=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,pe.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&Me.isBuffered(u.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,pe.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:i,type:s,parent:a,frag:o,part:u,chunkMeta:l,offset:c}=t,d=l.buffering[s],{sn:f,cc:h}=o,p=self.performance.now();d.start=p;const g=o.stats.buffering,m=u?u.stats.buffering:null;g.start===0&&(g.start=p),m&&m.start===0&&(m.start=p);const v=r.audio;let y=!1;s==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||l.id===1||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const E=r.video,_=E==null?void 0:E.buffer;if(_&&f!=="initSegment"){const L=u||o,w=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const R=L.start+L.duration*.05,N=_.buffered,G=this.currentOp("video");!N.length&&!G?this.blockAudio(L):!G&&!Me.isBuffered(_,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(L)}else if(s==="video"){const D=L.end;if(w){const R=w.frag.start;(D>R||D<this.lastVideoAppendEnd||Me.isBuffered(_,R))&&this.unblockAudio()}this.lastVideoAppendEnd=D}}const I=(u||o).start,b={label:`append-${s}`,execute:()=>{var L;d.executeStart=self.performance.now();const w=(L=this.tracks[s])==null?void 0:L.buffer;w&&(y?this.updateTimestampOffset(w,I,.1,s,f,h):c!==void 0&&ue(c)&&this.updateTimestampOffset(w,c,1e-6,s,f,h)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();d.executeEnd=d.end=L,g.first===0&&(g.first=L),m&&m.first===0&&(m.first=L);const w={};this.sourceBuffers.forEach(([D,R])=>{D&&(w[D]=Me.getBuffered(R))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(T.BUFFER_APPENDED,{type:s,frag:o,part:u,chunkMeta:l,parent:o.type,timeRanges:w})},onError:L=>{var w;const D={type:ve.MEDIA_ERROR,parent:o.type,details:B.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:u,chunkMeta:l,error:L,err:L,fatal:!1},R=(w=this.media)==null?void 0:w.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR||L.name=="QuotaExceededError"||"quota"in L)D.details=B.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)D.errorAction=zs(!0);else if(L.name===zE&&this.sourceBufferCount===0)D.errorAction=zs(!0);else{const N=++this.appendErrors[s];this.warn(`Failed ${N}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${R||"no media error"})`),(N>=this.hls.config.appendErrorMaxRetry||R)&&(D.fatal=!0)}this.hls.trigger(T.ERROR,D)}};this.log(`queuing "${s}" append sn: ${f}${u?" p: "+u.index:""} of ${o.type===pe.MAIN?"level":"track"} ${o.level} cc: ${h}`),this.append(b,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(T.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:r,startOffset:i,endOffset:s}=t;r?this.append(this.getFlushOp(r,i,s),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],a=i?i.elementaryStreams:r.elementaryStreams;a[rt.AUDIOVIDEO]?s.push("audiovideo"):(a[rt.AUDIO]&&s.push("audio"),a[rt.VIDEO]&&s.push("video"));const o=()=>{const u=self.performance.now();r.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const l=i?i.stats:r.stats;this.hls.trigger(T.FRAG_BUFFERED,{frag:r,part:i,stats:l,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,s).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(T.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(T.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===B.BUFFER_APPEND_ERROR&&t.frag){var r;const i=(r=t.errorAction)==null?void 0:r.nextAutoLevel;ue(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const i=e.config,s=r.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(ue(o)&&o>=0){const l=Math.max(o,a),c=Math.floor(s/a)*a-l;this.flushBackBuffer(s,a,c)}const u=i.frontBufferFlushThreshold;if(ue(u)&&u>0){const l=Math.max(i.maxBufferLength,u),c=Math.max(l,a),d=Math.floor(s/a)*a+c;this.flushFrontBuffer(s,a,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=Me.getBuffered(s);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(T.BACK_BUFFER_REACHED,{bufferEnd:r});const u=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(T.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:i})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=Me.getBuffered(s),o=a.length;if(o<2)return;const u=a.start(o-1),l=a.end(o-1);if(r>u||e>=u&&e<=l)return;this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const l=Math.max(0,t.fragmentStart),c=Math.max(l,i);return{duration:1/0,start:l,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return ue(s)?{duration:s}:null;const a=this.media.duration,o=ue(r.duration)?r.duration:0;return i>o&&i>a||!ue(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(ue(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${it(r)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(T.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const u=this.getTrackCodec(o,a),l=`${o.container};codecs=${u}`;o.codec=u,this.log(`creating sourceBuffer(${l})${this.currentOp(a)?" Queued":""} ${it(o)}`);try{const c=r.addSourceBuffer(l),d=hd(a),f=[a,c];t[d]=f,o.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:l,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let i=e.codec;r&&(t==="video"||t==="audiovideo")&&mo(r,"video")&&(i=wI(i,r));const s=Zl(i,e.levelCodec);return s?t.slice(0,5)==="audio"?ku(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(T.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,r,i,s,a){const o=t-e.timestampOffset;Math.abs(o)>=r&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=ue(i.duration)?i.duration:1/0,l=ue(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(r,u,l);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],i=r==null?void 0:r.buffer;if(!i)throw new F1(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const i=(r=this.tracks[t])==null?void 0:r.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=r.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(i=>{r.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function zm(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function B1(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function hd(n){return n==="audio"?1:0}class fp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ue(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,fp.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(o,u)=>u?o.width!==u.width||o.height!==u.height:!0;let s=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const u=e[o];if((u.width>=a||u.height>=a)&&i(u,e[o+1])){s=o;break}}return s}}const $1={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},gn=$1,G1={HLS:"h"},V1=G1;class Rr{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Rr?r:new Rr(r))),this.value=e,this.params=t}}const j1="Dict";function H1(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function K1(n,e,t,r){return new Error(`failed to ${n} "${H1(e)}" as ${t}`,{cause:r})}function wr(n,e,t){return K1("serialize",n,e,t)}class WE{constructor(e){this.description=e}}const Wm="Bare Item",z1="Boolean";function W1(n){if(typeof n!="boolean")throw wr(n,z1);return n?"?1":"?0"}function Y1(n){return btoa(String.fromCharCode(...n))}const q1="Byte Sequence";function X1(n){if(ArrayBuffer.isView(n)===!1)throw wr(n,q1);return`:${Y1(n)}:`}const Z1="Integer";function Q1(n){return n<-999999999999999||999999999999999<n}function YE(n){if(Q1(n))throw wr(n,Z1);return n.toString()}function J1(n){return`@${YE(n.getTime()/1e3)}`}function qE(n,e){if(n<0)return-qE(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const eR="Decimal";function tR(n){const e=qE(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw wr(n,eR);const t=e.toString();return t.includes(".")?t:`${t}.0`}const nR="String",rR=/[\x00-\x1f\x7f]+/;function iR(n){if(rR.test(n))throw wr(n,nR);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function sR(n){return n.description||n.toString().slice(7,-1)}const aR="Token";function Ym(n){const e=sR(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw wr(e,aR);return e}function Mf(n){switch(typeof n){case"number":if(!ue(n))throw wr(n,Wm);return Number.isInteger(n)?YE(n):tR(n);case"string":return iR(n);case"symbol":return Ym(n);case"boolean":return W1(n);case"object":if(n instanceof Date)return J1(n);if(n instanceof Uint8Array)return X1(n);if(n instanceof WE)return Ym(n);default:throw wr(n,Wm)}}const oR="Key";function Ff(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw wr(n,oR);return n}function hp(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Ff(e)}`:`;${Ff(e)}=${Mf(t)}`).join("")}function XE(n){return n instanceof Rr?`${Mf(n.value)}${hp(n.params)}`:Mf(n)}function lR(n){return`(${n.value.map(XE).join(" ")})${hp(n.params)}`}function uR(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw wr(n,j1);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Rr||(s=new Rr(s));let a=Ff(i);return s.value===!0?a+=hp(s.params):(a+="=",Array.isArray(s.value)?a+=lR(s):a+=XE(s)),a}).join(`,${r}`)}function ZE(n,e){return uR(n,e)}const gr="CMCD-Object",xt="CMCD-Request",Hi="CMCD-Session",oi="CMCD-Status",cR={br:gr,ab:gr,d:gr,ot:gr,tb:gr,tpb:gr,lb:gr,tab:gr,lab:gr,url:gr,pb:xt,bl:xt,tbl:xt,dl:xt,ltc:xt,mtp:xt,nor:xt,nrr:xt,rc:xt,sn:xt,sta:xt,su:xt,ttfb:xt,ttfbb:xt,ttlb:xt,cmsdd:xt,cmsds:xt,smrt:xt,df:xt,cs:xt,ts:xt,cid:Hi,pr:Hi,sf:Hi,sid:Hi,st:Hi,v:Hi,msd:Hi,bs:oi,bsd:oi,cdn:oi,rtp:oi,bg:oi,pt:oi,ec:oi,e:oi},dR={REQUEST:xt};function fR(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(i=>e[i]=t),e},{})}function hR(n,e){const t={};if(!n)return t;const r=Object.keys(n),i=e?fR(e):{};return r.reduce((s,a)=>{var o;const u=cR[a]||i[a]||dR.REQUEST,l=(o=s[u])!==null&&o!==void 0?o:s[u]={};return l[a]=n[a],s},t)}function pR(n){return["ot","sf","st","e","sta"].includes(n)}function gR(n){return typeof n=="number"?ue(n):n!=null&&n!==""&&n!==!1}const QE="event";function mR(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const nu=n=>Math.round(n),Uf=(n,e)=>Array.isArray(n)?n.map(t=>Uf(t,e)):n instanceof Rr&&typeof n.value=="string"?new Rr(Uf(n.value,e),n.params):(e.baseUrl&&(n=mR(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Ll=n=>nu(n/100)*100,yR=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Rr&&typeof n.value=="string"?t=new Rr([n]):typeof n=="string"&&(t=[n])),Uf(t,e)},vR={br:nu,d:nu,bl:Ll,dl:Ll,mtp:Ll,nor:yR,rtp:Ll,tb:nu},JE="request",eT="response",pp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],ER=["e"],TR=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function fc(n){return TR.test(n)}function SR(n){return pp.includes(n)||ER.includes(n)||fc(n)}const tT=["d","dl","nor","ot","rtp","su"];function xR(n){return pp.includes(n)||tT.includes(n)||fc(n)}const _R=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function AR(n){return pp.includes(n)||tT.includes(n)||_R.includes(n)||fc(n)}const IR=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function LR(n){return IR.includes(n)||fc(n)}const RR={[eT]:AR,[QE]:SR,[JE]:xR};function nT(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,i=e.reportingMode||JE,s=r===1?LR:RR[i];let a=Object.keys(n).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const u=i===eT||i===QE;u&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const l=nt({},vR,e.formatters),c={version:r,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=n[d];const h=l[d];if(typeof h=="function"&&(f=h(f,c)),d==="v"){if(r===1)return;f=r}d=="pr"&&f===1||(u&&d==="ts"&&!ue(f)&&(f=Date.now()),gR(f)&&(pR(d)&&typeof f=="string"&&(f=new WE(f)),t[d]=f))}),t}function wR(n,e={}){const t={};if(!n)return t;const r=nT(n,e),i=hR(r,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((s,[a,o])=>{const u=ZE(o,{whitespace:!1});return u&&(s[a]=u),s},t)}function bR(n,e,t){return nt(n,wR(e,t))}const kR="CMCD";function DR(n,e={}){return n?ZE(nT(n,e),{whitespace:!1}):""}function PR(n,e={}){if(!n)return"";const t=DR(n,e);return encodeURIComponent(t)}function CR(n,e={}){if(!n)return"";const t=PR(n,e);return`${kR}=${t}`}const qm=/CMCD=[^&#]+/;function NR(n,e,t){const r=CR(e,t);if(!r)return n;if(qm.test(n))return n.replace(qm,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class OR{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:gn.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],u=this.getObjectType(s),l={d:(a||s).duration*1e3,ot:u};(u===gn.VIDEO||u===gn.AUDIO||u==gn.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(u)/1e3,l.bl=this.getBufferLength(u));const c=a?this.getNextPart(a):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(l.nor=c.url),this.apply(i,l)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHED,this.onMediaDetached,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHED,this.onMediaDetached,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:V1.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){nt(t,this.createData());const r=t.ot===gn.INIT||t.ot===gn.VIDEO||t.ot===gn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),bR(e.headers,t,s)):e.url=NR(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const i=e.sn-r.startSN;return r.fragments[i+1]}}getNextPart(e){var t;const{index:r,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=i;for(let o=s.length-1;o>=0;o--){const u=s[o];if(u.index===r&&u.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return gn.TIMED_TEXT;if(e.sn==="initSegment")return gn.INIT;if(t==="audio")return gn.AUDIO;if(t==="main")return this.hls.audioTracks.length?gn.VIDEO:gn.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===gn.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;r=i.levels.slice(0,a)}return r.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===gn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Me.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const MR=3e5;class FR extends Qn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Ht.SendAlternateToPenaltyBox&&r.flags===Ln.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:u,type:l}=t.context;o&&i?a=this.getPathwayForGroupId(o,l,a):u&&(a=u)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==a),t.details===B.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${it(s)} penalized: ${it(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>MR&&delete r[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,u=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,xE(t),this.hls.trigger(T.LEVELS_UPDATED,{levels:t});const l=this.hls.levels[o];u&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===He.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===He.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":u}=s;if(t.some(c=>c.pathwayId===a))return;const l=this.getLevelsForPathway(o).map(c=>{const d=new pt(c.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),h&&(i[d.SUBTITLES]=h,d.SUBTITLES=h);const p=rT(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),g=new vo({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:p,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let m=1;m<c.audioGroups.length;m++)g.addGroupId("audio",`${c.audioGroups[m]}_clone_${a}`);if(c.subtitleGroups)for(let m=1;m<c.subtitleGroups.length;m++)g.addGroupId("text",`${c.subtitleGroups[m]}_clone_${a}`);return g});t.push(...l),Xm(this.audioTracks,r,u,a),Xm(this.subtitleTracks,i,u,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${i}"`);const p=c.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":v}=p;if(g)try{this.uri=new self.URL(g,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m);const y={steeringManifest:p,url:i.toString()};this.hls.trigger(T.STEERING_MANIFEST_LOADED,y),v&&this.updatePathwayPriority(v)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(c.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const m=g.getResponseHeader("Retry-After");m&&(p=parseFloat(m)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,u,l)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Xm(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(a=>a.groupId===i).map(a=>{const o=nt({},a);return o.details=void 0,o.attrs=new pt(o.attrs),o.url=o.attrs.URI=rT(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=r,o});n.push(...s)})}function rT(n,e,t,r){const{HOST:i,PARAMS:s,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const u=new self.URL(n);return i&&!o&&(u.host=i),s&&Object.keys(s).sort().forEach(l=>{l&&u.searchParams.set(l,s[l])}),u.href}class Ys extends Qn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ys.CDMCleanupPromise?[Ys.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Oa(this.config));const o=a.map(sd).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Jl(a);if(r!=="sinf"||o!==yt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}let u;try{const h=Ct(new Uint8Array(i)),p=np(JSON.parse(h).sinf),g=Zv(p);if(!g)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(g.subarray(8,24))}catch(h){this.warn(`${s} Failed to parse sinf: ${h}`);return}const l=Kt(u),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[l];for(let h=0;h<d.length;h++){const p=d[h],g=p.decryptdata;if(!g.keyId)continue;const m=Kt(g.keyId);if(Ou(u,g.keyId)||g.uri.replace(/-/g,"").indexOf(l)!==-1){if(f=c[m],!f)continue;if(g.pssh)break;delete c[m],g.pssh=new Uint8Array(i),g.keyId=u,f=c[l]=f.then(()=>this.generateRequestWithPreferredKeySession(p,r,i,"encrypted-event-key-match")),f.catch(v=>this.handleError(v));break}}f||this.handleError(new Error(`Key ID ${l} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(T.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(T.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===yt.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,u)=>!!a&&u.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(r),s=t.map(a=>a.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const u=l=>{const c=l.shift();this.getMediaKeysPromise(c,i,s).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{l.length?u(l):d instanceof An?o(d):o(new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return pE===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){var i;const s=yL(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${it(s)}`),o=this.requestMediaKeySystemAccess(e,s);const u=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=u.mediaKeys=l.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Kt(e.keyId||[])} keyUri: ${e.uri}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=Rl(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${Kt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>sd(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=sd(i);s?t(s):r(new Error(`Unable to find format for key-system "${i}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Oa(this.config),r=e.map(Jl).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const i=UR(e,t[r]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,r=Rl(t),i=this.bannedKeyIds[r];if(i||this.getKeyStatus(t)==="internal-error"){const o=Zm(i||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(u,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:l,decryptdata:t}))))).then(u=>{const l="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,l,c,"playlist-key")});return o.catch(u=>this.handleError(u,e.frag)),this.keyIdToKeySessionPromise[r]=o,o}return a.catch(o=>{if(o instanceof An){const u=Je({},o.data);this.getKeyStatus(t)==="internal-error"&&(u.decryptdata=t);const l=new An(u,o.message);this.handleError(l,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof An){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${Kt(r.keyId||[])})`:""}`),this.hls.trigger(T.ERROR,e.data)}else this.error(e.message),this.hls.trigger(T.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Rl(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=Jl(e.keyFormat),s=i?[i]:Oa(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Oa(this.config)),e.length===0)throw new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${it({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const p=a.call(this.hls,t,r,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,r=p.initData?p.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=Rl(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${o} URI: ${u} (init data type: ${t} length: ${r.byteLength})`);const l=new ip,c=e._onmessage=p=>{const g=e.mediaKeysSession;if(!g){l.emit("error",new Error("invalid state"));return}const{messageType:m,message:v}=p;this.log(`"${m}" message event for session "${g.sessionId}" message size: ${v.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,v).catch(y=>{l.eventNames().length?l.emit("error",y):this.handleError(y)}):m==="license-release"?e.keySystem===yt.FAIRPLAY&&this.updateKeySession(e,kf("acknowledged")).then(()=>this.removeSession(e)).catch(y=>this.handleError(y)):this.warn(`unhandled media key message type "${m}"`)},d=(p,g)=>{g.keyStatus=p;let m;p.startsWith("usable")?l.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?m=Zm(p,g.decryptdata):p==="expired"?m=new Error(`key expired (keyId: ${o})`):p==="released"?m=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${o})`),m&&(l.eventNames().length?l.emit("error",m):this.handleError(m))},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}const m=this.getKeyStatuses(e);if(!Object.keys(m).some(_=>m[_]!=="status-pending"))return;if(m[o]==="expired"){this.log(`Expired key ${it(m)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let y=m[o];if(y)d(y,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[o]||(E[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const I=this.getKeyStatus(e.decryptdata);if(I&&I!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${I} from other session.`),d(I,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),y="internal-error",d(y,e)},1e3)),this.log(`No status for keyId ${o} (${it(m)}).`)}};ln(e.mediaKeysSession,"message",c),ln(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((p,g)=>{l.on("error",g),l.on("resolved",p)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${u}`)}).catch(p=>{throw new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>h).catch(p=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,i)=>{if(typeof i=="string"&&typeof r=="object"){const o=i;i=r,r=o}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===yt.PLAYREADY&&s.length===16){const o=Kt(s);t[o]=r,fE(s)}const a=Kt(s);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const u={responseType:"arraybuffer",url:s},l=t.certLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{a(f.data)},onError:(f,h,p,g)=>{o(new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:Je({url:u.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,p)=>{o(new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,h,p)=>{o(new Error("aborted"))}};i.load(u,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var a,o;c=s[d];const h=(a=c.querySelector("name"))==null?void 0:a.textContent,p=(o=c.querySelector("value"))==null?void 0:o.textContent;h&&p&&e.setRequestHeader(h,p)}}const u=i.querySelector("Challenge"),l=u==null?void 0:u.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return kf(atob(l))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let u=o.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const l=this.config.licenseResponseCallback;if(l)try{u=l.call(this.hls,o,a,e)}catch(c){this.error(c)}i(u)}else{const u=r.errorRetry,l=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)s(new An({type:ve.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:u,licenseChallenge:l})=>{e.keySystem==yt.PLAYREADY&&(l=this.unpackPlayReadyKeyMessage(u,l)),u.send(l)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,ln(r,"encrypted",this.onMediaEncrypted),ln(r,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(vn(e,"encrypted",this.onMediaEncrypted),vn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ri.clearKeyUriToKeyIdMap();const s=i.length;Ys.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((r==null||(e=r.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Kt((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(l=>self.clearTimeout(a[l]));const{drmSystemOptions:o}=this.config;return(EL(o)?new Promise((l,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(l).catch(c)}):Promise.resolve()).catch(l=>{this.log(`Could not remove session: ${l}`),this.hls&&this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${l}`)})}).then(()=>t.close()).catch(l=>{this.log(`Could not close session: ${l}`),this.hls&&this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${l}`)})})}return Promise.resolve()}}Ys.CDMCleanupPromise=void 0;function Rl(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Kt(n.keyId)}function UR(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class An extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Zm(n,e){const t=n==="output-restricted",r=t?B.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:B.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new An({type:ve.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class BR{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,u=1e3*a/s,l=this.hls;if(l.trigger(T.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),u>0&&a>l.config.fpsDroppedMonitoringThreshold*o){let c=l.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=c)&&(c=c-1,l.trigger(T.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function iT(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function sT(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){et.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){et.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function Us(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function Bf(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=GR(n.cues,e,t);for(let a=0;a<s.length;a++)(!r||r(s[a]))&&n.removeCue(s[a])}i==="disabled"&&(n.mode=i)}function $R(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t,s;for(;r<=i;)if(s=Math.floor((i+r)/2),e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s;return n[r].startTime-e<e-n[i].startTime?r:i}function GR(n,e,t){const r=[],i=$R(n,e);if(i>-1)for(let s=i,a=n.length;s<a;s++){const o=n[s];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function ru(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class VR extends dp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=ru(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;ru(r.textTracks).forEach(a=>{Us(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const c=Sr(o,a);if(c>-1)s=a[c];else{const d=Sr(o,this.tracks);s=this.tracks[d]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const l={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(T.SUBTITLE_TRACKS_UPDATED,l),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||ns(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(xo(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(xo(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(Of(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===He.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&ns(e,r))return r;const i=Sr(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Sr(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(T.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ru(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>Of(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ue(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:u,type:l,url:c}=i;this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:u,type:l,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}function jR(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function Xa(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const qs=.025;let Bu=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function HR(n,e,t){return`${n.identifier}-${t+1}-${Xa(e)}`}class KR{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return pd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=pd(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ue(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return pd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<qs))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Bu.Range:Bu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return zR(this)}}function pd(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<qs)?e.start:e.start+e.duration}function aT(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function gd(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function zR(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function As(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class WR{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(T.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=i;const a=()=>{this.hasDetails=!0};s.once(T.LEVEL_LOADED,a),s.once(T.AUDIO_TRACK_LOADED,a),s.once(T.SUBTITLE_TRACK_LOADED,a),s.on(T.MEDIA_ATTACHING,(o,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(T.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,s.trigger(T.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=aT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=Me.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Me.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,r){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,r){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${As(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Qm=.033;class YR extends Qn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=i[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let i=0;i<r.length;i++){let s=r[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){const s=r[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var r;if(((r=t[i].event)==null?void 0:r.identifier)===e)return i}return-1}findAssetIndex(e,t){const r=e.assetList,i=r.length;if(i>1)for(let s=0;s<i;s++){const a=r[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,i=r[r.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:i}=r,s=this.events,a=this.parseDateRanges(i,{url:r.url},t),o=Object.keys(i),u=s?s.filter(l=>!o.includes(l.identifier)):[];a.length&&a.sort((l,c)=>{const d=l.cue.pre,f=l.cue.post,h=c.cue.pre,p=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!d&&!h&&!f&&!p){const g=l.startTime,m=c.startTime;if(g!==m)return g-m}return l.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,u.forEach(l=>{this.removeEvent(l)}),this.updateSchedule(e,u)}updateSchedule(e,t=[],r=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(i,e);(r||t.length||(s==null?void 0:s.length)!==a.length||a.some((u,l)=>Math.abs(u.playout.start-s[l].playout.start)>.005||Math.abs(u.playout.end-s[l].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,r){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],u=e[o];if(u.isInterstitial){let l=this.eventMap[o];l?l.setDateRange(u):(l=new KR(u,t),this.eventMap[o]=l,r===!1&&(l.appendInPlace=r)),i.push(l)}}return i}parseSchedule(e,t){const r=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,l=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,p=e[d-1]||null,g=c.appendInPlace,m=h?s:c.startOffset,v=c.duration,y=c.timelineOccupancy===Bu.Range?v:0,E=c.resumptionOffset,_=(p==null?void 0:p.startTime)===m,I=m+c.cumulativeDuration;let b=g?I+v:m+E;if(f||!h&&m<=0){const w=l;l+=y,c.timelineStart=I;const D=a;a+=v,r.push({event:c,start:I,end:b,playout:{start:D,end:a},integrated:{start:w,end:l}})}else if(m<=s){if(!_){const R=m-u;if(R>Qm){const N=u,G=l;l+=R;const ee=a;a+=R;const oe={previousEvent:e[d-1]||null,nextEvent:c,start:N,end:N+R,playout:{start:ee,end:a},integrated:{start:G,end:l}};r.push(oe)}else R>0&&p&&(p.cumulativeDuration+=R,r[r.length-1].end=m)}h&&(b=I),c.timelineStart=I;const w=l;l+=y;const D=a;a+=v,r.push({event:c,start:I,end:b,playout:{start:D,end:a},integrated:{start:w,end:l}})}else return;const L=c.resumeTime;h||L>s?u=s:u=L}),u<s){var o;const c=u,d=l,f=s-u;l+=f;const h=a;a+=f,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:u,end:c+f,playout:{start:h,end:a},integrated:{start:d,end:l}})}this.setDurations(s,a,l)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,i=r.live?1/0:r.edge;let s=0,a=-1;e.forEach((o,u)=>{const l=o.cue.pre,c=o.cue.post,d=l?0:c?i:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=cs(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<Qm&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const h=ue(o.resumeOffset)?o.resumeOffset:o.duration;s+=h})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>qs?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,u=o.edge;if(r>=u)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${u}`),!1;const l=cs(null,o.fragments,r);if(!l)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(l.start-r)<qs+c||Math.abs(l.end-r)<qs+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${l.start}-${l.end} sn: ${l.sn} cc: ${l.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,i=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],u=t+r;o.startOffset=r,o.timelineStart=u,i||(i=o.duration===null),s||(s=!!o.error);const l=o.error?0:o.duration||0;r+=l}i&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function er(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class qR{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let i;try{i=aT(r,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,B.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(T.ERROR,h);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),u={responseType:"json",url:i.href},l=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{const m=f.data,v=m==null?void 0:m.ASSETS;if(!Array.isArray(v)){const y=this.assignAssetListError(e,B.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,h,g);this.hls.trigger(T.ERROR,y);return}e.assetListResponse=m,this.hls.trigger(T.ASSET_LIST_LOADED,{event:e,assetListResponse:m,networkDetails:g})},onError:(f,h,p,g)=>{const m=this.assignAssetListError(e,B.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,g,p);this.hls.trigger(T.ERROR,m)},onTimeout:(f,h,p)=>{const g=this.assignAssetListError(e,B.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,p);this.hls.trigger(T.ERROR,g)}};return o.load(u,c,d),this.hls.trigger(T.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,i,s,a){return e.error=r,{type:ve.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:a,stats:s}}}function Jm(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function wl(n,e){return`[${n}] Advancing timeline position to ${e}`}class XR extends Qn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&r<o.start||r>=o.end){var u;const h=this.findItemIndex(o);let p=this.schedule.findItemIndexAtTime(r);if(p===-1&&(p=h+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${r} (resolving from ${h} to ${p})`)),!this.isInterstitial(o)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!a&&p>h){const g=this.schedule.findJumpRestrictedIndex(h+1,p);if(g>h){this.setSchedulePosition(g);return}}this.setSchedulePosition(p);return}const l=this.playingAsset;if(!l){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,h))}return}const c=l.timelineStart,d=l.duration||0;if(a&&r<c||r>=c+d){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,l)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(r>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,i)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],u=s.items||[],l=s.durations,c=r.map(g=>g.identifier),d=!!(o.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${u.map(g=>er(g))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,h=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(h=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,h)?this.bufferingItem=h:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),r.forEach(g=>{g.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const m=g.assetItem.timelineStart,v=g.timelineOffset-m;if(v)try{g.timelineOffset=m}catch(y){Math.abs(v)>qs&&this.warn(`${y} ("${g.assetId}" ${g.timelineOffset}->${m})`)}}}),d||i){if(this.hls.trigger(T.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:u.slice(0),durations:l,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),p&&h!==f&&this.trimInPlace(h,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new qR(e),this.schedule=new YR(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(T.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(T.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(T.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(T.MEDIA_ENDED,this.onMediaEnded,this),e.on(T.ERROR,this.onError,this),e.on(T.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(T.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(T.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(T.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(T.MEDIA_ENDED,this.onMediaEnded,this),e.off(T.ERROR,this.onError,this),e.off(T.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){vn(e,"play",this.onPlay),vn(e,"pause",this.onPause),vn(e,"seeking",this.onSeeking),vn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;ln(r,"seeking",this.onSeeking),ln(r,"timeupdate",this.onTimeupdate),ln(r,"play",this.onPlay),ln(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),i=(d,f,h,p,g)=>{if(d){let m=d[f].start;const v=d.event;if(v){if(f==="playout"||v.timelineOccupancy!==Bu.Point){const y=r(h);(y==null?void 0:y.interstitial)===v&&(m+=y.assetItem.startOffset+y[g])}}else{const y=p==="bufferedPos"?a():e[p];m+=y-d.start}return m}return 0},s=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var p;const g=e.schedule.findItemIndexAtTime(d),m=(p=e.schedule.items)==null?void 0:p[g];if(m){const v=m[f].start-m.start;return d+v}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},u=(d,f)=>{var h,p;const g=e.effectivePlayingItem;if(g!=null&&(h=g.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const m=e.effectivePlayingItem,v=e.schedule.findItemIndexAtTime(d,f),y=(p=e.schedule.items)==null?void 0:p[v],E=e.getBufferingPlayer(),_=E==null?void 0:E.interstitial,I=_==null?void 0:_.appendInPlace,b=m&&e.itemsMatch(m,y);if(m&&(I||b)){const L=r(e.playingAsset),w=(L==null?void 0:L.media)||e.primaryMedia;if(w){const D=f==="primary"?w.currentTime:i(m,f,e.playingAsset,"timelinePos","currentTime"),R=d-D,N=(I?D:w.currentTime)+R;if(N>=0&&(!L||I||N<=L.duration)){w.currentTime=N;return}}}if(y){let L=d;if(f!=="primary"){const D=y[f].start,R=d-D;L=y.start+R}const w=!e.isInterstitial(y);if((!e.isInterstitial(m)||m.event.appendInPlace)&&(w||y.event.appendInPlace)){const D=e.media||(I?E==null?void 0:E.media:null);D&&(D.currentTime=L)}else if(m){const D=e.findItemIndex(m);if(v>D){const N=e.schedule.findJumpRestrictedIndex(D+1,v);if(N>D){e.setSchedulePosition(N);return}}let R=0;if(w)e.timelinePos=L,e.checkBuffer();else{const N=y.event.assetList,G=d-(y[f]||y).start;for(let ee=N.length;ee--;){const oe=N[ee];if(oe.duration&&G>=oe.startOffset&&G<oe.startOffset+oe.duration){R=ee;break}}}e.setSchedulePosition(v,R)}}},l=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var h;return i(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=l(),f=e.effectivePlayingItem;return f&&f===d?i(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=l(),h=e.effectivePlayingItem;h&&h===f&&u(d+h.playout.start,"playout")},get duration(){const d=l();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=l())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=l())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return l()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){u(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){u(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const p=d.playout.start+d.event.duration;u(p+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!ue(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${it(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,u=o&&e.interstitial.appendInPlace,l=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(a.media)u&&(s=a.transferMedia(),this.detachedData=s),c="Primary";else if(l){const p=this.getBufferingPlayer();p?(s=p.transferMedia(),c=`${p}`):c="detached MediaSource"}else c="detached media";if(!s){if(l)s=this.detachedData,this.log(`using detachedData: MediaSource ${it(s)}`);else if(!this.detachedData||a.media===t){const p=this.playerQueue;p.length>1&&p.forEach(g=>{if(o&&g.interstitial.appendInPlace!==u){const m=g.interstitial;this.clearInterstitial(g.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",f=d&&s?s:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(f===s&&h){const p=o&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!o||p,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,i=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.log(wl("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const r=e.event,i=r.findAssetIndex(t),s=gd(r,i);if(!r.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,r){const i=gd(e,r);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.log(wl("advanceAfterAssetEnded",u)),this.timelinePos=u,e.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const i=t.parentIdentifier,s=r.getEvent(i);if(s){const a=r.findEventIndex(i),o=r.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var r;const i=(r=this.schedule)==null?void 0:r.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&er(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(a,s)||t!==void 0&&f!==c.assetList[t].identifier)){var u;const p=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${c.assetList.length} ${As(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(T.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:c,schedule:i.slice(0),scheduleIndex:e,player:h}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(f,s),h.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${er(a)}`),c.hasPlayed=!0,this.hls.trigger(T.INTERSTITIAL_ENDED,{event:c,schedule:i.slice(0),scheduleIndex:e}),c.cue.once)){var l;this.updateSchedule();const p=(l=this.schedule)==null?void 0:l.items;if(s&&p){const g=this.findItemIndex(s);this.advanceSchedule(g,p,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,r,i,s){const a=this.schedule;if(!a)return;const o=t[e]||null,u=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(c=>{const d=c.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(r===void 0){r=a.findAssetIndex(c,this.timelinePos);const p=gd(c,r-1);if(c.isAssetPastPlayoutLimit(p)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,r);return}r=p}const d=this.waitingItem;this.assetsBuffered(o,u)||this.setBufferingItem(o);let f=this.preloadAssets(c,r);if(this.eventItemsMatch(o,d||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${er(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(T.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const h=c.assetList[r];if(!h){this.advanceAfterAssetEnded(c,e,r||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const p=c.assetList.length;this.warn(`asset ${r+1}/${p} player destroyed ${c}`),f=this.createAssetPlayer(c,h,r),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,r,t,e,u),this.shouldPlay&&Jm(f.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&Jm(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${er(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(wl("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${er(e)}`),this.hls.trigger(T.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(r<i.fragmentStart||r>i.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Me.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(wl("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((r=i.mainForwardBufferInfo)==null?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(T.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(T.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const i=Je(Je({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Je(Je({},this.altSelection),{},{audio:r});return}const s=Je(Je({},i),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Je(Je({},this.altSelection),{},{subtitles:r});return}const s=Je(Je({},i),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=lm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=lm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var r;const a=this.schedule.findEventIndex(s.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const i=(r=this.schedule)==null?void 0:r.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const r=e.end+.25,i=Me.bufferInfo(this.primaryMedia,r,0);(i.end>r||(i.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${er(e)} (was ${er(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const i=Me.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,r,e)}updateBufferedPos(e,t,r){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const c=this.findItemIndex(s),d=Math.min(c+1,t.length-1),f=t[d];if((u===-1&&s&&e>=s.end||(l=f.event)!=null&&l.appendInPlace&&e+.01>=f.start)&&(u=d),this.isInterstitial(s)){const h=s.event;if(d-o>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,u>c&&u>o)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&a&&!this.itemsMatch(a,s)&&(u===o?this.bufferedToItem(a):u===o+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:i,events:s}=r;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${er(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const l=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===l&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(l=>l.pauseBuffering());this.hls.trigger(T.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,i=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(i||!s){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const r=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const u=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let l,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-u;f>0&&(l=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${l?` live-start: ${c} start-offset: ${l}`:""}`),r)return this.createAsset(e,0,0,u,e.duration,r);const d=this.assetListLoader.loadAssetList(e,l);d&&(e.assetListLoader=d)}else if(!a&&i){for(let l=t;l<i;l++){const c=e.assetList[l],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,l)}const u=e.assetList[t];if(u){const l=this.getAssetPlayer(u.identifier);return l&&l.loadSource(),l}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,s,a){const o={parentIdentifier:e.identifier,identifier:HR(e,a,t),duration:s,startOffset:r,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=nt({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const u=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const _=this.timelinePos-t.timelineStart;if(_>1){const I=t.duration;I&&_<I&&(c=_)}}const d=t.identifier,f=Je(Je({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:u||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=nt({},h,{contentId:Xa(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new WR(this.HlsPlayerClass,f,e,t);this.playerQueue.push(p),e.assetList[r]=t;let g=!0;const m=_=>{if(_.live){var I;const w=new Error(`Interstitials MUST be VOD assets ${e}`),D={fatal:!0,type:ve.OTHER_ERROR,details:B.INTERSTITIAL_ASSET_ITEM_ERROR,error:w},R=((I=this.schedule)==null?void 0:I.findEventIndex(e.identifier))||-1;this.handleAssetItemError(D,e,R,r,w.message);return}const b=_.edge-_.fragmentStart,L=t.duration;(g||L===null||b>L)&&(g=!1,this.log(`Interstitial asset "${d}" duration change ${L} > ${b}`),t.duration=b,this.updateSchedule())};p.on(T.LEVEL_UPDATED,(_,{details:I})=>m(I)),p.on(T.LEVEL_PTS_UPDATED,(_,{details:I})=>m(I)),p.on(T.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const v=(_,I)=>{const b=this.getAssetPlayer(d);if(b&&I.tracks){b.off(T.BUFFER_CODECS,v),b.tracks=I.tracks;const L=this.primaryMedia;this.bufferingAsset===b.assetItem&&L&&!b.media&&this.bufferAssetPlayer(b,L)}};p.on(T.BUFFER_CODECS,v);const y=()=>{var _;const I=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${I}`),!I||!this.schedule)return;const b=this.schedule.findEventIndex(e.identifier),L=(_=this.schedule.items)==null?void 0:_[b];this.isInterstitial(L)&&this.advanceAssetBuffering(L,t)};p.on(T.BUFFERED_TO_END,y);const E=_=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const b=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,b,_)};return p.once(T.MEDIA_ENDED,E(r)),p.once(T.PLAYOUT_LIMIT_REACHED,E(1/0)),p.on(T.ERROR,(_,I)=>{if(!this.schedule)return;const b=this.getAssetPlayer(d);if(I.details===B.BUFFER_STALLED_ERROR){if(b!=null&&b.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${I.error} ${e}`)}),p.on(T.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const I=new Error(`Asset player destroyed unexpectedly ${d}`),b={fatal:!0,type:ve.OTHER_ERROR,details:B.INTERSTITIAL_ASSET_ITEM_ERROR,error:I};this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),r,I.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${As(t)}`),this.hls.trigger(T.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:p}),p}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const i=this.playerQueue[r];this.log(`clear ${i} toSegment: ${t&&er(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(r,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,s){const{interstitial:a,assetItem:o,assetId:u}=e,l=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==u)&&(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${As(o)}`),this.hls.trigger(T.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,i;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),u=(r=this.schedule.items)==null?void 0:r[o];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=a;const l=this.getBufferingPlayer();if(l===e)return;const c=s.appendInPlace;if(c&&(l==null?void 0:l.interstitial.appendInPlace)===!1)return;const d=(l==null?void 0:l.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!Vv(d,e.tracks)){const f=new Error(`Asset ${As(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:ve.OTHER_ERROR,details:B.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=s.findAssetIndex(a);this.handleAssetItemError(h,s,o,p,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const i=r.currentTime,s=t.findAssetIndex(e,i),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const u=o.currentTime||i-a.timelineStart,l=o.duration-u;if(this.warn(`Stalled at ${u} of ${u+l} in ${o} ${e} (media.currentTime: ${i})`),u&&(l/r.playbackRate<.5||o.bufferedInPlaceToEnd(r))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,i,s){if(e.details===B.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&As(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",u=this.getAssetPlayerQueueIndex(o),l=this.playerQueue[u]||null,c=this.schedule.items,d=nt({},e,{fatal:!1,errorAction:zs(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:r,player:l});if(this.hls.trigger(T.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,p=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=p),!t.assetList.some(g=>!g.error))t.error=p;else for(let g=i;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,r,i):h&&h.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let i=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${er(r)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const a=this.updateItem(r,i);this.itemsMatch(r,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var r,i;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(a)))return;const u=s.timelineStart,l=s.duration;let c=0;o.forEach((g,m)=>{const v=parseFloat(g.DURATION);this.createAsset(s,m,c,u+c,v,g.URI),c+=v}),s.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${l}) ${s}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const h=(i=this.bufferingItem)==null?void 0:i.event;if(f){var p;const g=this.schedule.findEventIndex(a),m=(p=this.schedule.items)==null?void 0:p[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){s.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(m)}this.setSchedulePosition(g)}else if((h==null?void 0:h.identifier)===a){const g=s.assetList[0];if(g){const m=this.getAssetPlayer(g.identifier);if(h.appendInPlace){const v=this.primaryMedia;m&&v&&this.bufferAssetPlayer(m,v)}else m&&m.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case B.ASSET_LIST_PARSING_ERROR:case B.ASSET_LIST_LOAD_ERROR:case B.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case B.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const e0=500;class ZR extends rp{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",pe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=z.IDLE,this.setInterval(e0),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragContextChanged(r)||(Rt(r)&&(this.fragPrevious=r),this.state=z.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=r.start;for(let l=0;l<s.length;l++)if(o>=s[l].start&&o<=s[l].end){a=s[l];break}const u=r.start+r.duration;a?a.end=u:(a={start:o,end:u},s.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,s,pe.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===pe.SUBTITLE&&(t.details===B.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==z.STOPPED&&(this.state=z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&KE(this.levels,t)){this.levels=t.map(r=>new vo(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new vo(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,pe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==z.STOPPED&&this.setInterval(e0)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const u=s[o];if(o>=s.length||!u)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||(r=u.details)!=null&&r.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!u.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Fu(a,d),l=a.fragmentStart):f&&(l=f.start,Pf(a,l));else{var c;l=this.alignPlaylists(a,u.details,(c=this.levelLastLoaded)==null?void 0:c.details),l===0&&f&&(l=f.start,Pf(a,l))}d&&!this.startFragRequested&&this.setStartPosition(d,l)}u.details=a,this.levelLastLoaded=u,o===i&&(this.hls.trigger(T.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===z.IDLE&&(cs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&Ws(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,tp(i.method)).catch(o=>{throw s.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const u=performance.now();s.trigger(T.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:u}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=z.IDLE})}}doTick(){if(!this.media){this.state=z.IDLE;return}if(this.state===z.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:i}=this,s=this.getLoadPosition(),a=Me.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:u}=a,l=r.details,c=this.hls.maxBufferLength+l.levelTargetDuration;if(u>c)return;const d=l.fragments,f=d.length,h=l.edge;let p=null;const g=this.fragPrevious;if(o<h){const y=i.maxFragLookUpTolerance,E=o>h-y?0:y;p=cs(g,d,Math.max(d[0].start,o),E),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,r.details),!p)return;const m=p.sn-l.startSN,v=d[m-1];if(v&&v.cc===p.cc&&this.fragmentTracker.getState(v)===Mt.NOT_LOADED&&(p=v),this.fragmentTracker.getState(p)===Mt.NOT_LOADED){const y=this.mapToInitFragWhenRequired(p);y&&this.loadFragment(y,r,o)}}}loadFragment(e,t,r){Rt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new QR(this.tracksBuffered[this.currentTrackId]||[])}}class QR{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const JR={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},oT=n=>String.fromCharCode(JR[n]||n),tr=15,Br=100,ew={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},tw={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nw={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rw={25:2,26:4,29:6,30:8,31:10,27:13,28:15},iw=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class sw{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;et.log(`${this.time} [${e}] ${r}`)}}}const Ki=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class lT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class aw{constructor(){this.uchar=" ",this.penState=new lT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class ow{constructor(e){this.chars=[],this.pos=0,this.currPenState=new lT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Br;t++)this.chars.push(new aw);this.logger=e}equals(e){for(let t=0;t<Br;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Br;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Br;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Br&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Br)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=oT(e);if(this.pos>=Br){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Br;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Br;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class md{constructor(e){this.rows=[],this.currRow=tr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<tr;t++)this.rows.push(new ow(e));this.logger=e}reset(){for(let e=0;e<tr;e++)this.rows[e].clear();this.currRow=tr-1}equals(e){let t=!0;for(let r=0;r<tr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<tr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<tr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+it(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<tr;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,u=this.logger.time;if(o!==null&&u!==null&&o<u)for(let l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(a.rows[s+l])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+it(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<tr;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class t0{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new md(r),this.nonDisplayedMemory=new md(r),this.lastOutputScreen=new md(r),this.currRollUpRow=this.displayedMemory.rows[tr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[tr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+it(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class n0{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=uw(),this.logger=void 0;const i=this.logger=new sw;this.channels=[null,new t0(e,t,i),new t0(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Ki([t[r],t[r+1]])+"] -> ("+Ki([i,s])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(lw(i,s,u)){bl(null,null,u),this.logger.log(3,()=>"Repeated command ("+Ki([i,s])+") is dropped");continue}bl(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else bl(null,null,u);if(!a&&(o=this.parseChars(i,s),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ki([i,s])+" orig: "+Ki([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ki([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?ew[e]:nw[e]:r=a===1?tw[e]:rw[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+oT(a)+"' in channel "+r),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ki(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=iw[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}bl(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function bl(n,e,t){t.a=n,t.b=e}function lw(n,e,t){return t.a===n&&t.b===e}function uw(){return{a:null,b:null}}var gp=function(){if(Mu!=null&&Mu.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,u){if(typeof u!="string"||!Array.isArray(o))return!1;const l=u.toLowerCase();return~o.indexOf(l)?l:!1}function r(o){return t(n,o)}function i(o){return t(e,o)}function s(o,...u){let l=1;for(;l<arguments.length;l++){const c=arguments[l];for(const d in c)o[d]=c[d]}return o}function a(o,u,l){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,p=o,g=u,m=l,v=null,y="",E=!0,_="auto",I="start",b=50,L="middle",w=50,D="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(R){f=""+R}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return h},set:function(R){h=!!R}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return g},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");g=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return m},set:function(R){m=""+R,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return v},set:function(R){v=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return y},set:function(R){const N=r(R);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return E},set:function(R){E=!!R,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return _},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");_=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return I},set:function(R){const N=i(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");I=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return b},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");b=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return L},set:function(R){const N=i(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");L=N,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return w},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");w=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return D},set:function(R){const N=i(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");D=N,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class cw{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function uT(n){function e(r,i,s,a){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class dw{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function cT(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],u=a[1];e(o,u)}}const $f=new gp(0,0,""),kl=$f.align==="middle"?"middle":"center";function fw(n,e,t){const r=n;function i(){const o=uT(n);if(o===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,u){const l=new dw;cT(o,function(f,h){let p;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===h){l.set(f,t[g].region);break}break;case"vertical":l.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),l.integer(f,p[0]),l.percent(f,p[0])&&l.set("snapToLines",!1),l.alt(f,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",kl,"end"]);break;case"position":p=h.split(","),l.percent(f,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",kl,"end","line-left","line-right","auto"]);break;case"size":l.percent(f,h);break;case"align":l.alt(f,h,["start",kl,"end","left","right"]);break}},/:/,/\s/),u.region=l.get("region",null),u.vertical=l.get("vertical","");let c=l.get("line","auto");c==="auto"&&$f.line===-1&&(c=-1),u.line=c,u.lineAlign=l.get("lineAlign","start"),u.snapToLines=l.get("snapToLines",!0),u.size=l.get("size",100),u.align=l.get("align",kl);let d=l.get("position","auto");d==="auto"&&$f.position===50&&(d=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),a(),e.endTime=i(),a(),s(n,e)}function dT(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class hw{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new cw,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,a=0;for(s=dT(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){cT(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new gp(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{fw(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const pw=/\r\n|\n\r|\n|\r/g,yd=function(e,t,r=0){return e.slice(r,r+t.length)===t},gw=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ue(t)||!ue(r)||!ue(i)||!ue(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t};function mp(n,e,t){return Xa(n.toString())+Xa(e.toString())+Xa(t)}const mw=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function yw(n,e,t,r,i,s,a){const o=new hw,u=On(new Uint8Array(n)).trim().replace(pw,`
`).split(`
`),l=[],c=e?_1(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,p,g=!0;o.oncue=function(m){const v=t[r];let y=t.ccOffset;const E=(f-c)/9e4;if(v!=null&&v.new&&(h!==void 0?y=t.ccOffset=v.start:mw(t,r,E)),E){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}y=E-t.presentationOffset}const _=m.endTime-m.startTime,I=Rn((m.startTime+y-h)*9e4,i*9e4)/9e4;m.startTime=Math.max(I,0),m.endTime=Math.max(I+_,0);const b=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(b)),m.id||(m.id=mp(m.startTime,m.endTime,b)),m.endTime>0&&l.push(m)},o.onparsingerror=function(m){p=m},o.onflush=function(){if(p){a(p);return}s(l)},u.forEach(m=>{if(g)if(yd(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(v=>{yd(v,"LOCAL:")?d=v.slice(6):yd(v,"MPEGTS:")&&(f=parseInt(v.slice(7)))});try{h=gw(d)/1e3}catch(v){p=v}return}else m===""&&(g=!1);o.parse(m+`
`)}),o.flush()}const vd="stpp.ttml.im1t",fT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,hT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,vw={left:"start",center:"center",right:"end",start:"start",end:"end"};function r0(n,e,t,r){const i=Ge(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>On(o)),a=x1(e.baseTime,1,e.timescale);try{s.forEach(o=>t(Ew(o,a)))}catch(o){r(o)}}function Ew(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),o=i.getAttribute("xml:space")!=="preserve",u=i0(Ed(i,"styling","style")),l=i0(Ed(i,"layout","region")),c=Ed(i,"body","[begin]");return[].map.call(c,d=>{const f=pT(d,o);if(!f||!d.hasAttribute("begin"))return null;const h=Sd(d.getAttribute("begin"),a),p=Sd(d.getAttribute("dur"),a);let g=Sd(d.getAttribute("end"),a);if(h===null)throw s0(d);if(g===null){if(p===null)throw s0(d);g=h+p}const m=new gp(h-e,g-e,f);m.id=mp(m.startTime,m.endTime,m.text);const v=l[d.getAttribute("region")],y=u[d.getAttribute("style")],E=Tw(v,y,u),{textAlign:_}=E;if(_){const I=vw[_];I&&(m.lineAlign=I),m.align=_}return nt(m,E),m}).filter(d=>d!==null)}function Ed(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function i0(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function pT(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?pT(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function Tw(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,u)=>{const l=Td(e,r,u)||Td(n,r,u)||Td(i,r,u);return l&&(o[u]=l),o},{})}function Td(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function s0(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Sd(n,e){if(!n)return null;let t=uT(n);return t===null&&(fT.test(n)?t=Sw(n,e):hT.test(n)&&(t=xw(n,e))),t}function Sw(n,e){const t=fT.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function xw(n,e){const t=hT.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Dl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class _w{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o0(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Dl(this,"textTrack1"),t=new Dl(this,"textTrack2"),r=new Dl(this,"textTrack3"),i=new Dl(this,"textTrack4");this.cea608Parser1=new n0(1,e,t),this.cea608Parser2=new n0(3,r,i)}addCues(e,t,r,i,s){let a=!1;for(let o=s.length;o--;){const u=s[o],l=Aw(u[0],u[1],t,r);if(l>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],r),a=!0,l/(r-t)>.5))return}if(a||s.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,i)}else{const o=this.Cues.newCue(null,t,r,i);this.hls.trigger(T.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;r===pe.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(T.FRAG_LOADED,u):this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(a0(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)r[e]=o,Us(r[e]),iT(r[e],i);else{const u=this.createTextTrack("captions",s,a);u&&(u[e]=!0,r[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{Us(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o0(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Us(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===vd);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(KE(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?ru(a.textTracks):null;if(this.tracks.forEach((u,l)=>{let c;if(o){let d=null;for(let f=0;f<o.length;f++)if(o[f]&&a0(o[f],u)){d=o[f],o[f]=null;break}d&&(c=d)}if(c)Us(c);else{const d=gT(u);c=this.createTextTrack(d,u.name,u.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const u=o.filter(l=>l!==null).map(l=>l.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===pe.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:u,sn:l}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&a&&(l!==o+1||l===o&&c!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=u,this.lastSn=l,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===pe.SUBTITLE)if(i.byteLength){const s=r.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===vd?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;r0(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{r.logger.log(`Failed to parse IMSC1: ${i}`),r.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[r.cc]&&o===-1){a.push(e);return}const u=this.hls,l=(t=r.initSegment)!=null&&t.data?Xn(r.initSegment.data,new Uint8Array(i)).buffer:i;yw(l,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),u.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,i),u.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>r.cc)&&u.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||r0(t,this.initPTS[e.cc],()=>{r.textCodec=vd,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>sT(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(T.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===pe.SUBTITLE&&this.onFragLoaded(T.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:i}=t;if(!(r.type===pe.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(u=>Bf(o[u],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(u=>Bf(o[u],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const a=e[i++],o=127&e[i++],u=127&e[i++];if(o===0&&u===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(u))}}return t}}function gT(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function a0(n,e){return!!n&&n.kind===gT(e)&&Of(e,n)}function Aw(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function o0(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Iw=/\s/,Lw={newCue(n,e,t,r){const i=[];let s,a,o,u,l;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(s=r.rows[f],o=!0,u=0,l="",!s.isEmpty()){var d;for(let g=0;g<s.chars.length;g++)Iw.test(s.chars[g].uchar)&&o?u++:(l+=s.chars[g].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const h=dT(l.trim()),p=mp(e,t,h);n!=null&&(d=n.cues)!=null&&d.getCueById(p)||(a=new c(e,t,h),a.id=p,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(a))}return n&&i.length&&(i.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),i.forEach(f=>sT(n,f))),i}};function Rw(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const ww=/(\d+)-(\d+)\/(\d+)/;class l0{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Pw,this.controller=new self.AbortController,this.stats=new Yh}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=bw(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&ue(u)?u:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(So(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},l-(h-i.loading.start)),!d.ok){const{status:g,statusText:m}=d;throw new Cw(m||"fetch, bad network response",g,d)}i.loading.first=h,i.total=Dw(d.headers)||i.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&ue(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,p):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const g=d[o];g&&(i.loaded=i.total=g);const m={url:p.url,data:d,code:p.status},v=(f=this.callbacks)==null?void 0:f.onProgress;v&&!ue(t.highWaterMark)&&v(i,e,d,p),(h=this.callbacks)==null||h.onSuccess(m,i,e,p)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const h=d&&d.code||0,p=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:p},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const a=new IE,o=e.body.getReader(),u=()=>o.read().then(l=>{if(l.done)return a.dataLength&&s(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=l.value,d=c.length;return t.loaded+=d,d<i||a.dataLength?(a.push(c),a.dataLength>=i&&s(t,r,a.flush().buffer,e)):s(t,r,c.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function bw(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(nt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function kw(n){const e=ww.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Dw(n){const e=n.get("Content-Range");if(e){const r=kw(e);if(ue(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function Pw(n,e){return new self.Request(n.url,e)}class Cw extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const Nw=/^age:\s*[\d.]+\s*$/im;class mT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Yh,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=r.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&ue(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const l=t.status,c=t.responseType==="text"?t.responseText:null;if(l>=200&&l<300){const p=c??t.response;if(p!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=t.responseType==="arraybuffer"?p.byteLength:p.length;r.loaded=r.total=g,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const m=(a=this.callbacks)==null?void 0:a.onProgress;m&&m(r,e,p,t);const v={url:t.responseURL,data:p,code:l};(o=this.callbacks)==null||o.onSuccess(v,r,e,t);return}}const d=s.loadPolicy.errorRetry,f=r.retry,h={url:e.url,data:void 0,code:l};if(Nu(d,f,!1,h))this.retry(d);else{var u;et.error(`${l} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:l,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Nu(e,t,!0))this.retry(e);else{var r;et.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Qh(e,r.retry),r.retry++,et.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Nw.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Ow={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Mw=Je(Je({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:mT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:YI,bufferController:U1,capLevelController:fp,errorController:JI,fpsController:BR,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:pE,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Ow},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Fw()),{},{subtitleStreamController:ZR,subtitleTrackController:VR,timelineController:_w,audioStreamController:N1,audioTrackController:O1,emeController:Ys,cmcdController:OR,contentSteeringController:FR,interstitialsController:XR});function Fw(){return{cueHandler:Lw,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Uw(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Gf(n),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,u=e[o]===void 0,l=[];s.forEach(c=>{const d=`${a}Loading${c}`,f=e[d];if(f!==void 0&&u){l.push(d);const h=r[o].default;switch(e[o]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),l.length&&t.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${it(e[o])}`)}),Je(Je({},r),e)}function Gf(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Gf):Object.keys(n).reduce((e,t)=>(e[t]=Gf(n[t]),e),{}):n}function Bw(n,e){const t=n.loader;t!==l0&&t!==mT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):Rw()&&(n.loader=l0,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const iu=2,$w=.1,Gw=.05,Vw=100;class jw extends uE{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Vw),this.mediaSource=t.mediaSource;const r=this.media=t.media;ln(r,"playing",this.onMediaPlaying),ln(r,"waiting",this.onMediaWaiting),ln(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(vn(r,"playing",this.onMediaPlaying),vn(r,"waiting",this.onMediaWaiting),vn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,u=this.seeking&&!o,l=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(l||u){u&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!1}));return}if(!Me.getBuffered(a).length){this.nudgeRetry=0;return}const d=Me.bufferInfo(a,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(o&&h&&this.hls){const b=u0(this.hls.inFlightFragments,e),L=d.len>iu,w=!f||b||f-e>iu&&!h.getPartialFragment(e);if(L||w)return;this.moved=!1}const p=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const L=Math.max(f,d.start||0)-e,D=!!(p!=null&&p.live)?p.targetduration*2:iu,R=Pl(e,h);if(L>0&&(L<=D||R)){a.paused||this._trySkipBufferHole(R);return}}const g=s.detectStallWithCurrentTimeMs,m=self.performance.now(),v=this.waiting;let y=this.stalled;if(y===null)if(v>0&&m-v<g)y=this.stalled=v;else{this.stalled=m;return}const E=m-y;if(!o&&(E>=g||v)&&this.hls){var _;if(((_=this.mediaSource)==null?void 0:_.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const I=Me.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(I,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(T.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&i&&i.length>1&&e>i.end(0)){const s=Me.bufferedInfo(Me.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=Me.timeRangesToArray(i),o=Me.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const u=Me.bufferedInfo(a,e,0).bufferedIndex,l=a[o].end,c=a[o+1].start;if((u===-1||u>o)&&c-l<1&&e-l<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${l} -> ${c} buffered index: ${u}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Pl(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=Me.bufferInfo(this.media,e,0);this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,r){var i,s;const{fragmentTracker:a,media:o}=this,u=(i=this.hls)==null?void 0:i.config;if(!o||!a||!u)return;const l=(s=this.hls)==null?void 0:s.latestLevelDetails,c=Pl(r,a);if((c||l!=null&&l.live&&r<l.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-r<u.maxBufferHole||f))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,i=e.nextStart;if(r&&i){const s=r.getFragAtPos(t,pe.MAIN),a=r.getFragAtPos(i,pe.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:i,stalled:s}=this;if(!i&&s!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${it(e)})`);this.warn(a.message),t.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!r||!s)return 0;const a=i.currentTime,o=Me.bufferInfo(i,a,0),u=a<o.start?o.start:o.nextStart;if(u&&this.hls){const c=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,f=u-a;if(f>0&&(c||d)){if(f>s.maxBufferHole){let p=!1;if(a===0){const g=r.getAppendedFrag(0,pe.MAIN);g&&u<g.end&&(p=!0)}if(!p&&e){var l;if(!((l=this.hls.loadLevelObj)!=null&&l.details)||u0(this.hls.inFlightFragments,u))return 0;let m=!1,v=e.end;for(;v<u;){const y=Pl(v,r);if(y)v+=y.duration;else{m=!0;break}}if(m)return 0}}const h=Math.max(u+Gw,a+$w);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${h}`),this.moved=!0,i.currentTime=h,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${h}`),g={type:ve.MEDIA_ERROR,details:B.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?g.part=e:g.frag=e),this.hls.trigger(T.ERROR,g)}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!r||!s)return 0;const a=r.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(u.message),r.currentTime=o,t.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function u0(n,e){const t=c0(n.main);if(t&&t.start<=e)return t;const r=c0(n.audio);return r&&r.start<=e?r:null}function c0(n){if(!n)return null;switch(n.state){case z.IDLE:case z.STOPPED:case z.ENDED:case z.ERROR:return null}return n.frag}function Pl(n,e){return e.getAppendedFrag(n,pe.MAIN)||e.getPartialFragment(n)}const Hw=.25;function Vf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function xd(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,it(i?Je({type:i},r):r))}return s}const Cl=(()=>{const n=Vf();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Kw{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(T.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Us(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return iT(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:i}=this.hls.config;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Vf();if(a)for(let o=0;o<s.length;o++){const u=s[o].type;if(u===bn.emsg&&!r||!i)continue;const l=PE(s[o].data),c=s[o].pts;let d=c+s[o].duration;d>Cl&&(d=Cl),d-c<=0&&(d=c+Hw);for(let h=0;h<l.length;h++){const p=l[h];if(!CE(p)){this.updateId3CueEnds(c,u);const g=xd(a,c,d,p,u);g&&this.id3Track.addCue(g)}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===Cl&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:u}}=a;if(s&&(o||u)){let l;i==="audio"?l=c=>c.type===bn.audioId3&&u:i==="video"?l=c=>c.type===bn.emsg&&o:l=c=>c.type===bn.audioId3&&u||c.type===bn.emsg&&o,Bf(s,t,r,l)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=Vf();if(r&&i&&!a){const{fragmentStart:g,fragmentEnd:m}=e;let v=this.assetCue;v?(v.startTime=g,v.endTime=m):o&&(v=this.assetCue=xd(o,g,m,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),v&&(v.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(v),v.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:u}=this,{dateRanges:l}=e,c=Object.keys(l);let d=this.dateRangeCuesAppended;if(u&&t){var f;if((f=u.cues)!=null&&f.length){const g=Object.keys(d).filter(m=>!c.includes(m));for(let m=g.length;m--;){var h;const v=g[m],y=(h=d[v])==null?void 0:h.cues;delete d[v],y&&Object.keys(y).forEach(E=>{const _=y[E];if(_){_.removeEventListener("enter",this.onEventCueEnter);try{u.removeCue(_)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(c.length===0||!ue(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let g=0;g<c.length;g++){const m=c[g],v=l[m],y=v.startTime,E=d[m],_=(E==null?void 0:E.cues)||{};let I=(E==null?void 0:E.durationKnown)||!1,b=Cl;const{duration:L,endDate:w}=v;if(w&&L!==null)b=y+L,I=!0;else if(v.endOnNext&&!I){const R=c.reduce((N,G)=>{if(G!==v.id){const ee=l[G];if(ee.class===v.class&&ee.startDate>v.startDate&&(!N||v.startDate<N.startDate))return ee}return N},null);R&&(b=R.startTime,I=!0)}const D=Object.keys(v.attr);for(let R=0;R<D.length;R++){const N=D[R];if(!fL(N))continue;const G=_[N];if(G)I&&!(E!=null&&E.durationKnown)?G.endTime=b:Math.abs(G.startTime-y)>.01&&(G.startTime=y,G.endTime=b);else if(o){let ee=v.attr[N];hL(N)&&(ee=jv(ee));const re=xd(o,y,b,{key:N,data:ee},bn.dateRange);re&&(re.id=m,this.id3Track.addCue(re),_[N]=re,a&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&re.addEventListener("enter",this.onEventCueEnter))}}d[m]={cues:_,dateRange:v,durationKnown:I}}}}}class zw{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const u=i-o,l=Math.min(this.maxLatency,o+r.targetduration);if(u<l&&u>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,u=this.hls.userConfig;let l=o&&r||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:a*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,a=i-r.totalduration,o=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===B.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Ww extends dp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,u=!1,l=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:h}=c;f&&(c.audioCodec=f=ku(f,r)||void 0),h&&(h=c.videoCodec=bI(h));const{width:p,height:g,unknownCodecs:m}=c,v=(m==null?void 0:m.length)||0;if(o||(o=!!(p&&g)),u||(u=!!h),l||(l=!!f),v||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:y,"FRAME-RATE":E,"HDCP-LEVEL":_,"PATHWAY-ID":I,RESOLUTION:b,"VIDEO-RANGE":L}=d,D=`${`${I||"."}-`}${c.bitrate}-${b}-${E}-${y}-${L}-${_}`;if(s[D])if(s[D].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const R=a[D]+=1;c.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const N=this.createLevel(c);s[D]=N,i.push(N)}else s[D].addGroupId("audio",d.AUDIO),s[D].addGroupId("text",d.SUBTITLES);else{const R=this.createLevel(c);s[D]=R,a[D]=1,i.push(R)}}),this.filterAndSortMediaOptions(i,t,o,u,l)}createLevel(e){const t=new vo(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(i.message),t.supportedResult=tE(i,[])}return t}isAudioSupported(e){return mo(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return mo(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,s){var a;let o=[],u=[],l=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((r||i)&&s&&(l=l.filter(({videoCodec:y,videoRange:E,width:_,height:I})=>(!!y||!!(_&&I))&&BI(E))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",E=y;t.levels.length&&(E=`one or more CODECS in variant not supported: ${it(t.levels.map(I=>I.attrs.CODECS).filter((I,b,L)=>L.indexOf(I)===b))}`,this.warn(E),y+=` (${E})`);const _=new Error(y);this.hls.trigger(T.ERROR,{type:ve.MEDIA_ERROR,details:B.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:_,reason:E})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),d0(o)),t.subtitles&&(u=t.subtitles,d0(u));const d=l.slice(0);l.sort((y,E)=>{if(y.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&y.height!==E.height)return y.height-E.height;if(y.frameRate!==E.frameRate)return y.frameRate-E.frameRate;if(y.videoRange!==E.videoRange)return Du.indexOf(y.videoRange)-Du.indexOf(E.videoRange);if(y.videoCodec!==E.videoCodec){const _=nm(y.videoCodec),I=nm(E.videoCodec);if(_!==I)return I-_}if(y.uri===E.uri&&y.codecSet!==E.codecSet){const _=bu(y.codecSet),I=bu(E.codecSet);if(_!==I)return I-_}return y.averageBitrate!==E.averageBitrate?y.averageBitrate-E.averageBitrate:0});let f=d[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==d.length)){for(let y=0;y<d.length;y++)if(d[y].pathwayId===l[0].pathwayId){f=d[y];break}}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===f){var h;this._firstLevel=y;const E=f.bitrate,_=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${E}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const I=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);I>_&&_===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=I)}break}const p=s&&!i,g=this.hls.config,m=!!(g.audioStreamController&&g.audioTrackController),v={levels:l,audioTracks:o,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:m&&!p&&o.some(y=>!!y.url)};c.end=performance.now(),this.hls.trigger(T.MANIFEST_PARSED,v)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${s?" with Pathway "+s:""}`);const u={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(T.LEVEL_SWITCHING,u);const l=a.details;if(!l||l.live){const c=this.switchParams(a.uri,i==null?void 0:i.details,l);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===He.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===pe.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let u=a.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(T.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));xE(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(T.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(T.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function d0(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function yT(){return self.SourceBuffer||self.WebKitSourceBuffer}function vT(){if(!ki())return!1;const e=yT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Yw(){if(!vT())return!1;const n=ki();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(yo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(yo(e,"audio"))))}function qw(){var n;const e=yT();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const Xw=100;class Zw extends rp{constructor(e,t,r){super(e,t,r,"stream-controller",pe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!ue(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,pe.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(Xw),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=z.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case z.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],i=r==null?void 0:r.details;if(i&&(!i.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(i))break;this.state=z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=z.IDLE;break}break}case z.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const a=r[s],o=this.getMainFwdBufferInfo();if(o===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(o,u)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(T.BUFFER_EOS,g),this.state=z.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const l=a.details;if(!l||this.state===z.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=z.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let h=this.getNextFragment(f,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&Rt(h)&&this.fragmentTracker.getState(h)!==Mt.OK){var p;const m=((p=this.backtrackFragment)!=null?p:h).sn-l.startSN,v=l.fragments[m-1];v&&h.cc===v.cc&&(h=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const m=this.audioOnly&&!this.altAudio?rt.AUDIO:rt.VIDEO,v=(m===rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,m,pe.MAIN)}h=this.getNextFragmentLoopLoading(h,l,o,pe.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);i===Mt.NOT_LOADED||i===Mt.PARTIAL?Rt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,pe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,u=e[o],l=this.fragLastKbps;l&&this.fragCurrent?r=this.fragCurrent.duration*u.maxBitrate/(1e3*l)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const u=o.maxStartPTS?o.maxStartPTS:o.start,l=o.duration,c=Math.max(a.end,u+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case z.KEY_LOADING:case z.FRAG_LOADING:case z.FRAG_LOADING_WAITING_RETRY:case z.PARSING:case z.PARSED:this.state=z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;ln(r,"playing",this.onMediaPlaying),ln(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(vn(r,"playing",this.onMediaPlaying),vn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(T.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&i&&!qw(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==z.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=z.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,u=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${u}`);const l=t.levelInfo,c=this.fragCurrent;c&&(this.state===z.FRAG_LOADING||this.state===z.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=l.details)!=null&&r.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,l.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(l.details=o,this.levelLastLoaded=l,s||this.setStartPosition(o,d),this.hls.trigger(T.LEVEL_UPDATED,{details:o,level:a}),this.state===z.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=z.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,u=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&r.duration>i&&(s<i||!u)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&r.readyState<4||s<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var l;const d=Me.bufferInfo(r,i,0);if(!((l=d.buffered)!=null&&l.length)){r.currentTime=i;return}if(d.start<=s){r.currentTime=i;return}const{nextStart:h}=Me.bufferedInfo(d.buffered,s,0);h&&(r.currentTime=h)}else r.currentTime=i}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const u=o.details;if(!u){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const l=o.videoCodec,c=u.PTSKnown||!u.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new HE(this.hls,pe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,g=p!==-1,m=new ep(r.level,r.sn,r.stats.chunkCount,s.byteLength,p,g),v=this.initPTS[r.cc];h.push(s,d,f,l,r,i,u.totalduration,c,m,v)}onAudioTrackSwitching(e,t){const r=this.hls,i=this.altAudio!==0;if(Pu(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(T.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(T.AUDIO_TRACK_SWITCHED,t)}),r.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(T.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Pu(t.url,this.hls);if(r){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,a=!1;for(const o in r){const u=r[o];if(u.id==="main"){if(s=o,i=u,o==="video"){const l=r[o];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t,s=r.type===pe.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===z.PARSED&&(this.state=z.IDLE);return}const o=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Rt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}const a=this.media;a&&(!this._hasEnoughToStart&&Me.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case B.FRAG_GAP:case B.FRAG_PARSING_ERROR:case B.FRAG_DECRYPT_ERROR:case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.MAIN,t);break;case B.LEVEL_LOAD_ERROR:case B.LEVEL_LOAD_TIMEOUT:case B.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===He.LEVEL&&(this.state=z.IDLE);break;case B.BUFFER_ADD_CODEC_ERROR:case B.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case B.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case B.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=z.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==rt.AUDIO||!this.altAudio){const r=(t===rt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,pe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&r&&(r+=i);const s=this.getLevelDetails(),a=Me.getBuffered(e),o=a.length?a.start(0):0,u=o-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<l||this.loadingParts&&u<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),r+=u,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this,s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(T.FRAG_LOADED,r),s.bitrateTest=!1}).catch(r=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:u,level:l}=a,{video:c,text:d,id3:f,initSegment:h}=i,{details:p}=l,g=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=z.PARSING,h){const m=h.tracks;if(m){const _=o.initSegment||o;if(this.unhandledEncryptionError(h,o))return;this._bufferInitSegment(l,m,_,s),r.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:t,tracks:m})}const v=h.initPTS,y=h.timescale,E=this.initPTS[o.cc];if(ue(v)&&(!E||E.baseTime!==v||E.timescale!==y)){const _=h.trackId;this.initPTS[o.cc]={baseTime:v,timescale:y,trackId:_},r.trigger(T.INIT_PTS_FOUND,{frag:o,id:t,initPTS:v,timescale:y,trackId:_})}}if(c&&p){g&&c.type==="audiovideo"&&this.logMuxedErr(o);const m=p.fragments[o.sn-1-p.startSN],v=o.sn===p.startSN,y=!m||o.cc>m.cc;if(i.independent!==!1){const{startPTS:E,endPTS:_,startDTS:I,endDTS:b}=c;if(u)u.elementaryStreams[c.type]={startPTS:E,endPTS:_,startDTS:I,endDTS:b};else if(c.firstKeyFrame&&c.independent&&s.id===1&&!y&&(this.couldBacktrack=!0),c.dropped&&c.independent){const L=this.getMainFwdBufferInfo(),w=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,D=c.firstKeyFramePTS?c.firstKeyFramePTS:E;if(!v&&w<D-this.config.maxBufferHole&&!y){this.backtrack(o);return}else y&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,_,o.start,b,!0)}else v&&E-(p.appliedTimelineOffset||0)>iu&&(o.gap=!0);o.setElementaryStreamInfo(c.type,E,_,I,b),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,u,s,v||y)}else if(v||y)o.gap=!0;else{this.backtrack(o);return}}if(g){const{startPTS:m,endPTS:v,startDTS:y,endDTS:E}=g;u&&(u.elementaryStreams[rt.AUDIO]={startPTS:m,endPTS:v,startDTS:y,endDTS:E}),o.setElementaryStreamInfo(rt.AUDIO,m,v,y,E),this.bufferFragmentData(g,o,u,s)}if(p&&f!=null&&f.samples.length){const m={id:t,frag:o,details:p,samples:f.samples};r.trigger(T.FRAG_PARSING_METADATA,m)}if(p&&d){const m={id:t,frag:o,details:p,samples:d.samples};r.trigger(T.FRAG_PARSING_USERDATA,m)}}logMuxedErr(e){this.warn(`${Rt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,i){if(this.state!==z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:s,video:a,audiovideo:o}=t;if(s){const l=e.audioCodec;let c=Zl(s.codec,l);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),l&&l!==c&&this.log(`Swapping manifest audio codec "${l}" for "${c}"`),s.levelCodec=c,s.id=pe.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${l||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=pe.MAIN;const l=a.codec;if((l==null?void 0:l.length)===4)switch(l){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${l}]${a.codec!==l?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(T.BUFFER_CODECS,t),!this.hls)return;u.forEach(l=>{const d=t[l].initSegment;d!=null&&d.byteLength&&this.hls.trigger(T.BUFFER_APPENDING,{type:l,data:d,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,pe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=z.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Me.isBuffered(e,r)?t=this.getAppendedFrag(r):Me.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(T.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(T.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ue(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ue(t)){const r=this.getLevelDetails(),i=this.currentFrag||(r?cs(null,r.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Qw extends Qn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=B.KEY_LOAD_ERROR,r,i,s){return new Vr({type:ve.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const a=t[i];if(e.cc<=a.cc&&(!Rt(e)||!Rt(a)||e.sn<a.sn)||!r&&i==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const u=Jl(o);if(u)return this.emeController.getKeySystemAccess([u])})}if(this.config.requireKeySystemAccessOnStart){const i=Oa(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const l=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,l))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=_d(s);let u=this.keyIdToKeyInfo[o];if((r=u)!=null&&r.decryptdata.key)return s.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(this.emeController&&(i=u)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(u.decryptdata)){case"usable":case"usable-in-future":return u.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return s.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${s.keyId?" keyId: "+Kt(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),u=this.keyIdToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=yI(t.initSegment.data);if(a.length){let o=a[0];o.some(u=>u!==0)?(this.log(`Using keyId found in init segment ${Kt(o)}`),Ri.setKeyIdForUri(e.decryptdata.uri,o)):(o=Ri.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Kt(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Rt(t))return Promise.resolve(r);const s=this.emeController.loadKey(r);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,r))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=r.keyLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{const{frag:m,keyInfo:v}=p,y=_d(v.decryptdata);if(!m.decryptdata||v!==this.keyIdToKeyInfo[y])return o(this.createKeyLoadError(m,B.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));v.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,v.loader=null,a({frag:m,keyInfo:v})},onError:(f,h,p,g)=>{this.resetLoader(h),o(this.createKeyLoadError(t,B.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,Je({url:u.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(t,B.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(t,B.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(u,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null);const a=_d(r.decryptdata)||i;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function _d(n){if(n.keyFormat!==zt.FAIRPLAY){const e=n.keyId;if(e)return Kt(e)}return n.uri}function f0(n){const{type:e}=n;switch(e){case He.AUDIO_TRACK:return pe.AUDIO;case He.SUBTITLE_TRACK:return pe.SUBTITLE;default:return pe.MAIN}}function Ad(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Jw{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:He.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:u}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:He.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:He.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:He.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[He.LEVEL];if(r){const i=r.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(r.abort(),delete this.loaders[He.LEVEL])}}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const l=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?l.log(`[playlist-loader]: ignore ${e.url} ongoing request`):l.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}l.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===He.MANIFEST?s=r.manifestLoadPolicy.default:s=nt({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),ue((t=e.deliveryDirectives)==null?void 0:t.part)){let l;if(e.type===He.LEVEL&&e.level!==null?l=this.hls.levels[e.level].details:e.type===He.AUDIO_TRACK&&e.id!==null?l=this.hls.audioTracks[e.id].details:e.type===He.SUBTITLE_TRACK&&e.id!==null&&(l=this.hls.subtitleTracks[e.id].details),l){const c=l.partTarget,d=l.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=nt({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(l,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=l.data;c.parsing.start=performance.now(),xr.isMediaPlaylist(p)||d.type!==He.MANIFEST?this.handleTrackOrLevelPlaylist(l,c,d,f||null,h):this.handleMasterPlaylist(l,c,d,f)},onError:(l,c,d,f)=>{this.handleNetworkError(c,d,!1,l,f)},onTimeout:(l,c,d)=>{this.handleNetworkError(c,d,!0,void 0,l)}};i.load(e,o,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){const s=this.hls,a=e.data,o=Ad(e,r),u=xr.parseMasterPlaylist(a,o);if(u.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,u.playlistParsingError,i,t);return}const{contentSteering:l,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=u;this.variableList=p,c.forEach(y=>{const{unknownCodecs:E}=y;if(E){const{preferManagedMediaSource:_}=this.hls.config;let{audioCodec:I,videoCodec:b}=y;for(let L=E.length;L--;){const w=E[L];mo(w,"audio",_)?(y.audioCodec=I=I?`${I},${w}`:w,ia.audio[I.substring(0,4)]=2,E.splice(L,1)):mo(w,"video",_)&&(y.videoCodec=b=b?`${b},${w}`:w,ia.video[b.substring(0,4)]=2,E.splice(L,1))}}});const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":v}=xr.parseMasterPlaylistMedia(a,o,u);g.length&&!g.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new pt({}),bitrate:0,url:""})),s.trigger(T.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,captions:v,contentSteering:l,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,i,s){const a=this.hls,{id:o,level:u,type:l}=r,c=Ad(e,r),d=ue(u)?u:ue(o)?o:0,f=f0(r),h=xr.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(l===He.MANIFEST){const p={attrs:new pt({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+EE(h,0),a.trigger(T.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(T.ERROR,{type:ve.NETWORK_ERROR,details:B.MANIFEST_PARSING_ERROR,fatal:t.type===He.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let a=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===He.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===He.AUDIO_TRACK||e.type===He.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let u=B.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case He.MANIFEST:u=r?B.MANIFEST_LOAD_TIMEOUT:B.MANIFEST_LOAD_ERROR,l=!0;break;case He.LEVEL:u=r?B.LEVEL_LOAD_TIMEOUT:B.LEVEL_LOAD_ERROR,l=!1;break;case He.AUDIO_TRACK:u=r?B.AUDIO_TRACK_LOAD_TIMEOUT:B.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case He.SUBTITLE_TRACK:u=r?B.SUBTITLE_TRACK_LOAD_TIMEOUT:B.SUBTITLE_LOAD_ERROR,l=!1;break}c&&this.resetInternalLoader(e.type);const d={type:ve.NETWORK_ERROR,details:u,fatal:l,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;d.response=Je({url:f,data:void 0},i)}this.hls.trigger(T.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,a){const o=this.hls,{type:u,level:l,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:h}=i,p=Ad(t,i),g=f0(i);let m=typeof i.level=="number"&&g===pe.MAIN?l:void 0;const v=e.playlistParsingError;if(v){if(this.hls.logger.warn(`${v} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(T.ERROR,{type:ve.NETWORK_ERROR,details:B.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:v,reason:v.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(T.ERROR,{type:ve.NETWORK_ERROR,details:B.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:y,reason:y.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case He.MANIFEST:case He.LEVEL:if(m){if(!c)m=0;else if(c!==o.levels[m]){const y=o.levels.indexOf(c);y>-1&&(m=y)}}o.trigger(T.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:m||0,id:d||0,stats:r,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:u===He.MANIFEST});break;case He.AUDIO_TRACK:o.trigger(T.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:r,networkDetails:s,deliveryDirectives:h});break;case He.SUBTITLE_TRACK:o.trigger(T.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:r,networkDetails:s,deliveryDirectives:h});break}}}class kn{static get version(){return Eo}static isMSESupported(){return vT()}static isSupported(){return Yw()}static getMediaSource(){return ki()}static get Events(){return T}static get MetadataSchema(){return bn}static get ErrorTypes(){return ve}static get ErrorDetails(){return B}static get DefaultConfig(){return kn.defaultConfig?kn.defaultConfig:Mw}static set DefaultConfig(e){kn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ip,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=sI(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=Uw(kn.DefaultConfig,e,t);this.userConfig=e,r.progressive&&Bw(r,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:u}=r,l=new o(this),c=this.abrController=new i(this),d=new eL(this),f=r.interstitialsController,h=f?this.interstitialsController=new f(this,kn):null,p=this.bufferController=new s(this,d),g=this.capLevelController=new a(this),m=new u(this),v=new Jw(this),y=r.contentSteeringController,E=y?new y(this):null,_=this.levelController=new Ww(this,E),I=new Kw(this),b=new Qw(this.config,this.logger),L=this.streamController=new Zw(this,d,b),w=this.gapController=new jw(this,d);g.setStreamController(L),m.setStreamController(L);const D=[v,_,L];h&&D.splice(1,0,h),E&&D.splice(1,0,E),this.networkControllers=D;const R=[c,p,w,g,m,I,d];this.audioTrackController=this.createController(r.audioTrackController,D);const N=r.audioStreamController;N&&D.push(this.audioStreamController=new N(this,d,b)),this.subtitleTrackController=this.createController(r.subtitleTrackController,D);const G=r.subtitleStreamController;G&&D.push(this.subtititleStreamController=new G(this,d,b)),this.createController(r.timelineController,R),b.emeController=this.emeController=this.createController(r.emeController,R),this.cmcdController=this.createController(r.cmcdController,R),this.latencyController=this.createController(zw,R),this.coreComponents=R,D.push(l);const ee=l.onErrorOut;typeof ee=="function"&&this.on(T.ERROR,ee,l),this.on(T.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===T.ERROR;this.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(T.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(T.ERROR,{type:ve.OTHER_ERROR,details:B.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(T.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(T.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(T.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,i=this._url=Wh.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(T.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[pe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[pe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[pe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=jR()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){UI(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=iE(t);return nE(e,r,navigator.mediaCapabilities)}}kn.defaultConfig=void 0;const eb=({url:n,isPlaying:e,volume:t,seekTime:r,onTimeUpdate:i,onDurationChange:s,onEnded:a,onBuffer:o})=>{const u=Ee.useRef(null),l=Ee.useRef(null),c=Ee.useRef(null),d=Ee.useRef(null),[f,h]=Ee.useState(null),[p,g]=Ee.useState(null),m=Ee.useRef(null),v=b=>b?b.includes("/proxy/")?b:b.startsWith("http")?`/proxy/${b}`:b:"",y=b=>/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(b)?{type:"youtube",cleanUrl:b.replace(/\/shorts\//,"/watch?v=")}:{type:"hls",cleanUrl:b},E=b=>{try{const D=new URL(b);if(D.hostname.includes("youtube.com")){if(D.searchParams.has("v"))return D.searchParams.get("v");if(D.pathname.startsWith("/embed/")||D.pathname.startsWith("/v/"))return D.pathname.split("/")[2]}if(D.hostname.includes("youtu.be"))return D.pathname.slice(1)}catch{}const L=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,w=b.match(L);return w&&w[2].length===11?w[2]:null};Ee.useEffect(()=>{var w;if(!n)return;const{type:b,cleanUrl:L}=y(n);if(g(b),h(null),o(!0),l.current&&(l.current.destroy(),l.current=null),d.current&&(clearInterval(d.current),d.current=null),m.current&&(clearTimeout(m.current),m.current=null),b==="hls")c.current&&(c.current.destroy(),c.current=null),setTimeout(()=>{const D=u.current;if(D)if(kn.isSupported()){const R=new kn({enableWorker:!0,lowLatencyMode:!1,maxBufferLength:30,backBufferLength:90,startFragPrefetch:!0,xhrSetup:(N,G)=>{if(G.startsWith("http")&&!G.includes(window.location.origin)){const ee=v(G);N.open("GET",ee)}}});R.loadSource(L),R.attachMedia(D),R.on(kn.Events.ERROR,(N,G)=>{if(G.fatal)switch(G.type){case kn.ErrorTypes.NETWORK_ERROR:console.log("HLS Network error, trying to recover..."),R.startLoad();break;case kn.ErrorTypes.MEDIA_ERROR:console.log("HLS Media error, trying to recover..."),R.recoverMediaError();break;default:console.error("HLS Fatal error",G),h(`Stream Error: ${G.details}`),R.destroy();break}}),R.on(kn.Events.MANIFEST_PARSED,()=>{e&&D.play().catch(N=>console.warn("Autoplay blocked/failed",N)),o(!1)}),l.current=R}else D.canPlayType("application/vnd.apple.mpegurl")?D.src=v(L):h("HLS is not supported in this browser.")},0);else{const D=E(L.trim());if(!D){h("Invalid YouTube URL"),o(!1);return}const R=()=>{if(window.YT){if(c.current&&c.current.loadVideoById){c.current.loadVideoById(D);return}c.current=new window.YT.Player("youtube-player",{height:"100%",width:"100%",videoId:D,host:`${window.location.protocol}//${window.location.host}/yts`,playerVars:{playsinline:1,controls:0,enablejsapi:1,widget_referrer:window.location.href,origin:window.location.origin},events:{onReady:()=>{o(!1),s(c.current.getDuration()),e&&c.current.playVideo()},onStateChange:N=>{N.data===window.YT.PlayerState.BUFFERING&&o(!0),N.data===window.YT.PlayerState.PLAYING&&o(!1),N.data===window.YT.PlayerState.ENDED&&a()},onError:N=>{console.error("YouTube Player Error",N),N.data===150||N.data===101?h("This video cannot be played (Embed blocked by owner)."):h(`YouTube Error Code: ${N.data}`)}}})}};if(window.YT)R();else{const N=document.createElement("script");N.src="/yt/iframe_api";const G=document.querySelector("script[nonce]"),ee=document.querySelector('meta[property="csp-nonce"]'),oe=(G==null?void 0:G.nonce)||(G==null?void 0:G.getAttribute("nonce"))||(ee==null?void 0:ee.getAttribute("content"));oe&&N.setAttribute("nonce",oe),window.onYouTubeIframeAPIReady=R;const re=document.getElementsByTagName("script")[0];(w=re.parentNode)==null||w.insertBefore(N,re)}d.current=window.setInterval(()=>{c.current&&c.current.getCurrentTime&&(i(c.current.getCurrentTime()),c.current.getDuration&&s(c.current.getDuration()))},500)}return()=>{d.current&&clearInterval(d.current)}},[n]),Ee.useEffect(()=>{m.current&&clearTimeout(m.current),m.current=window.setTimeout(()=>{if(p==="hls"){const b=u.current;if(!b)return;if(e){const L=b.play();L!==void 0&&L.catch(w=>{console.log("Play interrupted or blocked",w)})}else b.pause()}else p==="youtube"&&c.current&&c.current.playVideo&&(e?c.current.playVideo():c.current.pauseVideo())},100)},[e,p]),Ee.useEffect(()=>{r!==null&&requestAnimationFrame(()=>{p==="hls"&&u.current?Math.abs(u.current.currentTime-r)>.5&&(u.current.currentTime=r):p==="youtube"&&c.current&&c.current.seekTo&&c.current.seekTo(r,!0)})},[r,p]),Ee.useEffect(()=>{p==="hls"&&u.current?(u.current.volume=t,u.current.muted=t===0):p==="youtube"&&c.current&&c.current.setVolume&&(c.current.setVolume(t*100),t===0?c.current.mute():c.current.unMute())},[t,p]);const _=()=>{u.current&&i(u.current.currentTime)},I=()=>{u.current&&s(u.current.duration)};return P.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-black relative",children:[f&&P.jsxs("div",{className:"absolute top-4 left-4 right-4 z-50 bg-red-500/90 text-white p-3 rounded-md text-sm shadow-lg backdrop-blur-sm border border-red-400",children:[P.jsx("p",{className:"font-bold",children:"Playback Error"}),P.jsx("p",{className:"opacity-90",children:f})]}),p==="hls"&&P.jsx("video",{ref:u,className:"w-full h-full object-contain",onTimeUpdate:_,onLoadedMetadata:I,onDurationChange:I,onEnded:a,onWaiting:()=>o(!0),onCanPlay:()=>o(!1),onPlaying:()=>o(!1),onStalled:()=>o(!0),playsInline:!0,autoPlay:!0}),P.jsx("div",{id:"youtube-player",className:`${p==="youtube"?"block":"hidden"} w-full h-full`})]})},h0="1460502909149253813",tb="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",nb=[{name:"Bunny (Cartoon)",url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},{name:"Sintel (Animation)",url:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"},{name:"Tears of Steel (Sci-Fi)",url:"https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8"}];var rb={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ib=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ht=(n,e)=>{const t=Ee.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,children:o,...u},l)=>Ee.createElement("svg",{ref:l,...rb,width:i,height:i,stroke:r,strokeWidth:a?Number(s)*24/Number(i):s,className:`lucide lucide-${ib(n)}`,...u},[...e.map(([c,d])=>Ee.createElement(c,d)),...(Array.isArray(o)?o:[o])||[]]));return t.displayName=`${n}`,t},sb=ht("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ab=ht("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ob=ht("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),lb=ht("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),ub=ht("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),yp=ht("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),cb=ht("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),db=ht("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),fb=ht("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),p0=ht("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),hb=ht("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),pb=ht("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ET=ht("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),gb=ht("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),TT=ht("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]),ST=ht("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),vp=ht("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),mb=ht("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),xT=ht("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),yb=ht("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_T=ht("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),vb=ht("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Eb=ht("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),AT=ht("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Tb=({videoState:n,showControls:e,isFullscreen:t,onPlayPause:r,onUrlSubmit:i,onSeek:s,onVolumeChange:a,onToggleFullscreen:o,onOpenSaveModal:u})=>{const[l,c]=Ee.useState(""),[d,f]=Ee.useState(!1),[h,p]=Ee.useState(null),[g,m]=Ee.useState(null),[v,y]=Ee.useState(0),E=Ee.useRef(null),_=N=>{if(!N||isNaN(N))return"00:00";const G=Math.floor(N/3600),ee=Math.floor(N%3600/60),oe=Math.floor(N%60);return G>0?`${G}:${ee.toString().padStart(2,"0")}:${oe.toString().padStart(2,"0")}`:`${ee.toString().padStart(2,"0")}:${oe.toString().padStart(2,"0")}`},I=N=>{if(!E.current||!n.duration)return;const G=E.current.getBoundingClientRect(),ee=(N.clientX-G.left)/G.width;s(ee*n.duration)},b=N=>{if(!E.current||!n.duration)return;const G=E.current.getBoundingClientRect(),ee=(N.clientX-G.left)/G.width;y(N.clientX-G.left),m(Math.max(0,Math.min(ee*n.duration,n.duration)))},L=N=>{p(null);const G=N.trim();G&&i(G)},w=N=>{N.preventDefault(),L(l)},D=N=>{c(N),L(N)},R=n.duration?n.currentTime/n.duration*100:0;return P.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent p-4 transition-opacity duration-300 ${e?"opacity-100":"opacity-0"}`,onClick:N=>N.stopPropagation(),children:[P.jsxs("div",{className:"group/progress relative w-full h-1 bg-gray-600/50 hover:bg-gray-600 rounded-full mb-4 cursor-pointer hover:h-1.5 transition-all touch-none",ref:E,onClick:I,onMouseMove:b,onMouseLeave:()=>m(null),children:[P.jsx("div",{className:"absolute top-0 left-0 h-full bg-red-600 rounded-full",style:{width:`${R}%`}}),P.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-3.5 h-3.5 bg-white rounded-full shadow-md scale-0 group-hover/progress:scale-100 transition-transform",style:{left:`${R}%`,transform:`translate(-50%, -50%) scale(${e?1:0})`}}),g!==null&&P.jsx("div",{className:"absolute bottom-4 bg-black/90 text-white text-xs px-1.5 py-0.5 rounded -translate-x-1/2 pointer-events-none whitespace-nowrap border border-gray-700",style:{left:v},children:_(g)})]}),P.jsxs("div",{className:"flex flex-col gap-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{className:"flex items-center gap-4",children:[P.jsx("button",{onClick:()=>r(!n.isPlaying),className:"hover:text-white text-gray-200 transition-colors",children:n.isPlaying?P.jsx(ST,{size:24,fill:"currentColor"}):P.jsx(vp,{size:24,fill:"currentColor"})}),P.jsxs("div",{className:"flex items-center gap-2 group/vol",children:[P.jsx("button",{onClick:()=>a(n.volume===0?1:0),className:"hover:text-white text-gray-200",children:n.volume===0?P.jsx(Eb,{size:20}):P.jsx(vb,{size:20})}),P.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:n.volume,onChange:N=>a(parseFloat(N.target.value)),onClick:N=>N.stopPropagation(),className:"w-0 overflow-hidden group-hover/vol:w-24 transition-all h-1 bg-white/30 rounded-lg appearance-none cursor-pointer hover:bg-white"})]}),P.jsxs("div",{className:"text-xs text-gray-300 font-mono",children:[_(n.currentTime)," / ",_(n.duration)]})]}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsxs("form",{onSubmit:w,className:"hidden md:flex items-center bg-black/40 rounded-full border border-white/10 focus-within:border-white/30 transition-colors",children:[P.jsx("input",{type:"text",placeholder:"Link / YT...",value:l,onChange:N=>c(N.target.value),className:"bg-transparent border-none text-xs text-white px-3 py-1.5 w-40 focus:outline-none"}),P.jsx("button",{type:"submit",className:"pr-3 pl-1 text-gray-400 hover:text-white",children:P.jsx(hb,{size:14})})]}),P.jsx("button",{onClick:u,disabled:!n.url,className:`p-2 hover:bg-white/10 rounded-full ${n.url?"text-yellow-400 hover:text-yellow-300":"text-gray-500 cursor-not-allowed"}`,title:"Save to Library",children:P.jsx(xT,{size:20,fill:n.url?"currentColor":"none"})}),P.jsx("button",{onClick:()=>f(!d),className:"p-2 hover:bg-white/10 rounded-full text-gray-300",title:"Help",children:P.jsx(fb,{size:20})}),P.jsx("button",{onClick:o,className:"p-2 hover:bg-white/10 rounded-full text-gray-300",title:t?"Exit Fullscreen":"Fullscreen",children:t?P.jsx(TT,{size:20}):P.jsx(ET,{size:20})})]})]}),h&&P.jsxs("div",{className:"flex items-center gap-2 text-yellow-500 text-xs px-1 bg-black/60 p-2 rounded w-fit",children:[P.jsx(sb,{size:12}),P.jsx("span",{children:h})]}),!n.url&&P.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[P.jsx("button",{onClick:()=>D(tb),className:"text-xs bg-white/10 hover:bg-white/20 px-2 py-1 rounded text-gray-200",children:"Test HLS"}),nb.map((N,G)=>P.jsx("button",{onClick:()=>D(N.url),className:"text-xs bg-white/10 hover:bg-white/20 px-2 py-1 rounded text-gray-200",children:N.name},G))]})]}),d&&P.jsxs("div",{className:"absolute bottom-full right-4 mb-2 w-64 bg-[#202225] p-3 rounded-md text-xs text-gray-300 shadow-xl border border-gray-700",children:[P.jsx("h3",{className:"font-bold text-white mb-1",children:"Supported Formats:"}),P.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-1 mb-1",children:[P.jsxs("li",{children:[P.jsx("strong",{children:"HLS:"})," .m3u8 links"]}),P.jsxs("li",{children:[P.jsx("strong",{children:"YouTube:"})," Standard & Shorts"]})]}),P.jsx("div",{className:"mt-2 text-gray-400 italic",children:"For HLS: Press F12  Network  Filter 'm3u8'"}),P.jsx("button",{onClick:()=>f(!1),className:"text-blue-400 hover:underline mt-1 w-full text-center",children:"Close"})]})]})},Sb=({isHost:n,partyCode:e})=>{const[t,r]=Ee.useState(!1),i=()=>{e&&(navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3))};return P.jsxs("header",{className:"h-16 bg-[#2f3136] border-b border-[#202225] flex items-center px-4 justify-between shrink-0 shadow-md z-10",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("div",{className:"bg-[#5865F2] p-2 rounded-lg",children:P.jsx(cb,{className:"text-white",size:20})}),P.jsxs("div",{children:[P.jsx("h1",{className:"font-bold text-white tracking-wide hidden sm:block",children:"TwinCinema"}),P.jsx("p",{className:"text-[10px] text-gray-400 font-mono uppercase tracking-wider",children:"HLS Sync Activity"})]})]}),P.jsxs("div",{className:"flex items-center gap-3",children:[e&&P.jsxs("div",{onClick:i,className:"flex items-center gap-1.5 px-3 py-1 bg-[#202225] hover:bg-[#292b2f] border border-[#2f3136] rounded-full cursor-pointer transition-colors group",title:"Click to copy Party Code",children:[P.jsx(db,{size:14,className:"text-gray-400 group-hover:text-white"}),P.jsx("span",{className:"text-xs font-mono font-medium text-gray-300 group-hover:text-white select-all",children:e}),t?P.jsx(lb,{size:12,className:"text-green-500"}):P.jsx(ub,{size:12,className:"text-gray-500 group-hover:text-white opacity-0 group-hover:opacity-100 transition-opacity"})]}),n&&P.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded-full",children:[P.jsx(yp,{size:14,className:"text-yellow-500"}),P.jsx("span",{className:"text-xs font-bold text-yellow-500",children:"HOST"})]}),P.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-[#202225] rounded-full hidden sm:flex",children:[P.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),P.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Connected"})]})]})]})},xb=({user:n,participants:e,hostId:t,isOpen:r,onClose:i,onPromoteUser:s,onPlayLibraryItem:a})=>{const[o,u]=Ee.useState("users"),[l,c]=Ee.useState([]);Ee.useEffect(()=>{const h=()=>{try{const p=localStorage.getItem("tc_favorites");p&&c(JSON.parse(p))}catch(p){console.error("Failed to load favorites",p)}};return h(),window.addEventListener("storage",h),window.addEventListener("favoritesUpdated",h),()=>{window.removeEventListener("storage",h),window.removeEventListener("favoritesUpdated",h)}},[]);const d=(h,p)=>{p.stopPropagation();const g=l.filter(m=>m.id!==h);c(g),localStorage.setItem("tc_favorites",JSON.stringify(g)),window.dispatchEvent(new Event("favoritesUpdated"))},f=h=>{(n==null?void 0:n.id)===t&&h.id!==t&&s(h.id,h.username)};return P.jsxs(P.Fragment,{children:[r&&P.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-sm",onClick:i}),P.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50
        w-72 bg-[#2f3136] flex flex-col border-r border-[#202225]
        transform transition-transform duration-300 ease-in-out shadow-2xl lg:shadow-none
        ${r?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,children:[P.jsx("div",{className:"lg:hidden absolute top-2 right-2",children:P.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white p-1",children:P.jsx(AT,{size:20})})}),P.jsxs("div",{className:"flex border-b border-[#202225] bg-[#292b2f]",children:[P.jsxs("button",{onClick:()=>u("users"),className:`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${o==="users"?"text-white border-b-2 border-[#5865F2] bg-[#36393f]":"text-[#b9bbbe] hover:bg-[#32353b]"}`,children:[P.jsx(_T,{size:16})," Participants"]}),P.jsxs("button",{onClick:()=>u("library"),className:`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${o==="library"?"text-white border-b-2 border-[#5865F2] bg-[#36393f]":"text-[#b9bbbe] hover:bg-[#32353b]"}`,children:[P.jsx(p0,{size:16})," Your Library"]})]}),P.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:o==="users"?P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"text-xs font-bold text-[#8e9297] uppercase mb-3 px-2",children:["Participants  ",e.length]}),e.length>0?e.map(h=>P.jsxs("div",{onDoubleClick:()=>f(h),className:`flex items-center gap-3 px-2 py-2 rounded transition-colors group select-none ${h.id!==t&&(n==null?void 0:n.id)===t?"cursor-pointer hover:bg-[#36393f] active:bg-[#40444b]":"hover:bg-[#36393f]"}`,title:(n==null?void 0:n.id)===t&&h.id!==t?"Double-click to make Host":"",children:[P.jsxs("div",{className:"relative",children:[P.jsx("img",{src:h.avatar?`https://cdn.discordapp.com/avatars/${h.id}/${h.avatar}.png`:"https://cdn.discordapp.com/embed/avatars/0.png",alt:h.username,className:"w-8 h-8 rounded-full bg-[#202225]"}),P.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#2f3136] rounded-full"})]}),P.jsxs("div",{className:"overflow-hidden flex-1",children:[P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx("span",{className:`font-medium text-sm truncate ${h.id===t?"text-yellow-400":"text-white"}`,children:h.username}),h.id===t&&P.jsx(yp,{size:12,className:"text-yellow-400 fill-yellow-400"})]}),P.jsx("div",{className:"text-xs text-[#b9bbbe]",children:h.id===t?"Hosting":"Watching"})]})]},h.id)):P.jsx("div",{className:"px-2 text-sm text-gray-500 italic",children:"No one else is here..."})]}):P.jsxs(P.Fragment,{children:[P.jsxs("div",{className:"text-xs font-bold text-[#8e9297] uppercase mb-3 px-2",children:["Saved Media  ",l.length]}),l.length>0?P.jsx("div",{className:"space-y-2",children:l.map(h=>P.jsx("div",{onClick:()=>a(h.url,h.timestamp),className:"group bg-[#202225] p-3 rounded hover:bg-[#36393f] transition-colors cursor-pointer border border-transparent hover:border-[#40444b]",children:P.jsxs("div",{className:"flex justify-between items-start",children:[P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("div",{className:"font-medium text-sm text-gray-200 truncate pr-2",children:h.name}),P.jsx("div",{className:"text-[10px] text-gray-500 truncate mt-0.5",children:h.url}),h.timestamp>0&&P.jsxs("div",{className:"text-[10px] text-[#5865F2] mt-1 flex items-center gap-1",children:[P.jsx(vp,{size:10,fill:"currentColor"})," Starts at ",new Date(h.timestamp*1e3).toISOString().substr(14,5)]})]}),P.jsx("button",{onClick:p=>d(h.id,p),className:"text-gray-500 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:P.jsx(yb,{size:14})})]})},h.id))}):P.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center px-4",children:[P.jsx(p0,{size:32,className:"text-[#40444b] mb-2"}),P.jsx("p",{className:"text-sm text-gray-400",children:"Nothing here!"}),P.jsx("p",{className:"text-xs text-gray-500",children:"Save something first."})]})]})}),P.jsx("div",{className:"bg-[#292b2f] p-3 flex items-center gap-2",children:n?P.jsxs(P.Fragment,{children:[P.jsx("img",{src:n.avatar?`https://cdn.discordapp.com/avatars/${n.id}/${n.avatar}.png`:"https://cdn.discordapp.com/embed/avatars/0.png",alt:"Me",className:"w-8 h-8 rounded-full"}),P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("div",{className:"text-sm font-bold text-white truncate",children:n.username}),P.jsxs("div",{className:"text-xs text-[#b9bbbe] truncate",children:["#",n.discriminator]})]})]}):P.jsx("div",{className:"text-xs text-gray-500",children:"Loading User..."})})]})]})};var Nl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function IT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Id={exports:{}},g0;function _b(){return g0||(g0=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||u,f),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],h]:u._events[p].push(h):(u._events[p]=h,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new r:delete u._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,c,d,f,h,p){var g=t?t+l:l;if(!this._events[g])return!1;var m=this._events[g],v=arguments.length,y,E;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,d),!0;case 4:return m.fn.call(m.context,c,d,f),!0;case 5:return m.fn.call(m.context,c,d,f,h),!0;case 6:return m.fn.call(m.context,c,d,f,h,p),!0}for(E=1,y=new Array(v-1);E<v;E++)y[E-1]=arguments[E];m.fn.apply(m.context,y)}else{var _=m.length,I;for(E=0;E<_;E++)switch(m[E].once&&this.removeListener(l,m[E].fn,void 0,!0),v){case 1:m[E].fn.call(m[E].context);break;case 2:m[E].fn.call(m[E].context,c);break;case 3:m[E].fn.call(m[E].context,c,d);break;case 4:m[E].fn.call(m[E].context,c,d,f);break;default:if(!y)for(I=1,y=new Array(v-1);I<v;I++)y[I-1]=arguments[I];m[E].fn.apply(m[E].context,y)}}return!0},o.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},o.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},o.prototype.removeListener=function(l,c,d,f){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return a(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&a(this,h);else{for(var g=0,m=[],v=p.length;g<v;g++)(p[g].fn!==c||f&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[h]=m.length===1?m[0]:m:a(this,h)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Id)),Id.exports}var Ab=_b(),Ib=IT(Ab),We;(function(n){n.assertEqual=i=>i;function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const s={};for(const a of i)s[a]=a;return s},n.getValidEnumValues=i=>{const s=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(const o of s)a[o]=i[o];return n.objectValues(a)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},n.find=(i,s)=>{for(const a of i)if(s(a))return a},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(We||(We={}));var jf;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(jf||(jf={}));const he=We.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),gi=n=>{switch(typeof n){case"undefined":return he.undefined;case"string":return he.string;case"number":return isNaN(n)?he.nan:he.number;case"boolean":return he.boolean;case"function":return he.function;case"bigint":return he.bigint;case"symbol":return he.symbol;case"object":return Array.isArray(n)?he.array:n===null?he.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?he.promise:typeof Map<"u"&&n instanceof Map?he.map:typeof Set<"u"&&n instanceof Set?he.set:typeof Date<"u"&&n instanceof Date?he.date:he.object;default:return he.unknown}},ne=We.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Lb=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Mn extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),r}static assert(e){if(!(e instanceof Mn))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,We.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Mn.create=n=>new Mn(n);const aa=(n,e)=>{let t;switch(n.code){case ne.invalid_type:n.received===he.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ne.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,We.jsonStringifyReplacer)}`;break;case ne.unrecognized_keys:t=`Unrecognized key(s) in object: ${We.joinValues(n.keys,", ")}`;break;case ne.invalid_union:t="Invalid input";break;case ne.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${We.joinValues(n.options)}`;break;case ne.invalid_enum_value:t=`Invalid enum value. Expected ${We.joinValues(n.options)}, received '${n.received}'`;break;case ne.invalid_arguments:t="Invalid function arguments";break;case ne.invalid_return_type:t="Invalid function return type";break;case ne.invalid_date:t="Invalid date";break;case ne.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:We.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ne.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ne.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ne.custom:t="Invalid input";break;case ne.invalid_intersection_types:t="Intersection results could not be merged";break;case ne.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ne.not_finite:t="Number must be finite";break;default:t=e.defaultError,We.assertNever(n)}return{message:t}};let LT=aa;function Rb(n){LT=n}function $u(){return LT}const Gu=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,s=[...t,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},wb=[];function ce(n,e){const t=$u(),r=Gu({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===aa?void 0:aa].filter(i=>!!i)});n.common.issues.push(r)}class nn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return De;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const s=await i.key,a=await i.value;r.push({key:s,value:a})}return nn.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return De;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(r[s.value]=a.value)}return{status:e.value,value:r}}}const De=Object.freeze({status:"aborted"}),Bs=n=>({status:"dirty",value:n}),cn=n=>({status:"valid",value:n}),Hf=n=>n.status==="aborted",Kf=n=>n.status==="dirty",_o=n=>n.status==="valid",Ao=n=>typeof Promise<"u"&&n instanceof Promise;function Vu(n,e,t,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function RT(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var xe;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(xe||(xe={}));var Ma,Fa;class br{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const m0=(n,e)=>{if(_o(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Mn(n.common.issues);return this._error=t,this._error}}};function Ue(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;const{message:c}=n;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??t)!==null&&l!==void 0?l:o.defaultError}},description:i}}class Be{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return gi(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:gi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new nn,ctx:{common:e.parent.common,data:e.data,parsedType:gi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ao(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gi(e)},s=this._parseSync({data:e,path:i.path,parent:i});return m0(i,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:gi(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(Ao(i)?i:Promise.resolve(i));return m0(r,s)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const a=e(i),o=()=>s.addIssue({code:ne.custom,...r(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new cr({schema:this,typeName:be.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Lr.create(this,this._def)}nullable(){return Oi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return lr.create(this,this._def)}promise(){return la.create(this,this._def)}or(e){return wo.create([this,e],this._def)}and(e){return bo.create(this,e,this._def)}transform(e){return new cr({...Ue(this._def),schema:this,typeName:be.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new No({...Ue(this._def),innerType:this,defaultValue:t,typeName:be.ZodDefault})}brand(){return new Ep({typeName:be.ZodBranded,type:this,...Ue(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Oo({...Ue(this._def),innerType:this,catchValue:t,typeName:be.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ho.create(this,e)}readonly(){return Mo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const bb=/^c[^\s-]{8,}$/i,kb=/^[0-9a-z]+$/,Db=/^[0-9A-HJKMNP-TV-Z]{26}$/,Pb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Cb=/^[a-z0-9_-]{21}$/i,Nb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ob=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Mb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ld;const Fb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ub=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Bb=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,wT="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$b=new RegExp(`^${wT}$`);function bT(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Gb(n){return new RegExp(`^${bT(n)}$`)}function kT(n){let e=`${wT}T${bT(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Vb(n,e){return!!((e==="v4"||!e)&&Fb.test(n)||(e==="v6"||!e)&&Ub.test(n))}class sr extends Be{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==he.string){const s=this._getOrReturnCtx(e);return ce(s,{code:ne.invalid_type,expected:he.string,received:s.parsedType}),De}const r=new nn;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?ce(i,{code:ne.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&ce(i,{code:ne.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")Ob.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"email",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")Ld||(Ld=new RegExp(Mb,"u")),Ld.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"emoji",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Pb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"uuid",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Cb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"nanoid",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")bb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"cuid",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")kb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"cuid2",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Db.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"ulid",code:ne.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),ce(i,{validation:"url",code:ne.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"regex",code:ne.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?kT(s).test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?$b.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Gb(s).test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Nb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"duration",code:ne.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?Vb(e.data,s.version)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"ip",code:ne.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?Bb.test(e.data)||(i=this._getOrReturnCtx(e,i),ce(i,{validation:"base64",code:ne.invalid_string,message:s.message}),r.dirty()):We.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:ne.invalid_string,...xe.errToObj(r)})}_addCheck(e){return new sr({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...xe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...xe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...xe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...xe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...xe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...xe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...xe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...xe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...xe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...xe.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...xe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...xe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...xe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...xe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...xe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...xe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...xe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...xe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...xe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...xe.errToObj(t)})}nonempty(e){return this.min(1,xe.errToObj(e))}trim(){return new sr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}sr.create=n=>{var e;return new sr({checks:[],typeName:be.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ue(n)})};function jb(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,s=parseInt(n.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}class Pi extends Be{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==he.number){const s=this._getOrReturnCtx(e);return ce(s,{code:ne.invalid_type,expected:he.number,received:s.parsedType}),De}let r;const i=new nn;for(const s of this._def.checks)s.kind==="int"?We.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?jb(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.not_finite,message:s.message}),i.dirty()):We.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,xe.toString(t))}setLimit(e,t,r,i){return new Pi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:xe.toString(i)}]})}_addCheck(e){return new Pi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:xe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:xe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:xe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:xe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:xe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&We.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Pi.create=n=>new Pi({checks:[],typeName:be.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Ue(n)});class Ci extends Be{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==he.bigint){const s=this._getOrReturnCtx(e);return ce(s,{code:ne.invalid_type,expected:he.bigint,received:s.parsedType}),De}let r;const i=new nn;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ce(r,{code:ne.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):We.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,xe.toString(t))}setLimit(e,t,r,i){return new Ci({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:xe.toString(i)}]})}_addCheck(e){return new Ci({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:xe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ci.create=n=>{var e;return new Ci({checks:[],typeName:be.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ue(n)})};class Io extends Be{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==he.boolean){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.boolean,received:r.parsedType}),De}return cn(e.data)}}Io.create=n=>new Io({typeName:be.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Ue(n)});class ds extends Be{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==he.date){const s=this._getOrReturnCtx(e);return ce(s,{code:ne.invalid_type,expected:he.date,received:s.parsedType}),De}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return ce(s,{code:ne.invalid_date}),De}const r=new nn;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),ce(i,{code:ne.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):We.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ds({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:xe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:xe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ds.create=n=>new ds({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:be.ZodDate,...Ue(n)});class ju extends Be{_parse(e){if(this._getType(e)!==he.symbol){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.symbol,received:r.parsedType}),De}return cn(e.data)}}ju.create=n=>new ju({typeName:be.ZodSymbol,...Ue(n)});class Lo extends Be{_parse(e){if(this._getType(e)!==he.undefined){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.undefined,received:r.parsedType}),De}return cn(e.data)}}Lo.create=n=>new Lo({typeName:be.ZodUndefined,...Ue(n)});class Ro extends Be{_parse(e){if(this._getType(e)!==he.null){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.null,received:r.parsedType}),De}return cn(e.data)}}Ro.create=n=>new Ro({typeName:be.ZodNull,...Ue(n)});class oa extends Be{constructor(){super(...arguments),this._any=!0}_parse(e){return cn(e.data)}}oa.create=n=>new oa({typeName:be.ZodAny,...Ue(n)});class rs extends Be{constructor(){super(...arguments),this._unknown=!0}_parse(e){return cn(e.data)}}rs.create=n=>new rs({typeName:be.ZodUnknown,...Ue(n)});class ti extends Be{_parse(e){const t=this._getOrReturnCtx(e);return ce(t,{code:ne.invalid_type,expected:he.never,received:t.parsedType}),De}}ti.create=n=>new ti({typeName:be.ZodNever,...Ue(n)});class Hu extends Be{_parse(e){if(this._getType(e)!==he.undefined){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.void,received:r.parsedType}),De}return cn(e.data)}}Hu.create=n=>new Hu({typeName:be.ZodVoid,...Ue(n)});class lr extends Be{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==he.array)return ce(t,{code:ne.invalid_type,expected:he.array,received:t.parsedType}),De;if(i.exactLength!==null){const a=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(a||o)&&(ce(t,{code:a?ne.too_big:ne.too_small,minimum:o?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(ce(t,{code:ne.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(ce(t,{code:ne.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>i.type._parseAsync(new br(t,a,t.path,o)))).then(a=>nn.mergeArray(r,a));const s=[...t.data].map((a,o)=>i.type._parseSync(new br(t,a,t.path,o)));return nn.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new lr({...this._def,minLength:{value:e,message:xe.toString(t)}})}max(e,t){return new lr({...this._def,maxLength:{value:e,message:xe.toString(t)}})}length(e,t){return new lr({...this._def,exactLength:{value:e,message:xe.toString(t)}})}nonempty(e){return this.min(1,e)}}lr.create=(n,e)=>new lr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:be.ZodArray,...Ue(e)});function Is(n){if(n instanceof gt){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Lr.create(Is(r))}return new gt({...n._def,shape:()=>e})}else return n instanceof lr?new lr({...n._def,type:Is(n.element)}):n instanceof Lr?Lr.create(Is(n.unwrap())):n instanceof Oi?Oi.create(Is(n.unwrap())):n instanceof kr?kr.create(n.items.map(e=>Is(e))):n}class gt extends Be{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=We.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==he.object){const l=this._getOrReturnCtx(e);return ce(l,{code:ne.invalid_type,expected:he.object,received:l.parsedType}),De}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ti&&this._def.unknownKeys==="strip"))for(const l in i.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const c=s[l],d=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new br(i,d,i.path,l)),alwaysSet:l in i.data})}if(this._def.catchall instanceof ti){const l=this._def.unknownKeys;if(l==="passthrough")for(const c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(l==="strict")o.length>0&&(ce(i,{code:ne.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const c of o){const d=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new br(i,d,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const l=[];for(const c of u){const d=await c.key,f=await c.value;l.push({key:d,value:f,alwaysSet:c.alwaysSet})}return l}).then(l=>nn.mergeObjectSync(r,l)):nn.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return xe.errToObj,new gt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,s,a,o;const u=(a=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=xe.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new gt({...this._def,unknownKeys:"strip"})}passthrough(){return new gt({...this._def,unknownKeys:"passthrough"})}extend(e){return new gt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new gt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:be.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new gt({...this._def,catchall:e})}pick(e){const t={};return We.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new gt({...this._def,shape:()=>t})}omit(e){const t={};return We.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new gt({...this._def,shape:()=>t})}deepPartial(){return Is(this)}partial(e){const t={};return We.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}),new gt({...this._def,shape:()=>t})}required(e){const t={};return We.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Lr;)s=s._def.innerType;t[r]=s}}),new gt({...this._def,shape:()=>t})}keyof(){return DT(We.objectKeys(this.shape))}}gt.create=(n,e)=>new gt({shape:()=>n,unknownKeys:"strip",catchall:ti.create(),typeName:be.ZodObject,...Ue(e)});gt.strictCreate=(n,e)=>new gt({shape:()=>n,unknownKeys:"strict",catchall:ti.create(),typeName:be.ZodObject,...Ue(e)});gt.lazycreate=(n,e)=>new gt({shape:n,unknownKeys:"strip",catchall:ti.create(),typeName:be.ZodObject,...Ue(e)});class wo extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=s.map(o=>new Mn(o.ctx.common.issues));return ce(t,{code:ne.invalid_union,unionErrors:a}),De}if(t.common.async)return Promise.all(r.map(async s=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(i);{let s;const a=[];for(const u of r){const l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=a.map(u=>new Mn(u));return ce(t,{code:ne.invalid_union,unionErrors:o}),De}}get options(){return this._def.options}}wo.create=(n,e)=>new wo({options:n,typeName:be.ZodUnion,...Ue(e)});const $r=n=>n instanceof Do?$r(n.schema):n instanceof cr?$r(n.innerType()):n instanceof Po?[n.value]:n instanceof Ni?n.options:n instanceof Co?We.objectValues(n.enum):n instanceof No?$r(n._def.innerType):n instanceof Lo?[void 0]:n instanceof Ro?[null]:n instanceof Lr?[void 0,...$r(n.unwrap())]:n instanceof Oi?[null,...$r(n.unwrap())]:n instanceof Ep||n instanceof Mo?$r(n.unwrap()):n instanceof Oo?$r(n._def.innerType):[];class hc extends Be{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==he.object)return ce(t,{code:ne.invalid_type,expected:he.object,received:t.parsedType}),De;const r=this.discriminator,i=t.data[r],s=this.optionsMap.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(ce(t,{code:ne.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),De)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const s of t){const a=$r(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,s)}}return new hc({typeName:be.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Ue(r)})}}function zf(n,e){const t=gi(n),r=gi(e);if(n===e)return{valid:!0,data:n};if(t===he.object&&r===he.object){const i=We.objectKeys(e),s=We.objectKeys(n).filter(o=>i.indexOf(o)!==-1),a={...n,...e};for(const o of s){const u=zf(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===he.array&&r===he.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<n.length;s++){const a=n[s],o=e[s],u=zf(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===he.date&&r===he.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class bo extends Be{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(s,a)=>{if(Hf(s)||Hf(a))return De;const o=zf(s.value,a.value);return o.valid?((Kf(s)||Kf(a))&&t.dirty(),{status:t.value,value:o.data}):(ce(r,{code:ne.invalid_intersection_types}),De)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}bo.create=(n,e,t)=>new bo({left:n,right:e,typeName:be.ZodIntersection,...Ue(t)});class kr extends Be{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.array)return ce(r,{code:ne.invalid_type,expected:he.array,received:r.parsedType}),De;if(r.data.length<this._def.items.length)return ce(r,{code:ne.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),De;!this._def.rest&&r.data.length>this._def.items.length&&(ce(r,{code:ne.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new br(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>nn.mergeArray(t,a)):nn.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new kr({...this._def,rest:e})}}kr.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new kr({items:n,typeName:be.ZodTuple,rest:null,...Ue(e)})};class ko extends Be{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.object)return ce(r,{code:ne.invalid_type,expected:he.object,received:r.parsedType}),De;const i=[],s=this._def.keyType,a=this._def.valueType;for(const o in r.data)i.push({key:s._parse(new br(r,o,r.path,o)),value:a._parse(new br(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?nn.mergeObjectAsync(t,i):nn.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Be?new ko({keyType:e,valueType:t,typeName:be.ZodRecord,...Ue(r)}):new ko({keyType:sr.create(),valueType:e,typeName:be.ZodRecord,...Ue(t)})}}class Ku extends Be{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.map)return ce(r,{code:ne.invalid_type,expected:he.map,received:r.parsedType}),De;const i=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([o,u],l)=>({key:i._parse(new br(r,o,r.path,[l,"key"])),value:s._parse(new br(r,u,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return De;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return De;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}}}}Ku.create=(n,e,t)=>new Ku({valueType:e,keyType:n,typeName:be.ZodMap,...Ue(t)});class fs extends Be{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==he.set)return ce(r,{code:ne.invalid_type,expected:he.set,received:r.parsedType}),De;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(ce(r,{code:ne.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(ce(r,{code:ne.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function a(u){const l=new Set;for(const c of u){if(c.status==="aborted")return De;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}const o=[...r.data.values()].map((u,l)=>s._parse(new br(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new fs({...this._def,minSize:{value:e,message:xe.toString(t)}})}max(e,t){return new fs({...this._def,maxSize:{value:e,message:xe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}fs.create=(n,e)=>new fs({valueType:n,minSize:null,maxSize:null,typeName:be.ZodSet,...Ue(e)});class Xs extends Be{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==he.function)return ce(t,{code:ne.invalid_type,expected:he.function,received:t.parsedType}),De;function r(o,u){return Gu({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$u(),aa].filter(l=>!!l),issueData:{code:ne.invalid_arguments,argumentsError:u}})}function i(o,u){return Gu({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$u(),aa].filter(l=>!!l),issueData:{code:ne.invalid_return_type,returnTypeError:u}})}const s={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof la){const o=this;return cn(async function(...u){const l=new Mn([]),c=await o._def.args.parseAsync(u,s).catch(h=>{throw l.addIssue(r(u,h)),l}),d=await Reflect.apply(a,this,c);return await o._def.returns._def.type.parseAsync(d,s).catch(h=>{throw l.addIssue(i(d,h)),l})})}else{const o=this;return cn(function(...u){const l=o._def.args.safeParse(u,s);if(!l.success)throw new Mn([r(u,l.error)]);const c=Reflect.apply(a,this,l.data),d=o._def.returns.safeParse(c,s);if(!d.success)throw new Mn([i(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Xs({...this._def,args:kr.create(e).rest(rs.create())})}returns(e){return new Xs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Xs({args:e||kr.create([]).rest(rs.create()),returns:t||rs.create(),typeName:be.ZodFunction,...Ue(r)})}}class Do extends Be{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Do.create=(n,e)=>new Do({getter:n,typeName:be.ZodLazy,...Ue(e)});class Po extends Be{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ce(t,{received:t.data,code:ne.invalid_literal,expected:this._def.value}),De}return{status:"valid",value:e.data}}get value(){return this._def.value}}Po.create=(n,e)=>new Po({value:n,typeName:be.ZodLiteral,...Ue(e)});function DT(n,e){return new Ni({values:n,typeName:be.ZodEnum,...Ue(e)})}class Ni extends Be{constructor(){super(...arguments),Ma.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return ce(t,{expected:We.joinValues(r),received:t.parsedType,code:ne.invalid_type}),De}if(Vu(this,Ma)||RT(this,Ma,new Set(this._def.values)),!Vu(this,Ma).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return ce(t,{received:t.data,code:ne.invalid_enum_value,options:r}),De}return cn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ni.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ni.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Ma=new WeakMap;Ni.create=DT;class Co extends Be{constructor(){super(...arguments),Fa.set(this,void 0)}_parse(e){const t=We.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==he.string&&r.parsedType!==he.number){const i=We.objectValues(t);return ce(r,{expected:We.joinValues(i),received:r.parsedType,code:ne.invalid_type}),De}if(Vu(this,Fa)||RT(this,Fa,new Set(We.getValidEnumValues(this._def.values))),!Vu(this,Fa).has(e.data)){const i=We.objectValues(t);return ce(r,{received:r.data,code:ne.invalid_enum_value,options:i}),De}return cn(e.data)}get enum(){return this._def.values}}Fa=new WeakMap;Co.create=(n,e)=>new Co({values:n,typeName:be.ZodNativeEnum,...Ue(e)});class la extends Be{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==he.promise&&t.common.async===!1)return ce(t,{code:ne.invalid_type,expected:he.promise,received:t.parsedType}),De;const r=t.parsedType===he.promise?t.data:Promise.resolve(t.data);return cn(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}la.create=(n,e)=>new la({type:n,typeName:be.ZodPromise,...Ue(e)});class cr extends Be{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===be.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:a=>{ce(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const a=i.transform(r.data,s);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return De;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?De:u.status==="dirty"||t.value==="dirty"?Bs(u.value):u});{if(t.value==="aborted")return De;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?De:o.status==="dirty"||t.value==="dirty"?Bs(o.value):o}}if(i.type==="refinement"){const a=o=>{const u=i.refinement(o,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?De:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?De:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!_o(a))return a;const o=i.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>_o(a)?Promise.resolve(i.transform(a.value,s)).then(o=>({status:t.value,value:o})):a);We.assertNever(i)}}cr.create=(n,e,t)=>new cr({schema:n,typeName:be.ZodEffects,effect:e,...Ue(t)});cr.createWithPreprocess=(n,e,t)=>new cr({schema:e,effect:{type:"preprocess",transform:n},typeName:be.ZodEffects,...Ue(t)});class Lr extends Be{_parse(e){return this._getType(e)===he.undefined?cn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Lr.create=(n,e)=>new Lr({innerType:n,typeName:be.ZodOptional,...Ue(e)});class Oi extends Be{_parse(e){return this._getType(e)===he.null?cn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Oi.create=(n,e)=>new Oi({innerType:n,typeName:be.ZodNullable,...Ue(e)});class No extends Be{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===he.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}No.create=(n,e)=>new No({innerType:n,typeName:be.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ue(e)});class Oo extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ao(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Mn(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Mn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Oo.create=(n,e)=>new Oo({innerType:n,typeName:be.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ue(e)});class zu extends Be{_parse(e){if(this._getType(e)!==he.nan){const r=this._getOrReturnCtx(e);return ce(r,{code:ne.invalid_type,expected:he.nan,received:r.parsedType}),De}return{status:"valid",value:e.data}}}zu.create=n=>new zu({typeName:be.ZodNaN,...Ue(n)});const Hb=Symbol("zod_brand");class Ep extends Be{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ho extends Be{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?De:s.status==="dirty"?(t.dirty(),Bs(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?De:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new Ho({in:e,out:t,typeName:be.ZodPipeline})}}class Mo extends Be{_parse(e){const t=this._def.innerType._parse(e),r=i=>(_o(i)&&(i.value=Object.freeze(i.value)),i);return Ao(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}Mo.create=(n,e)=>new Mo({innerType:n,typeName:be.ZodReadonly,...Ue(e)});function Tp(n,e={},t){return n?oa.create().superRefine((r,i)=>{var s,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(a=(s=o.fatal)!==null&&s!==void 0?s:t)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...l,fatal:u})}}):oa.create()}const Kb={object:gt.lazycreate};var be;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(be||(be={}));const zb=(n,e={message:`Input not instance of ${n.name}`})=>Tp(t=>t instanceof n,e),M=sr.create,_e=Pi.create,Wb=zu.create,PT=Ci.create,Ne=Io.create,Yb=ds.create,qb=ju.create,Xb=Lo.create,pc=Ro.create,Zb=oa.create,Fo=rs.create,Qb=ti.create,Jb=Hu.create,ze=lr.create,se=gt.create,ek=gt.strictCreate,Sp=wo.create,tk=hc.create,nk=bo.create,rk=kr.create,ik=ko.create,sk=Ku.create,ak=fs.create,ok=Xs.create,lk=Do.create,Nt=Po.create,uk=Ni.create,ha=Co.create,ck=la.create,y0=cr.create,CT=Lr.create,dk=Oi.create,NT=cr.createWithPreprocess,fk=Ho.create,hk=()=>M().optional(),pk=()=>_e().optional(),gk=()=>Ne().optional(),mk={string:n=>sr.create({...n,coerce:!0}),number:n=>Pi.create({...n,coerce:!0}),boolean:n=>Io.create({...n,coerce:!0}),bigint:n=>Ci.create({...n,coerce:!0}),date:n=>ds.create({...n,coerce:!0})},yk=De;var ae=Object.freeze({__proto__:null,defaultErrorMap:aa,setErrorMap:Rb,getErrorMap:$u,makeIssue:Gu,EMPTY_PATH:wb,addIssueToContext:ce,ParseStatus:nn,INVALID:De,DIRTY:Bs,OK:cn,isAborted:Hf,isDirty:Kf,isValid:_o,isAsync:Ao,get util(){return We},get objectUtil(){return jf},ZodParsedType:he,getParsedType:gi,ZodType:Be,datetimeRegex:kT,ZodString:sr,ZodNumber:Pi,ZodBigInt:Ci,ZodBoolean:Io,ZodDate:ds,ZodSymbol:ju,ZodUndefined:Lo,ZodNull:Ro,ZodAny:oa,ZodUnknown:rs,ZodNever:ti,ZodVoid:Hu,ZodArray:lr,ZodObject:gt,ZodUnion:wo,ZodDiscriminatedUnion:hc,ZodIntersection:bo,ZodTuple:kr,ZodRecord:ko,ZodMap:Ku,ZodSet:fs,ZodFunction:Xs,ZodLazy:Do,ZodLiteral:Po,ZodEnum:Ni,ZodNativeEnum:Co,ZodPromise:la,ZodEffects:cr,ZodTransformer:cr,ZodOptional:Lr,ZodNullable:Oi,ZodDefault:No,ZodCatch:Oo,ZodNaN:zu,BRAND:Hb,ZodBranded:Ep,ZodPipeline:Ho,ZodReadonly:Mo,custom:Tp,Schema:Be,ZodSchema:Be,late:Kb,get ZodFirstPartyTypeKind(){return be},coerce:mk,any:Zb,array:ze,bigint:PT,boolean:Ne,date:Yb,discriminatedUnion:tk,effect:y0,enum:uk,function:ok,instanceof:zb,intersection:nk,lazy:lk,literal:Nt,map:sk,nan:Wb,nativeEnum:ha,never:Qb,null:pc,nullable:dk,number:_e,object:se,oboolean:gk,onumber:pk,optional:CT,ostring:hk,pipeline:fk,preprocess:NT,promise:ck,record:ik,set:ak,strictObject:ek,string:M,symbol:qb,transformer:y0,tuple:rk,undefined:Xb,union:Sp,unknown:Fo,void:Jb,NEVER:yk,ZodIssueCode:ne,quotelessJson:Lb,ZodError:Mn}),Rd={exports:{}},v0;function vk(){return v0||(v0=1,function(n){var e=function(t){var r=1e7,i=7,s=9007199254740992,a=p(s),o="0123456789abcdefghijklmnopqrstuvwxyz",u=typeof BigInt=="function";function l(S,A,C,O){return typeof S>"u"?l[0]:typeof A<"u"?+A==10&&!C?Ae(S):Tt(S,A,C,O):Ae(S)}function c(S,A){this.value=S,this.sign=A,this.isSmall=!1}c.prototype=Object.create(l.prototype);function d(S){this.value=S,this.sign=S<0,this.isSmall=!0}d.prototype=Object.create(l.prototype);function f(S){this.value=S}f.prototype=Object.create(l.prototype);function h(S){return-s<S&&S<s}function p(S){return S<1e7?[S]:S<1e14?[S%1e7,Math.floor(S/1e7)]:[S%1e7,Math.floor(S/1e7)%1e7,Math.floor(S/1e14)]}function g(S){m(S);var A=S.length;if(A<4&&Z(S,a)<0)switch(A){case 0:return 0;case 1:return S[0];case 2:return S[0]+S[1]*r;default:return S[0]+(S[1]+S[2]*r)*r}return S}function m(S){for(var A=S.length;S[--A]===0;);S.length=A+1}function v(S){for(var A=new Array(S),C=-1;++C<S;)A[C]=0;return A}function y(S){return S>0?Math.floor(S):Math.ceil(S)}function E(S,A){var C=S.length,O=A.length,j=new Array(C),$=0,Y=r,K,Q;for(Q=0;Q<O;Q++)K=S[Q]+A[Q]+$,$=K>=Y?1:0,j[Q]=K-$*Y;for(;Q<C;)K=S[Q]+$,$=K===Y?1:0,j[Q++]=K-$*Y;return $>0&&j.push($),j}function _(S,A){return S.length>=A.length?E(S,A):E(A,S)}function I(S,A){var C=S.length,O=new Array(C),j=r,$,Y;for(Y=0;Y<C;Y++)$=S[Y]-j+A,A=Math.floor($/j),O[Y]=$-A*j,A+=1;for(;A>0;)O[Y++]=A%j,A=Math.floor(A/j);return O}c.prototype.add=function(S){var A=Ae(S);if(this.sign!==A.sign)return this.subtract(A.negate());var C=this.value,O=A.value;return A.isSmall?new c(I(C,Math.abs(O)),this.sign):new c(_(C,O),this.sign)},c.prototype.plus=c.prototype.add,d.prototype.add=function(S){var A=Ae(S),C=this.value;if(C<0!==A.sign)return this.subtract(A.negate());var O=A.value;if(A.isSmall){if(h(C+O))return new d(C+O);O=p(Math.abs(O))}return new c(I(O,Math.abs(C)),C<0)},d.prototype.plus=d.prototype.add,f.prototype.add=function(S){return new f(this.value+Ae(S).value)},f.prototype.plus=f.prototype.add;function b(S,A){var C=S.length,O=A.length,j=new Array(C),$=0,Y=r,K,Q;for(K=0;K<O;K++)Q=S[K]-$-A[K],Q<0?(Q+=Y,$=1):$=0,j[K]=Q;for(K=O;K<C;K++){if(Q=S[K]-$,Q<0)Q+=Y;else{j[K++]=Q;break}j[K]=Q}for(;K<C;K++)j[K]=S[K];return m(j),j}function L(S,A,C){var O;return Z(S,A)>=0?O=b(S,A):(O=b(A,S),C=!C),O=g(O),typeof O=="number"?(C&&(O=-O),new d(O)):new c(O,C)}function w(S,A,C){var O=S.length,j=new Array(O),$=-A,Y=r,K,Q;for(K=0;K<O;K++)Q=S[K]+$,$=Math.floor(Q/Y),Q%=Y,j[K]=Q<0?Q+Y:Q;return j=g(j),typeof j=="number"?(C&&(j=-j),new d(j)):new c(j,C)}c.prototype.subtract=function(S){var A=Ae(S);if(this.sign!==A.sign)return this.add(A.negate());var C=this.value,O=A.value;return A.isSmall?w(C,Math.abs(O),this.sign):L(C,O,this.sign)},c.prototype.minus=c.prototype.subtract,d.prototype.subtract=function(S){var A=Ae(S),C=this.value;if(C<0!==A.sign)return this.add(A.negate());var O=A.value;return A.isSmall?new d(C-O):w(O,Math.abs(C),C>=0)},d.prototype.minus=d.prototype.subtract,f.prototype.subtract=function(S){return new f(this.value-Ae(S).value)},f.prototype.minus=f.prototype.subtract,c.prototype.negate=function(){return new c(this.value,!this.sign)},d.prototype.negate=function(){var S=this.sign,A=new d(-this.value);return A.sign=!S,A},f.prototype.negate=function(){return new f(-this.value)},c.prototype.abs=function(){return new c(this.value,!1)},d.prototype.abs=function(){return new d(Math.abs(this.value))},f.prototype.abs=function(){return new f(this.value>=0?this.value:-this.value)};function D(S,A){var C=S.length,O=A.length,j=C+O,$=v(j),Y=r,K,Q,Pe,Ve,Oe;for(Pe=0;Pe<C;++Pe){Ve=S[Pe];for(var Xe=0;Xe<O;++Xe)Oe=A[Xe],K=Ve*Oe+$[Pe+Xe],Q=Math.floor(K/Y),$[Pe+Xe]=K-Q*Y,$[Pe+Xe+1]+=Q}return m($),$}function R(S,A){var C=S.length,O=new Array(C),j=r,$=0,Y,K;for(K=0;K<C;K++)Y=S[K]*A+$,$=Math.floor(Y/j),O[K]=Y-$*j;for(;$>0;)O[K++]=$%j,$=Math.floor($/j);return O}function N(S,A){for(var C=[];A-- >0;)C.push(0);return C.concat(S)}function G(S,A){var C=Math.max(S.length,A.length);if(C<=30)return D(S,A);C=Math.ceil(C/2);var O=S.slice(C),j=S.slice(0,C),$=A.slice(C),Y=A.slice(0,C),K=G(j,Y),Q=G(O,$),Pe=G(_(j,O),_(Y,$)),Ve=_(_(K,N(b(b(Pe,K),Q),C)),N(Q,2*C));return m(Ve),Ve}function ee(S,A){return-.012*S-.012*A+15e-6*S*A>0}c.prototype.multiply=function(S){var A=Ae(S),C=this.value,O=A.value,j=this.sign!==A.sign,$;if(A.isSmall){if(O===0)return l[0];if(O===1)return this;if(O===-1)return this.negate();if($=Math.abs(O),$<r)return new c(R(C,$),j);O=p($)}return ee(C.length,O.length)?new c(G(C,O),j):new c(D(C,O),j)},c.prototype.times=c.prototype.multiply;function oe(S,A,C){return S<r?new c(R(A,S),C):new c(D(A,p(S)),C)}d.prototype._multiplyBySmall=function(S){return h(S.value*this.value)?new d(S.value*this.value):oe(Math.abs(S.value),p(Math.abs(this.value)),this.sign!==S.sign)},c.prototype._multiplyBySmall=function(S){return S.value===0?l[0]:S.value===1?this:S.value===-1?this.negate():oe(Math.abs(S.value),this.value,this.sign!==S.sign)},d.prototype.multiply=function(S){return Ae(S)._multiplyBySmall(this)},d.prototype.times=d.prototype.multiply,f.prototype.multiply=function(S){return new f(this.value*Ae(S).value)},f.prototype.times=f.prototype.multiply;function re(S){var A=S.length,C=v(A+A),O=r,j,$,Y,K,Q;for(Y=0;Y<A;Y++){K=S[Y],$=0-K*K;for(var Pe=Y;Pe<A;Pe++)Q=S[Pe],j=2*(K*Q)+C[Y+Pe]+$,$=Math.floor(j/O),C[Y+Pe]=j-$*O;C[Y+A]=$}return m(C),C}c.prototype.square=function(){return new c(re(this.value),!1)},d.prototype.square=function(){var S=this.value*this.value;return h(S)?new d(S):new c(re(p(Math.abs(this.value))),!1)},f.prototype.square=function(S){return new f(this.value*this.value)};function J(S,A){var C=S.length,O=A.length,j=r,$=v(A.length),Y=A[O-1],K=Math.ceil(j/(2*Y)),Q=R(S,K),Pe=R(A,K),Ve,Oe,Xe,sn,Xt,ya,va;for(Q.length<=C&&Q.push(0),Pe.push(0),Y=Pe[O-1],Oe=C-O;Oe>=0;Oe--){for(Ve=j-1,Q[Oe+O]!==Y&&(Ve=Math.floor((Q[Oe+O]*j+Q[Oe+O-1])/Y)),Xe=0,sn=0,ya=Pe.length,Xt=0;Xt<ya;Xt++)Xe+=Ve*Pe[Xt],va=Math.floor(Xe/j),sn+=Q[Oe+Xt]-(Xe-va*j),Xe=va,sn<0?(Q[Oe+Xt]=sn+j,sn=-1):(Q[Oe+Xt]=sn,sn=0);for(;sn!==0;){for(Ve-=1,Xe=0,Xt=0;Xt<ya;Xt++)Xe+=Q[Oe+Xt]-j+Pe[Xt],Xe<0?(Q[Oe+Xt]=Xe+j,Xe=0):(Q[Oe+Xt]=Xe,Xe=1);sn+=Xe}$[Oe]=Ve}return Q=V(Q,K)[0],[g($),g(Q)]}function le(S,A){for(var C=S.length,O=A.length,j=[],$=[],Y=r,K,Q,Pe,Ve,Oe;C;){if($.unshift(S[--C]),m($),Z($,A)<0){j.push(0);continue}Q=$.length,Pe=$[Q-1]*Y+$[Q-2],Ve=A[O-1]*Y+A[O-2],Q>O&&(Pe=(Pe+1)*Y),K=Math.ceil(Pe/Ve);do{if(Oe=R(A,K),Z(Oe,$)<=0)break;K--}while(K);j.push(K),$=b($,Oe)}return j.reverse(),[g(j),g($)]}function V(S,A){var C=S.length,O=v(C),j=r,$,Y,K,Q;for(K=0,$=C-1;$>=0;--$)Q=K*j+S[$],Y=y(Q/A),K=Q-Y*A,O[$]=Y|0;return[O,K|0]}function W(S,A){var C,O=Ae(A);if(u)return[new f(S.value/O.value),new f(S.value%O.value)];var j=S.value,$=O.value,Y;if($===0)throw new Error("Cannot divide by zero");if(S.isSmall)return O.isSmall?[new d(y(j/$)),new d(j%$)]:[l[0],S];if(O.isSmall){if($===1)return[S,l[0]];if($==-1)return[S.negate(),l[0]];var K=Math.abs($);if(K<r){C=V(j,K),Y=g(C[0]);var Q=C[1];return S.sign&&(Q=-Q),typeof Y=="number"?(S.sign!==O.sign&&(Y=-Y),[new d(Y),new d(Q)]):[new c(Y,S.sign!==O.sign),new d(Q)]}$=p(K)}var Pe=Z(j,$);if(Pe===-1)return[l[0],S];if(Pe===0)return[l[S.sign===O.sign?1:-1],l[0]];j.length+$.length<=200?C=J(j,$):C=le(j,$),Y=C[0];var Ve=S.sign!==O.sign,Oe=C[1],Xe=S.sign;return typeof Y=="number"?(Ve&&(Y=-Y),Y=new d(Y)):Y=new c(Y,Ve),typeof Oe=="number"?(Xe&&(Oe=-Oe),Oe=new d(Oe)):Oe=new c(Oe,Xe),[Y,Oe]}c.prototype.divmod=function(S){var A=W(this,S);return{quotient:A[0],remainder:A[1]}},f.prototype.divmod=d.prototype.divmod=c.prototype.divmod,c.prototype.divide=function(S){return W(this,S)[0]},f.prototype.over=f.prototype.divide=function(S){return new f(this.value/Ae(S).value)},d.prototype.over=d.prototype.divide=c.prototype.over=c.prototype.divide,c.prototype.mod=function(S){return W(this,S)[1]},f.prototype.mod=f.prototype.remainder=function(S){return new f(this.value%Ae(S).value)},d.prototype.remainder=d.prototype.mod=c.prototype.remainder=c.prototype.mod,c.prototype.pow=function(S){var A=Ae(S),C=this.value,O=A.value,j,$,Y;if(O===0)return l[1];if(C===0)return l[0];if(C===1)return l[1];if(C===-1)return A.isEven()?l[1]:l[-1];if(A.sign)return l[0];if(!A.isSmall)throw new Error("The exponent "+A.toString()+" is too large.");if(this.isSmall&&h(j=Math.pow(C,O)))return new d(y(j));for($=this,Y=l[1];O&!0&&(Y=Y.times($),--O),O!==0;)O/=2,$=$.square();return Y},d.prototype.pow=c.prototype.pow,f.prototype.pow=function(S){var A=Ae(S),C=this.value,O=A.value,j=BigInt(0),$=BigInt(1),Y=BigInt(2);if(O===j)return l[1];if(C===j)return l[0];if(C===$)return l[1];if(C===BigInt(-1))return A.isEven()?l[1]:l[-1];if(A.isNegative())return new f(j);for(var K=this,Q=l[1];(O&$)===$&&(Q=Q.times(K),--O),O!==j;)O/=Y,K=K.square();return Q},c.prototype.modPow=function(S,A){if(S=Ae(S),A=Ae(A),A.isZero())throw new Error("Cannot take modPow with modulus 0");var C=l[1],O=this.mod(A);for(S.isNegative()&&(S=S.multiply(l[-1]),O=O.modInv(A));S.isPositive();){if(O.isZero())return l[0];S.isOdd()&&(C=C.multiply(O).mod(A)),S=S.divide(2),O=O.square().mod(A)}return C},f.prototype.modPow=d.prototype.modPow=c.prototype.modPow;function Z(S,A){if(S.length!==A.length)return S.length>A.length?1:-1;for(var C=S.length-1;C>=0;C--)if(S[C]!==A[C])return S[C]>A[C]?1:-1;return 0}c.prototype.compareAbs=function(S){var A=Ae(S),C=this.value,O=A.value;return A.isSmall?1:Z(C,O)},d.prototype.compareAbs=function(S){var A=Ae(S),C=Math.abs(this.value),O=A.value;return A.isSmall?(O=Math.abs(O),C===O?0:C>O?1:-1):-1},f.prototype.compareAbs=function(S){var A=this.value,C=Ae(S).value;return A=A>=0?A:-A,C=C>=0?C:-C,A===C?0:A>C?1:-1},c.prototype.compare=function(S){if(S===1/0)return-1;if(S===-1/0)return 1;var A=Ae(S),C=this.value,O=A.value;return this.sign!==A.sign?A.sign?1:-1:A.isSmall?this.sign?-1:1:Z(C,O)*(this.sign?-1:1)},c.prototype.compareTo=c.prototype.compare,d.prototype.compare=function(S){if(S===1/0)return-1;if(S===-1/0)return 1;var A=Ae(S),C=this.value,O=A.value;return A.isSmall?C==O?0:C>O?1:-1:C<0!==A.sign?C<0?-1:1:C<0?1:-1},d.prototype.compareTo=d.prototype.compare,f.prototype.compare=function(S){if(S===1/0)return-1;if(S===-1/0)return 1;var A=this.value,C=Ae(S).value;return A===C?0:A>C?1:-1},f.prototype.compareTo=f.prototype.compare,c.prototype.equals=function(S){return this.compare(S)===0},f.prototype.eq=f.prototype.equals=d.prototype.eq=d.prototype.equals=c.prototype.eq=c.prototype.equals,c.prototype.notEquals=function(S){return this.compare(S)!==0},f.prototype.neq=f.prototype.notEquals=d.prototype.neq=d.prototype.notEquals=c.prototype.neq=c.prototype.notEquals,c.prototype.greater=function(S){return this.compare(S)>0},f.prototype.gt=f.prototype.greater=d.prototype.gt=d.prototype.greater=c.prototype.gt=c.prototype.greater,c.prototype.lesser=function(S){return this.compare(S)<0},f.prototype.lt=f.prototype.lesser=d.prototype.lt=d.prototype.lesser=c.prototype.lt=c.prototype.lesser,c.prototype.greaterOrEquals=function(S){return this.compare(S)>=0},f.prototype.geq=f.prototype.greaterOrEquals=d.prototype.geq=d.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals,c.prototype.lesserOrEquals=function(S){return this.compare(S)<=0},f.prototype.leq=f.prototype.lesserOrEquals=d.prototype.leq=d.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals,c.prototype.isEven=function(){return(this.value[0]&1)===0},d.prototype.isEven=function(){return(this.value&1)===0},f.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},c.prototype.isOdd=function(){return(this.value[0]&1)===1},d.prototype.isOdd=function(){return(this.value&1)===1},f.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},c.prototype.isPositive=function(){return!this.sign},d.prototype.isPositive=function(){return this.value>0},f.prototype.isPositive=d.prototype.isPositive,c.prototype.isNegative=function(){return this.sign},d.prototype.isNegative=function(){return this.value<0},f.prototype.isNegative=d.prototype.isNegative,c.prototype.isUnit=function(){return!1},d.prototype.isUnit=function(){return Math.abs(this.value)===1},f.prototype.isUnit=function(){return this.abs().value===BigInt(1)},c.prototype.isZero=function(){return!1},d.prototype.isZero=function(){return this.value===0},f.prototype.isZero=function(){return this.value===BigInt(0)},c.prototype.isDivisibleBy=function(S){var A=Ae(S);return A.isZero()?!1:A.isUnit()?!0:A.compareAbs(2)===0?this.isEven():this.mod(A).isZero()},f.prototype.isDivisibleBy=d.prototype.isDivisibleBy=c.prototype.isDivisibleBy;function q(S){var A=S.abs();if(A.isUnit())return!1;if(A.equals(2)||A.equals(3)||A.equals(5))return!0;if(A.isEven()||A.isDivisibleBy(3)||A.isDivisibleBy(5))return!1;if(A.lesser(49))return!0}function X(S,A){for(var C=S.prev(),O=C,j=0,$,Y,K;O.isEven();)O=O.divide(2),j++;e:for(Y=0;Y<A.length;Y++)if(!S.lesser(A[Y])&&(K=e(A[Y]).modPow(O,S),!(K.isUnit()||K.equals(C)))){for($=j-1;$!=0;$--){if(K=K.square().mod(S),K.isUnit())return!1;if(K.equals(C))continue e}return!1}return!0}c.prototype.isPrime=function(S){var A=q(this);if(A!==t)return A;var C=this.abs(),O=C.bitLength();if(O<=64)return X(C,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var j=Math.log(2)*O.toJSNumber(),$=Math.ceil(S===!0?2*Math.pow(j,2):j),Y=[],K=0;K<$;K++)Y.push(e(K+2));return X(C,Y)},f.prototype.isPrime=d.prototype.isPrime=c.prototype.isPrime,c.prototype.isProbablePrime=function(S,A){var C=q(this);if(C!==t)return C;for(var O=this.abs(),j=S===t?5:S,$=[],Y=0;Y<j;Y++)$.push(e.randBetween(2,O.minus(2),A));return X(O,$)},f.prototype.isProbablePrime=d.prototype.isProbablePrime=c.prototype.isProbablePrime,c.prototype.modInv=function(S){for(var A=e.zero,C=e.one,O=Ae(S),j=this.abs(),$,Y,K;!j.isZero();)$=O.divide(j),Y=A,K=O,A=C,O=j,C=Y.subtract($.multiply(C)),j=K.subtract($.multiply(j));if(!O.isUnit())throw new Error(this.toString()+" and "+S.toString()+" are not co-prime");return A.compare(0)===-1&&(A=A.add(S)),this.isNegative()?A.negate():A},f.prototype.modInv=d.prototype.modInv=c.prototype.modInv,c.prototype.next=function(){var S=this.value;return this.sign?w(S,1,this.sign):new c(I(S,1),this.sign)},d.prototype.next=function(){var S=this.value;return S+1<s?new d(S+1):new c(a,!1)},f.prototype.next=function(){return new f(this.value+BigInt(1))},c.prototype.prev=function(){var S=this.value;return this.sign?new c(I(S,1),!0):w(S,1,this.sign)},d.prototype.prev=function(){var S=this.value;return S-1>-s?new d(S-1):new c(a,!0)},f.prototype.prev=function(){return new f(this.value-BigInt(1))};for(var ye=[1];2*ye[ye.length-1]<=r;)ye.push(2*ye[ye.length-1]);var ke=ye.length,Te=ye[ke-1];function Le(S){return Math.abs(S)<=r}c.prototype.shiftLeft=function(S){var A=Ae(S).toJSNumber();if(!Le(A))throw new Error(String(A)+" is too large for shifting.");if(A<0)return this.shiftRight(-A);var C=this;if(C.isZero())return C;for(;A>=ke;)C=C.multiply(Te),A-=ke-1;return C.multiply(ye[A])},f.prototype.shiftLeft=d.prototype.shiftLeft=c.prototype.shiftLeft,c.prototype.shiftRight=function(S){var A,C=Ae(S).toJSNumber();if(!Le(C))throw new Error(String(C)+" is too large for shifting.");if(C<0)return this.shiftLeft(-C);for(var O=this;C>=ke;){if(O.isZero()||O.isNegative()&&O.isUnit())return O;A=W(O,Te),O=A[1].isNegative()?A[0].prev():A[0],C-=ke-1}return A=W(O,ye[C]),A[1].isNegative()?A[0].prev():A[0]},f.prototype.shiftRight=d.prototype.shiftRight=c.prototype.shiftRight;function Re(S,A,C){A=Ae(A);for(var O=S.isNegative(),j=A.isNegative(),$=O?S.not():S,Y=j?A.not():A,K=0,Q=0,Pe=null,Ve=null,Oe=[];!$.isZero()||!Y.isZero();)Pe=W($,Te),K=Pe[1].toJSNumber(),O&&(K=Te-1-K),Ve=W(Y,Te),Q=Ve[1].toJSNumber(),j&&(Q=Te-1-Q),$=Pe[0],Y=Ve[0],Oe.push(C(K,Q));for(var Xe=C(O?1:0,j?1:0)!==0?e(-1):e(0),sn=Oe.length-1;sn>=0;sn-=1)Xe=Xe.multiply(Te).add(e(Oe[sn]));return Xe}c.prototype.not=function(){return this.negate().prev()},f.prototype.not=d.prototype.not=c.prototype.not,c.prototype.and=function(S){return Re(this,S,function(A,C){return A&C})},f.prototype.and=d.prototype.and=c.prototype.and,c.prototype.or=function(S){return Re(this,S,function(A,C){return A|C})},f.prototype.or=d.prototype.or=c.prototype.or,c.prototype.xor=function(S){return Re(this,S,function(A,C){return A^C})},f.prototype.xor=d.prototype.xor=c.prototype.xor;var at=1<<30,kt=(r&-r)*(r&-r)|at;function Qe(S){var A=S.value,C=typeof A=="number"?A|at:typeof A=="bigint"?A|BigInt(at):A[0]+A[1]*r|kt;return C&-C}function At(S,A){if(A.compareTo(S)<=0){var C=At(S,A.square(A)),O=C.p,j=C.e,$=O.multiply(A);return $.compareTo(S)<=0?{p:$,e:j*2+1}:{p:O,e:j*2}}return{p:e(1),e:0}}c.prototype.bitLength=function(){var S=this;return S.compareTo(e(0))<0&&(S=S.negate().subtract(e(1))),S.compareTo(e(0))===0?e(0):e(At(S,e(2)).e).add(e(1))},f.prototype.bitLength=d.prototype.bitLength=c.prototype.bitLength;function dr(S,A){return S=Ae(S),A=Ae(A),S.greater(A)?S:A}function $n(S,A){return S=Ae(S),A=Ae(A),S.lesser(A)?S:A}function Gn(S,A){if(S=Ae(S).abs(),A=Ae(A).abs(),S.equals(A))return S;if(S.isZero())return A;if(A.isZero())return S;for(var C=l[1],O,j;S.isEven()&&A.isEven();)O=$n(Qe(S),Qe(A)),S=S.divide(O),A=A.divide(O),C=C.multiply(O);for(;S.isEven();)S=S.divide(Qe(S));do{for(;A.isEven();)A=A.divide(Qe(A));S.greater(A)&&(j=A,A=S,S=j),A=A.subtract(S)}while(!A.isZero());return C.isUnit()?S:S.multiply(C)}function fr(S,A){return S=Ae(S).abs(),A=Ae(A).abs(),S.divide(Gn(S,A)).multiply(A)}function $e(S,A,C){S=Ae(S),A=Ae(A);var O=C||Math.random,j=$n(S,A),$=dr(S,A),Y=$.subtract(j).add(1);if(Y.isSmall)return j.add(Math.floor(O()*Y));for(var K=fe(Y,r).value,Q=[],Pe=!0,Ve=0;Ve<K.length;Ve++){var Oe=Pe?K[Ve]+(Ve+1<K.length?K[Ve+1]/r:0):r,Xe=y(O()*Oe);Q.push(Xe),Xe<K[Ve]&&(Pe=!1)}return j.add(l.fromArray(Q,r,!1))}var Tt=function(S,A,C,O){C=C||o,S=String(S),O||(S=S.toLowerCase(),C=C.toLowerCase());var j=S.length,$,Y=Math.abs(A),K={};for($=0;$<C.length;$++)K[C[$]]=$;for($=0;$<j;$++){var Q=S[$];if(Q!=="-"&&Q in K&&K[Q]>=Y){if(Q==="1"&&Y===1)continue;throw new Error(Q+" is not a valid digit in base "+A+".")}}A=Ae(A);var Pe=[],Ve=S[0]==="-";for($=Ve?1:0;$<S.length;$++){var Q=S[$];if(Q in K)Pe.push(Ae(K[Q]));else if(Q==="<"){var Oe=$;do $++;while(S[$]!==">"&&$<S.length);Pe.push(Ae(S.slice(Oe+1,$)))}else throw new Error(Q+" is not a valid character")}return Dt(Pe,A,Ve)};function Dt(S,A,C){var O=l[0],j=l[1],$;for($=S.length-1;$>=0;$--)O=O.add(S[$].times(j)),j=j.times(A);return C?O.negate():O}function de(S,A){return A=A||o,S<A.length?A[S]:"<"+S+">"}function fe(S,A){if(A=e(A),A.isZero()){if(S.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(A.equals(-1)){if(S.isZero())return{value:[0],isNegative:!1};if(S.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-S.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var C=Array.apply(null,Array(S.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return C.unshift([1]),{value:[].concat.apply([],C),isNegative:!1}}var O=!1;if(S.isNegative()&&A.isPositive()&&(O=!0,S=S.abs()),A.isUnit())return S.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(S.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:O};for(var j=[],$=S,Y;$.isNegative()||$.compareAbs(A)>=0;){Y=$.divmod(A),$=Y.quotient;var K=Y.remainder;K.isNegative()&&(K=A.minus(K).abs(),$=$.next()),j.push(K.toJSNumber())}return j.push($.toJSNumber()),{value:j.reverse(),isNegative:O}}function Ye(S,A,C){var O=fe(S,A);return(O.isNegative?"-":"")+O.value.map(function(j){return de(j,C)}).join("")}c.prototype.toArray=function(S){return fe(this,S)},d.prototype.toArray=function(S){return fe(this,S)},f.prototype.toArray=function(S){return fe(this,S)},c.prototype.toString=function(S,A){if(S===t&&(S=10),S!==10||A)return Ye(this,S,A);for(var C=this.value,O=C.length,j=String(C[--O]),$="0000000",Y;--O>=0;)Y=String(C[O]),j+=$.slice(Y.length)+Y;var K=this.sign?"-":"";return K+j},d.prototype.toString=function(S,A){return S===t&&(S=10),S!=10||A?Ye(this,S,A):String(this.value)},f.prototype.toString=d.prototype.toString,f.prototype.toJSON=c.prototype.toJSON=d.prototype.toJSON=function(){return this.toString()},c.prototype.valueOf=function(){return parseInt(this.toString(),10)},c.prototype.toJSNumber=c.prototype.valueOf,d.prototype.valueOf=function(){return this.value},d.prototype.toJSNumber=d.prototype.valueOf,f.prototype.valueOf=f.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function Pt(S){if(h(+S)){var A=+S;if(A===y(A))return u?new f(BigInt(A)):new d(A);throw new Error("Invalid integer: "+S)}var C=S[0]==="-";C&&(S=S.slice(1));var O=S.split(/e/i);if(O.length>2)throw new Error("Invalid integer: "+O.join("e"));if(O.length===2){var j=O[1];if(j[0]==="+"&&(j=j.slice(1)),j=+j,j!==y(j)||!h(j))throw new Error("Invalid integer: "+j+" is not a valid exponent.");var $=O[0],Y=$.indexOf(".");if(Y>=0&&(j-=$.length-Y-1,$=$.slice(0,Y)+$.slice(Y+1)),j<0)throw new Error("Cannot include negative exponent part for integers");$+=new Array(j+1).join("0"),S=$}var K=/^([0-9][0-9]*)$/.test(S);if(!K)throw new Error("Invalid integer: "+S);if(u)return new f(BigInt(C?"-"+S:S));for(var Q=[],Pe=S.length,Ve=i,Oe=Pe-Ve;Pe>0;)Q.push(+S.slice(Oe,Pe)),Oe-=Ve,Oe<0&&(Oe=0),Pe-=Ve;return m(Q),new c(Q,C)}function Pr(S){if(u)return new f(BigInt(S));if(h(S)){if(S!==y(S))throw new Error(S+" is not an integer.");return new d(S)}return Pt(S.toString())}function Ae(S){return typeof S=="number"?Pr(S):typeof S=="string"?Pt(S):typeof S=="bigint"?new f(S):S}for(var _n=0;_n<1e3;_n++)l[_n]=Ae(_n),_n>0&&(l[-_n]=Ae(-_n));return l.one=l[1],l.zero=l[0],l.minusOne=l[-1],l.max=dr,l.min=$n,l.gcd=Gn,l.lcm=fr,l.isInstance=function(S){return S instanceof c||S instanceof d||S instanceof f},l.randBetween=$e,l.fromArray=function(S,A,C){return Dt(S.map(Ae),Ae(A||10),C)},l}();n.hasOwnProperty("exports")&&(n.exports=e)}(Rd)),Rd.exports}var Ek=vk(),Tk=IT(Ek);const OT=64,Wf=16,mi=OT/Wf;function Sk(){try{return!0}catch{return!1}}function xk(n,e,t){let r=0;for(let i=0;i<t;i++){const s=n[e+i];if(s===void 0)break;r+=s*16**i}return r}function MT(n){const e=[];for(let t=0;t<n.length;t++){let r=Number(n[t]);for(let i=0;r||i<e.length;i++)r+=(e[i]||0)*10,e[i]=r%16,r=(r-e[i])/16}return e}function _k(n){const e=MT(n),t=Array(mi);for(let r=0;r<mi;r++)t[mi-1-r]=xk(e,r*mi,mi);return t}class Er{static fromString(e){return new Er(_k(e),e)}static fromBit(e){const t=Array(mi),r=Math.floor(e/Wf);for(let i=0;i<mi;i++)t[mi-1-i]=i===r?1<<e-r*Wf:0;return new Er(t)}constructor(e,t){this.parts=e,this.str=t}and({parts:e}){return new Er(this.parts.map((t,r)=>t&e[r]))}or({parts:e}){return new Er(this.parts.map((t,r)=>t|e[r]))}xor({parts:e}){return new Er(this.parts.map((t,r)=>t^e[r]))}not(){return new Er(this.parts.map(e=>~e))}equals({parts:e}){return this.parts.every((t,r)=>t===e[r])}toString(){if(this.str!=null)return this.str;const e=new Array(OT/4);return this.parts.forEach((t,r)=>{const i=MT(t.toString());for(let s=0;s<4;s++)e[s+r*4]=i[3-s]||0}),this.str=Tk.fromArray(e,16).toString()}toJSON(){return this.toString()}}const $i=Sk();$i&&BigInt.prototype.toJSON==null&&(BigInt.prototype.toJSON=function(){return this.toString()});const Ol={},FT=$i?function(e){return BigInt(e)}:function(e){return e instanceof Er?e:(typeof e=="number"&&(e=e.toString()),Ol[e]!=null||(Ol[e]=Er.fromString(e)),Ol[e])},Wt=FT(0),gc=$i?function(e=Wt,t=Wt){return e&t}:function(e=Wt,t=Wt){return e.and(t)},UT=$i?function(e=Wt,t=Wt){return e|t}:function(e=Wt,t=Wt){return e.or(t)},Ak=$i?function(e=Wt,t=Wt){return e^t}:function(e=Wt,t=Wt){return e.xor(t)},Ik=$i?function(e=Wt){return~e}:function(e=Wt){return e.not()},xp=$i?function(e,t){return e===t}:function(e,t){return e==null||t==null?e==t:e.equals(t)};function Lk(...n){let e=n[0];for(let t=1;t<n.length;t++)e=UT(e,n[t]);return e}function Rk(n,e){return xp(gc(n,e),e)}function wk(n,e){return!xp(gc(n,e),Wt)}function bk(n,e){return e===Wt?n:UT(n,e)}function kk(n,e){return e===Wt?n:Ak(n,gc(n,e))}const Dk=$i?function(e){return BigInt(1)<<BigInt(e)}:function(e){return Er.fromBit(e)};var we={combine:Lk,add:bk,remove:kk,filter:gc,invert:Ik,has:Rk,hasAny:wk,equals:xp,deserialize:FT,getFlag:Dk},E0;(function(n){n[n.CLOSE_NORMAL=1e3]="CLOSE_NORMAL",n[n.CLOSE_UNSUPPORTED=1003]="CLOSE_UNSUPPORTED",n[n.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",n[n.INVALID_CLIENTID=4e3]="INVALID_CLIENTID",n[n.INVALID_ORIGIN=4001]="INVALID_ORIGIN",n[n.RATELIMITED=4002]="RATELIMITED",n[n.TOKEN_REVOKED=4003]="TOKEN_REVOKED",n[n.INVALID_VERSION=4004]="INVALID_VERSION",n[n.INVALID_ENCODING=4005]="INVALID_ENCODING"})(E0||(E0={}));var Yf;(function(n){n[n.INVALID_PAYLOAD=4e3]="INVALID_PAYLOAD",n[n.INVALID_COMMAND=4002]="INVALID_COMMAND",n[n.INVALID_EVENT=4004]="INVALID_EVENT",n[n.INVALID_PERMISSIONS=4006]="INVALID_PERMISSIONS"})(Yf||(Yf={}));var qf;(function(n){n.LANDSCAPE="landscape",n.PORTRAIT="portrait"})(qf||(qf={}));var zr;(function(n){n.MOBILE="mobile",n.DESKTOP="desktop"})(zr||(zr={}));Object.freeze({CREATE_INSTANT_INVITE:we.getFlag(0),KICK_MEMBERS:we.getFlag(1),BAN_MEMBERS:we.getFlag(2),ADMINISTRATOR:we.getFlag(3),MANAGE_CHANNELS:we.getFlag(4),MANAGE_GUILD:we.getFlag(5),ADD_REACTIONS:we.getFlag(6),VIEW_AUDIT_LOG:we.getFlag(7),PRIORITY_SPEAKER:we.getFlag(8),STREAM:we.getFlag(9),VIEW_CHANNEL:we.getFlag(10),SEND_MESSAGES:we.getFlag(11),SEND_TTS_MESSAGES:we.getFlag(12),MANAGE_MESSAGES:we.getFlag(13),EMBED_LINKS:we.getFlag(14),ATTACH_FILES:we.getFlag(15),READ_MESSAGE_HISTORY:we.getFlag(16),MENTION_EVERYONE:we.getFlag(17),USE_EXTERNAL_EMOJIS:we.getFlag(18),VIEW_GUILD_INSIGHTS:we.getFlag(19),CONNECT:we.getFlag(20),SPEAK:we.getFlag(21),MUTE_MEMBERS:we.getFlag(22),DEAFEN_MEMBERS:we.getFlag(23),MOVE_MEMBERS:we.getFlag(24),USE_VAD:we.getFlag(25),CHANGE_NICKNAME:we.getFlag(26),MANAGE_NICKNAMES:we.getFlag(27),MANAGE_ROLES:we.getFlag(28),MANAGE_WEBHOOKS:we.getFlag(29),MANAGE_GUILD_EXPRESSIONS:we.getFlag(30),USE_APPLICATION_COMMANDS:we.getFlag(31),REQUEST_TO_SPEAK:we.getFlag(32),MANAGE_EVENTS:we.getFlag(33),MANAGE_THREADS:we.getFlag(34),CREATE_PUBLIC_THREADS:we.getFlag(35),CREATE_PRIVATE_THREADS:we.getFlag(36),USE_EXTERNAL_STICKERS:we.getFlag(37),SEND_MESSAGES_IN_THREADS:we.getFlag(38),USE_EMBEDDED_ACTIVITIES:we.getFlag(39),MODERATE_MEMBERS:we.getFlag(40),VIEW_CREATOR_MONETIZATION_ANALYTICS:we.getFlag(41),USE_SOUNDBOARD:we.getFlag(42),CREATE_GUILD_EXPRESSIONS:we.getFlag(43),CREATE_EVENTS:we.getFlag(44),USE_EXTERNAL_SOUNDS:we.getFlag(45),SEND_VOICE_MESSAGES:we.getFlag(46),SEND_POLLS:we.getFlag(49),USE_EXTERNAL_APPS:we.getFlag(50)});const T0=-1,Pk=250;function rn(n){return NT(e=>{var t;const[r]=(t=Object.entries(n).find(([,i])=>i===e))!==null&&t!==void 0?t:[];return e!=null&&r===void 0?n.UNHANDLED:e},M().or(_e()))}function BT(n){const e=Tp().transform(t=>{const r=n.safeParse(t);return r.success?r.data:n._def.defaultValue()});return e.overlayType=n,e}const Ck=ae.object({image_url:ae.string()}),Nk=ae.object({mediaUrl:ae.string().max(1024)}),Ok=ae.object({access_token:ae.union([ae.string(),ae.null()]).optional()}),$T=ae.object({access_token:ae.string(),user:ae.object({username:ae.string(),discriminator:ae.string(),id:ae.string(),avatar:ae.union([ae.string(),ae.null()]).optional(),public_flags:ae.number(),global_name:ae.union([ae.string(),ae.null()]).optional()}),scopes:ae.array(BT(ae.enum(["identify","email","connections","guilds","guilds.join","guilds.members.read","guilds.channels.read","gdm.join","bot","rpc","rpc.notifications.read","rpc.voice.read","rpc.voice.write","rpc.video.read","rpc.video.write","rpc.screenshare.read","rpc.screenshare.write","rpc.activities.write","webhook.incoming","messages.read","applications.builds.upload","applications.builds.read","applications.commands","applications.commands.permissions.update","applications.commands.update","applications.store.update","applications.entitlements","activities.read","activities.write","relationships.read","relationships.write","voice","dm_channels.read","role_connections.write","presences.read","presences.write","openid","dm_channels.messages.read","dm_channels.messages.write","gateway.connect","account.global_name.update","payment_sources.country_code","sdk.social_layer"]).or(ae.literal(-1)).default(-1))),expires:ae.string(),application:ae.object({description:ae.string(),icon:ae.union([ae.string(),ae.null()]).optional(),id:ae.string(),rpc_origins:ae.array(ae.string()).optional(),name:ae.string()})}),GT=ae.object({participants:ae.array(ae.object({id:ae.string(),username:ae.string(),global_name:ae.union([ae.string(),ae.null()]).optional(),discriminator:ae.string(),avatar:ae.union([ae.string(),ae.null()]).optional(),flags:ae.number(),bot:ae.boolean(),avatar_decoration_data:ae.union([ae.object({asset:ae.string(),skuId:ae.string().optional()}),ae.null()]).optional(),premium_type:ae.union([ae.number(),ae.null()]).optional(),nickname:ae.string().optional()}))}),Mk=ae.object({command:ae.string(),content:ae.string().max(2e3).optional(),preview_image:ae.object({height:ae.number(),url:ae.string(),width:ae.number()}).optional(),components:ae.array(ae.object({type:ae.literal(1),components:ae.array(ae.object({type:ae.literal(2),style:ae.number().gte(1).lte(5),label:ae.string().max(80).optional(),custom_id:ae.string().max(100).describe("Developer-defined identifier for the button; max 100 characters").optional()})).max(5).optional()})).optional()}),Fk=ae.object({referrer_id:ae.string().max(64).optional(),custom_id:ae.string().max(64).optional(),message:ae.string().max(1e3)}),Uk=ae.object({success:ae.boolean()});var Dn;(function(n){n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.AUTHENTICATE="AUTHENTICATE",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",n.SHARE_INTERACTION="SHARE_INTERACTION",n.SHARE_LINK="SHARE_LINK"})(Dn||(Dn={}));const S0=ae.object({}).optional().nullable(),x0=ae.void(),VT={[Dn.INITIATE_IMAGE_UPLOAD]:{request:x0,response:Ck},[Dn.OPEN_SHARE_MOMENT_DIALOG]:{request:Nk,response:S0},[Dn.AUTHENTICATE]:{request:Ok,response:$T},[Dn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS]:{request:x0,response:GT},[Dn.SHARE_INTERACTION]:{request:Mk,response:S0},[Dn.SHARE_LINK]:{request:Fk,response:Uk}},Bk="DISPATCH";var Ie;(function(n){n.AUTHORIZE="AUTHORIZE",n.AUTHENTICATE="AUTHENTICATE",n.GET_GUILDS="GET_GUILDS",n.GET_GUILD="GET_GUILD",n.GET_CHANNEL="GET_CHANNEL",n.GET_CHANNELS="GET_CHANNELS",n.SELECT_VOICE_CHANNEL="SELECT_VOICE_CHANNEL",n.SELECT_TEXT_CHANNEL="SELECT_TEXT_CHANNEL",n.SUBSCRIBE="SUBSCRIBE",n.UNSUBSCRIBE="UNSUBSCRIBE",n.CAPTURE_SHORTCUT="CAPTURE_SHORTCUT",n.SET_CERTIFIED_DEVICES="SET_CERTIFIED_DEVICES",n.SET_ACTIVITY="SET_ACTIVITY",n.GET_SKUS="GET_SKUS",n.GET_ENTITLEMENTS="GET_ENTITLEMENTS",n.GET_SKUS_EMBEDDED="GET_SKUS_EMBEDDED",n.GET_ENTITLEMENTS_EMBEDDED="GET_ENTITLEMENTS_EMBEDDED",n.START_PURCHASE="START_PURCHASE",n.SET_CONFIG="SET_CONFIG",n.SEND_ANALYTICS_EVENT="SEND_ANALYTICS_EVENT",n.USER_SETTINGS_GET_LOCALE="USER_SETTINGS_GET_LOCALE",n.OPEN_EXTERNAL_LINK="OPEN_EXTERNAL_LINK",n.ENCOURAGE_HW_ACCELERATION="ENCOURAGE_HW_ACCELERATION",n.CAPTURE_LOG="CAPTURE_LOG",n.SET_ORIENTATION_LOCK_STATE="SET_ORIENTATION_LOCK_STATE",n.OPEN_INVITE_DIALOG="OPEN_INVITE_DIALOG",n.GET_PLATFORM_BEHAVIORS="GET_PLATFORM_BEHAVIORS",n.GET_CHANNEL_PERMISSIONS="GET_CHANNEL_PERMISSIONS",n.OPEN_SHARE_MOMENT_DIALOG="OPEN_SHARE_MOMENT_DIALOG",n.INITIATE_IMAGE_UPLOAD="INITIATE_IMAGE_UPLOAD",n.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS="GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS",n.SHARE_LINK="SHARE_LINK"})(Ie||(Ie={}));const pa=se({cmd:M(),data:Fo(),evt:pc(),nonce:M()}).passthrough(),$k=Object.assign(Object.assign({},$T.shape.scopes.element.overlayType._def.innerType.options[0].Values),{UNHANDLED:-1});rn($k);const Mi=se({id:M(),username:M(),discriminator:M(),global_name:M().optional().nullable(),avatar:M().optional().nullable(),avatar_decoration_data:se({asset:M(),sku_id:M().optional()}).nullable(),bot:Ne(),flags:_e().optional().nullable(),premium_type:_e().optional().nullable()}),_p=se({user:Mi,nick:M().optional().nullable(),roles:ze(M()),joined_at:M(),deaf:Ne(),mute:Ne()}),Gk=se({user_id:M(),nick:M().optional().nullable(),guild_id:M(),avatar:M().optional().nullable(),avatar_decoration_data:se({asset:M(),sku_id:M().optional().nullable()}).optional().nullable(),color_string:M().optional().nullable()}),Ap=se({id:M(),name:M().optional().nullable(),roles:ze(M()).optional().nullable(),user:Mi.optional().nullable(),require_colons:Ne().optional().nullable(),managed:Ne().optional().nullable(),animated:Ne().optional().nullable(),available:Ne().optional().nullable()}),jT=se({mute:Ne(),deaf:Ne(),self_mute:Ne(),self_deaf:Ne(),suppress:Ne()}),HT=se({mute:Ne(),nick:M(),user:Mi,voice_state:jT,volume:_e()}),Vk={UNHANDLED:-1,IDLE:"idle",DND:"dnd",ONLINE:"online",OFFLINE:"offline"},Ml=rn(Vk),Za=se({name:M(),type:_e(),url:M().optional().nullable(),created_at:_e().optional().nullable(),timestamps:se({start:_e(),end:_e()}).partial().optional().nullable(),application_id:M().optional().nullable(),details:M().optional().nullable(),state:M().optional().nullable(),emoji:Ap.optional().nullable(),party:se({id:M().optional().nullable(),size:ze(_e()).optional().nullable()}).optional().nullable(),assets:se({large_image:M().nullable(),large_text:M().nullable(),small_image:M().nullable(),small_text:M().nullable()}).partial().optional().nullable(),secrets:se({join:M(),match:M()}).partial().optional().nullable(),instance:Ne().optional().nullable(),flags:_e().optional().nullable()}),jk={UNHANDLED:-1,ROLE:0,MEMBER:1},Hk=se({id:M(),type:rn(jk),allow:M(),deny:M()}),KT={UNHANDLED:-1,DM:1,GROUP_DM:3,GUILD_TEXT:0,GUILD_VOICE:2,GUILD_CATEGORY:4,GUILD_ANNOUNCEMENT:5,GUILD_STORE:6,ANNOUNCEMENT_THREAD:10,PUBLIC_THREAD:11,PRIVATE_THREAD:12,GUILD_STAGE_VOICE:13,GUILD_DIRECTORY:14,GUILD_FORUM:15},zT=se({id:M(),type:rn(KT),guild_id:M().optional().nullable(),position:_e().optional().nullable(),permission_overwrites:ze(Hk).optional().nullable(),name:M().optional().nullable(),topic:M().optional().nullable(),nsfw:Ne().optional().nullable(),last_message_id:M().optional().nullable(),bitrate:_e().optional().nullable(),user_limit:_e().optional().nullable(),rate_limit_per_user:_e().optional().nullable(),recipients:ze(Mi).optional().nullable(),icon:M().optional().nullable(),owner_id:M().optional().nullable(),application_id:M().optional().nullable(),parent_id:M().optional().nullable(),last_pin_timestamp:M().optional().nullable()}),Kk=se({user:Mi,guild_id:M(),status:Ml,activities:ze(Za),client_status:se({desktop:Ml,mobile:Ml,web:Ml}).partial()}),zk=se({id:M(),name:M(),color:_e(),hoist:Ne(),position:_e(),permissions:M(),managed:Ne(),mentionable:Ne()});se({id:M(),name:M(),owner_id:M(),icon:M().nullable(),icon_hash:M().optional().nullable(),splash:M().nullable(),discovery_splash:M().nullable(),owner:Ne().optional().nullable(),permissions:M().optional().nullable(),region:M(),afk_channel_id:M().nullable(),afk_timeout:_e(),widget_enabled:Ne().optional().nullable(),widget_channel_id:M().optional().nullable(),verification_level:_e(),default_message_notifications:_e(),explicit_content_filter:_e(),roles:ze(zk),emojis:ze(Ap),features:ze(M()),mfa_level:_e(),application_id:M().nullable(),system_channel_id:M().nullable(),system_channel_flags:_e(),rules_channel_id:M().nullable(),joined_at:M().optional().nullable(),large:Ne().optional().nullable(),unavailable:Ne().optional().nullable(),member_count:_e().optional().nullable(),voice_states:ze(jT).optional().nullable(),members:ze(_p).optional().nullable(),channels:ze(zT).optional().nullable(),presences:ze(Kk).optional().nullable(),max_presences:_e().optional().nullable(),max_members:_e().optional().nullable(),vanity_url_code:M().nullable(),description:M().nullable(),banner:M().nullable(),premium_tier:_e(),premium_subscription_count:_e().optional().nullable(),preferred_locale:M(),public_updates_channel_id:M().nullable(),max_video_channel_users:_e().optional().nullable(),approximate_member_count:_e().optional().nullable(),approximate_presence_count:_e().optional().nullable()});const Wk=se({id:M(),guild_id:M(),type:_e(),name:M()}),Yk=se({id:M(),filename:M(),size:_e(),url:M(),proxy_url:M(),height:_e().optional().nullable(),width:_e().optional().nullable()}),qk=se({text:M(),icon_url:M().optional().nullable(),proxy_icon_url:M().optional().nullable()}),Xf=se({url:M().optional().nullable(),proxy_url:M().optional().nullable(),height:_e().optional().nullable(),width:_e().optional().nullable()}),Xk=Xf.omit({proxy_url:!0}),Zk=se({name:M().optional().nullable(),url:M().optional().nullable()}),Qk=se({name:M().optional().nullable(),url:M().optional().nullable(),icon_url:M().optional().nullable(),proxy_icon_url:M().optional().nullable()}),Jk=se({name:M(),value:M(),inline:Ne()}),eD=se({title:M().optional().nullable(),type:M().optional().nullable(),description:M().optional().nullable(),url:M().optional().nullable(),timestamp:M().optional().nullable(),color:_e().optional().nullable(),footer:qk.optional().nullable(),image:Xf.optional().nullable(),thumbnail:Xf.optional().nullable(),video:Xk.optional().nullable(),provider:Zk.optional().nullable(),author:Qk.optional().nullable(),fields:ze(Jk).optional().nullable()}),tD=se({count:_e(),me:Ne(),emoji:Ap}),nD=se({type:_e(),party_id:M().optional().nullable()}),rD=se({id:M(),cover_image:M().optional().nullable(),description:M(),icon:M().optional().nullable(),name:M()}),iD=se({message_id:M().optional().nullable(),channel_id:M().optional().nullable(),guild_id:M().optional().nullable()}),sD=se({id:M(),channel_id:M(),guild_id:M().optional().nullable(),author:Mi.optional().nullable(),member:_p.optional().nullable(),content:M(),timestamp:M(),edited_timestamp:M().optional().nullable(),tts:Ne(),mention_everyone:Ne(),mentions:ze(Mi),mention_roles:ze(M()),mention_channels:ze(Wk),attachments:ze(Yk),embeds:ze(eD),reactions:ze(tD).optional().nullable(),nonce:Sp([M(),_e()]).optional().nullable(),pinned:Ne(),webhook_id:M().optional().nullable(),type:_e(),activity:nD.optional().nullable(),application:rD.optional().nullable(),message_reference:iD.optional().nullable(),flags:_e().optional().nullable(),stickers:ze(Fo()).optional().nullable(),referenced_message:Fo().optional().nullable()}),aD=se({id:M(),name:M()}),oD={UNHANDLED:-1,KEYBOARD_KEY:0,MOUSE_BUTTON:1,KEYBOARD_MODIFIER_KEY:2,GAMEPAD_BUTTON:3},WT=se({type:rn(oD),code:_e(),name:M()}),lD={UNHANDLED:-1,PUSH_TO_TALK:"PUSH_TO_TALK",VOICE_ACTIVITY:"VOICE_ACTIVITY"},uD=se({type:rn(lD),auto_threshold:Ne(),threshold:_e(),shortcut:ze(WT),delay:_e()}),_0=se({device_id:M(),volume:_e(),available_devices:ze(aD)}),cD={UNHANDLED:-1,AUDIO_INPUT:"AUDIO_INPUT",AUDIO_OUTPUT:"AUDIO_OUTPUT",VIDEO_INPUT:"VIDEO_INPUT"};se({type:rn(cD),id:M(),vendor:se({name:M(),url:M()}),model:se({name:M(),url:M()}),related:ze(M()),echo_cancellation:Ne().optional().nullable(),noise_suppression:Ne().optional().nullable(),automatic_gain_control:Ne().optional().nullable(),hardware_mute:Ne().optional().nullable()});const dD={UNHANDLED:-1,APPLICATION:1,DLC:2,CONSUMABLE:3,BUNDLE:4,SUBSCRIPTION:5},fD=se({id:M(),name:M(),type:rn(dD),price:se({amount:_e(),currency:M()}),application_id:M(),flags:_e(),release_date:M().nullable()}),hD={UNHANDLED:-1,PURCHASE:1,PREMIUM_SUBSCRIPTION:2,DEVELOPER_GIFT:3,TEST_MODE_PURCHASE:4,FREE_PURCHASE:5,USER_GIFT:6,PREMIUM_PURCHASE:7},Ip=se({id:M(),sku_id:M(),application_id:M(),user_id:M(),gift_code_flags:_e(),type:rn(hD),gifter_user_id:M().optional().nullable(),branches:ze(M()).optional().nullable(),starts_at:M().optional().nullable(),ends_at:M().optional().nullable(),parent_id:M().optional().nullable(),consumed:Ne().optional().nullable(),deleted:Ne().optional().nullable(),gift_code_batch_id:M().optional().nullable()}),pD={UNHANDLED:-1,UNLOCKED:1,PORTRAIT:2,LANDSCAPE:3};rn(pD);const gD={UNHANDLED:-1,NOMINAL:0,FAIR:1,SERIOUS:2,CRITICAL:3},mD=rn(gD),YT={UNHANDLED:-1,PORTRAIT:0,LANDSCAPE:1};rn(YT);const qT={UNHANDLED:-1,FOCUSED:0,PIP:1,GRID:2};rn(qT);const Lp="ERROR";var Ze;(function(n){n.READY="READY",n.VOICE_STATE_UPDATE="VOICE_STATE_UPDATE",n.SPEAKING_START="SPEAKING_START",n.SPEAKING_STOP="SPEAKING_STOP",n.ACTIVITY_LAYOUT_MODE_UPDATE="ACTIVITY_LAYOUT_MODE_UPDATE",n.ORIENTATION_UPDATE="ORIENTATION_UPDATE",n.CURRENT_USER_UPDATE="CURRENT_USER_UPDATE",n.CURRENT_GUILD_MEMBER_UPDATE="CURRENT_GUILD_MEMBER_UPDATE",n.ENTITLEMENT_CREATE="ENTITLEMENT_CREATE",n.THERMAL_STATE_UPDATE="THERMAL_STATE_UPDATE",n.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE="ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE"})(Ze||(Ze={}));const In=pa.extend({evt:ha(Ze),nonce:M().nullable(),cmd:Nt(Bk),data:se({}).passthrough()}),XT=pa.extend({evt:Nt(Lp),data:se({code:_e(),message:M().optional()}).passthrough(),cmd:ha(Ie),nonce:M().nullable()}),yD=In.extend({evt:M()}),vD=Sp([In,yD,XT]);function ED(n){const e=n.evt;if(!(e in Ze))throw new Error(`Unrecognized event type ${n.evt}`);return TD[e].payload.parse(n)}const TD={[Ze.READY]:{payload:In.extend({evt:Nt(Ze.READY),data:se({v:_e(),config:se({cdn_host:M().optional(),api_endpoint:M(),environment:M()}),user:se({id:M(),username:M(),discriminator:M(),avatar:M().optional()}).optional()})})},[Ze.VOICE_STATE_UPDATE]:{payload:In.extend({evt:Nt(Ze.VOICE_STATE_UPDATE),data:HT}),subscribeArgs:se({channel_id:M()})},[Ze.SPEAKING_START]:{payload:In.extend({evt:Nt(Ze.SPEAKING_START),data:se({lobby_id:M().optional(),channel_id:M().optional(),user_id:M()})}),subscribeArgs:se({lobby_id:M().nullable().optional(),channel_id:M().nullable().optional()})},[Ze.SPEAKING_STOP]:{payload:In.extend({evt:Nt(Ze.SPEAKING_STOP),data:se({lobby_id:M().optional(),channel_id:M().optional(),user_id:M()})}),subscribeArgs:se({lobby_id:M().nullable().optional(),channel_id:M().nullable().optional()})},[Ze.ACTIVITY_LAYOUT_MODE_UPDATE]:{payload:In.extend({evt:Nt(Ze.ACTIVITY_LAYOUT_MODE_UPDATE),data:se({layout_mode:rn(qT)})})},[Ze.ORIENTATION_UPDATE]:{payload:In.extend({evt:Nt(Ze.ORIENTATION_UPDATE),data:se({screen_orientation:rn(YT),orientation:ha(qf)})})},[Ze.CURRENT_USER_UPDATE]:{payload:In.extend({evt:Nt(Ze.CURRENT_USER_UPDATE),data:Mi})},[Ze.CURRENT_GUILD_MEMBER_UPDATE]:{payload:In.extend({evt:Nt(Ze.CURRENT_GUILD_MEMBER_UPDATE),data:Gk}),subscribeArgs:se({guild_id:M()})},[Ze.ENTITLEMENT_CREATE]:{payload:In.extend({evt:Nt(Ze.ENTITLEMENT_CREATE),data:se({entitlement:Ip})})},[Ze.THERMAL_STATE_UPDATE]:{payload:In.extend({evt:Nt(Ze.THERMAL_STATE_UPDATE),data:se({thermal_state:mD})})},[Ze.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE]:{payload:In.extend({evt:Nt(Ze.ACTIVITY_INSTANCE_PARTICIPANTS_UPDATE),data:se({participants:GT.shape.participants})})}};function SD(n,e){throw e}const mc=se({}).nullable(),ZT=se({code:M()}),xD=se({guilds:ze(se({id:M(),name:M()}))}),_D=se({id:M(),name:M(),icon_url:M().optional(),members:ze(_p)}),ua=se({id:M(),type:rn(KT),guild_id:M().optional().nullable(),name:M().optional().nullable(),topic:M().optional().nullable(),bitrate:_e().optional().nullable(),user_limit:_e().optional().nullable(),position:_e().optional().nullable(),voice_states:ze(HT),messages:ze(sD)}),AD=se({channels:ze(zT)});ua.nullable();const ID=ua.nullable(),LD=ua.nullable();se({input:_0,output:_0,mode:uD,automatic_gain_control:Ne(),echo_cancellation:Ne(),noise_suppression:Ne(),qos:Ne(),silence_warning:Ne(),deaf:Ne(),mute:Ne()});const RD=se({evt:M()}),wD=se({shortcut:WT}),QT=Za,JT=se({skus:ze(fD)}),eS=se({entitlements:ze(Ip)}),tS=ze(Ip).nullable(),nS=se({use_interactive_pip:Ne()}),rS=se({locale:M()}),iS=se({enabled:Ne()}),sS=se({permissions:PT().or(M())}),aS=BT(se({opened:Ne().or(pc())}).default({opened:null})),oS=se({iosKeyboardResizesView:CT(Ne())}),bD=pa.extend({cmd:ha(Ie),evt:pc()});function kD({cmd:n,data:e}){switch(n){case Ie.AUTHORIZE:return ZT.parse(e);case Ie.CAPTURE_SHORTCUT:return wD.parse(e);case Ie.ENCOURAGE_HW_ACCELERATION:return iS.parse(e);case Ie.GET_CHANNEL:return ua.parse(e);case Ie.GET_CHANNELS:return AD.parse(e);case Ie.GET_CHANNEL_PERMISSIONS:return sS.parse(e);case Ie.GET_GUILD:return _D.parse(e);case Ie.GET_GUILDS:return xD.parse(e);case Ie.GET_PLATFORM_BEHAVIORS:return oS.parse(e);case Ie.GET_CHANNEL:return ua.parse(e);case Ie.SELECT_TEXT_CHANNEL:return LD.parse(e);case Ie.SELECT_VOICE_CHANNEL:return ID.parse(e);case Ie.SET_ACTIVITY:return QT.parse(e);case Ie.GET_SKUS_EMBEDDED:return JT.parse(e);case Ie.GET_ENTITLEMENTS_EMBEDDED:return eS.parse(e);case Ie.SET_CONFIG:return nS.parse(e);case Ie.START_PURCHASE:return tS.parse(e);case Ie.SUBSCRIBE:case Ie.UNSUBSCRIBE:return RD.parse(e);case Ie.USER_SETTINGS_GET_LOCALE:return rS.parse(e);case Ie.OPEN_EXTERNAL_LINK:return aS.parse(e);case Ie.SET_ORIENTATION_LOCK_STATE:case Ie.SET_CERTIFIED_DEVICES:case Ie.SEND_ANALYTICS_EVENT:case Ie.OPEN_INVITE_DIALOG:case Ie.CAPTURE_LOG:case Ie.GET_SKUS:case Ie.GET_ENTITLEMENTS:return mc.parse(e);case Ie.AUTHENTICATE:case Ie.INITIATE_IMAGE_UPLOAD:case Ie.OPEN_SHARE_MOMENT_DIALOG:case Ie.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS:case Ie.SHARE_LINK:const{response:t}=VT[n];return t.parse(e);default:SD(n,new Error(`Unrecognized command ${n}`))}}function DD(n){return Object.assign(Object.assign({},n),{data:kD(n)})}se({frame_id:M(),platform:ha(zr).optional().nullable()});se({v:Nt(1),encoding:Nt("json").optional(),client_id:M(),frame_id:M()});const PD=se({code:_e(),message:M().optional()}),CD=se({evt:M().nullable(),nonce:M().nullable(),data:Fo().nullable(),cmd:M()}).passthrough();function ND(n){const e=CD.parse(n);return e.evt!=null?e.evt===Lp?XT.parse(e):ED(vD.parse(e)):DD(bD.passthrough().parse(e))}function xn(n,e,t,r=()=>{}){const i=pa.extend({cmd:Nt(e),data:t});return async s=>{const a=await n({cmd:e,args:s,transfer:r(s)});return i.parse(a).data}}function Ko(n,e=()=>{}){const t=VT[n].response,r=pa.extend({cmd:Nt(n),data:t});return i=>async s=>{const a=await i({cmd:n,args:s,transfer:e(s)});return r.parse(a).data}}const OD=Ko(Dn.AUTHENTICATE),MD=n=>xn(n,Ie.AUTHORIZE,ZT),FD=n=>xn(n,Ie.CAPTURE_LOG,mc),UD=n=>xn(n,Ie.ENCOURAGE_HW_ACCELERATION,iS),BD=n=>xn(n,Ie.GET_ENTITLEMENTS_EMBEDDED,eS),$D=n=>xn(n,Ie.GET_SKUS_EMBEDDED,JT),GD=n=>xn(n,Ie.GET_CHANNEL_PERMISSIONS,sS),VD=n=>xn(n,Ie.GET_PLATFORM_BEHAVIORS,oS),jD=n=>xn(n,Ie.OPEN_EXTERNAL_LINK,aS),HD=n=>xn(n,Ie.OPEN_INVITE_DIALOG,mc),KD=Ko(Dn.OPEN_SHARE_MOMENT_DIALOG);Za.pick({state:!0,details:!0,timestamps:!0,assets:!0,party:!0,secrets:!0,instance:!0,type:!0}).extend({type:Za.shape.type.optional(),instance:Za.shape.instance.optional()}).nullable();const zD=n=>xn(n,Ie.SET_ACTIVITY,QT),WD=n=>xn(n,Ie.SET_CONFIG,nS);function YD({sendCommand:n,cmd:e,response:t,fallbackTransform:r,transferTransform:i=()=>{}}){const s=pa.extend({cmd:Nt(e),data:t});return async a=>{try{const o=await n({cmd:e,args:a,transfer:i(a)});return s.parse(o).data}catch(o){if(o.code===Yf.INVALID_PAYLOAD){const u=r(a),l=await n({cmd:e,args:u,transfer:i(u)});return s.parse(l).data}else throw o}}}const qD=n=>({lock_state:n.lock_state,picture_in_picture_lock_state:n.picture_in_picture_lock_state}),XD=n=>YD({sendCommand:n,cmd:Ie.SET_ORIENTATION_LOCK_STATE,response:mc,fallbackTransform:qD}),ZD=Ko(Dn.SHARE_LINK),QD=n=>xn(n,Ie.START_PURCHASE,tS),JD=n=>xn(n,Ie.USER_SETTINGS_GET_LOCALE,rS),eP=Ko(Dn.INITIATE_IMAGE_UPLOAD),tP=n=>xn(n,Ie.GET_CHANNEL,ua),nP=Ko(Dn.GET_ACTIVITY_INSTANCE_CONNECTED_PARTICIPANTS);function rP(n){return{authenticate:OD(n),authorize:MD(n),captureLog:FD(n),encourageHardwareAcceleration:UD(n),getChannel:tP(n),getChannelPermissions:GD(n),getEntitlements:BD(n),getPlatformBehaviors:VD(n),getSkus:$D(n),openExternalLink:jD(n),openInviteDialog:HD(n),openShareMomentDialog:KD(n),setActivity:zD(n),setConfig:WD(n),setOrientationLockState:XD(n),shareLink:ZD(n),startPurchase:QD(n),userSettingsGetLocale:JD(n),initiateImageUpload:eP(n),getInstanceConnectedParticipants:nP(n)}}class iP extends Error{constructor(e,t=""){super(t),this.code=e,this.message=t,this.name="Discord SDK Error"}}function sP(){return{disableConsoleLogOverride:!1}}const aP=["log","warn","debug","info","error"];function oP(n,e,t){const r=n[e],i=n;r&&(n[e]=function(){const s=[].slice.call(arguments),a=""+s.join(" ");t(e,a),r.apply(i,s)})}var lP="1.9.0",uP=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),A0={randomUUID:uP},Fl,cP=new Uint8Array(16);function dP(){if(!Fl&&(Fl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fl(cP)}var Vt=[];for(var wd=0;wd<256;++wd)Vt.push((wd+256).toString(16).slice(1));function fP(n,e=0){return(Vt[n[e+0]]+Vt[n[e+1]]+Vt[n[e+2]]+Vt[n[e+3]]+"-"+Vt[n[e+4]]+Vt[n[e+5]]+"-"+Vt[n[e+6]]+Vt[n[e+7]]+"-"+Vt[n[e+8]]+Vt[n[e+9]]+"-"+Vt[n[e+10]]+Vt[n[e+11]]+Vt[n[e+12]]+Vt[n[e+13]]+Vt[n[e+14]]+Vt[n[e+15]]).toLowerCase()}function I0(n,e,t){if(A0.randomUUID&&!n)return A0.randomUUID();n=n||{};var r=n.random||(n.rng||dP)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,fP(r)}var Hr;(function(n){n[n.HANDSHAKE=0]="HANDSHAKE",n[n.FRAME=1]="FRAME",n[n.CLOSE=2]="CLOSE",n[n.HELLO=3]="HELLO"})(Hr||(Hr={}));const hP=new Set(pP());function pP(){return typeof window>"u"?[]:[window.location.origin,"https://discord.com","https://discordapp.com","https://ptb.discord.com","https://ptb.discordapp.com","https://canary.discord.com","https://canary.discordapp.com","https://staging.discord.co","http://localhost:3333","https://pax.discord.com","null"]}function gP(){var n;return[(n=window.parent.opener)!==null&&n!==void 0?n:window.parent,document.referrer?document.referrer:"*"]}class mP{getTransfer(e){var t;switch(e.cmd){case Ie.SUBSCRIBE:case Ie.UNSUBSCRIBE:return;default:return(t=e.transfer)!==null&&t!==void 0?t:void 0}}constructor(e,t){if(this.sdkVersion=lP,this.mobileAppVersion=null,this.source=null,this.sourceOrigin="",this.eventBus=new Ib,this.pendingCommands=new Map,this.sendCommand=o=>{var u;if(this.source==null)throw new Error("Attempting to send message before initialization");const l=I0();return(u=this.source)===null||u===void 0||u.postMessage([Hr.FRAME,Object.assign(Object.assign({},o),{nonce:l})],this.sourceOrigin,this.getTransfer(o)),new Promise((d,f)=>{this.pendingCommands.set(l,{resolve:d,reject:f})})},this.commands=rP(this.sendCommand),this.handleMessage=o=>{if(!hP.has(o.origin))return;const u=o.data;if(!Array.isArray(u))return;const[l,c]=u;switch(l){case Hr.HELLO:return;case Hr.CLOSE:return this.handleClose(c);case Hr.HANDSHAKE:return this.handleHandshake();case Hr.FRAME:return this.handleFrame(c);default:throw new Error("Invalid message format")}},this.isReady=!1,this.clientId=e,this.configuration=t??sP(),typeof window<"u"&&window.addEventListener("message",this.handleMessage),typeof window>"u"){this.frameId="",this.instanceId="",this.customId=null,this.referrerId=null,this.platform=zr.DESKTOP,this.guildId=null,this.channelId=null,this.locationId=null;return}const r=new URLSearchParams(this._getSearch()),i=r.get("frame_id");if(!i)throw new Error("frame_id query param is not defined");this.frameId=i;const s=r.get("instance_id");if(!s)throw new Error("instance_id query param is not defined");this.instanceId=s;const a=r.get("platform");if(a){if(a!==zr.DESKTOP&&a!==zr.MOBILE)throw new Error(`Invalid query param "platform" of "${a}". Valid values are "${zr.DESKTOP}" or "${zr.MOBILE}"`)}else throw new Error("platform query param is not defined");this.platform=a,this.customId=r.get("custom_id"),this.referrerId=r.get("referrer_id"),this.guildId=r.get("guild_id"),this.channelId=r.get("channel_id"),this.locationId=r.get("location_id"),this.mobileAppVersion=r.get("mobile_app_version"),[this.source,this.sourceOrigin]=gP(),this.addOnReadyListener(),this.handshake()}close(e,t){var r;window.removeEventListener("message",this.handleMessage);const i=I0();(r=this.source)===null||r===void 0||r.postMessage([Hr.CLOSE,{code:e,message:t,nonce:i}],this.sourceOrigin)}async subscribe(e,t,...r){const[i]=r,s=this.eventBus.listenerCount(e),a=this.eventBus.on(e,t);return Object.values(Ze).includes(e)&&e!==Ze.READY&&s===0&&await this.sendCommand({cmd:Ie.SUBSCRIBE,args:i,evt:e}),a}async unsubscribe(e,t,...r){const[i]=r;return e!==Ze.READY&&this.eventBus.listenerCount(e)===1&&await this.sendCommand({cmd:Ie.UNSUBSCRIBE,evt:e,args:i}),this.eventBus.off(e,t)}async ready(){this.isReady||await new Promise(e=>{this.eventBus.once(Ze.READY,e)})}parseMajorMobileVersion(){if(this.mobileAppVersion&&this.mobileAppVersion.includes("."))try{return parseInt(this.mobileAppVersion.split(".")[0])}catch{return T0}return T0}handshake(){var e;const t={v:1,encoding:"json",client_id:this.clientId,frame_id:this.frameId},r=this.parseMajorMobileVersion();(this.platform===zr.DESKTOP||r>=Pk)&&(t.sdk_version=this.sdkVersion),(e=this.source)===null||e===void 0||e.postMessage([Hr.HANDSHAKE,t],this.sourceOrigin)}addOnReadyListener(){this.eventBus.once(Ze.READY,()=>{this.overrideConsoleLogging(),this.isReady=!0})}overrideConsoleLogging(){if(this.configuration.disableConsoleLogOverride)return;const e=(t,r)=>{this.commands.captureLog({level:t,message:r})};aP.forEach(t=>{oP(console,t,e)})}handleClose(e){PD.parse(e)}handleHandshake(){}handleFrame(e){var t,r;let i;try{i=ND(e)}catch(s){console.error("Failed to parse",e),console.error(s);return}if(i.cmd==="DISPATCH")this.eventBus.emit(i.evt,i.data);else{if(i.evt===Lp){if(i.nonce!=null){(t=this.pendingCommands.get(i.nonce))===null||t===void 0||t.reject(i.data),this.pendingCommands.delete(i.nonce);return}this.eventBus.emit("error",new iP(i.data.code,i.data.message))}if(i.nonce==null){console.error("Missing nonce",e);return}(r=this.pendingCommands.get(i.nonce))===null||r===void 0||r.resolve(i),this.pendingCommands.delete(i.nonce)}}_getSearch(){return typeof window>"u"?"":window.location.search}}var ga=1e9,yP={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},hS,ft=!0,Zn="[DecimalError] ",is=Zn+"Invalid argument: ",Rp=Zn+"Exponent out of range: ",ma=Math.floor,Xi=Math.pow,vP=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Pn,Bt=1e7,ut=7,lS=9007199254740991,Wu=ma(lS/ut),me={};me.absoluteValue=me.abs=function(){var n=new this.constructor(this);return n.s&&(n.s=1),n};me.comparedTo=me.cmp=function(n){var e,t,r,i,s=this;if(n=new s.constructor(n),s.s!==n.s)return s.s||-n.s;if(s.e!==n.e)return s.e>n.e^s.s<0?1:-1;for(r=s.d.length,i=n.d.length,e=0,t=r<i?r:i;e<t;++e)if(s.d[e]!==n.d[e])return s.d[e]>n.d[e]^s.s<0?1:-1;return r===i?0:r>i^s.s<0?1:-1};me.decimalPlaces=me.dp=function(){var n=this,e=n.d.length-1,t=(e-n.e)*ut;if(e=n.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};me.dividedBy=me.div=function(n){return Xr(this,new this.constructor(n))};me.dividedToIntegerBy=me.idiv=function(n){var e=this,t=e.constructor;return st(Xr(e,new t(n),0,1),t.precision)};me.equals=me.eq=function(n){return!this.cmp(n)};me.exponent=function(){return bt(this)};me.greaterThan=me.gt=function(n){return this.cmp(n)>0};me.greaterThanOrEqualTo=me.gte=function(n){return this.cmp(n)>=0};me.isInteger=me.isint=function(){return this.e>this.d.length-2};me.isNegative=me.isneg=function(){return this.s<0};me.isPositive=me.ispos=function(){return this.s>0};me.isZero=function(){return this.s===0};me.lessThan=me.lt=function(n){return this.cmp(n)<0};me.lessThanOrEqualTo=me.lte=function(n){return this.cmp(n)<1};me.logarithm=me.log=function(n){var e,t=this,r=t.constructor,i=r.precision,s=i+5;if(n===void 0)n=new r(10);else if(n=new r(n),n.s<1||n.eq(Pn))throw Error(Zn+"NaN");if(t.s<1)throw Error(Zn+(t.s?"NaN":"-Infinity"));return t.eq(Pn)?new r(0):(ft=!1,e=Xr(Uo(t,s),Uo(n,s),s),ft=!0,st(e,i))};me.minus=me.sub=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?dS(e,n):uS(e,(n.s=-n.s,n))};me.modulo=me.mod=function(n){var e,t=this,r=t.constructor,i=r.precision;if(n=new r(n),!n.s)throw Error(Zn+"NaN");return t.s?(ft=!1,e=Xr(t,n,0,1).times(n),ft=!0,t.minus(e)):st(new r(t),i)};me.naturalExponential=me.exp=function(){return cS(this)};me.naturalLogarithm=me.ln=function(){return Uo(this)};me.negated=me.neg=function(){var n=new this.constructor(this);return n.s=-n.s||0,n};me.plus=me.add=function(n){var e=this;return n=new e.constructor(n),e.s==n.s?uS(e,n):dS(e,(n.s=-n.s,n))};me.precision=me.sd=function(n){var e,t,r,i=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(is+n);if(e=bt(i)+1,r=i.d.length-1,t=r*ut+1,r=i.d[r],r){for(;r%10==0;r/=10)t--;for(r=i.d[0];r>=10;r/=10)t++}return n&&e>t?e:t};me.squareRoot=me.sqrt=function(){var n,e,t,r,i,s,a,o=this,u=o.constructor;if(o.s<1){if(!o.s)return new u(0);throw Error(Zn+"NaN")}for(n=bt(o),ft=!1,i=Math.sqrt(+o),i==0||i==1/0?(e=_r(o.d),(e.length+n)%2==0&&(e+="0"),i=Math.sqrt(e),n=ma((n+1)/2)-(n<0||n%2),i==1/0?e="5e"+n:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+n),r=new u(e)):r=new u(i.toString()),t=u.precision,i=a=t+3;;)if(s=r,r=s.plus(Xr(o,s,a+2)).times(.5),_r(s.d).slice(0,a)===(e=_r(r.d)).slice(0,a)){if(e=e.slice(a-3,a+1),i==a&&e=="4999"){if(st(s,t+1,0),s.times(s).eq(o)){r=s;break}}else if(e!="9999")break;a+=4}return ft=!0,st(r,t)};me.times=me.mul=function(n){var e,t,r,i,s,a,o,u,l,c=this,d=c.constructor,f=c.d,h=(n=new d(n)).d;if(!c.s||!n.s)return new d(0);for(n.s*=c.s,t=c.e+n.e,u=f.length,l=h.length,u<l&&(s=f,f=h,h=s,a=u,u=l,l=a),s=[],a=u+l,r=a;r--;)s.push(0);for(r=l;--r>=0;){for(e=0,i=u+r;i>r;)o=s[i]+h[r]*f[i-r-1]+e,s[i--]=o%Bt|0,e=o/Bt|0;s[i]=(s[i]+e)%Bt|0}for(;!s[--a];)s.pop();return e?++t:s.shift(),n.d=s,n.e=t,ft?st(n,d.precision):n};me.toDecimalPlaces=me.todp=function(n,e){var t=this,r=t.constructor;return t=new r(t),n===void 0?t:(Dr(n,0,ga),e===void 0?e=r.rounding:Dr(e,0,8),st(t,n+bt(t)+1,e))};me.toExponential=function(n,e){var t,r=this,i=r.constructor;return n===void 0?t=hs(r,!0):(Dr(n,0,ga),e===void 0?e=i.rounding:Dr(e,0,8),r=st(new i(r),n+1,e),t=hs(r,!0,n+1)),t};me.toFixed=function(n,e){var t,r,i=this,s=i.constructor;return n===void 0?hs(i):(Dr(n,0,ga),e===void 0?e=s.rounding:Dr(e,0,8),r=st(new s(i),n+bt(i)+1,e),t=hs(r.abs(),!1,n+bt(r)+1),i.isneg()&&!i.isZero()?"-"+t:t)};me.toInteger=me.toint=function(){var n=this,e=n.constructor;return st(new e(n),bt(n)+1,e.rounding)};me.toNumber=function(){return+this};me.toPower=me.pow=function(n){var e,t,r,i,s,a,o=this,u=o.constructor,l=12,c=+(n=new u(n));if(!n.s)return new u(Pn);if(o=new u(o),!o.s){if(n.s<1)throw Error(Zn+"Infinity");return o}if(o.eq(Pn))return o;if(r=u.precision,n.eq(Pn))return st(o,r);if(e=n.e,t=n.d.length-1,a=e>=t,s=o.s,a){if((t=c<0?-c:c)<=lS){for(i=new u(Pn),e=Math.ceil(r/ut+4),ft=!1;t%2&&(i=i.times(o),R0(i.d,e)),t=ma(t/2),t!==0;)o=o.times(o),R0(o.d,e);return ft=!0,n.s<0?new u(Pn).div(i):st(i,r)}}else if(s<0)throw Error(Zn+"NaN");return s=s<0&&n.d[Math.max(e,t)]&1?-1:1,o.s=1,ft=!1,i=n.times(Uo(o,r+l)),ft=!0,i=cS(i),i.s=s,i};me.toPrecision=function(n,e){var t,r,i=this,s=i.constructor;return n===void 0?(t=bt(i),r=hs(i,t<=s.toExpNeg||t>=s.toExpPos)):(Dr(n,1,ga),e===void 0?e=s.rounding:Dr(e,0,8),i=st(new s(i),n,e),t=bt(i),r=hs(i,n<=t||t<=s.toExpNeg,n)),r};me.toSignificantDigits=me.tosd=function(n,e){var t=this,r=t.constructor;return n===void 0?(n=r.precision,e=r.rounding):(Dr(n,1,ga),e===void 0?e=r.rounding:Dr(e,0,8)),st(new r(t),n,e)};me.toString=me.valueOf=me.val=me.toJSON=me[Symbol.for("nodejs.util.inspect.custom")]=function(){var n=this,e=bt(n),t=n.constructor;return hs(n,e<=t.toExpNeg||e>=t.toExpPos)};function uS(n,e){var t,r,i,s,a,o,u,l,c=n.constructor,d=c.precision;if(!n.s||!e.s)return e.s||(e=new c(n)),ft?st(e,d):e;if(u=n.d,l=e.d,a=n.e,i=e.e,u=u.slice(),s=a-i,s){for(s<0?(r=u,s=-s,o=l.length):(r=l,i=a,o=u.length),a=Math.ceil(d/ut),o=a>o?a+1:o+1,s>o&&(s=o,r.length=1),r.reverse();s--;)r.push(0);r.reverse()}for(o=u.length,s=l.length,o-s<0&&(s=o,r=l,l=u,u=r),t=0;s;)t=(u[--s]=u[s]+l[s]+t)/Bt|0,u[s]%=Bt;for(t&&(u.unshift(t),++i),o=u.length;u[--o]==0;)u.pop();return e.d=u,e.e=i,ft?st(e,d):e}function Dr(n,e,t){if(n!==~~n||n<e||n>t)throw Error(is+n)}function _r(n){var e,t,r,i=n.length-1,s="",a=n[0];if(i>0){for(s+=a,e=1;e<i;e++)r=n[e]+"",t=ut-r.length,t&&(s+=fi(t)),s+=r;a=n[e],r=a+"",t=ut-r.length,t&&(s+=fi(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}var Xr=function(){function n(r,i){var s,a=0,o=r.length;for(r=r.slice();o--;)s=r[o]*i+a,r[o]=s%Bt|0,a=s/Bt|0;return a&&r.unshift(a),r}function e(r,i,s,a){var o,u;if(s!=a)u=s>a?1:-1;else for(o=u=0;o<s;o++)if(r[o]!=i[o]){u=r[o]>i[o]?1:-1;break}return u}function t(r,i,s){for(var a=0;s--;)r[s]-=a,a=r[s]<i[s]?1:0,r[s]=a*Bt+r[s]-i[s];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,s,a){var o,u,l,c,d,f,h,p,g,m,v,y,E,_,I,b,L,w,D=r.constructor,R=r.s==i.s?1:-1,N=r.d,G=i.d;if(!r.s)return new D(r);if(!i.s)throw Error(Zn+"Division by zero");for(u=r.e-i.e,L=G.length,I=N.length,h=new D(R),p=h.d=[],l=0;G[l]==(N[l]||0);)++l;if(G[l]>(N[l]||0)&&--u,s==null?y=s=D.precision:a?y=s+(bt(r)-bt(i))+1:y=s,y<0)return new D(0);if(y=y/ut+2|0,l=0,L==1)for(c=0,G=G[0],y++;(l<I||c)&&y--;l++)E=c*Bt+(N[l]||0),p[l]=E/G|0,c=E%G|0;else{for(c=Bt/(G[0]+1)|0,c>1&&(G=n(G,c),N=n(N,c),L=G.length,I=N.length),_=L,g=N.slice(0,L),m=g.length;m<L;)g[m++]=0;w=G.slice(),w.unshift(0),b=G[0],G[1]>=Bt/2&&++b;do c=0,o=e(G,g,L,m),o<0?(v=g[0],L!=m&&(v=v*Bt+(g[1]||0)),c=v/b|0,c>1?(c>=Bt&&(c=Bt-1),d=n(G,c),f=d.length,m=g.length,o=e(d,g,f,m),o==1&&(c--,t(d,L<f?w:G,f))):(c==0&&(o=c=1),d=G.slice()),f=d.length,f<m&&d.unshift(0),t(g,d,m),o==-1&&(m=g.length,o=e(G,g,L,m),o<1&&(c++,t(g,L<m?w:G,m))),m=g.length):o===0&&(c++,g=[0]),p[l++]=c,o&&g[0]?g[m++]=N[_]||0:(g=[N[_]],m=1);while((_++<I||g[0]!==void 0)&&y--)}return p[0]||p.shift(),h.e=u,st(h,a?s+bt(h)+1:s)}}();function cS(n,e){var t,r,i,s,a,o,u=0,l=0,c=n.constructor,d=c.precision;if(bt(n)>16)throw Error(Rp+bt(n));if(!n.s)return new c(Pn);for(ft=!1,o=d,a=new c(.03125);n.abs().gte(.1);)n=n.times(a),l+=5;for(r=Math.log(Xi(2,l))/Math.LN10*2+5|0,o+=r,t=i=s=new c(Pn),c.precision=o;;){if(i=st(i.times(n),o),t=t.times(++u),a=s.plus(Xr(i,t,o)),_r(a.d).slice(0,o)===_r(s.d).slice(0,o)){for(;l--;)s=st(s.times(s),o);return c.precision=d,e==null?(ft=!0,st(s,d)):s}s=a}}function bt(n){for(var e=n.e*ut,t=n.d[0];t>=10;t/=10)e++;return e}function bd(n,e,t){if(e>n.LN10.sd())throw ft=!0,t&&(n.precision=t),Error(Zn+"LN10 precision limit exceeded");return st(new n(n.LN10),e)}function fi(n){for(var e="";n--;)e+="0";return e}function Uo(n,e){var t,r,i,s,a,o,u,l,c,d=1,f=10,h=n,p=h.d,g=h.constructor,m=g.precision;if(h.s<1)throw Error(Zn+(h.s?"NaN":"-Infinity"));if(h.eq(Pn))return new g(0);if(e==null?(ft=!1,l=m):l=e,h.eq(10))return e==null&&(ft=!0),bd(g,l);if(l+=f,g.precision=l,t=_r(p),r=t.charAt(0),s=bt(h),Math.abs(s)<15e14){for(;r<7&&r!=1||r==1&&t.charAt(1)>3;)h=h.times(n),t=_r(h.d),r=t.charAt(0),d++;s=bt(h),r>1?(h=new g("0."+t),s++):h=new g(r+"."+t.slice(1))}else return u=bd(g,l+2,m).times(s+""),h=Uo(new g(r+"."+t.slice(1)),l-f).plus(u),g.precision=m,e==null?(ft=!0,st(h,m)):h;for(o=a=h=Xr(h.minus(Pn),h.plus(Pn),l),c=st(h.times(h),l),i=3;;){if(a=st(a.times(c),l),u=o.plus(Xr(a,new g(i),l)),_r(u.d).slice(0,l)===_r(o.d).slice(0,l))return o=o.times(2),s!==0&&(o=o.plus(bd(g,l+2,m).times(s+""))),o=Xr(o,new g(d),l),g.precision=m,e==null?(ft=!0,st(o,m)):o;o=u,i+=2}}function L0(n,e){var t,r,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),r=0;e.charCodeAt(r)===48;)++r;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(r,i),e){if(i-=r,t=t-r-1,n.e=ma(t/ut),n.d=[],r=(t+1)%ut,t<0&&(r+=ut),r<i){for(r&&n.d.push(+e.slice(0,r)),i-=ut;r<i;)n.d.push(+e.slice(r,r+=ut));e=e.slice(r),r=ut-e.length}else r-=i;for(;r--;)e+="0";if(n.d.push(+e),ft&&(n.e>Wu||n.e<-Wu))throw Error(Rp+t)}else n.s=0,n.e=0,n.d=[0];return n}function st(n,e,t){var r,i,s,a,o,u,l,c,d=n.d;for(a=1,s=d[0];s>=10;s/=10)a++;if(r=e-a,r<0)r+=ut,i=e,l=d[c=0];else{if(c=Math.ceil((r+1)/ut),s=d.length,c>=s)return n;for(l=s=d[c],a=1;s>=10;s/=10)a++;r%=ut,i=r-ut+a}if(t!==void 0&&(s=Xi(10,a-i-1),o=l/s%10|0,u=e<0||d[c+1]!==void 0||l%s,u=t<4?(o||u)&&(t==0||t==(n.s<0?3:2)):o>5||o==5&&(t==4||u||t==6&&(r>0?i>0?l/Xi(10,a-i):0:d[c-1])%10&1||t==(n.s<0?8:7))),e<1||!d[0])return u?(s=bt(n),d.length=1,e=e-s-1,d[0]=Xi(10,(ut-e%ut)%ut),n.e=ma(-e/ut)||0):(d.length=1,d[0]=n.e=n.s=0),n;if(r==0?(d.length=c,s=1,c--):(d.length=c+1,s=Xi(10,ut-r),d[c]=i>0?(l/Xi(10,a-i)%Xi(10,i)|0)*s:0),u)for(;;)if(c==0){(d[0]+=s)==Bt&&(d[0]=1,++n.e);break}else{if(d[c]+=s,d[c]!=Bt)break;d[c--]=0,s=1}for(r=d.length;d[--r]===0;)d.pop();if(ft&&(n.e>Wu||n.e<-Wu))throw Error(Rp+bt(n));return n}function dS(n,e){var t,r,i,s,a,o,u,l,c,d,f=n.constructor,h=f.precision;if(!n.s||!e.s)return e.s?e.s=-e.s:e=new f(n),ft?st(e,h):e;if(u=n.d,d=e.d,r=e.e,l=n.e,u=u.slice(),a=l-r,a){for(c=a<0,c?(t=u,a=-a,o=d.length):(t=d,r=l,o=u.length),i=Math.max(Math.ceil(h/ut),o)+2,a>i&&(a=i,t.length=1),t.reverse(),i=a;i--;)t.push(0);t.reverse()}else{for(i=u.length,o=d.length,c=i<o,c&&(o=i),i=0;i<o;i++)if(u[i]!=d[i]){c=u[i]<d[i];break}a=0}for(c&&(t=u,u=d,d=t,e.s=-e.s),o=u.length,i=d.length-o;i>0;--i)u[o++]=0;for(i=d.length;i>a;){if(u[--i]<d[i]){for(s=i;s&&u[--s]===0;)u[s]=Bt-1;--u[s],u[i]+=Bt}u[i]-=d[i]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=r,ft?st(e,h):e):new f(0)}function hs(n,e,t){var r,i=bt(n),s=_r(n.d),a=s.length;return e?(t&&(r=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+fi(r):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(i<0?"e":"e+")+i):i<0?(s="0."+fi(-i-1)+s,t&&(r=t-a)>0&&(s+=fi(r))):i>=a?(s+=fi(i+1-a),t&&(r=t-i-1)>0&&(s=s+"."+fi(r))):((r=i+1)<a&&(s=s.slice(0,r)+"."+s.slice(r)),t&&(r=t-a)>0&&(i+1===a&&(s+="."),s+=fi(r))),n.s<0?"-"+s:s}function R0(n,e){if(n.length>e)return n.length=e,!0}function fS(n){var e,t,r;function i(s){var a=this;if(!(a instanceof i))return new i(s);if(a.constructor=i,s instanceof i){a.s=s.s,a.e=s.e,a.d=(s=s.d)?s.slice():s;return}if(typeof s=="number"){if(s*0!==0)throw Error(is+s);if(s>0)a.s=1;else if(s<0)s=-s,a.s=-1;else{a.s=0,a.e=0,a.d=[0];return}if(s===~~s&&s<1e7){a.e=0,a.d=[s];return}return L0(a,s.toString())}else if(typeof s!="string")throw Error(is+s);if(s.charCodeAt(0)===45?(s=s.slice(1),a.s=-1):a.s=1,vP.test(s))L0(a,s);else throw Error(is+s)}if(i.prototype=me,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=fS,i.config=i.set=EP,n===void 0&&(n={}),n)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<r.length;)n.hasOwnProperty(t=r[e++])||(n[t]=this[t]);return i.config(n),i}function EP(n){if(!n||typeof n!="object")throw Error(Zn+"Object expected");var e,t,r,i=["precision",1,ga,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((r=n[t=i[e]])!==void 0)if(ma(r)===r&&r>=i[e+1]&&r<=i[e+2])this[t]=r;else throw Error(is+t+": "+r);if((r=n[t="LN10"])!==void 0)if(r==Math.LN10)this[t]=new this(r);else throw Error(is+t+": "+r);return this}var hS=fS(yP);Pn=new hS(1);var F;(function(n){n.AED="aed",n.AFN="afn",n.ALL="all",n.AMD="amd",n.ANG="ang",n.AOA="aoa",n.ARS="ars",n.AUD="aud",n.AWG="awg",n.AZN="azn",n.BAM="bam",n.BBD="bbd",n.BDT="bdt",n.BGN="bgn",n.BHD="bhd",n.BIF="bif",n.BMD="bmd",n.BND="bnd",n.BOB="bob",n.BOV="bov",n.BRL="brl",n.BSD="bsd",n.BTN="btn",n.BWP="bwp",n.BYN="byn",n.BYR="byr",n.BZD="bzd",n.CAD="cad",n.CDF="cdf",n.CHE="che",n.CHF="chf",n.CHW="chw",n.CLF="clf",n.CLP="clp",n.CNY="cny",n.COP="cop",n.COU="cou",n.CRC="crc",n.CUC="cuc",n.CUP="cup",n.CVE="cve",n.CZK="czk",n.DJF="djf",n.DKK="dkk",n.DOP="dop",n.DZD="dzd",n.EGP="egp",n.ERN="ern",n.ETB="etb",n.EUR="eur",n.FJD="fjd",n.FKP="fkp",n.GBP="gbp",n.GEL="gel",n.GHS="ghs",n.GIP="gip",n.GMD="gmd",n.GNF="gnf",n.GTQ="gtq",n.GYD="gyd",n.HKD="hkd",n.HNL="hnl",n.HRK="hrk",n.HTG="htg",n.HUF="huf",n.IDR="idr",n.ILS="ils",n.INR="inr",n.IQD="iqd",n.IRR="irr",n.ISK="isk",n.JMD="jmd",n.JOD="jod",n.JPY="jpy",n.KES="kes",n.KGS="kgs",n.KHR="khr",n.KMF="kmf",n.KPW="kpw",n.KRW="krw",n.KWD="kwd",n.KYD="kyd",n.KZT="kzt",n.LAK="lak",n.LBP="lbp",n.LKR="lkr",n.LRD="lrd",n.LSL="lsl",n.LTL="ltl",n.LVL="lvl",n.LYD="lyd",n.MAD="mad",n.MDL="mdl",n.MGA="mga",n.MKD="mkd",n.MMK="mmk",n.MNT="mnt",n.MOP="mop",n.MRO="mro",n.MUR="mur",n.MVR="mvr",n.MWK="mwk",n.MXN="mxn",n.MXV="mxv",n.MYR="myr",n.MZN="mzn",n.NAD="nad",n.NGN="ngn",n.NIO="nio",n.NOK="nok",n.NPR="npr",n.NZD="nzd",n.OMR="omr",n.PAB="pab",n.PEN="pen",n.PGK="pgk",n.PHP="php",n.PKR="pkr",n.PLN="pln",n.PYG="pyg",n.QAR="qar",n.RON="ron",n.RSD="rsd",n.RUB="rub",n.RWF="rwf",n.SAR="sar",n.SBD="sbd",n.SCR="scr",n.SDG="sdg",n.SEK="sek",n.SGD="sgd",n.SHP="shp",n.SLL="sll",n.SOS="sos",n.SRD="srd",n.SSP="ssp",n.STD="std",n.SVC="svc",n.SYP="syp",n.SZL="szl",n.THB="thb",n.TJS="tjs",n.TMT="tmt",n.TND="tnd",n.TOP="top",n.TRY="try",n.TTD="ttd",n.TWD="twd",n.TZS="tzs",n.UAH="uah",n.UGX="ugx",n.USD="usd",n.USN="usn",n.USS="uss",n.UYI="uyi",n.UYU="uyu",n.UZS="uzs",n.VEF="vef",n.VND="vnd",n.VUV="vuv",n.WST="wst",n.XAF="xaf",n.XAG="xag",n.XAU="xau",n.XBA="xba",n.XBB="xbb",n.XBC="xbc",n.XBD="xbd",n.XCD="xcd",n.XDR="xdr",n.XFU="xfu",n.XOF="xof",n.XPD="xpd",n.XPF="xpf",n.XPT="xpt",n.XSU="xsu",n.XTS="xts",n.XUA="xua",n.YER="yer",n.ZAR="zar",n.ZMW="zmw",n.ZWL="zwl"})(F||(F={}));F.AED+"",F.AFN+"",F.ALL+"",F.AMD+"",F.ANG+"",F.AOA+"",F.ARS+"",F.AUD+"",F.AWG+"",F.AZN+"",F.BAM+"",F.BBD+"",F.BDT+"",F.BGN+"",F.BHD+"",F.BIF+"",F.BMD+"",F.BND+"",F.BOB+"",F.BOV+"",F.BRL+"",F.BSD+"",F.BTN+"",F.BWP+"",F.BYR+"",F.BYN+"",F.BZD+"",F.CAD+"",F.CDF+"",F.CHE+"",F.CHF+"",F.CHW+"",F.CLF+"",F.CLP+"",F.CNY+"",F.COP+"",F.COU+"",F.CRC+"",F.CUC+"",F.CUP+"",F.CVE+"",F.CZK+"",F.DJF+"",F.DKK+"",F.DOP+"",F.DZD+"",F.EGP+"",F.ERN+"",F.ETB+"",F.EUR+"",F.FJD+"",F.FKP+"",F.GBP+"",F.GEL+"",F.GHS+"",F.GIP+"",F.GMD+"",F.GNF+"",F.GTQ+"",F.GYD+"",F.HKD+"",F.HNL+"",F.HRK+"",F.HTG+"",F.HUF+"",F.IDR+"",F.ILS+"",F.INR+"",F.IQD+"",F.IRR+"",F.ISK+"",F.JMD+"",F.JOD+"",F.JPY+"",F.KES+"",F.KGS+"",F.KHR+"",F.KMF+"",F.KPW+"",F.KRW+"",F.KWD+"",F.KYD+"",F.KZT+"",F.LAK+"",F.LBP+"",F.LKR+"",F.LRD+"",F.LSL+"",F.LTL+"",F.LVL+"",F.LYD+"",F.MAD+"",F.MDL+"",F.MGA+"",F.MKD+"",F.MMK+"",F.MNT+"",F.MOP+"",F.MRO+"",F.MUR+"",F.MVR+"",F.MWK+"",F.MXN+"",F.MXV+"",F.MYR+"",F.MZN+"",F.NAD+"",F.NGN+"",F.NIO+"",F.NOK+"",F.NPR+"",F.NZD+"",F.OMR+"",F.PAB+"",F.PEN+"",F.PGK+"",F.PHP+"",F.PKR+"",F.PLN+"",F.PYG+"",F.QAR+"",F.RON+"",F.RSD+"",F.RUB+"",F.RWF+"",F.SAR+"",F.SBD+"",F.SCR+"",F.SDG+"",F.SEK+"",F.SGD+"",F.SHP+"",F.SLL+"",F.SOS+"",F.SRD+"",F.SSP+"",F.STD+"",F.SVC+"",F.SYP+"",F.SZL+"",F.THB+"",F.TJS+"",F.TMT+"",F.TND+"",F.TOP+"",F.TRY+"",F.TTD+"",F.TWD+"",F.TZS+"",F.UAH+"",F.UGX+"",F.USD+"",F.USN+"",F.USS+"",F.UYI+"",F.UYU+"",F.UZS+"",F.VEF+"",F.VND+"",F.VUV+"",F.WST+"",F.XAF+"",F.XAG+"",F.XAU+"",F.XBA+"",F.XBB+"",F.XBC+"",F.XBD+"",F.XCD+"",F.XDR+"",F.XFU+"",F.XOF+"",F.XPD+"",F.XPF+"",F.XPT+"",F.XSU+"",F.XTS+"",F.XUA+"",F.YER+"",F.ZAR+"",F.ZMW+"",F.ZWL+"";var Ua={exports:{}};Ua.exports;var w0;function TP(){return w0||(w0=1,function(n,e){var t=200,r="Expected a function",i="__lodash_hash_undefined__",s=1,a=2,o=9007199254740991,u="[object Arguments]",l="[object Array]",c="[object Boolean]",d="[object Date]",f="[object Error]",h="[object Function]",p="[object GeneratorFunction]",g="[object Map]",m="[object Number]",v="[object Object]",y="[object Promise]",E="[object RegExp]",_="[object Set]",I="[object String]",b="[object Symbol]",L="[object WeakMap]",w="[object ArrayBuffer]",D="[object DataView]",R="[object Float32Array]",N="[object Float64Array]",G="[object Int8Array]",ee="[object Int16Array]",oe="[object Int32Array]",re="[object Uint8Array]",J="[object Uint8ClampedArray]",le="[object Uint16Array]",V="[object Uint32Array]",W=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z=/^\w*$/,q=/^\./,X=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ye=/[\\^$.*+?()[\]{}|]/g,ke=/\\(\\)?/g,Te=/^\[object .+?Constructor\]$/,Le=/^(?:0|[1-9]\d*)$/,Re={};Re[R]=Re[N]=Re[G]=Re[ee]=Re[oe]=Re[re]=Re[J]=Re[le]=Re[V]=!0,Re[u]=Re[l]=Re[w]=Re[c]=Re[D]=Re[d]=Re[f]=Re[h]=Re[g]=Re[m]=Re[v]=Re[E]=Re[_]=Re[I]=Re[L]=!1;var at=typeof Nl=="object"&&Nl&&Nl.Object===Object&&Nl,kt=typeof self=="object"&&self&&self.Object===Object&&self,Qe=at||kt||Function("return this")(),At=e&&!e.nodeType&&e,dr=At&&!0&&n&&!n.nodeType&&n,$n=dr&&dr.exports===At,Gn=$n&&at.process,fr=function(){try{return Gn&&Gn.binding("util")}catch{}}(),$e=fr&&fr.isTypedArray;function Tt(x,k){for(var H=-1,ie=x?x.length:0;++H<ie&&k(x[H],H,x)!==!1;);return x}function Dt(x,k){for(var H=-1,ie=x?x.length:0;++H<ie;)if(k(x[H],H,x))return!0;return!1}function de(x){return function(k){return k==null?void 0:k[x]}}function fe(x,k){for(var H=-1,ie=Array(x);++H<x;)ie[H]=k(H);return ie}function Ye(x){return function(k){return x(k)}}function Pt(x,k){return x==null?void 0:x[k]}function Pr(x){var k=!1;if(x!=null&&typeof x.toString!="function")try{k=!!(x+"")}catch{}return k}function Ae(x){var k=-1,H=Array(x.size);return x.forEach(function(ie,Fe){H[++k]=[Fe,ie]}),H}function _n(x,k){return function(H){return x(k(H))}}function S(x){var k=-1,H=Array(x.size);return x.forEach(function(ie){H[++k]=ie}),H}var A=Array.prototype,C=Function.prototype,O=Object.prototype,j=Qe["__core-js_shared__"],$=function(){var x=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||"");return x?"Symbol(src)_1."+x:""}(),Y=C.toString,K=O.hasOwnProperty,Q=O.toString,Pe=RegExp("^"+Y.call(K).replace(ye,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=Qe.Symbol,Oe=Qe.Uint8Array,Xe=_n(Object.getPrototypeOf,Object),sn=Object.create,Xt=O.propertyIsEnumerable,ya=A.splice,va=_n(Object.keys,Object),vc=ms(Qe,"DataView"),Ea=ms(Qe,"Map"),Ec=ms(Qe,"Promise"),Tc=ms(Qe,"Set"),Sc=ms(Qe,"WeakMap"),Ta=ms(Object,"create"),mS=Vi(vc),yS=Vi(Ea),vS=Vi(Ec),ES=Vi(Tc),TS=Vi(Sc),zo=Ve?Ve.prototype:void 0,xc=zo?zo.valueOf:void 0,bp=zo?zo.toString:void 0;function Gi(x){var k=-1,H=x?x.length:0;for(this.clear();++k<H;){var ie=x[k];this.set(ie[0],ie[1])}}function SS(){this.__data__=Ta?Ta(null):{}}function xS(x){return this.has(x)&&delete this.__data__[x]}function _S(x){var k=this.__data__;if(Ta){var H=k[x];return H===i?void 0:H}return K.call(k,x)?k[x]:void 0}function AS(x){var k=this.__data__;return Ta?k[x]!==void 0:K.call(k,x)}function IS(x,k){var H=this.__data__;return H[x]=Ta&&k===void 0?i:k,this}Gi.prototype.clear=SS,Gi.prototype.delete=xS,Gi.prototype.get=_S,Gi.prototype.has=AS,Gi.prototype.set=IS;function Cr(x){var k=-1,H=x?x.length:0;for(this.clear();++k<H;){var ie=x[k];this.set(ie[0],ie[1])}}function LS(){this.__data__=[]}function RS(x){var k=this.__data__,H=Yo(k,x);if(H<0)return!1;var ie=k.length-1;return H==ie?k.pop():ya.call(k,H,1),!0}function wS(x){var k=this.__data__,H=Yo(k,x);return H<0?void 0:k[H][1]}function bS(x){return Yo(this.__data__,x)>-1}function kS(x,k){var H=this.__data__,ie=Yo(H,x);return ie<0?H.push([x,k]):H[ie][1]=k,this}Cr.prototype.clear=LS,Cr.prototype.delete=RS,Cr.prototype.get=wS,Cr.prototype.has=bS,Cr.prototype.set=kS;function Nr(x){var k=-1,H=x?x.length:0;for(this.clear();++k<H;){var ie=x[k];this.set(ie[0],ie[1])}}function DS(){this.__data__={hash:new Gi,map:new(Ea||Cr),string:new Gi}}function PS(x){return qo(this,x).delete(x)}function CS(x){return qo(this,x).get(x)}function NS(x){return qo(this,x).has(x)}function OS(x,k){return qo(this,x).set(x,k),this}Nr.prototype.clear=DS,Nr.prototype.delete=PS,Nr.prototype.get=CS,Nr.prototype.has=NS,Nr.prototype.set=OS;function Wo(x){var k=-1,H=x?x.length:0;for(this.__data__=new Nr;++k<H;)this.add(x[k])}function MS(x){return this.__data__.set(x,i),this}function FS(x){return this.__data__.has(x)}Wo.prototype.add=Wo.prototype.push=MS,Wo.prototype.has=FS;function Or(x){this.__data__=new Cr(x)}function US(){this.__data__=new Cr}function BS(x){return this.__data__.delete(x)}function $S(x){return this.__data__.get(x)}function GS(x){return this.__data__.has(x)}function VS(x,k){var H=this.__data__;if(H instanceof Cr){var ie=H.__data__;if(!Ea||ie.length<t-1)return ie.push([x,k]),this;H=this.__data__=new Nr(ie)}return H.set(x,k),this}Or.prototype.clear=US,Or.prototype.delete=BS,Or.prototype.get=$S,Or.prototype.has=GS,Or.prototype.set=VS;function jS(x,k){var H=Mr(x)||Fp(x)?fe(x.length,String):[],ie=H.length,Fe=!!ie;for(var Se in x)K.call(x,Se)&&!(Fe&&(Se=="length"||Cp(Se,ie)))&&H.push(Se);return H}function Yo(x,k){for(var H=x.length;H--;)if(Mp(x[H][0],k))return H;return-1}function HS(x){return ys(x)?sn(x):{}}var KS=sx();function zS(x,k){return x&&KS(x,k,Jo)}function kp(x,k){k=Xo(k,x)?[k]:Dp(k);for(var H=0,ie=k.length;x!=null&&H<ie;)x=x[Zo(k[H++])];return H&&H==ie?x:void 0}function WS(x){return Q.call(x)}function YS(x,k){return x!=null&&k in Object(x)}function _c(x,k,H,ie,Fe){return x===k?!0:x==null||k==null||!ys(x)&&!Qo(k)?x!==x&&k!==k:qS(x,k,_c,H,ie,Fe)}function qS(x,k,H,ie,Fe,Se){var je=Mr(x),It=Mr(k),St=l,Zt=l;je||(St=ri(x),St=St==u?v:St),It||(Zt=ri(k),Zt=Zt==u?v:Zt);var hn=St==v&&!Pr(x),pn=Zt==v&&!Pr(k),an=St==Zt;if(an&&!hn)return Se||(Se=new Or),je||Bp(x)?Pp(x,k,H,ie,Fe,Se):ax(x,k,St,H,ie,Fe,Se);if(!(Fe&a)){var Vn=hn&&K.call(x,"__wrapped__"),jn=pn&&K.call(k,"__wrapped__");if(Vn||jn){var ii=Vn?x.value():x,Fr=jn?k.value():k;return Se||(Se=new Or),H(ii,Fr,ie,Fe,Se)}}return an?(Se||(Se=new Or),ox(x,k,H,ie,Fe,Se)):!1}function XS(x,k,H,ie){var Fe=H.length,Se=Fe;if(x==null)return!Se;for(x=Object(x);Fe--;){var je=H[Fe];if(je[2]?je[1]!==x[je[0]]:!(je[0]in x))return!1}for(;++Fe<Se;){je=H[Fe];var It=je[0],St=x[It],Zt=je[1];if(je[2]){if(St===void 0&&!(It in x))return!1}else{var hn=new Or,pn;if(!(pn===void 0?_c(Zt,St,ie,s|a,hn):pn))return!1}}return!0}function ZS(x){if(!ys(x)||dx(x))return!1;var k=Ic(x)||Pr(x)?Pe:Te;return k.test(Vi(x))}function QS(x){return Qo(x)&&Lc(x.length)&&!!Re[Q.call(x)]}function JS(x){return typeof x=="function"?x:x==null?Ex:typeof x=="object"?Mr(x)?nx(x[0],x[1]):tx(x):Tx(x)}function ex(x){if(!fx(x))return va(x);var k=[];for(var H in Object(x))K.call(x,H)&&H!="constructor"&&k.push(H);return k}function tx(x){var k=lx(x);return k.length==1&&k[0][2]?Op(k[0][0],k[0][1]):function(H){return H===x||XS(H,x,k)}}function nx(x,k){return Xo(x)&&Np(k)?Op(Zo(x),k):function(H){var ie=mx(H,x);return ie===void 0&&ie===k?yx(H,x):_c(k,ie,void 0,s|a)}}function rx(x){return function(k){return kp(k,x)}}function ix(x){if(typeof x=="string")return x;if(Rc(x))return bp?bp.call(x):"";var k=x+"";return k=="0"&&1/x==-1/0?"-0":k}function Dp(x){return Mr(x)?x:hx(x)}function sx(x){return function(k,H,ie){for(var Fe=-1,Se=Object(k),je=ie(k),It=je.length;It--;){var St=je[++Fe];if(H(Se[St],St,Se)===!1)break}return k}}function Pp(x,k,H,ie,Fe,Se){var je=Fe&a,It=x.length,St=k.length;if(It!=St&&!(je&&St>It))return!1;var Zt=Se.get(x);if(Zt&&Se.get(k))return Zt==k;var hn=-1,pn=!0,an=Fe&s?new Wo:void 0;for(Se.set(x,k),Se.set(k,x);++hn<It;){var Vn=x[hn],jn=k[hn];if(ie)var ii=je?ie(jn,Vn,hn,k,x,Se):ie(Vn,jn,hn,x,k,Se);if(ii!==void 0){if(ii)continue;pn=!1;break}if(an){if(!Dt(k,function(Fr,ji){if(!an.has(ji)&&(Vn===Fr||H(Vn,Fr,ie,Fe,Se)))return an.add(ji)})){pn=!1;break}}else if(!(Vn===jn||H(Vn,jn,ie,Fe,Se))){pn=!1;break}}return Se.delete(x),Se.delete(k),pn}function ax(x,k,H,ie,Fe,Se,je){switch(H){case D:if(x.byteLength!=k.byteLength||x.byteOffset!=k.byteOffset)return!1;x=x.buffer,k=k.buffer;case w:return!(x.byteLength!=k.byteLength||!ie(new Oe(x),new Oe(k)));case c:case d:case m:return Mp(+x,+k);case f:return x.name==k.name&&x.message==k.message;case E:case I:return x==k+"";case g:var It=Ae;case _:var St=Se&a;if(It||(It=S),x.size!=k.size&&!St)return!1;var Zt=je.get(x);if(Zt)return Zt==k;Se|=s,je.set(x,k);var hn=Pp(It(x),It(k),ie,Fe,Se,je);return je.delete(x),hn;case b:if(xc)return xc.call(x)==xc.call(k)}return!1}function ox(x,k,H,ie,Fe,Se){var je=Fe&a,It=Jo(x),St=It.length,Zt=Jo(k),hn=Zt.length;if(St!=hn&&!je)return!1;for(var pn=St;pn--;){var an=It[pn];if(!(je?an in k:K.call(k,an)))return!1}var Vn=Se.get(x);if(Vn&&Se.get(k))return Vn==k;var jn=!0;Se.set(x,k),Se.set(k,x);for(var ii=je;++pn<St;){an=It[pn];var Fr=x[an],ji=k[an];if(ie)var $p=je?ie(ji,Fr,an,k,x,Se):ie(Fr,ji,an,x,k,Se);if(!($p===void 0?Fr===ji||H(Fr,ji,ie,Fe,Se):$p)){jn=!1;break}ii||(ii=an=="constructor")}if(jn&&!ii){var el=x.constructor,tl=k.constructor;el!=tl&&"constructor"in x&&"constructor"in k&&!(typeof el=="function"&&el instanceof el&&typeof tl=="function"&&tl instanceof tl)&&(jn=!1)}return Se.delete(x),Se.delete(k),jn}function qo(x,k){var H=x.__data__;return cx(k)?H[typeof k=="string"?"string":"hash"]:H.map}function lx(x){for(var k=Jo(x),H=k.length;H--;){var ie=k[H],Fe=x[ie];k[H]=[ie,Fe,Np(Fe)]}return k}function ms(x,k){var H=Pt(x,k);return ZS(H)?H:void 0}var ri=WS;(vc&&ri(new vc(new ArrayBuffer(1)))!=D||Ea&&ri(new Ea)!=g||Ec&&ri(Ec.resolve())!=y||Tc&&ri(new Tc)!=_||Sc&&ri(new Sc)!=L)&&(ri=function(x){var k=Q.call(x),H=k==v?x.constructor:void 0,ie=H?Vi(H):void 0;if(ie)switch(ie){case mS:return D;case yS:return g;case vS:return y;case ES:return _;case TS:return L}return k});function ux(x,k,H){k=Xo(k,x)?[k]:Dp(k);for(var ie,Fe=-1,je=k.length;++Fe<je;){var Se=Zo(k[Fe]);if(!(ie=x!=null&&H(x,Se)))break;x=x[Se]}if(ie)return ie;var je=x?x.length:0;return!!je&&Lc(je)&&Cp(Se,je)&&(Mr(x)||Fp(x))}function Cp(x,k){return k=k??o,!!k&&(typeof x=="number"||Le.test(x))&&x>-1&&x%1==0&&x<k}function Xo(x,k){if(Mr(x))return!1;var H=typeof x;return H=="number"||H=="symbol"||H=="boolean"||x==null||Rc(x)?!0:Z.test(x)||!W.test(x)||k!=null&&x in Object(k)}function cx(x){var k=typeof x;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?x!=="__proto__":x===null}function dx(x){return!!$&&$ in x}function fx(x){var k=x&&x.constructor,H=typeof k=="function"&&k.prototype||O;return x===H}function Np(x){return x===x&&!ys(x)}function Op(x,k){return function(H){return H==null?!1:H[x]===k&&(k!==void 0||x in Object(H))}}var hx=Ac(function(x){x=gx(x);var k=[];return q.test(x)&&k.push(""),x.replace(X,function(H,ie,Fe,Se){k.push(Fe?Se.replace(ke,"$1"):ie||H)}),k});function Zo(x){if(typeof x=="string"||Rc(x))return x;var k=x+"";return k=="0"&&1/x==-1/0?"-0":k}function Vi(x){if(x!=null){try{return Y.call(x)}catch{}try{return x+""}catch{}}return""}function Ac(x,k){if(typeof x!="function"||k&&typeof k!="function")throw new TypeError(r);var H=function(){var ie=arguments,Fe=k?k.apply(this,ie):ie[0],Se=H.cache;if(Se.has(Fe))return Se.get(Fe);var je=x.apply(this,ie);return H.cache=Se.set(Fe,je),je};return H.cache=new(Ac.Cache||Nr),H}Ac.Cache=Nr;function Mp(x,k){return x===k||x!==x&&k!==k}function Fp(x){return px(x)&&K.call(x,"callee")&&(!Xt.call(x,"callee")||Q.call(x)==u)}var Mr=Array.isArray;function Up(x){return x!=null&&Lc(x.length)&&!Ic(x)}function px(x){return Qo(x)&&Up(x)}function Ic(x){var k=ys(x)?Q.call(x):"";return k==h||k==p}function Lc(x){return typeof x=="number"&&x>-1&&x%1==0&&x<=o}function ys(x){var k=typeof x;return!!x&&(k=="object"||k=="function")}function Qo(x){return!!x&&typeof x=="object"}function Rc(x){return typeof x=="symbol"||Qo(x)&&Q.call(x)==b}var Bp=$e?Ye($e):QS;function gx(x){return x==null?"":ix(x)}function mx(x,k,H){var ie=x==null?void 0:kp(x,k);return ie===void 0?H:ie}function yx(x,k){return x!=null&&ux(x,k,YS)}function Jo(x){return Up(x)?jS(x):ex(x)}function vx(x,k,H){var ie=Mr(x)||Bp(x);if(k=JS(k),H==null)if(ie||ys(x)){var Fe=x.constructor;ie?H=Mr(x)?new Fe:[]:H=Ic(Fe)?HS(Xe(x)):{}}else H={};return(ie?Tt:zS)(x,function(Se,je,It){return k(H,Se,je,It)}),H}function Ex(x){return x}function Tx(x){return Xo(x)?de(Zo(x)):rx(x)}n.exports=vx}(Ua,Ua.exports)),Ua.exports}TP();let zi=null,yc="local-dev-room";const Zf=new URLSearchParams(window.location.search),wp=Zf.has("frame_id");if(!wp&&Zf.has("instanceId")){const n=Zf.get("instanceId");n&&(yc=n)}const Ul=()=>wp,SP=async()=>{if(!wp)return console.log("Running in browser environment. Returning mock for Web Flow."),pS();zi||(zi=new mP(h0)),await zi.ready(),zi.instanceId&&(yc=zi.instanceId);const{code:n}=await zi.commands.authorize({client_id:h0,response_type:"code",state:"",prompt:"none",scope:["identify","guilds"]}),e=await fetch("/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})});if(!e.ok)throw new Error("Failed to exchange token");const{access_token:t}=await e.json(),r=await zi.commands.authenticate({access_token:t});if(r==null)throw new Error("Authenticate command failed");return{id:r.user.id,username:r.user.username,discriminator:r.user.discriminator,avatar:r.user.avatar??null,public_flags:r.user.public_flags}},pS=()=>{const n=Math.floor(Math.random()*1e6).toString();return{id:`web-user-${n}`,username:`Guest ${n.slice(0,4)}`,discriminator:"0000",avatar:null}},Qf=()=>yc,b0=n=>{yc=n};class xP{constructor(){wc(this,"ws",null);wc(this,"onStateChange",null)}getInstanceId(){return Qf()}connect(e,t,r){this.onStateChange=t;const i=Qf(),s=window.location.protocol==="https:"?"wss:":"ws:",a=window.location.host,o=new URLSearchParams({instanceId:i,userId:e,username:(r==null?void 0:r.username)||"Guest",avatar:(r==null?void 0:r.avatar)||""});this.ws=new WebSocket(`${s}//${a}?${o.toString()}`),this.ws.onmessage=u=>{const{type:l,data:c}=JSON.parse(u.data);l==="STATE_UPDATE"&&this.onStateChange&&this.onStateChange(c)},this.ws.onclose=()=>{console.log("Sync connection closed. Reconnecting in 3s..."),setTimeout(()=>this.connect(e,t,r),3e3)}}updateState(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"UPDATE_STATE",data:e}))}transferHost(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"TRANSFER_HOST",data:{targetUserId:e}}))}}const ka=new xP,_P=()=>{const[n,e]=Ee.useState("LOADING"),[t,r]=Ee.useState(null),[i,s]=Ee.useState(null),[a,o]=Ee.useState([]),[u,l]=Ee.useState(""),[c,d]=Ee.useState({url:"",isPlaying:!1,currentTime:0,duration:0,volume:1}),[f,h]=Ee.useState(null),[p,g]=Ee.useState(!1),[m,v]=Ee.useState(!1),[y,E]=Ee.useState(null),[_,I]=Ee.useState(!0),[b,L]=Ee.useState(!1),[w,D]=Ee.useState(!1),[R,N]=Ee.useState(!1),G=Ee.useRef(null),ee=Ee.useRef(null),oe=Ee.useRef(null),re=(t==null?void 0:t.id)===i;Ee.useEffect(()=>{(async()=>{try{Ul()||pS();const fe=await SP();if(r(fe),Ul())J(fe);else{const Ye=Qf();Ye&&Ye!=="local-dev-room"?(console.log(`Web client joining specific instance: ${Ye}`),J(fe)):e("LANDING")}}catch(fe){console.error("Initialization failed:",fe),e("LANDING")}})()},[]);const J=de=>{e("APP"),l(ka.getInstanceId()),ka.connect(de.id,fe=>{s(fe.hostId||null),fe.participants&&o(fe.participants),d(Ye=>{const Pt=Ye.volume,Ae=Math.abs(Ye.currentTime-fe.currentTime)>2||!Ye.isPlaying;return Ae&&h(fe.currentTime),{...Ye,url:fe.url,isPlaying:fe.isPlaying,currentTime:Ae?fe.currentTime:Ye.currentTime,volume:Pt}})},{username:de.username,avatar:de.avatar})};Ee.useEffect(()=>{if(!re||!c.isPlaying)return;const de=setInterval(()=>{ye({currentTime:c.currentTime})},4e3);return()=>clearInterval(de)},[re,c.isPlaying,c.currentTime]);const[le,V]=Ee.useState(""),[W,Z]=Ee.useState(null),q=()=>{if(!t)return;const de=Math.random().toString(36).substring(2,10).toUpperCase();b0(de),J(t)},X=async de=>{if(de.preventDefault(),Z(null),!(!t||!le.trim())){try{const fe=await fetch(`/api/party/${le.trim()}`),Ye=await fe.json();if(!fe.ok||!Ye.exists){Z("Party not found!");return}}catch{Z("Connection failed.");return}b0(le.trim()),J(t)}},ye=de=>{if(!re)return;const{volume:fe,...Ye}=de;ka.updateState(Ye),d(Pt=>({...Pt,...de}))},ke=Ee.useCallback(de=>{if(Ul()&&(de.includes("youtube.com")||de.includes("youtu.be"))){console.warn("YouTube disabled in Discord due to Proxy issues");return}ye({url:de,isPlaying:!0,currentTime:0})},[re]),Te=Ee.useCallback(de=>{ye({isPlaying:de,currentTime:c.currentTime})},[re,c.currentTime]),Le=Ee.useCallback(de=>{h(de),ye({currentTime:de})},[re]),Re=Ee.useCallback(de=>{d(fe=>({...fe,currentTime:de}))},[]),at=Ee.useCallback(de=>{d(fe=>({...fe,duration:de}))},[]),kt=Ee.useCallback(de=>{d(fe=>({...fe,volume:de}))},[]),Qe=Ee.useCallback(()=>{D(!1),I(!0),ee.current&&window.clearTimeout(ee.current),oe.current&&window.clearTimeout(oe.current),ee.current=window.setTimeout(()=>{c.isPlaying&&I(!1)},3e3),oe.current=window.setTimeout(()=>{c.isPlaying&&D(!0)},3e3)},[c.isPlaying]),At=()=>{Qe()};Ee.useEffect(()=>(window.addEventListener("mousemove",At),window.addEventListener("touchstart",At),window.addEventListener("keydown",At),()=>{window.removeEventListener("mousemove",At),window.removeEventListener("touchstart",At),window.removeEventListener("keydown",At)}),[At]);const dr=Ee.useCallback(async()=>{if(!G.current)return;const de=document,fe=G.current,Ye=!!(de.fullscreenElement||de.webkitFullscreenElement||de.mozFullScreenElement||de.msFullscreenElement);if(m||Ye){if(Ye)try{de.exitFullscreen?await de.exitFullscreen():de.webkitExitFullscreen?await de.webkitExitFullscreen():de.mozCancelFullScreen?await de.mozCancelFullScreen():de.msExitFullscreen&&await de.msExitFullscreen()}catch{}v(!1)}else try{fe.requestFullscreen?await fe.requestFullscreen():fe.webkitRequestFullscreen?await fe.webkitRequestFullscreen():fe.mozRequestFullScreen?await fe.mozRequestFullScreen():fe.msRequestFullscreen&&await fe.msRequestFullscreen()}catch{}finally{v(!0)}},[m]);Ee.useEffect(()=>{const de=fe=>{if(fe.key==="Escape"&&m){const Ye=document;!!(Ye.fullscreenElement||Ye.webkitFullscreenElement)||v(!1)}if(re&&!(fe.target instanceof HTMLInputElement)){switch(fe.code){case"Space":fe.preventDefault(),Te(!c.isPlaying);break;case"ArrowLeft":Le(Math.max(0,c.currentTime-5));break;case"ArrowRight":Le(Math.min(c.duration,c.currentTime+5));break}Qe()}};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[re,c,Te,Le,m,Qe]);const[$n,Gn]=Ee.useState(""),[fr,$e]=Ee.useState(!1),Tt=()=>{if(!c.url)return;const de={id:Date.now().toString(),name:$n||"Untitled Video",url:c.url,timestamp:fr?c.currentTime:0,createdAt:Date.now()};try{const fe=JSON.parse(localStorage.getItem("tc_favorites")||"[]"),Ye=[de,...fe];localStorage.setItem("tc_favorites",JSON.stringify(Ye)),window.dispatchEvent(new Event("favoritesUpdated")),N(!1),Gn("")}catch(fe){console.error("Save failed",fe)}},Dt=(de,fe)=>{re&&(ye({url:de,isPlaying:!0,currentTime:0}),fe>=0&&setTimeout(()=>{h(fe),ye({currentTime:fe})},500),L(!1))};return n==="LOADING"?P.jsx("div",{className:"flex items-center justify-center h-screen bg-[#36393f] text-white",children:P.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[P.jsx("div",{className:"h-12 w-12 bg-[#5865F2] rounded-full mb-4"}),P.jsx("p",{children:"Connecting to TwinCinema..."})]})}):n==="LANDING"?P.jsx("div",{className:"flex h-screen bg-[#36393f] text-[#dcddde] items-center justify-center p-4",children:P.jsxs("div",{className:"max-w-md w-full bg-[#2f3136] p-8 rounded-xl shadow-2xl border border-[#202225] text-center",children:[P.jsx("div",{className:"flex justify-center mb-6",children:P.jsx("div",{className:"bg-[#5865F2] p-4 rounded-2xl",children:P.jsx(vp,{className:"text-white w-8 h-8"})})}),P.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"TwinCinema Web"}),P.jsx("p",{className:"text-gray-400 mb-8",children:"Watch YouTube & HLS streams together in perfect sync."}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("button",{onClick:q,className:"w-full py-3 bg-[#5865F2] hover:bg-[#4752c4] text-white font-bold rounded flex items-center justify-center gap-2 transition-colors",children:[P.jsx(_T,{size:20})," Create a Party"]}),P.jsxs("div",{className:"relative",children:[P.jsx("div",{className:"absolute inset-0 flex items-center",children:P.jsx("span",{className:"w-full border-t border-[#40444b]"})}),P.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:P.jsx("span",{className:"bg-[#2f3136] px-2 text-gray-500",children:"Or Join Existing"})})]}),P.jsxs("form",{onSubmit:X,className:"flex flex-col gap-2",children:[P.jsxs("div",{className:"flex gap-2",children:[P.jsx("input",{type:"text",placeholder:"Enter Party Code...",className:`flex-1 bg-[#202225] border ${W?"border-red-500":"border-[#202225]"} rounded px-4 py-2 text-white focus:outline-none focus:border-[#5865F2]`,value:le,onChange:de=>{V(de.target.value),Z(null)}}),P.jsx("button",{type:"submit",disabled:!le,className:"px-4 bg-[#40444b] hover:bg-[#36393f] text-white rounded font-medium disabled:opacity-50 transition-colors",children:P.jsx(ob,{})})]}),W&&P.jsx("p",{className:"text-red-400 text-xs text-left ml-1 font-bold",children:W})]})]})]})}):P.jsxs("div",{className:"flex h-screen bg-[#36393f] text-[#dcddde] overflow-hidden font-sans relative",children:[P.jsx("button",{onClick:()=>L(!0),className:`lg:hidden fixed top-4 left-4 z-50 p-2 bg-black/50 text-white rounded backdrop-blur-sm transition-opacity duration-300 ${w?"opacity-0 pointer-events-none":"opacity-100"}`,children:P.jsx(gb,{size:24})}),!m&&P.jsx(xb,{user:t,participants:a,hostId:i,onPromoteUser:(de,fe)=>E({isOpen:!0,targetId:de,targetName:fe}),isOpen:b,onClose:()=>L(!1),onPlayLibraryItem:Dt}),P.jsxs("div",{className:"flex-1 flex flex-col min-w-0 relative",children:[!m&&P.jsx("div",{className:`transition-opacity duration-300 ${w?"opacity-0":"opacity-100"}`,children:P.jsx(Sb,{isHost:re,partyCode:u})}),P.jsx("main",{className:`flex-1 flex flex-col ${m?"p-0":"p-4"} overflow-y-auto`,children:P.jsxs("div",{ref:G,className:`flex-1 flex flex-col bg-black overflow-hidden shadow-2xl relative group select-none ${m?"rounded-none w-full h-full":"rounded-xl"}`,onMouseMove:Qe,onMouseLeave:()=>c.isPlaying&&I(!1),children:[P.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black",children:c.url?P.jsxs(P.Fragment,{children:[P.jsx(eb,{url:c.url,isPlaying:c.isPlaying,volume:c.volume,seekTime:f,onTimeUpdate:Re,onDurationChange:at,onEnded:()=>Te(!1),onBuffer:g}),P.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center z-10",children:p?P.jsx("div",{className:"bg-black/40 p-4 rounded-full backdrop-blur-sm",children:P.jsx(pb,{size:48,className:"text-white animate-spin"})}):c.isPlaying?null:P.jsx("div",{className:"bg-black/40 p-6 rounded-full backdrop-blur-sm animate-in fade-in zoom-in duration-200",children:P.jsx(ST,{size:48,className:"text-white fill-white"})})})]}):P.jsxs("div",{className:"text-center p-8 text-gray-500 z-0",children:[P.jsx("p",{className:"text-lg font-medium",children:"No video loaded"}),re?P.jsx("p",{className:"text-sm",children:"Enter a YouTube or .m3u8 link to start."}):P.jsx("p",{className:"text-sm",children:"Waiting for Host to select a video..."}),!Ul()&&P.jsxs("div",{className:"mt-6 bg-[#202225] p-2 rounded inline-block",children:[P.jsx("span",{className:"text-xs uppercase font-bold text-gray-400 mr-2",children:"Party Code:"}),P.jsx("span",{className:"text-white font-mono font-bold select-all tracking-widest",children:ka.getInstanceId()})]})]})}),P.jsx("div",{className:`transition-opacity duration-300 ${w?"opacity-0":"opacity-100"}`,children:re?P.jsx(Tb,{videoState:c,showControls:_||!c.url,isFullscreen:m,onPlayPause:Te,onUrlSubmit:ke,onSeek:Le,onVolumeChange:kt,onToggleFullscreen:dr,onOpenSaveModal:()=>N(!0)}):P.jsx("div",{className:`absolute bottom-0 left-0 right-0 p-4 transition-opacity duration-300 ${_?"opacity-100":"opacity-0"} bg-gradient-to-t from-black/80 to-transparent z-20`,children:P.jsxs("div",{className:"flex justify-between items-center",children:[P.jsxs("div",{className:"flex gap-2 items-center",children:[P.jsxs("div",{className:"text-xs text-yellow-400 flex items-center gap-1 bg-yellow-400/10 px-2 py-1 rounded",children:[P.jsx(yp,{size:12}),P.jsx("span",{children:"Spectator Mode"})]}),P.jsx("div",{className:"text-xs text-gray-300 font-mono",children:new Date(c.currentTime*1e3).toISOString().substr(14,5)})]}),P.jsxs("div",{className:"flex items-center gap-3",children:[P.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:c.volume,onChange:de=>kt(parseFloat(de.target.value)),className:"w-20 h-1 bg-white/30 rounded-lg appearance-none cursor-pointer hover:bg-white",onClick:de=>de.stopPropagation()}),P.jsx("button",{onClick:()=>N(!0),disabled:!c.url,className:`p-2 hover:bg-white/10 rounded-full ${c.url?"text-yellow-400 hover:text-yellow-300":"text-gray-500 cursor-not-allowed"}`,title:"Save to Library",children:P.jsx(xT,{size:20,fill:c.url?"currentColor":"none"})}),P.jsx("button",{onClick:dr,className:"text-white hover:text-gray-200",children:m?P.jsx(TT,{size:20}):P.jsx(ET,{size:20})})]})]})})})]})})]}),R&&P.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:P.jsxs("div",{className:"bg-[#36393f] p-6 rounded-lg shadow-2xl w-full max-w-sm border border-[#202225] animate-in fade-in zoom-in-95 duration-200",children:[P.jsxs("div",{className:"flex justify-between items-center mb-4",children:[P.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[P.jsx(mb,{size:18,className:"text-yellow-400"})," Name this save?"]}),P.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-white",children:P.jsx(AT,{size:20})})]}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{children:[P.jsx("label",{className:"text-xs text-gray-400 uppercase font-bold mb-1 block",children:"Name"}),P.jsx("input",{type:"text",autoFocus:!0,placeholder:"My awesome video...",className:"w-full bg-[#202225] text-white p-2 rounded focus:outline-none focus:ring-1 focus:ring-[#5865F2]",value:$n,onChange:de=>Gn(de.target.value)})]}),P.jsxs("div",{className:"flex items-center justify-between p-2 bg-[#2f3136] rounded border border-[#202225]",children:[P.jsx("span",{className:"text-sm text-gray-300",children:"Save Timestamp?"}),P.jsx("button",{onClick:()=>$e(!fr),className:`w-10 h-5 rounded-full relative transition-colors ${fr?"bg-green-500":"bg-gray-500"}`,children:P.jsx("div",{className:`absolute top-1 w-3 h-3 bg-white rounded-full transition-transform ${fr?"left-6":"left-1"}`})})]}),P.jsx("button",{onClick:Tt,className:"w-full py-2 bg-[#5865F2] hover:bg-[#4752c4] text-white rounded font-bold transition-colors",children:"Save"})]})]})}),y&&P.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:P.jsxs("div",{className:"bg-[#36393f] p-6 rounded-lg shadow-2xl max-w-sm w-full border border-[#202225] animate-in fade-in zoom-in-95 duration-200",children:[P.jsxs("div",{className:"flex items-center gap-3 text-yellow-500 mb-4",children:[P.jsx(ab,{size:24}),P.jsx("h2",{className:"text-lg font-bold text-white",children:"Transfer Host?"})]}),P.jsxs("p",{className:"text-gray-300 text-sm mb-6",children:["Make ",P.jsx("span",{className:"font-bold text-white",children:y.targetName})," the Host? You will lose control."]}),P.jsxs("div",{className:"flex justify-end gap-3",children:[P.jsx("button",{onClick:()=>E(null),className:"px-4 py-2 text-sm rounded hover:bg-[#40444b] text-gray-300",children:"Cancel"}),P.jsx("button",{onClick:()=>{y&&(ka.transferHost(y.targetId),E(null))},className:"px-4 py-2 text-sm bg-yellow-600 hover:bg-yellow-700 text-white rounded font-medium shadow-lg",children:"Confirm"})]})]})})]})},gS=document.getElementById("root");if(!gS)throw new Error("Could not find root element to mount to");const AP=kd.createRoot(gS);AP.render(P.jsx(Bx.StrictMode,{children:P.jsx(_P,{})}));
